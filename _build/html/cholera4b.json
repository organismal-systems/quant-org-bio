{"version":3,"kind":"Notebook","sha256":"b7c8c2e78a10ea99a891084d4652400016ab41a1aa410f62df6272b62336e4bb","slug":"cholera4b","location":"/subrepos/demography/KoelleCholera/cholera4b.ipynb","dependencies":[],"frontmatter":{"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"nameParsed":{"literal":"Daniel Grünbaum","given":"Daniel","family":"Grünbaum"},"name":"Daniel Grünbaum","affiliations":["School of Oceanography, University of Washington"],"id":"contributors-myst-generated-uid-0"}],"license":{"content":{"id":"CC-BY-NC-SA-4.0","url":"https://creativecommons.org/licenses/by-nc-sa/4.0/","name":"Creative Commons Attribution Non Commercial Share Alike 4.0 International","CC":true}},"github":"https://github.com/organismal-systems/quant-org-bio","keywords":["models"],"copyright":"2025","affiliations":[{"id":"School of Oceanography, University of Washington","name":"School of Oceanography, University of Washington"}],"numbering":{"title":{"offset":2}},"source_url":"https://github.com/organismal-systems/quant-org-bio/blob/main/subrepos/demography/KoelleCholera/cholera4b.ipynb","edit_url":"https://github.com/organismal-systems/quant-org-bio/edit/main/subrepos/demography/KoelleCholera/cholera4b.ipynb","exports":[{"format":"ipynb","filename":"cholera4b.ipynb","url":"/build/cholera4b-9de45b8b12a4bf30457c97ee3e0f29c7.ipynb"}]},"widgets":{"application/vnd.jupyter.widget-state+json":{"state":{},"version_major":2,"version_minor":0}},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\nfrom math import pi, cos, sin, erfc\nplot_prefix = \"Cholera_plot%d\" % (int(10000.*np.random.uniform()))\nglobal nyears_,beta_t_\n\nplt.ion()","visibility":"show","key":"alHBcUdhmm"},{"type":"outputs","id":"sSoq33EzYzsEtwsiXfyYN","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":1,"metadata":{},"data":{"text/plain":{"content":"<contextlib.ExitStack at 0x7cb75cd30bf0>","content_type":"text/plain"}}},"children":[],"key":"CHbgtfMd7q"}],"visibility":"show","key":"LVERggeN62"}],"visibility":"show","key":"p0KSUGa9Xz"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"#def _(nyears = input_box(default=30, label = 'Number of years, $n_{years}$'),\n#      season = input_box(default=1., label = 'Seasonal variability, $c$'),\n#      climate = input_box(default=1.5, label = 'Climatic variability, $b$'),\n#      show_season=checkbox(default=True,label = \"Show seasonal transmission\"),\n#      show_climate=checkbox(default=True,label = \"Show climatic transmission\")):\n\ndef plot_transmission(nyears = 3,season = 1.,climate=1.5,verbose=False):\n    global nyears_,beta_t_\n    # We actually calculate in months... \n    nyears_=nyears\n    nmonths=12*nyears\n    \n    # Temporally varying transmission rate\n    beta_season=[1.+season*q*(0.1e1-cos(pi*q/0.3e1))/0.8e1 for q in np.arange(1,13)]\n    beta_season.reverse()\n    #beta_season= [1.+q*(0.1e1-cos(fpi*q/0.3e1))/0.2e1 for q in np.arange(1,13)]\n    for i in range(12):\n        beta_season[i]=beta_season[i]/beta_season[-1]\n\n    #b0=10.\n    climate=max(climate,0.)\n    beta_long_term=[q for q in np.linspace(1.5,climate,round(nmonths/2))]\n    beta_long_term.extend([q for q in np.linspace(climate,1.5,round(nmonths/2))])\n    beta_t=[beta_long_term[i]*beta_season[i % 11] for i in range(nmonths)]\n    beta_t_=beta_t\n\n    if verbose:\n        print('beta_season = ',beta_season)\n        print('beta_long_term = ',beta_long_term)\n        print('beta_t = ',beta_t)\n        \n    # create figure and subpolts\n    fig=plt.figure()  #figsize=(20,12))\n    # plot seasonal variation in transmission\n    ax1=fig.add_subplot(311)\n    ax1.plot(np.arange(1,13),beta_season,'r-',label='Seasonal Trans. rate, $\\\\beta_{season}$')\n    #ax1.set_xlabel(r'Months')\n    ax1.set_ylabel(r'$\\beta_{season}$')\n    \n    ax2=fig.add_subplot(312)\n    ax2.plot(beta_long_term,'b-',label='Climatic Trans. rate,$\\\\beta_{climate}$')\n    #ax2.set_xlabel(r'Months')\n    ax2.set_ylabel(r'$\\beta_{climate}$')\n\n    ax3=fig.add_subplot(313)\n    ax3.plot(range(nmonths),beta_t,'k-',label='Total Trans. rate, $\\\\beta_t$')\n    ax3.set_xlabel(r'Months')\n    ax3.set_ylabel(r'$\\beta_{t}$')\n    #show(trans_plot,gridlines=True)","visibility":"show","key":"RoezoFKeis"},{"type":"outputs","id":"0RidXW786tTGjaOG9_OKV","children":[],"visibility":"show","key":"w3E3hZnZmF"}],"visibility":"show","key":"hbY0EvcrnL"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"plot_transmission(nyears=10,climate=5)","visibility":"show","key":"VOknUlFMBo"},{"type":"outputs","id":"KBOag5kH1ABpgB-PlD0u4","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"259ed269d2c9273c9639e70038f1a03c","path":"/build/259ed269d2c9273c9639e70038f1a03c.png"},"text/plain":{"content":"<Figure size 640x480 with 3 Axes>","content_type":"text/plain"}}},"children":[],"key":"yir02YA8vv"}],"visibility":"show","key":"CQBIUmRGN5"}],"visibility":"show","key":"IBtJUZGSB5"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"#def _(Nint = input_box(default=200000, label = 'Population, $N$'),\n#      alpha = input_box(default=.57, label='$\\\\alpha$'),\n#      gamma_ = input_box(default=1., label='$\\gamma$'),\n#      epsilon = slider(0.,1.,0.025,0.,label='Noise'),\n#      #epsilon = slider(0.,1.,0.025,0.995,label='Noise'),\n#      Iinit_frac = input_box(default=.0001, label='Init. fraction infected'),\n#      asymptom = input_box(default=25, label='Asymptomatic ratio, $A$'),\n#      t_immunity = input_box(default=12, label='$t_{immunity}$ (mos.)'),\n#      frac_vacc = slider(0.,1.,0.025,0.,label='$f_{vaccinated}$'),\n#      show_legend=checkbox(default=True,label = \"Show legends\"),\n#      show_immunity=checkbox(default=True,label = \"Show immunity\")):\n    \ndef plot_caseload(Nint=200000,alpha=.57,gamma_=1.,epsilon = 0.,Iinit_frac=.0001,\n                  asymptom=25,t_immunity=12,frac_vacc=0.,\n                  show_legend=True,show_immunity=True):\n    global nyears_,beta_t_\n    nyears=nyears_\n    beta_t=beta_t_\n    # We actually calculate in months... \n    nmonths=12*nyears\n    # We want population as a float\n    N=float(Nint)\n    \n    # Noise\n    eps_t=1.+np.random.uniform(low=-epsilon, high=epsilon, size=nmonths)\n    #eps_t=1.-epsilon*2.*epsilon*np.random.uniform(low=0.0, high=1.0, size=nmonths)\n\n\n    #  kappa contains the fractional loss of immunity\n    #t_immunity=12 # Period over which immunity declines (in months)\n    #kappa=[asymptom*q for q in np.linspace(1.,0.,t_immunity)]\n    kappa=[asymptom*0.5*(erfc(q)+0.) for q in np.linspace(-2.,2.,t_immunity)]\n\n    #  Create arrays to hold population categories\n    S=[0. for i in range(nmonths)]\n    I=[0. for i in range(nmonths+1)]\n    R=[0. for i in range(nmonths)]\n    years=[q/12. for q in np.arange(nmonths)]\n\n    #  Initial conditions\n    I[0]=Iinit_frac*N  #  Initial infecteds\n    S[0]=(1.-frac_vacc)*(N-I[0])  #  Initial susceptibles\n    R[0]=0.  # Initial resistants\n\n    for t in range(1,nmonths):\n    #for t in range(0,nmonths):\n        # Calculate the corresponding months\n        t_past=[q for q in range(t-t_immunity,t-1) if q>0]\n        #kappa_I=[I[tt]*kappa[t-tt] for tt in t_past]\n        #print t,t_past,[t-tt-1 for tt in t_past]\n        sum_kappa_I=sum([I[tt]*kappa[t-tt-1] for tt in t_past])\n        S[t]=(1.-frac_vacc)*(N-sum_kappa_I)\n        #S[t]=N-sum_kappa_I\n        R[t]=N-S[t]\n        I[t]=beta_t[t]*I[t-1]**alpha*(S[t]/N)**gamma_*eps_t[t]\n        #print t,sum_kappa_I\n\n    #==============================================================\n    #  Use pyplot to create a plot with dual y axes -- code modified from http://ask.sagemath.org/question/1000/two-y-axes\n    #\n    fig2 = plt.figure()\n    # Create the first Y-axis on the left by default and\n    # plot the first curve associated to the left Y-axis\n    ax3 = fig2.add_subplot(111)\n    ln3 = ax3.plot(years,I[0:-1], '-', color='red',label='Infected, $I(t)$')\n    ax3.set_ylabel('# Individuals', color='black')\n    #ax1.set_ylabel(ylabel='\\# Individuals', color='black')\n    #ax1.set_ylabel(ylabel='\\# Individuals', color='red')\n\n    # Paint the tick labels on the left Y-axis in red \n    # to match the color of a curve\n    for tl in ax3.get_yticklabels():\n        tl.set_color('red')\n\n    # Create the second Y-axis on the right and\n    # plot the second curve associated to the right Y-axis\n    ax4 = ax3.twinx()\n    ln4 = ax4.plot(years,S, '-', color='blue',label='Susceptible, $S(t)$')\n    ax4.set_ylim([0,N])\n    #ax2.set_ylabel(ylabel='\\# Individuals', color='blue')\n\n    # Paint the tick labels on the left Y-axis in blue \n    # to match the color of a curve\n    for tl in ax4.get_yticklabels():\n        tl.set_color('blue')\n\n    # Create the vertical and horizontal grid lines\n    ax3.xaxis.grid(color='grey', linestyle='--', linewidth=0.5)\n    ax3.yaxis.grid(color='grey', linestyle='--', linewidth=0.5)\n    #ax3.legend(handles=[ln3,ln4])\n    ax3.legend(loc=(0.0625,0.75))\n    ax4.legend(loc=(0.65,0.75))\n    #ax4.legend(loc=2)\n    \n    # Set range in time\n    plt.xlim([0.,nyears])\n    plt.xlabel('Year')\n    #if show_legend is True:\n     #   # Create a combined legend\n     #   lns=ln1+ln2\n     #   labs=[l.get_label() for l in lns]\n     #   ax3.legend(lns, labs, loc=0)\n\n    # Save the figure (to see it in Sage)\n    #plt.savefig(plot_prefix+'_comb.png')\n    #fig.show()\n\n    #show(I_plot+S_plot+R_plot)\n    fig3 = plt.figure()\n    ax5 = fig3.add_subplot(111)\n    ax5.plot(kappa,'-',label='Immunity after $i$ mos., $\\kappa_{i}$')\n    ax5.set_xlabel(r'Months')\n    ax5.set_ylabel(r'$\\kappa_{i}$')\n        #show(imm_plot,gridlines=True)\n    # Some textual output\n    print('Total number of cholera cases =',sum(I))\n    print('Average monthly cholera cases =',sum(I)/len(I)) #mean(I))\n    print('Average fraction of population that is susceptible =',sum(S)/(len(S)*N)) #mean(S)/N)\n    #print('Average transmission rate =',mean([beta_t))\n    print('Average transmission rate =',np.mean([beta_t[t]*eps_t[t] for t in range(1,nmonths)]))","visibility":"show","key":"i6LOoQRXHv"},{"type":"outputs","id":"F5csz_JLmfRDc-k0uPsXA","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"<>:111: SyntaxWarning: invalid escape sequence '\\k'\n<>:111: SyntaxWarning: invalid escape sequence '\\k'\n/tmp/ipykernel_182324/744422039.py:111: SyntaxWarning: invalid escape sequence '\\k'\n  ax5.plot(kappa,'-',label='Immunity after $i$ mos., $\\kappa_{i}$')\n"},"children":[],"key":"Z09H2cycy3"}],"visibility":"show","key":"I9VNPWg74x"}],"visibility":"show","key":"yrEU45h2x5"},{"type":"block","kind":"notebook-code","data":{"collapsed":false,"jupyter":{"outputs_hidden":false}},"children":[{"type":"code","lang":"python","executable":true,"value":"plot_caseload()","key":"D64lvyXbbu"},{"type":"outputs","id":"akgq3fphxwBar8nRG_B2u","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Total number of cholera cases = 6510.862912454572\nAverage monthly cholera cases = 53.80878440045101\nAverage fraction of population that is susceptible = 0.9664155346228338\nAverage transmission rate = 5.5859396600115625\n"},"children":[],"key":"bYhJ8Sqh9E"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"e2317bf3a6f41661750f4ae29b00c6df","path":"/build/e2317bf3a6f41661750f4ae29b00c6df.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"UZsskvkpzv"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"780fd8dbaa5c4f33258d9e92801b9d0f","path":"/build/780fd8dbaa5c4f33258d9e92801b9d0f.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"DoN5DCt8Ei"}],"key":"pk9aLb0eYj"}],"key":"Pm6HsqFn63"}],"key":"PpYDdTexwU"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Understanding life history dynamics in structured populations with a stage-within-age matrix model","url":"/croaker","group":"Demography"},"next":{"title":"Spiror","url":"/spiror","group":"Demography"}}},"domain":"http://localhost:3002"}