{"version":3,"kind":"Notebook","sha256":"344f248536e9343151067b677cfdae9fbfbdbc85a8d1e4da7acaac03007fe8ab","slug":"wolfsheeppersist","location":"/subrepos/spatial-dynamics/MesaWolfSheep/WolfSheepPersist.ipynb","dependencies":[],"frontmatter":{"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"nameParsed":{"literal":"Daniel Gr√ºnbaum","given":"Daniel","family":"Gr√ºnbaum"},"name":"Daniel Gr√ºnbaum","affiliations":["School of Oceanography, University of Washington"],"id":"contributors-myst-generated-uid-0"}],"license":{"content":{"id":"CC-BY-NC-SA-4.0","url":"https://creativecommons.org/licenses/by-nc-sa/4.0/","name":"Creative Commons Attribution Non Commercial Share Alike 4.0 International","CC":true}},"github":"https://github.com/organismal-systems/quant-org-bio","keywords":["models"],"copyright":"2025","affiliations":[{"id":"School of Oceanography, University of Washington","name":"School of Oceanography, University of Washington"}],"numbering":{"title":{"offset":2}},"source_url":"https://github.com/organismal-systems/quant-org-bio/blob/main/subrepos/spatial-dynamics/MesaWolfSheep/WolfSheepPersist.ipynb","edit_url":"https://github.com/organismal-systems/quant-org-bio/edit/main/subrepos/spatial-dynamics/MesaWolfSheep/WolfSheepPersist.ipynb","exports":[{"format":"ipynb","filename":"WolfSheepPersist.ipynb","url":"/build/WolfSheepPersist-419e2ac0d14e677a47c936cfe1f21e49.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","data":{"jupyter":{"source_hidden":true}},"children":[{"type":"code","lang":"python","executable":true,"value":"import math\nimport ipywidgets as widgets\nfrom agents import GrassPatch, Sheep, Wolf\nfrom mesa import Model\nfrom mesa.datacollection import DataCollector\nfrom mesa.discrete_space import OrthogonalVonNeumannGrid\nfrom mesa.experimental.devs import ABMSimulator\nfrom mesa.visualization import (\n    CommandConsole,\n    Slider,\n    SolaraViz,\n    SpaceRenderer,\n    make_plot_component,\n)\nfrom mesa.visualization.components import AgentPortrayalStyle","key":"iOMR0pPC20"},{"type":"outputs","id":"FYIEGyanvr1otkd2pWHDT","children":[],"key":"yykp7ExCG1"}],"key":"FAmbRT0rTc"},{"type":"block","kind":"notebook-code","data":{"jupyter":{"source_hidden":true}},"children":[{"type":"code","lang":"python","executable":true,"value":"LabelGrid = widgets.Label(value=r\"\\(\\textbf{Grid Properties}\\)\",\n                         layout=widgets.Layout(display=\"flex\", \n                                               #justify_content=\"center\", \n                                               width=\"100%\"))\nmark_size=widgets.FloatText(value=50,width=20,description = r\"Marker Size\")\ngrid_width=widgets.FloatText(value=20,description = \"Width\")\ngrid_height=widgets.FloatText(value=20,description = \"Height\")\n\nui1 = widgets.VBox([LabelGrid,mark_size,grid_width,grid_height])\ndisplay(ui1)","key":"tXYe3gvqxz"},{"type":"outputs","id":"w1PAa0lD376CdQy9j0QAS","children":[],"key":"KONpSyxBeF"}],"key":"TLHUCAqaBh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"","key":"g2ejVuBBDQ"},{"type":"outputs","id":"7GZS-Kwmi0YAVZTD7zJrM","children":[],"key":"LaXZ4CVlQ9"}],"key":"jMJ0XBwFrN"},{"type":"block","kind":"notebook-code","data":{"jupyter":{"source_hidden":true}},"children":[{"type":"code","lang":"python","executable":true,"value":"def wolf_sheep_portrayal(agent,marker_size=int(mark_size.value)):\n    if agent is None:\n        return\n\n    portrayal = AgentPortrayalStyle(\n        size=marker_size,\n        marker=\"o\",\n        zorder=2,\n    )\n\n    if isinstance(agent, Wolf):\n        portrayal.update((\"color\", \"black\"))\n    elif isinstance(agent, Sheep):\n        portrayal.update((\"color\", \"white\"))\n    elif isinstance(agent, GrassPatch):\n        if agent.fully_grown:\n            portrayal.update((\"color\", \"tab:green\"))\n        else:\n            portrayal.update((\"color\", \"tab:brown\"))\n        portrayal.update((\"marker\", \"s\"), (\"size\", 125), (\"zorder\", 1))\n\n    return portrayal\n\n\nmodel_params = {\n    \"seed\": {\n        \"type\": \"InputText\",\n        \"value\": 42,\n        \"label\": \"Random Seed\",\n    },\n    \"grass\": {\n        \"type\": \"Select\",\n        \"value\": True,\n        \"values\": [True, False],\n        \"label\": \"grass regrowth enabled?\",\n    },\n    \"grass_regrowth_time\": Slider(\"Grass Regrowth Time\", 20, 1, 50),\n    \"initial_sheep\": Slider(\"Initial Sheep Population\", 100, 10, 300),\n    \"sheep_reproduce\": Slider(\"Sheep Reproduction Rate\", 0.04, 0.01, 1.0, 0.01),\n    \"initial_wolves\": Slider(\"Initial Wolf Population\", 10, 5, 100),\n    \"wolf_reproduce\": Slider(\n        \"Wolf Reproduction Rate\",\n        0.05,\n        0.01,\n        1.0,\n        0.01,\n    ),\n    \"wolf_gain_from_food\": Slider(\"Wolf Gain From Food Rate\", 20, 1, 50),\n    \"sheep_gain_from_food\": Slider(\"Sheep Gain From Food\", 4, 1, 10),\n}\n\n\ndef post_process_space(ax):\n    ax.set_aspect(\"equal\")\n    ax.set_xticks([])\n    ax.set_yticks([])\n\n\ndef post_process_lines(ax):\n    ax.legend(loc=\"center left\", bbox_to_anchor=(1, 0.9))\n\n\nlineplot_component = make_plot_component(\n    {\"Wolves\": \"black\", \"Sheep\": \"tab:gray\", \"Grass\": \"tab:green\"},\n    post_process=post_process_lines,\n)\n\nclass WolfSheep(Model):\n    \"\"\"Wolf-Sheep Predation Model.\n\n    A model for simulating wolf and sheep (predator-prey) ecosystem modelling.\n    \"\"\"\n\n    description = (\n        \"A model for simulating wolf and sheep (predator-prey) ecosystem modelling.\"\n    )\n\n    def __init__(\n        self,\n        width=int(grid_height.value),\n        height=int(grid_width.value),\n        initial_sheep=100,\n        initial_wolves=50,\n        sheep_reproduce=0.04,\n        wolf_reproduce=0.05,\n        wolf_gain_from_food=20,\n        grass=True,\n        grass_regrowth_time=30,\n        sheep_gain_from_food=4,\n        seed=None,\n        simulator: ABMSimulator = None,\n    ):\n        \"\"\"Create a new Wolf-Sheep model with the given parameters.\n\n        Args:\n            height: Height of the grid\n            width: Width of the grid\n            initial_sheep: Number of sheep to start with\n            initial_wolves: Number of wolves to start with\n            sheep_reproduce: Probability of each sheep reproducing each step\n            wolf_reproduce: Probability of each wolf reproducing each step\n            wolf_gain_from_food: Energy a wolf gains from eating a sheep\n            grass: Whether to have the sheep eat grass for energy\n            grass_regrowth_time: How long it takes for a grass patch to regrow\n                                once it is eaten\n            sheep_gain_from_food: Energy sheep gain from grass, if enabled\n            seed: Random seed\n            simulator: ABMSimulator instance for event scheduling\n        \"\"\"\n        super().__init__(seed=seed)\n        self.simulator = simulator\n        self.simulator.setup(self)\n\n        # Initialize model parameters\n        self.height = height\n        self.width = width\n        self.grass = grass\n\n        # Create grid using experimental cell space\n        self.grid = OrthogonalVonNeumannGrid(\n            [self.height, self.width],\n            torus=True,\n            capacity=math.inf,\n            random=self.random,\n        )\n\n        # Set up data collection\n        model_reporters = {\n            \"Wolves\": lambda m: len(m.agents_by_type[Wolf]),\n            \"Sheep\": lambda m: len(m.agents_by_type[Sheep]),\n        }\n        if grass:\n            model_reporters[\"Grass\"] = lambda m: len(\n                m.agents_by_type[GrassPatch].select(lambda a: a.fully_grown)\n            )\n\n        self.datacollector = DataCollector(model_reporters)\n\n        # Create sheep:\n        Sheep.create_agents(\n            self,\n            initial_sheep,\n            energy=self.rng.random((initial_sheep,)) * 2 * sheep_gain_from_food,\n            p_reproduce=sheep_reproduce,\n            energy_from_food=sheep_gain_from_food,\n            cell=self.random.choices(self.grid.all_cells.cells, k=initial_sheep),\n        )\n        # Create Wolves:\n        Wolf.create_agents(\n            self,\n            initial_wolves,\n            energy=self.rng.random((initial_wolves,)) * 2 * wolf_gain_from_food,\n            p_reproduce=wolf_reproduce,\n            energy_from_food=wolf_gain_from_food,\n            cell=self.random.choices(self.grid.all_cells.cells, k=initial_wolves),\n        )\n\n        # Create grass patches if enabled\n        if grass:\n            possibly_fully_grown = [True, False]\n            for cell in self.grid:\n                fully_grown = self.random.choice(possibly_fully_grown)\n                countdown = (\n                    0 if fully_grown else self.random.randrange(0, grass_regrowth_time)\n                )\n                GrassPatch(self, countdown, grass_regrowth_time, cell)\n\n        # Collect initial data\n        self.running = True\n        self.datacollector.collect(self)\n\n    def step(self):\n        \"\"\"Execute one step of the model.\"\"\"\n        # First activate all sheep, then all wolves, both in random order\n        self.agents_by_type[Sheep].shuffle_do(\"step\")\n        self.agents_by_type[Wolf].shuffle_do(\"step\")\n\n        # Collect data\n        self.datacollector.collect(self)\n\n\nsimulator = ABMSimulator()\n# NOTE: the width and height arguments in SolaraViz appear to be reversed in their effect on the displayed grid\n#wolfsheep = WolfSheep(simulator=simulator, grass=True,width=int(grid_height.value),height=int(grid_width.value))\n#model = wolfsheep()\nmodel = WolfSheep(simulator=simulator, grass=True)\n\n#class WolfSheep2(WolfSheep):\n#    def __init__(self):\n#        super().__init__(simulator=simulator, grass=True,width=int(grid_height.value),height=int(grid_width.value))\n#        pass\n#model = WolfSheep()\n\nrenderer = SpaceRenderer(\n    model,\n    backend=\"matplotlib\",\n)\nrenderer.draw_agents(wolf_sheep_portrayal)\nrenderer.post_process = post_process_space\n\npage = SolaraViz(\n    model,\n    renderer,\n    components=[lineplot_component, CommandConsole],\n    model_params=model_params,\n    name=\"Wolf Sheep\",\n    simulator=simulator,\n)\npage  # noqa","key":"bWklVrV41D"},{"type":"outputs","id":"R4L1nvyvcped_WfgAfDA3","children":[],"key":"S4mtGIjs5X"}],"key":"XhqKEdnjFr"}],"key":"l8X9SX6mjD"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"FS L2 D","url":"/fsl2d","group":"Spatial Dynamics"},"next":{"title":"üß≠Ô∏è Searching the OSYM library for Models, Context, Activities and Quick Explainers","url":"/osymindex","group":"Appendix"}}},"domain":"http://localhost:3002"}