{"version":"1","records":[{"hierarchy":{"lvl1":"üß≠Ô∏è Searching the OSYM library for Models, Context, Activities and Quick Explainers"},"type":"lvl1","url":"/osymindex","position":0},{"hierarchy":{"lvl1":"üß≠Ô∏è Searching the OSYM library for Models, Context, Activities and Quick Explainers"},"content":"This is a utility to facilitate finding resources within the OSYM library. To use the utility, open this notebook within a Jupyter Lab environment. Clicking on this binder button is an easy way to do this:\n\n\n\nWhen the page has loaded, pull down the Run menu and select Run All Cells. Then, scroll down until you find a set of criteria describing the entries you would like to see. For example, if you want to see all the entries within the topic areas ‚ÄúBiomechanics‚Äù and ‚ÄúDemography‚Äù:\n\nScroll down to the set of checkboxes labeled Filter for Topics\n\nSelect the boxes labeled ‚ÄúBiomechanics‚Äù and ‚ÄúDemography‚Äù\n\nSelect the box labeled ‚ÄúApply filter‚Äù\n\nScroll down and click the button under the heading Display selected entries\nYou can apply as many or as few filters as you want. Un-selecting the ‚ÄúApply filter‚Äù button means that set of criteria will not be used, so you don‚Äôt have to uncheck the specific entries.\n\nfrom glob import glob\nimport ipywidgets as widgets\nimport json\nimport pprint\n\nglobal data,ind\n\nindices = glob('*.json')\nout = widgets.Output()\nHTML_text_widget = widgets.HTML(value='<b>Choose an OSYM index: </b>')\ndisplay(HTML_text_widget)\nind = widgets.Select(\n    options=indices,\n    value=indices[0],\n    rows=len(indices),\n    description='',\n    disabled=False\n)\n# load default index file\n#with open('OSYMindex.json') as file:\nwith open(ind.value) as file:\n    data = json.load(file)\n\nbuttonL = widgets.Button(\n    description='Load OSYM index',\n    disabled=False,\n    button_style='', # 'success', 'info', 'warning', 'danger' or ''\n    tooltip='Click to select a json file containing an index of OSYM models and activities',\n    icon='check' # (FontAwesome names without the `fa-` prefix)\n)\n\ndef on_button_clickedL(b):\n    global data,ind\n    with open(ind.value) as file:\n        data = json.load(file)\n    \nbuttonL.on_click(on_button_clickedL)\n\nwidgets.Box([ind,buttonL])\n\n\n\n\n\n\n\n\ndisplay(widgets.HTML(value='<b>Filter for document type</b>'))\nchk_model = widgets.Checkbox(\n    value=False,\n    description='Model',\n    disabled=False,\n    indent=False\n)\ndisplay(widgets.Box([chk_model]))\nchk_context = widgets.Checkbox(\n    value=False,\n    description='Context',\n    disabled=False,\n    indent=False\n)\ndisplay(widgets.Box([chk_context]))\nchk_activity = widgets.Checkbox(\n    value=False,\n    description='Activity',\n    disabled=False,\n    indent=False\n)\ndisplay(widgets.Box([chk_activity]))\nchk_explainer = widgets.Checkbox(\n    value=False,\n    description='Quick Explainer',\n    disabled=False,\n    indent=False\n)\ndisplay(widgets.Box([chk_explainer]))\ndisplay(widgets.HTML(value='Apply filter'))\nchk_use1 = widgets.Checkbox(\n    value=False,\n    description='Apply',\n    disabled=False,\n    indent=False\n)\nwidgets.Box([chk_use1])\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ndisplay(widgets.HTML(value='<b>Filter for Topics</b>'))\nchk_overview = widgets.Checkbox(\n    value=False,\n    description='Overview',\n    disabled=False,\n    indent=False\n)\ndisplay(widgets.Box([chk_overview]))\nchk_biomechanics = widgets.Checkbox(\n    value=False,\n    description='Biomechanics',\n    disabled=False,\n    indent=False\n)\ndisplay(widgets.Box([chk_biomechanics]))\nchk_demography = widgets.Checkbox(\n    value=False,\n    description='Demography',\n    disabled=False,\n    indent=False\n)\ndisplay(widgets.Box([chk_demography]))\nchk_spatial = widgets.Checkbox(\n    value=False,\n    description='Spatial Dynamics',\n    disabled=False,\n    indent=False\n)\ndisplay(widgets.Box([chk_spatial]))\nchk_expt = widgets.Checkbox(\n    value=False,\n    description='Experimental Methods',\n    disabled=False,\n    indent=False\n)\ndisplay(widgets.Box([chk_expt]))\ndisplay(widgets.HTML(value='Apply filter'))\nchk_use2 = widgets.Checkbox(\n    value=False,\n    description='Apply',\n    disabled=False,\n    indent=False\n)\nwidgets.Box([chk_use2])\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ndisplay(widgets.HTML(value='<b>Filter for Organizational Level Transition</b>'))\nchk_subcell = widgets.Checkbox(\n    value=False,\n    description='Sub-Cell',\n    disabled=False,\n    indent=False\n)\ndisplay(widgets.Box([chk_subcell]))\nchk_cell = widgets.Checkbox(\n    value=False,\n    description='Cell',\n    disabled=False,\n    indent=False\n)\ndisplay(widgets.Box([chk_cell]))\nchk_morph = widgets.Checkbox(\n    value=False,\n    description='Morphology',\n    disabled=False,\n    indent=False\n)\ndisplay(widgets.Box([chk_morph]))\nchk_phys = widgets.Checkbox(\n    value=False,\n    description='Physiology',\n    disabled=False,\n    indent=False\n)\ndisplay(widgets.Box([chk_phys]))\nchk_org = widgets.Checkbox(\n    value=False,\n    description='Organism',\n    disabled=False,\n    indent=False\n)\ndisplay(widgets.Box([chk_org]))\nchk_habitat = widgets.Checkbox(\n    value=False,\n    description='Habitat Choice/Utilization',\n    disabled=False,\n    indent=False\n)\ndisplay(widgets.Box([chk_habitat]))\nchk_community = widgets.Checkbox(\n    value=False,\n    description='Community Interactions',\n    disabled=False,\n    indent=False\n)\ndisplay(widgets.Box([chk_community]))\nchk_ecosys = widgets.Checkbox(\n    value=False,\n    description='Ecosystems',\n    disabled=False,\n    indent=False\n)\ndisplay(widgets.Box([chk_ecosys]))\ndisplay(widgets.HTML(value='Apply filter'))\nchk_use3 = widgets.Checkbox(\n    value=False,\n    description='Apply',\n    disabled=False,\n    indent=False\n)\nwidgets.Box([chk_use3])\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ndisplay(widgets.HTML(value='<b>Filter for Key Mechanisms</b>'))\nchk_devel = widgets.Checkbox(\n    value=False,\n    description='Developmental',\n    disabled=False,\n    indent=False\n)\ndisplay(widgets.Box([chk_devel]))\nchk_demog = widgets.Checkbox(\n    value=False,\n    description='Demographic',\n    disabled=False,\n    indent=False\n)\ndisplay(widgets.Box([chk_demog]))\nchk_biomech = widgets.Checkbox(\n    value=False,\n    description='Biomechanical',\n    disabled=False,\n    indent=False\n)\ndisplay(widgets.Box([chk_biomech]))\nchk_genetic = widgets.Checkbox(\n    value=False,\n    description='Genetic',\n    disabled=False,\n    indent=False\n)\ndisplay(widgets.Box([chk_genetic]))\nchk_spat = widgets.Checkbox(\n    value=False,\n    description='Spatial',\n    disabled=False,\n    indent=False\n)\ndisplay(widgets.Box([chk_spat]))\nchk_behav = widgets.Checkbox(\n    value=False,\n    description='Behavioral',\n    disabled=False,\n    indent=False\n)\ndisplay(widgets.Box([chk_behav]))\ndisplay(widgets.HTML(value='Apply filter'))\nchk_use4 = widgets.Checkbox(\n    value=False,\n    description='Apply',\n    disabled=False,\n    indent=False\n)\nwidgets.Box([chk_use4])\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ndef apply_filters():\n    # Create a list of flags determining which entries to include\n    tpc = [1 for d in data]\n    # Filter on document type\n    if chk_use1.value:\n        dlist = []\n        if chk_model.value:\n            dlist.append('model')\n        if chk_context.value:\n            dlist.append('context')\n        if chk_activity.value:\n            dlist.append('activity')\n        if chk_explainer.value:\n            dlist.append('explainer')\n        for i,d in enumerate(data):\n            if not list(set(dlist) & set([d['Class']])):\n                tpc[i] = 0  \n    # Filter on topic\n    if chk_use2.value:\n        tlist = []\n        if chk_overview.value:\n            tlist.append('Overview')\n        if chk_biomechanics.value:\n            tlist.append('Biomechanics')\n        if chk_demography.value:\n            tlist.append('Demography')\n        if chk_spatial.value:\n            tlist.append('SpatialDynamics')\n        if chk_expt.value:\n            tlist.append('ExptMethods')\n        for i,d in enumerate(data):\n            if not list(set(tlist) & set(d['Topics'])):\n                tpc[i] = 0  \n    # Filter on organizational level transitions\n    if chk_use3.value:\n        olist = []\n        if chk_subcell.value:\n            olist.append('S')\n        if chk_cell.value:\n            olist.append('C')\n        if chk_morph.value:\n            olist.append('M')\n        if chk_phys.value:\n            olist.append('P')\n        if chk_org.value:\n            olist.append('O')\n        if chk_habitat.value:\n            olist.append('H')\n        if chk_community.value:\n            olist.append('I')\n        if chk_ecosys.value:\n            olist.append('E')\n        for i,d in enumerate(data):\n            if not list(set(olist) & set(d['OrgLevels'])):\n                tpc[i] = 0  \n    # Filter on key mechanisms\n    if chk_use4.value:\n        mlist = []\n        if chk_devel.value:\n            mlist.append('V')\n        if chk_demog.value:\n            mlist.append('D')\n        if chk_biomech.value:\n            mlist.append('B')\n        if chk_genetic.value:\n            mlist.append('G')\n        if chk_spat.value:\n            mlist.append('S')\n        if chk_behav.value:\n            mlist.append('H')\n        for i,d in enumerate(data):\n            if not list(set(mlist) & set(d['Mechanisms'])):\n                tpc[i] = 0  \n    return [d for i,d in enumerate(data) if tpc[i]]\n\n\n\n\nbuttonA = widgets.Button(\n    description='Show filter results',\n    disabled=False,\n    button_style='', # 'success', 'info', 'warning', 'danger' or ''\n    tooltip='Click to display entries matching any criteria within selected filter criteria',\n    icon='check' # (FontAwesome names without the `fa-` prefix)\n)\n\nglobal new_data\noutputA = widgets.Output()\n@outputA.capture()\ndef on_button_clickedA(b):\n    global new_data\n    new_data = apply_filters()\n    with outputA:\n        outputA.clear_output()\n    pprint.pprint(new_data)\n\nbuttonA.on_click(on_button_clickedA)\ndisplay(widgets.HTML(value='<b>Display selected entries</b>'))\nwidgets.Box([buttonA,outputA])\n\n\n\n\n\n","type":"content","url":"/osymindex","position":1},{"hierarchy":{"lvl1":"Biomechanics in physiology, behavior and sensing"},"type":"lvl1","url":"/","position":0},{"hierarchy":{"lvl1":"Biomechanics in physiology, behavior and sensing"},"content":"This section focuses on perspectives on Organismal Biology relating to biomechanic.\nThe units in this section address questions that can be broadly framed as:\n\nHow are  biomechanical consequences of organisms‚Äô morphology, movement, habitat selection and other traits reflected in their performance of key functions?\n\nHow are do functional requirements impose biomechanical constraints on organisms?\n\nThe traits of interest span the diverse attributes of organisms: physiological, behavioral, sensory, and many other characteristics.\nThe case studies and activities elucidate linkages between these organismal attributes and their impacts on both higher and lower levels of organisation, as mediated by biomechanics.\n\nThe units in the section currently are:\n\nUnderstanding and predicting the movement of particles in fluids, with application to dispersal and diffusive mass exchange for relevant biotic particles (eggs, pollen, etc.) and abiotic particles (fecal pellets, iron-containing dust, etc.).\n\nA model of swimming and orientation of early-stage marine invertebrate larvae which simulates biomechanical consequences of embryo size and morphology.","type":"content","url":"/","position":1},{"hierarchy":{"lvl1":"Demography, epidemeology and other dyamics of populations"},"type":"lvl1","url":"/readme-3","position":0},{"hierarchy":{"lvl1":"Demography, epidemeology and other dyamics of populations"},"content":"This section focuses on population-level perspectives on Organismal Biology.\nThe units in this section address questions that can be broadly framed as:\n\nHow are organismal traits reflected in the dynamics of populations and their consumers, predators, prey and pathogens?\n\nHow do the dynamics of populations and their consumers, predators, prey and pathogens shape organismal traits?\n\nThe traits of interest span the diverse attributes of organisms: physiological, behavioral, life history, and many other characteristics.\nThe case studies and activities elucidate linkages between these organismal attributes and their impacts on both higher and lower levels of organisation, as mediated by populations.\n\nThe units in the section currently are:\n\nExploration of cloning in marine invertebrate larvae as a little-studied alternative to conventional larval life histories.\n\nA model of diatom population dynamics and evolution which simulates demographic and evolutionary consequences of allometries in growth and nutrient uptake.The activities in this section elucidate lin\nActivities frame with linkages orgs w higher lower levels","type":"content","url":"/readme-3","position":1},{"hierarchy":{"lvl1":"Preface"},"type":"lvl1","url":"/overview","position":0},{"hierarchy":{"lvl1":"Preface"},"content":"This is an \n\nexecutable book presenting applications of quantitative reasoning to important questions in Organismal Biology research.\nThe book‚Äôs purpose is to help students and professional scientists gain quantitative skills and perspectives enhancing their practice of Organismal Biology as a holistic, integrative field.\n\nOrganismal Biology, by its nature, operates at all the scales that organsism do.\nThat is, it integrates across organisational scales from intracellular molecular reactions to ecosystem dynamics; spatial scales from nanometers to 1000s of kilometers, and temporal scales from microseconds to geologic eras.\nAt each of these diverse scales, the details of how organisms are constituted and how they function are fascinating and important.\nHowever, this diversity also requires Organismal Biologists to specialize in acquiring knowledge, skills and facilities for investigating in a small subset of fields relevant to their focal organisms.\nThey rely on other specialists to provide outside context for their observations and conclusions.\n\nSpecialists with complementary expertise typically use different vocabulary, address different focal questions and work in different organisations.\nFor example, a simple term like ‚Äúmemory‚Äù has specific ‚Äì but different ‚Äì meanings to a behavioral ecologist, a mathematical biologist, a materials scientist and an immunologist.\nHow can these specialists collaborate efficiently and avoid misunderstanding if what one says is fundamentally different from what another hears?\nThe fragmentation of the biological sciences into subdisciplines that are mutually relevant but effectively isolated is among the biggest challenges currently facing Organismal Biology.\n\nOne way to address this challenge is to use quantitative tools and executable models.\nThese tools and models can help integrate across scales and subdisciplines in several ways.\nFirst, because models and other quantitative analyses must define their terms explicitly and specifically, they enable any reader to understand precisely what is meant by a given term.\n\nSecond, models provide quantitative results that are effectively ‚Äútake-home‚Äù summaries from in-depth studies in other subdisciplines.\nFor example, a biologist investigating foraging behavior might exploit the results of a biomechanical study quantifying the cost of movement, without needing to replicate (or even understand) the basis of those results.\nLikewise, the biomechanicist could use the results of a foraging model to assess the costs vs. benefits of alternative modes of locomotion.","type":"content","url":"/overview","position":1},{"hierarchy":{"lvl1":"Preface","lvl2":"Absolute and relative measures of organisms"},"type":"lvl2","url":"/overview#absolute-and-relative-measures-of-organisms","position":2},{"hierarchy":{"lvl1":"Preface","lvl2":"Absolute and relative measures of organisms"},"content":"A third way quantitative tools and executable models can serve Organismal Biologists is by concisely summarizing which of the near-infinite number of potential connections, interactions and mechanisms are the most important in a given context.\nFor example, the energetic costs of locomotion can be much lower ‚Äì relative to basal metabolism, reproduction and other demands ‚Äì for a bacterium compared to a large terrestrial mammal or an insect such as a honeybee.\nConversely, the relative costs of modulating body temperature is typically moderate for a large terrestrial mammal, prohibitive for a smaller organism like a bacterium or bee, but moderate or negligible for an aggregation of small organisms such as a hive or compost heap.\nAn investigator of energetic constraints for each of these organisms could justifiably emphasize some mechanisms for expending energy while neglecting others.\n\nBut, how to know which mechanisms are primary and which are negligible?\nThe analysis of relative magnitudes of mechanisms is often referred to among biologists as ‚Äúscaling‚Äù, and among mathematicians as ‚Äúdimensional analysis‚Äù.\nThe gist of this analytical approach is expressing organismal states and rates of change in relative instead of absolute terms.\n\nFor example, two organisms that each give birth to one offspring every week have, in one sense, the same birth rate ‚Äì their absolute birth intervals are the same.\nHowever, if one organism has a lifespan of three weeks and the other of six weeks, then the effect of that birth rate on population growth is quite different.\nThat is because birth interval and lifespan jointly determine population growth, and their relative magnitudes differ in the two organisms.\n\nSuppose, instead, that one organism gives birth to one offspring every week and has a lifespan of three weeks, and the other gives birth every two weeks and has a lifespan of six weeks.\nThese organisms differ in their absolute birth intervals, but they are similar in a relative sense: the ratio of their birth intervals and lifespans are the same.\nIf we plot these populations using time scaled by lifespan on the horizontal axis, then the populations of these two organisms would follow exactly the same trajectories.\n\nThese organisms (and any other organism with the same birth interval/lifespan ratio) are referred to as being dynamically similar because they share the same relative magnitudes of key mechanisms (in this case, birth and death) and therefore their progression over time (scaled appropriately) are the same.\nThat is, they are scale models of each other ‚Äî understanding the dynamics of one also tells us about the dynamics of the other.\nFor example, it has been argued that, in terms of foraging, \n\nbacteria are scale models of gazelles!","type":"content","url":"/overview#absolute-and-relative-measures-of-organisms","position":3},{"hierarchy":{"lvl1":"Preface","lvl3":"Nothing is big or small by itself","lvl2":"Absolute and relative measures of organisms"},"type":"lvl3","url":"/overview#nothing-is-big-or-small-by-itself","position":4},{"hierarchy":{"lvl1":"Preface","lvl3":"Nothing is big or small by itself","lvl2":"Absolute and relative measures of organisms"},"content":"Measuring birth interval as a fraction of lifespan is just one example of thinking about metrics like ‚Äúlarge‚Äù, ‚Äúsmall‚Äù, ‚Äúfast‚Äù and ‚Äúslow‚Äù as relative comparisons between elements affecting organisms.\nThat is, nothing is ‚Äúbig‚Äù or ‚Äúsmall‚Äù by itself ‚Äì a metric, state or rate characteristic of an organism is large or small only relative to other comparable metrics, states and rates.\n\nMore generally, it is typical for many factors to affect how an organism functions, but almost always only a subset of these factors have a significant effect in any given scenario.\nExploiting scaling and dynamic similarity to identify hidden relationships and identify dominant vs. negligible mechanisms affecting organism function is an effective but underutilized approach in Organismal Biology.\nFor instance, if in our example emigration occurs in addition to births and deaths, knowing that the emigration rate is much lower than the death rate we could justify neglecting emigration in a population model, while if it is on a par with the death rate then we know that it cannot be ignored.\n\nProviding readers with opportunities to understand and practice this way of thinking about Organismal Biology, with an eye towards applying it in their own investigations, is a major theme in this book.","type":"content","url":"/overview#nothing-is-big-or-small-by-itself","position":5},{"hierarchy":{"lvl1":"Preface","lvl2":"Models as aids to communication"},"type":"lvl2","url":"/overview#models-as-aids-to-communication","position":6},{"hierarchy":{"lvl1":"Preface","lvl2":"Models as aids to communication"},"content":"Beyond making definitions and assumptions explicit, models also often offer opportunities to present results in visually appealing and easily understood ways.\nAmong the guidelines to contributors is encouragement to provide straightforward tools for generating and exporting graphical output that visualizes the key insights from their models about the causes and consequences of organismal characteristics.\nGraphs of numerical results are a ubiquitous and powerful presentation mode.\nLess common, but in many cases more compelling in conveying processes affecting organisms, are animations of dynamic processes (such as orientation of swimming organisms in turbulence, or spatial distributions of swimming larvae in tidally-driven estuaries), or variation of outcomes across parameter ranges (such as foraging success as a function of how patchy resources are).\nMany sections in this book present activities in which readers are explicitly encouraged to practice generating constrasting graphical results, as the basis of presentations explaining key model dynamics and conclusions.","type":"content","url":"/overview#models-as-aids-to-communication","position":7},{"hierarchy":{"lvl1":"üèûÔ∏è Allometry: How organismal characteristics vary with size"},"type":"lvl1","url":"/allometry","position":0},{"hierarchy":{"lvl1":"üèûÔ∏è Allometry: How organismal characteristics vary with size"},"content":"One area in which Organismal Biologists use these ideas is in the study of \n\nallometry.\nAllometry is the study of how organismal traits vary systematically with body length or similar metrics of size.\nAllometric relationships have been found or hypothesized for many traits, including mass, morphology of limbs and other structures, locomotion and other behaviors, and physiological characteristics such as respiration and nutrient uptake.\n\nA well-known example of an allometric relationshop is \n\nKleiber‚Äôs law, which posits that the basal metabolic rate of animals varies approximately as the animal‚Äôs mass raised to the \\frac{3}{4} power:\n\n\n\nFigure¬†1:A plot of Kleiber‚Äôs law, relating the metabolic rates of organisms to their sizes across a large range of sizes. See the Wikipedia article on \n\nKleiber‚Äôs law for details.\n\nAllometric relationships within taxonomic groups are usually determined by statistical analysis of observations across a range of organism sizes within the group.\nThese observations are most commonly plotted on log-log plots, and statistically analyzed to detect trends.\nA line on a log-log plot represents a power law relationship, which can be expressed mathematically astrait = c~size^p,\n\nwhere c is a constant, and p is an exponent indicating the type of allometry.\nTaking the log of both sides of [#K1] gives\\log{trait} = \\log{c} + p \\times \\log{ size}.\n\n[#K2] shows why power law allometries appear at straight lines on log-log plots.\n\nFor example, in \n\nFigure¬†1, the trait is \n\nBasal Metabolic Rate in watts, BMR, the size metric is mass, M, the constant c = 70, and the hypothesized exponent is p=\\frac{3}{4}, i.e.,BMR = 70~ M^\\frac{3}{4}\n\nIt is useful to distinguish two types of allometry, isometric scaling and allometric scaling.","type":"content","url":"/allometry","position":1},{"hierarchy":{"lvl1":"üèûÔ∏è Allometry: How organismal characteristics vary with size","lvl2":"Isometric scaling"},"type":"lvl2","url":"/allometry#isometric-scaling","position":2},{"hierarchy":{"lvl1":"üèûÔ∏è Allometry: How organismal characteristics vary with size","lvl2":"Isometric scaling"},"content":"Isometric scaling is also known as geometrical similarity.\nIn isometric scaling, all linear proportions are held constant as overall size increases or decreases.\nThe spherical egg model in \n\nthe previous notebook is an example of isometric scaling.\nIn general, a series of isometrically scaled objects follow the so-called \n\nsquare-cube law, stating that surface area is proportional to the length squared, and volume is proportional to length cubed.","type":"content","url":"/allometry#isometric-scaling","position":3},{"hierarchy":{"lvl1":"üèûÔ∏è Allometry: How organismal characteristics vary with size","lvl2":"Allometric scaling"},"type":"lvl2","url":"/allometry#allometric-scaling","position":4},{"hierarchy":{"lvl1":"üèûÔ∏è Allometry: How organismal characteristics vary with size","lvl2":"Allometric scaling"},"content":"In allometric scaling, different organismal traits scale differently with metrics of size.\nFor example, larger animals often have more robust bones than would be predicted by isometric scaling from smaller animals.\nIn a given organism, different traits may reflect either direct or indirect effects of isometric and allometric scaling.\n\nFor example, if a set of animals scaled isometrically, their weight might be expected to increase in proportion to the cube of their length.\nHowever, following the \n\nsquare-cube law, the cross-sectional area of their bones would increase only in proportion to the square of their length.\nThis is likely to result in much higher loading and risk of breakage in larger animals.\n\nIn this case, some traits of these animals might deviate from isometric scaling, and instead follow an allometric scaling.\nFor example, bones might increase in thickness faster than isometrically, or mass might increase slower than isometrically.\nEither form of allometric scaling would tend to equalize the loading on bones, relative to isometric scaling.","type":"content","url":"/allometry#allometric-scaling","position":5},{"hierarchy":{"lvl1":"üßÆ An example Jupyter notebook"},"type":"lvl1","url":"/example","position":0},{"hierarchy":{"lvl1":"üßÆ An example Jupyter notebook"},"content":"This is an example of a Jupyter notebook. It demonstrates some of the properties that make these notebooks useful for executable books.\nThis notebook can be run online via \n\nBinder, by clicking on the button below:\n\n\n\nNote that when you open a notebook on Binder, the Python environment in which the notebook runs must be loaded before it can execute.\nIf it hasn‚Äôt been run recently, Binder has to rebuilt its environment and this can take a few minutes.\nRerunning it afterwards is noticeably faster.\n\nAlternatively, it can be run directly on your own machine if you have JupyterLab set up, by cloning the \n\nqob-notebooks repository or the source materials for this \n\nbook.\n\n","type":"content","url":"/example","position":1},{"hierarchy":{"lvl1":"üßÆ An example Jupyter notebook","lvl2":"Jupyter notebook structure"},"type":"lvl2","url":"/example#jupyter-notebook-structure","position":2},{"hierarchy":{"lvl1":"üßÆ An example Jupyter notebook","lvl2":"Jupyter notebook structure"},"content":"Jupyter notebooks are composed of cells.\nTo execute a cell, make it the active cell by clicking on it, and either type shift-enter or select Run Selected Cells from the Run menu at the top of the page.\n\nThe sentences you are reading are in a cell of type ‚ÄúMarkdown‚Äù.\nThis is indicated (and, if need be, selected) in the drop-down menu at the top of the page.\nAs the name suggests, the content of this cell is coded in the formatting language Markdown, and when executed is rendered as a formatted display.\n\nTo see the Markdown code, click on the blue vertical bar at left, then type the letter ‚Äúm‚Äù on your keyboard (or just double-click on the cell).\nThe cell will now show the original Markdown code.\nNow you are able, for example, to edit words and links in the cell.\n\nTo re-render it, execute the cell by typing shift-enter.\nNow you see the formatted display.\n\n","type":"content","url":"/example#jupyter-notebook-structure","position":3},{"hierarchy":{"lvl1":"üßÆ An example Jupyter notebook","lvl2":"Python code cells"},"type":"lvl2","url":"/example#python-code-cells","position":4},{"hierarchy":{"lvl1":"üßÆ An example Jupyter notebook","lvl2":"Python code cells"},"content":"The cell below is a Code cell, containing Python commands to be run when the cell is executed. You can see what this code does in either of two ways:\n\nby selecting its cell and typing shift-enter\n\nby selecting the Run Selected Cell item under the Run menu at the top left of this page\n\nMany notebooks are set up for your use by running all the code cells. This is easy to do using the Run All Cells item under the Run menu.\n\nTry changing the numbers in the cell below, then executing it by clicking on it and typing shift-enter:\n\n# This is a simple test of whether your notebook is executing correctly: \n# Change the value of a or b and shift-enter.\n# The output should reflect your updated addition calculation.\na = 2\nb = 3\nprint('{} plus {} equals {}'.format(a,b,a+b))\n\n\n\n","type":"content","url":"/example#python-code-cells","position":5},{"hierarchy":{"lvl1":"üßÆ An example Jupyter notebook","lvl3":"Code cell visibility","lvl2":"Python code cells"},"type":"lvl3","url":"/example#code-cell-visibility","position":6},{"hierarchy":{"lvl1":"üßÆ An example Jupyter notebook","lvl3":"Code cell visibility","lvl2":"Python code cells"},"content":"In Jupyter Lab, the commands in code cells can be hidden by clicking on the blue vertical bar at left, leaving only three small dots visible.\nThe output remains visible below in its own cell.\n\nFor example, the cell below is a hidden code cell. Even though the code isn‚Äôt initially visible, you can still execute it by selcting it and typing shift-enter.\n\n# This is another test of whether your notebook is executing correctly: \n# Change the value of a or b and shift-enter.\n# The output should reflect your updated addition calculation.\na = 2\nb = 3\nprint('{} times {} equals {}'.format(a,b,a*b))\n\n\n\nYou can see hidden code any time you want. In an active notebook (e.g., on Binder) you can show or hide code by clicking on the blue bar at the left. In the static version, you can click on the ‚ÄúSource‚Äù bar to show or hide the code.\n\nThis is convenient when there is a lot of code that would be distracting in ordinary usage of the notebook.\nFor example, the parameters in many models are set in textboxes (called ‚Äúwidgets‚Äù).\nThis means users can use the models without having to interact directly with the code. However, there is distracting amount of code needed to set up the widgets.\nHiding that code makes using the model more intuitive and visually appealing.\nTo make the code visible, click on the blue vertical bar again.\n\nThe output can also be hidden and exposed by clicking on the vertical bar.\n\n# This cell shows an example of defining a Python class, in this case representing a \n# spherical egg, with some calculated geometrical properties relevant to respiration, \n# heat content and other processes.\nfrom math import pi # import the value of pi from the math module\nclass Egg():\n    \"\"\" An example of a class definition in Python, that facilitates calculating\n        the surface area and volume of a spherical egg given its diameter.\n        If the parameter d is not supplied, it defaults to d=1\n    \"\"\"\n    def __init__(self,d=1):\n        \"\"\" Create an Egg instance.\n        \"\"\"\n        self.d = d            # save the diameter as an attribute of the egg\n        self.r = d/2          # calculate the radius\n        self.A = pi * d**2    # calculate the surface area\n        self.V = pi/6 * d**3  # calculate the volume\n\n\n\n\n# An example of using an instance of the Egg class.\negg = Egg(d=2)\nprint(f'The surface area of an egg of diameter {egg.d} is {egg.A} and its volume is {egg.V}')\n\n\n\n# Now let's look at some plotting examples. Here is an example of making a list of diameters,\n# using that to make lists of volumes and areas, and then making a plot of area and volume as\n# functions of diameter.\nimport matplotlib.pyplot as plt # import the pyplot graphics library\nplt.ion()                       # use interactive plotting mode\nds = [0.1*(d+1) for d in range(150)]\nAs = [Egg(d).A for d in ds]\nVs = [Egg(d).V for d in ds]\n# Create a plot object, and add the first subplot\nfig = plt.figure()\n# Plot area and volume against diameter, on a linear axis\nax1 = fig.add_subplot(1,2,1)\nax1.plot(ds,As,label='Area')\nax1.plot(ds,Vs,label='Volume')\nax1.legend()\nax1.grid()\n# Plot area and volume against diameter, on a log axis\nax2 = fig.add_subplot(1,2,2)\nax2.plot(ds,As,label='Area')\nax2.plot(ds,Vs,label='Volume')\nax2.set_xscale('log')\nax2.set_yscale('log')\nax2.legend()\nax2.grid()\n\n\n\nThe plots above demonstrate several things.\nFirst, if they are visible, they show your Jupyter notebook is executing correctly.\n\nSecondly, they provide examples of using a model (in this case, a very simple model\nof egg characteristics) to make a systematic study of variation of key model results across a range of input variables.\nThis sytematic use of models to understand cause and effect, analogous to systematic variation of parameters in experimental design, is one of the most important yet widely underappreciated uses of models.\n\nThirdly, they illustrate that a very orderly pattern of variation exists in area and volume as functions of diameter ‚Äì area and volume are simple lines as functions of diameter on a log-log plot ‚Äì but the simplicity of this variation is obvious only when scaled and plotted in a specific way.\n\nAll three of these are important ideas to carry forward in using this book.","type":"content","url":"/example#code-cell-visibility","position":7},{"hierarchy":{"lvl1":"How to use this book"},"type":"lvl1","url":"/how2use","position":0},{"hierarchy":{"lvl1":"How to use this book"},"content":"This book is organized into Parts, each devoted to a different general topic or biological research area (e.g., Biomechanics, Demography, etc.).\nEach Part contains Chapters that present, in context, one or more models within the general topic.\n‚ÄúIn context‚Äù means that these examples provide brief background (with additional outside references); a working ‚Äúexecutable‚Äù model; instructions how to use that model and suggested activities for exploring potential implications of the model for interesting questions in Larval Biology.\n\nIn most cases, background is presented in short form, often supplemented by separate ‚ÄúQuick Explainer‚Äù pages.\nThese pages are intended to be short enough for a reader to internalize the most relevant, essential facts about a topic refered to in a model, without losing continuity of thought while working with that model.\nQuick Explainers are not intended to be comprehensive, though ideally they may refer to additional sources that provide in-depth perspectives.\nIn many cases the most useful reference is simply a link to Wikipedia, which has proven to usually be comprehensive and accurate in many areas of biology, mathematics, physics, statistics and other disciplines.\n\nModels, instructions on how to use them, and activities applying the models to currently relevant questions in Larval Biology are presented in Jupyter notebooks.\nJupyter notebooks are among the latest and (so far) best platforms for embedding working computer code with formatted text and graphical content.\nJupyter notebooks can be combined and integrated with Markdown and other content in the form of an Executable Book.\nJupyter books can be run on a reader‚Äôs own computer, can be run online on platforms such as Binder, and can be freely exported using a drop-down menu as a static (non-executable) PDF document.\nWith additional setup, Jupyter books can also be exported as a LaTeX document, and then reconverted to a variety of other formats.\nThis flexibility in format and usage makes Jupyter books the best platform, at the time of this writing, for a book aimed at helping Larval Biologists gain experience working with models.\n\nThe source documents for the book can be downloaded (‚Äúcloned‚Äù) from GitHub at the book‚Äôs main repository, quant-larval-bio.\nThis repository belongs to the organismal-systems organization on GitHub, which is associated with the Organismal Systems Modeling Network.\nThe source documents can be used to fully build the book using \n\nJupyterBook.\n\nA static (read-only) version of the book constructed with GitHub Pages can be viewed online (or downloaded) at the **\n\norganismal-systems GitHub Pages site.\nThis version is quick and easy to read, and can be a useful reference alongside executable pages.\n\nOnline executable models implemented in \n\nJupyter notebooks are available with a button click through \n\nBinder.\nThe great advantage of these models is that they require nothing more than a browser to be running on users‚Äô machines.\nThis makes them accessible to nearly everyone everywhere.\n\nAs with most free online resources, though, there are limitations.\nOne is that the execution speed can be slower, especially at peak times, compared to running the same model on a local workstation (it can also be faster, depending on the workstation...).\nAnother is that sessions ‚Äúexpire‚Äù after a period of inactivity, freeing computing resources for other users.\nThe session can easily be restarted, however, with the click of a button.\nIn some contexts, \n\nBinder implementations also have constraints on reading and writing data files.\n\nExecutable models running locally on your computer can be launched from downloaded copies of the source repositories, or from copies of those repositories already in the source materials for this book.\nExecutable Jupyter notebooks containing models (and supporting Python libraries, if needed) are also incorporated into the book as subrepos or submodules, which it git jargon for repositories that are incorporated as components of other repositories.\nThe source repositories for these models are stored elsewhere on GitHub, at links provided in the text.\nThese repositories are typically forked so that independent copies are retained on the OSYM GitHub site, from which they are linked in the book.\nThese repositories often have their own license requirements, which supercede (for that content) the licensing requirements for the original content of this book.\nThis structure is necessary for two reasons:\n\nThe Jupyter notebooks (and, often, a Python code library in which models are implemented) may be created and updated by different authors.\nHaving a separate repository for these models enables the authors to develop their own codes, avoiding requiring them to separately update a book implementation. It also avoids giving all authors editing access to the entire book content, which is not sustainable in the long run.\n\nDifferent models require different sets of Python libraries.\nSome of these libraries are quite voluminous, so requiring a user of one model to install all libraries relevant to any of the other models is problematic.\nMoreover, Python libraries are updated and modified frequently; it is quite possible for different models in the book to require conflicting, incompatible versions of the same library.\n\nThe easiest way to manage the libraries required to build the book on your own computer and to run the executable models in \n\nJupyter Lab is using the \n\nminiconda, \n\nAnaconda or \n\nMamba package managers.\nA brief explanation of what these managers do, the differences between them, and how to install and use them is given in the \n\nAppendix.\nThe required modules for each repository are listed in a file called environment.yml, included with the repository.\nminiconda, Anaconda and Mamba use this file to automatically recreate the set of packages needed to make the models function correctly.","type":"content","url":"/how2use","position":1},{"hierarchy":{"lvl1":"üìñ Non-dimensional numbers"},"type":"lvl1","url":"/nondim-numbers","position":0},{"hierarchy":{"lvl1":"üìñ Non-dimensional numbers"},"content":"The idea that similarity of proportions generalized to include both geometries and forces as required for dynamic similarity is most practical to work with using non-dimensional numbers.\nDimensions, in this context, refers to measurements in physical units (such as SI units: meters, seconds, kilograms, etc.).\n‚ÄúNon-dimensional numbers‚Äù is somewhat strange terminology, because by nature pure numbers are not associated with any physical dimensions.\nIn this context, though, ‚Äúnon-dimensional‚Äù refers to ratios that have no dimensions because the units of the numerator are the same as the units of the denominator.\nThat is, non-dimensional numbers are composed of factors with units (lengths, times, masses, etc.) but they are nonetheless non-dimensional because the units of their factors cancel.\n\nMany non-dimensional numbers have been devised in diverse fields of science.\nSome of these are listed, together with their physical interpretations, in \n\nthis Wikipedia page.\n\nNon-dimensional numbers are useful in quantitative sciences for two reasons:\n\nMany phenomena are governed by non-dimensional combinations of parameters, which is made explicit in the form of non-dimensional numbers.\nBy using non-dimensional numbers as ‚Äúmeta‚Äù parameters, these phenomena can be understood and predicted using far fewer variables than in the original dimensional form.\n\nNon-dimensional numbers in which the denominator and the numerator reflect different mechanisms can be indicators of the relative importance of those mechanisms, across variation in important parameters such as size, speed, duration, etc.\n\nBecause non-dimensional numbers are not intuitive the first few times they are encountered, it‚Äôs worth delving into some further explanation of these ideas.","type":"content","url":"/nondim-numbers","position":1},{"hierarchy":{"lvl1":"üìñ Non-dimensional numbers","lvl2":"Characteristic values"},"type":"lvl2","url":"/nondim-numbers#characteristic-values","position":2},{"hierarchy":{"lvl1":"üìñ Non-dimensional numbers","lvl2":"Characteristic values"},"content":"A good starting point for thinking about non-dimensional numbers is to consider the fact that adjectives like big, small, fast, slow, etc. are relative descriptions.\n\nThat is, nothing is big or small except in comparison to something else.\nIn our ordinary thinking, that something else is a standard set of units.\nFor example, the fundamental SI unit for length is the meter.\nAn object a kilometer long is ‚Äúbig‚Äù compared to a meter -- it‚Äôs equal to 1000 of them.\nAn object a micron long is ‚Äúsmall‚Äù, because it‚Äôs only 1/1000th of a meter.\n\nSuppose, instead, we adopt a complementary perspective, in which the basis for comparison comes from the object itself.\nThis depends on finding what are called characteristic values.\nCharacteristic values could include a length, speed or duration that emerges from the object or its interations with its surroundings.\nThese characteristic values specify a subset chosen from a set of scale models.","type":"content","url":"/nondim-numbers#characteristic-values","position":3},{"hierarchy":{"lvl1":"üìñ Non-dimensional numbers","lvl3":"Characteristic dimensions of an egg","lvl2":"Characteristic values"},"type":"lvl3","url":"/nondim-numbers#characteristic-dimensions-of-an-egg","position":4},{"hierarchy":{"lvl1":"üìñ Non-dimensional numbers","lvl3":"Characteristic dimensions of an egg","lvl2":"Characteristic values"},"content":"Let‚Äôs begin with an intentionally simplified example, that we completely understand:\nIn a \n\nprevious page, we considered the surface area, A, and volume, V, of a spherical egg.\nWe could expect that A and V have signicance for an egg‚Äôs biology.\nFor example, we might expect its mass to be roughly proportional to its volume; that mass may have functional consequences for respiratory demands, development time, sinking or rising rates, etc.\nLikewise, we might expect its surface area to be related to gas exchange rates, encounter probability with sperm or pathogens, and other factors.\nIn this simplified example, these serve as a biological motivation for understanding how surface area and volume vary with size.\n\nBecause spheres have the same shape, all spheres are geometrical scale models of each other.\nAcross the set of spheres, there is a single parameter, the diameter d, that specifies a unique sphere.\nKnowing d, we can calculate the surface area A and volume V using familiar formulas:\n\nA = \\pi d^2\n\nV = \\frac{\\pi}{6} d^3\n\nAnticipating more complicated and realistic applications in Organismal Biology, let‚Äôs suppose we did not know these formulas.\nIn that case, we would expect to conduct a series of observations in which we measure the surface area and volume of a series of spheres of various sizes.\nWe could then use interpolation or curve-fitting to estimate the surface area and volume of spheres within the range of our measurements.\n\nInstead, lt‚Äôs consider using nondimensional ratios to express the formulas for A and V, in a more general form with fewer parameters.\nWe‚Äôll start by choosing a characteristic length, L.\nThe geometry of the egg suggests that the most useful choice of characteristic value is the length scale corresponding to the diameter,\n\nL = d.\nFrom their units (m^3 for A, m^3 for V) we can anticipate that surface areas of shapes generally scale isometrically with the length scale squared, L^2, while the volume scales with the length scale cubed, L^3.\nWe know this because there is no other way to construct a quantity with the units of area and volume using the only available characteristic dimension, L.\n\nKnowing that A \\propto L^2 and  V \\propto L^3, we can set about measuring the constants of proportionality.\nDoing so for a conveniently sized sphere, we find that\n\nc_{A_{sphere}} = \\frac{A}{L^2} = \\pi\n\nc_{V_{sphere}} = \\frac{V}{L^3} = \\frac{\\pi}{6}\n\nThat is, our measurements tell us that the constant of proportionality c_{A_{sphere}} of surface area to L^2 is \\pi, and the constant of proportionality c_{V_{sphere}} of volume to L^3 is \\frac{\\pi}{6}.\n\nHaving measured one sphere, we are done.\nThat is, knowing c_{A_{sphere}} and c_{V_{sphere}}, we can write down A and V for spheres with any L (even those too large or small to measure).\nThat beats making new measurements for tens or hundreds of different-sized spheres!","type":"content","url":"/nondim-numbers#characteristic-dimensions-of-an-egg","position":5},{"hierarchy":{"lvl1":"üìñ Non-dimensional numbers","lvl3":"What did we just do?","lvl2":"Characteristic values"},"type":"lvl3","url":"/nondim-numbers#what-did-we-just-do","position":6},{"hierarchy":{"lvl1":"üìñ Non-dimensional numbers","lvl3":"What did we just do?","lvl2":"Characteristic values"},"content":"In the lines above, we did not create any new formulas or data.\nAll we did was to express the surface area as relative to the square of the characteristic length, L^2, and the volume relative to L^3.\nIn mathematical jargon, we nondimensionalized A and V with the formulas\n\n\\hat{A} = \\frac{A}{L^2} = c_{A_{sphere}}\n\n\\hat{V} = \\frac{V}{L^3} = c_{V_{sphere}}\n\nWe call \\hat{A} the nondimensional surface area and \\hat{V} the nondimensional volume.\nThinking in terms of these nondimensional variables,\n\nAll the effects of size are encapsulated in the length scale, L.\n\nAll the effects of shape are encapsulated in the constants c_{A_{sphere}} and c_{V_{sphere}}.\n\nIn words, the constants c_{A_{sphere}} and c_{V_{sphere}} are shape factors, that together with the basic geometrical scaling of L, tell us the surface area and volume of all spheres.","type":"content","url":"/nondim-numbers#what-did-we-just-do","position":7},{"hierarchy":{"lvl1":"üìñ Non-dimensional numbers","lvl3":"Nondimensionalization as a general approach","lvl2":"Characteristic values"},"type":"lvl3","url":"/nondim-numbers#nondimensionalization-as-a-general-approach","position":8},{"hierarchy":{"lvl1":"üìñ Non-dimensional numbers","lvl3":"Nondimensionalization as a general approach","lvl2":"Characteristic values"},"content":"The strategy of nondimensionalization by scaling using appropriate characteristic values is a common one in engineering, mathematics and physics but much less fully employed by Organismal Biologists.\nBefore moving on, it‚Äôs worth broadening our perspective with a few take-home points:\n\nThe logic leading to the shape constants c_{A_{sphere}} and c_{V_{sphere}} did not depend on the spherical shape, or on us having a formula.\nIt depended only on the basic scaling geometry, that areas and volumes of geometrically similar objects must be proportional to their length scale squared and cubed, respectively.\nIf you were to conduct the same measurement on a cube, you would find the same scaling but different shape constants (c_{A_{sphere}} = c_{V_{sphere}} = 1).\nFor any other shape ‚Äì an ellipsiod, a dodecahedron, or a lobster ‚Äì corresponding pair of shape constants summarize the area and volume across all sizes.\n\nThe nondimensionalization exploited the fact that all spheres are scale models of each other, so that only one needed to be measured rather than an infinite spectrum of diameters.\nIn mathematical jargon, it reduced the dimensionality of the problem.\nDimensionality is the number of variable along which we have to measure to characterize a phenomenon.\nIn this simplified case, nondimensionalization reduced the dimensionality from 1 axis (diameter) to none (all spheres have the same constants).\nEven in this simple case, reducing a hypothetical series of measurements from a series to a single observation represents a significant savings.In a more relevant problem in Organismal Biology, there may be many axes of variation.\nIn such a case, reducing the number of parameters to vary is even more helpful.\n\nAs stated, this example started with an extremely simple calculation, which the analysis made still simpler.\nThe real utility of non-dimensionalization is found in application to more complex problems in Organismal Biology, in which there are many independent variables and for which no formulas are available.\nIn these cases, including examples found in the following chapters of this book, a reduction in the number of parameters and an orderly separation of effects of different elements of the problem can be very useful and insightful.","type":"content","url":"/nondim-numbers#nondimensionalization-as-a-general-approach","position":9},{"hierarchy":{"lvl1":"üèûÔ∏è Why use models in Organismal Biology?"},"type":"lvl1","url":"/overview-1","position":0},{"hierarchy":{"lvl1":"üèûÔ∏è Why use models in Organismal Biology?"},"content":"Organismal Biology is, historically, a mostly experimental disciplne.\nOrganismal Biologists have frequently pushed experimental technological boundaries.\nExamples include confocal microscopy and other computerized imaging techniques; molecular techniques to identify taxa, measure population connectivity and understand patterns of development; and many other areas.\nThis innovative spirit has not reached similar levels in applying quantitative approaches like mathematical modeling and computer simulations to Organismal Biology.\nMathematical models have so far made only modest contributions to Organismal Biology.\nThe potential of mathematical tools to contribute to Organismal Biology, however, is much broader and deeper than the current literature reflects.\n\nOne reason thinking about and using models can benefit Organismal Biologists is that much of what we do already implicitly assumes some type of modeling framework.\nFor example, all statistics are based on underlying models about probability distributions and random processes that emerge from them (independent events, normal distributions, etc.).\nNearly all measurements of environmental characteristics (temperature, pH, salinity, etc.) are based on electrical measurements as proxies for the quantity being measured.\nThe resistance or voltage being measured is translated into the environmental quantity using models.\nEven more broadly, most experimental design is based (often on an unspoken, intuitive level) on assumptions about how a measurement or manipulation carries implications for a biological process ‚Äì in other words, a model.\n\nA great many scientists who undertake statistical tests, use environmental sensors or design experiments have little awareness of the ways their work is based solidly on modeling.\nBetter awareness of the modeling already involved in their work, especially if they also approach their investigations with a quantitative framework in mind, could result in a very satisfying synergy:\nModelers who also undertake experiments can design more innovative and insightful models.\nExperimentalists equipped with a modeling perspective can have insights that enable them to design better, more compelling experiments.\nThe best modeling of all is modeling while experimenting, when moving quickly between the computer and the laboratory or field site makes the connections between nature and models especially thought-provoking.\n\nDisseminating some of the background knowledge and experience for using models, and the understanding of why using models is a productive adjunct to traditional approaches in Organismal Biology, is a primary objective of this book.\nA future Organismal Biology in which the potential of models to enhance discovery is more fully exploited ‚Äì in which quantitative models are freely interdigitated among empirical methods and observations where each approach can best contribute  ‚Äì would be a more interesting, productive and impactful discipline.\n\nSome of the reasons Organismal Biologists might be interested in quantitative models are:\n\nModels are tools for inferring the logical consequences of specific assumptions.\n\nThe emphasis here is on the ‚Äúspecific assumptions‚Äù as much as on the ‚Äúlogical consequences‚Äù.\nIn a career of modeling biological processes in which I believed I was well versed, and of helping other biologists to formulate models in their own areas of expertise, I have consistently encountered two phenomena:\n\nFormulating a mathematical model requires specificity in details that are easy to overlook in conceptual thinking:\nExactly how is a process like morphogenesis, synchronized spawning, predator avoidance or gene flow regulated?\nIn what way are an egg, an early embryo, a larva and an adult ‚Äúindividuals‚Äù in a population model?\nI have been frequently flummoxed (and delighted) while modeling to discover basic aspects I had never thought about in organismal systems I thought I knew well.\nWriting down a quantitative model, even if results are never calculated, exposes these details and the intriguing new insights and questions that arise from them.\n\nDifferent scientists, especially scientists from different disciplines, use the same word with very different meanings.\nThis means that interdisciplinary collaborations, which are necessary and productive in Organismal Biology, are frequently derailed by misunderstandings between two experts who have firm, well-founded (but different) interpretations of the subject at hand.\nAn example is ‚Äúmemory‚Äù.\nTo a mathematician or statistician, a ‚Äúmemoryless system‚Äù is one in which the current state determines the probabilities of future events, without regard to how the current state was brought about.\nThus, a mathematician could happily formulate a ‚Äúmemoryless‚Äù model of the human brain.\nClearly, this would not be a biologist‚Äôs interpretation.\nConfounding vocabulary and other vagueness in terminology are usually clarified when the relevant biological mechanisms are expressed in mathematical form.\n\nModels are tools for inferring what we want to know from what we can measure.\n\nOrganismal Biology is frequently hampered by quantities and characteristics  that we want to know but cannot directly measure.\nWhat are the fitness implications of variants we observe in morphology, size, behavior, geography, or seasonality?\nWhat are the mechanisms responsible for patterns in speciation and extinction, for species range expansion and contraction, or for the prevalence or rarity of different life history strategies?\nHow is recruitment of a juvenile cohort limited or enhanced by each of the numerous biotic and abiotic environmental variables at a given time and place?\nHow are environmental signals transduced by sensory and regulatory processes into reproductive, foraging or mortality events?\n\nAll of these questions, and many more, involve unknowns that are difficult or impossible to measure.\nModeling provides approaches to infer quantities that cannot be measured.\nFor example, it is in most cases impractical to measure the mortality rates of organisms in most terrestrial and marine environments.\nDirect measurements would involve unobtrusive observations following a large sample size of individuals, recording whether and how they died.\nIn most cases, this is not possible to carry out.\nAn alternative is to track cohorts of juveniles, measuring changes in abundance, age- and stage- structure, and geographic distribution.\nFrom cohort data, combined with a modeling framework that provides quantitative predictions based on alternative mortality regimes, inferences can be made regarding plausible rates and mechanisms of mortality in the observed juvenile population (e.g. \n\nSchneider et al. (2003)).\n\nAnother way in which observations are constrained is in considering the consequences of hypothetical alternatives to observed characteristics such as morphology or life history.\nOrganisms that do not exist cannot be observed, but models that correctly reflect the key underlying mechanisms can give quantitative assessments of how hypothetical variations of extant organisms might function.\nThese models could give insight into why these variant don‚Äôt exist, in the context of implied changes in performance or distribution, or evolutionary costs and benefits.\n\nModels are tools for communicating biological knowledge across organizational levels.\n\nAnother way in which models can contribute to insights in Organismal Biology is by integrating specialized knowledge from different disciplines.\nFor example, biologists investigating maternal allocation to reproduction ‚Äì how many eggs of what size mom should make each year ‚Äì may focus on the physiology of egg production, the energy inputs and outputs of mature females, and coordination of spawning to maximize fertilization success.\nHowever, they would not be able to draw inferences about the costs and benefits of the traits they observe without context:\nWhat are the functional consequences of smaller or larger juveniles in terms of habitat selection, food capture and predator avoidance?\nWhat are the geographic implications of shorter or longer dispersal phases, and do those have implications for maintaining viable self-sustaining populations?\nHow do impacts in present environments compare to historical environments, or future environments affected by climate change?\n\nEach of these questions draws in the expertise of other scientists, whose understanding can be exploited by investigators of an organism‚Äôs reproductive biology.\nBiomechanical models may provide them with specific estimates of how locomotion and sensory performance is likely to differ in smaller or larger offspring.\nDemographic models may offer quantitative insight into the consequences of variations in maturation time and dispersal.\nGeophysical circulation models may predict the transport of propagules in winds, tides and currents, and environmental characteristics such as temperature, oxygen, chlorophyll and pH that may affect recruitment.\nClimate models may specify the environmental conditions in relevant to past and future environments.\nIn all these cases, quantitative models formulated at one biological or environmental level can be leveraged by investigators at another level.\nLeveraging models in this way provides a mechanisms for community level collaborations, in which investigators make their discoveries available in the form of publicly available and easily used toolkits.\nThis approach would mark a change for Organismal Biology, but would be following the productive pathways of other disciplines such as statistics, geophysical modeling and molecular biology.\n\nModels let you make scientific discoveries anytime, anywhere.\n\nBeyond all of these reasons, one additional point which has given me satisfaction is worth mentioning:\nMany interesting and important organisms are available only at narrowly constrained times and places, commonly a certain interval in spring or early summer, at a field station, marine lab  or offshore location.\nExperimental work in Organismal Biology grinds to a halt outside this very limited window in space and time.\nModeling is portable and extends the productive working season of a Organismal Biologist to year-round.\nA novel insight in Organismal Biology, even if obtained on a computer rather than a microscope, is equally thrilling in the dark winter months!","type":"content","url":"/overview-1","position":1},{"hierarchy":{"lvl1":"üßÆ Scale models and dynamic similarity"},"type":"lvl1","url":"/scale-models","position":0},{"hierarchy":{"lvl1":"üßÆ Scale models and dynamic similarity"},"content":"Much of the discussion in this book involves \n\nscale models.\nMost of us are familiar with scale models, even if we don‚Äôt ordimarily think of them using that name.\nFor example, a model boat that a child plays with in a bathtub is a scale model of a full sized boat that floats on the ocean.\nA doll is a scale model of a human being.\nAn architect often uses a scale model of a building to develop and explain a design.\nThese examples are of large objects made small enough to be practical and inexpensive, but scale models that are enlargements of the original can also be useful.\nFor example, a model of a microorganism or cell can be a useful tool for understanding its morphology and relationship with its surroundings.\n\nThese examples reflect geometric similarity.\nThat is, the derived objects are scale models because their components have geometries that are similar in proportion to the originals*.","type":"content","url":"/scale-models","position":1},{"hierarchy":{"lvl1":"üßÆ Scale models and dynamic similarity","lvl3":"Dynamic similarity"},"type":"lvl3","url":"/scale-models#dynamic-similarity","position":2},{"hierarchy":{"lvl1":"üßÆ Scale models and dynamic similarity","lvl3":"Dynamic similarity"},"content":"The concept of similarity can be extended to include forces acting on objects and their surroundings.\nThis concept is called \n\n‚Äúdynamic similarity‚Äù or ‚Äúsimilitude‚Äù.\nScale models are dynamically similar if, in addition to being geometrically similar in proportion, the different forces acting on them are also similar in proportion.\n\nThe additional requirement of equal proportional forces means that not all geometrically similar scale models are dynamically similar.\nWe all have an intuitive grasp of this fact.\nTo illustrate this, let‚Äôs look at video of a scale model of the Titanic sailing on a body of water:\n\nAs you watch this video, consider your intuition about how big the model is.\n\n# A convenient way to play this video from YouTube in a Jupyter notebook cell is \n#shown in this post:\n# https://gist.github.com/christopherlovell/e3e70880c0b0ad666e7b5fe311320a62\n# First, we import the appropriate library\nfrom IPython.display import YouTubeVideo\n\n\n\n# Next, we define a function to take care of some formatting awkwardness\n# in the URLs of YouTube videos\ndef display_yotube_video(url, **kwargs):\n    \"\"\"\n    Displays a Youtube video in a Jupyter notebook.\n    \n    Args:\n        url (string): a link to a Youtube video.\n        **kwargs: further arguments for IPython.display.YouTubeVideo\n    \n    Returns:\n        YouTubeVideo: a video that is displayed in your notebook.\n    \"\"\"\n    id_ = url.split(\"=\")[-1]\n    return YouTubeVideo(id_, **kwargs)\n\n\n\n\n# Finally, we use this function to link to a video by Rick Norris of his Titanic model\n# sailing on a pond.\ndisplay_yotube_video(\"https://www.youtube.com/watch?v=8hghNqCZmso\", width=800, height=600)\n\n\n\nWhat is your intuitive estimate of the size of this model?\n\nThe model in this video is a very detailed scale model of the Titanic.\nIt is geometrically similar in nearly every visible detail, and in a great many that are not visible.\nThere is little direct information about the size of the model (such as a ruler, human hand or other object of known scale)\nNonetheless, it is immediately apparent from watching the video that this model is not 267 meters long, like the full sized Titanic was.\nWhat is it about the video that makes the model seem smaller?\n\nIt is the context of the water motion.\nThe water is behaving as water always does, and the model is geometrically similar.\nHowever, the relative motion of the water waves and model are out of proportion with each other, compared to a full sized ship moving in the ocean.\n\nThat is, the forces moving the ship and the forces moving the water are not in the proper proportions.\nTherefore, this geometrically similar model is not dynamically similar.\n\nOur intuition based on many experiences watching lakes, oceans, pools and other water bodies gives us a sense of scale for waves.\nThe model gives little indication of its size, but the size scale suggested by our intuition for the water waves tells us that the model is only about a meter long (it‚Äôs actually a 1:212 scale model, with a length of roughly 1.25m).\n\n","type":"content","url":"/scale-models#dynamic-similarity","position":3},{"hierarchy":{"lvl1":"üßÆ Scale models and dynamic similarity","lvl4":"Ship model basins","lvl3":"Dynamic similarity"},"type":"lvl4","url":"/scale-models#ship-model-basins","position":4},{"hierarchy":{"lvl1":"üßÆ Scale models and dynamic similarity","lvl4":"Ship model basins","lvl3":"Dynamic similarity"},"content":"For comparison, let‚Äôs take a look at a \n\nship model basin, also known as a ‚Äútow tank‚Äù.\nA ship model basin is a facility for inferring characteristics of full sized ship, from measurements of motions and forces on much smaller scale models.\nThe video below shows some sequences of scale models being towed in Southhampton University‚Äôs Boldrewood Towing Tank as part of engineering studies:\n\n# This displays a video posted of the [QinetiQ Ship Tank](https://www.qinetiq.com)\ndisplay_yotube_video(\"https://www.youtube.com/watch?v=Q9qZcN5iX2k\", width=800, height=600)\n\n\n\nThe video shows a modern ship model basin being used to observe water interactions with the moving ship and boat models in great detail.\nThe bow and stern waves from these models are dramatically more reminiscent of those from a full sized ship than the Titanic video.\nIn fact, if it were not for the people on the moving gantry, it would be difficult to estimate the size of these scale models just by observing their interactions with the water.\nThe difference betwen the two videos is that the models in the second video are set up by engineers to be dynamically similar, while the first model is not.\n\n","type":"content","url":"/scale-models#ship-model-basins","position":5},{"hierarchy":{"lvl1":"üßÆ Scale models and dynamic similarity","lvl2":"Establishing dynamic similarity"},"type":"lvl2","url":"/scale-models#establishing-dynamic-similarity","position":6},{"hierarchy":{"lvl1":"üßÆ Scale models and dynamic similarity","lvl2":"Establishing dynamic similarity"},"content":"How did the engineers in the video know how to design the model and set its movement so that it would be dynamically similar?\n\nThe criterion an engineer used to determine dynamic similarity is called the \n\nFroud number, abbreviated as \\mathcal{Fr}.\nThe Froud number associated with a full sized ship  of length L sailing on the ocean at speed U is defined as\n\n{\\mathcal{Fr}} = \\frac{U}{\\sqrt{g L}}\n\nwere g is gravitational acceleration.\n\nIf a scale model of the ship which has length L_{model} travels at speed U_{model}, its Froud number is\n\n{\\mathcal{Fr_{model}}} = \\frac{U_{model}}{\\sqrt{g L_{model}}}\n\nWhen\n\n{\\mathcal{Fr}} = {\\mathcal{Fr_{model}}}\n\nthe full sized ship and the model are dynamically similar.\nThis is the condition created by the engineers in the second video.\nAs you can see, the resulting water motion resembles that around a real vessel much more than the dynamically dis-similar model in the first video.\n\n","type":"content","url":"/scale-models#establishing-dynamic-similarity","position":7},{"hierarchy":{"lvl1":"üßÆ Scale models and dynamic similarity","lvl3":"Why does the Froud number determine dynamic similarity for ships and ship models?","lvl2":"Establishing dynamic similarity"},"type":"lvl3","url":"/scale-models#why-does-the-froud-number-determine-dynamic-similarity-for-ships-and-ship-models","position":8},{"hierarchy":{"lvl1":"üßÆ Scale models and dynamic similarity","lvl3":"Why does the Froud number determine dynamic similarity for ships and ship models?","lvl2":"Establishing dynamic similarity"},"content":"The Froud number is based on the speed at which water waves travel.\nThis speed is a function of their wavelength, L_w (the distance between neighboring crests): water waves‚Äô speed is (in the ideal case) proportional to \\sqrt{L_w} (and to g, the gravitational acceleration).\nThe Froud number is the ratio of the full sized ship‚Äôs speed, divided by the estimated speed of a wave equal in length to the ship.\n\nWhy do the relative lengths of the ship and wave matter?\nIt is because a moving ship generates waves traveling around the same speed it‚Äôs traveling.\nThat means a slow ship is generating slow, short waves.\nAs the ship increases speed, it generates faster, longer waves.\n\nA ship can effectively ‚Äústraddle‚Äù and plow through waves that are much shorter than its hull.\nHowever, when a wave starts to get to as long or longer than the hull, the ship‚Äôs stern gets caught in the trough while the bow is raised in the crest.\nThat means that, in effect, the ship is continuously going uphill!\nWhen this happens, an increase in propulsive power just adds to the size of the wave being generated ‚Äì it has almost no effect on ship speed.\n\nIn effect, the length of the hull imposes a ‚Äúspeed limit‚Äù: the speed of waves as long as the ship.\nThis is known as the hull speed.\nThe faster hull speeds of longer vessels is one of the reasons racing shells, hunting kayaks, container ships and many other watercraft for which speed is important tend to be long.\n\nThe Froud number, \\cal{Fr}, is a ship‚Äôs speed expressed as a fraction of its hull speed.\nA model with matching Froud number ‚Äì that is, traveling at the same fraction of its hull speed -- will both in appearance and in the quantitative measures of force and motion match the full sized ship.\nThat is, the ship and model will be dynamically similar.\n\n","type":"content","url":"/scale-models#why-does-the-froud-number-determine-dynamic-similarity-for-ships-and-ship-models","position":9},{"hierarchy":{"lvl1":"üßÆ Scale models and dynamic similarity","lvl3":"Nondimensional numbers","lvl2":"Establishing dynamic similarity"},"type":"lvl3","url":"/scale-models#nondimensional-numbers","position":10},{"hierarchy":{"lvl1":"üßÆ Scale models and dynamic similarity","lvl3":"Nondimensional numbers","lvl2":"Establishing dynamic similarity"},"content":"The Froud number is a ratio of two quantities ‚Äì the wave speed and the hull speed of a moving ship or model &ndash that have the same units, \\frac{m}{s}.\nBecause the units of the numerator and denomenator cancel, the Froud number is dimensioness.\n\nThe Froud number is one of many indices in engineering, physics and biology that has this characteristic. These indices are usually referred to with the slightly unintuitive name \n\nnon-dimensional numbers (also known as ‚Äúdimensionless quantities‚Äù).\nNondimensional indices that express the ratio of two lengths, speeds, masses, rates or other characteristics relevant to an organism‚Äôs biology are often informative about that organism‚Äôs function.\n\nFor example, you may already be familiar with a nondimensional number from epidemiology: the pathogen reproductive number, \\mathcal{R}.\n\\mathcal{R} is the number of new infections caused by a primary infection before it is cleared.\nIf \\mathcal{R}<1, then each successing round of infection is smaller; the infected population is then decreasing, and an epidemic is not possible.\nIf \\mathcal{R}>1, then each successing round of infection is larger; the infected population is increasing and an epidemic can occur.\n\nBy summarizing the conditions under which an epidemic is or is not possible, the nondimensional index \\mathcal{R} highlights factors that make epidemics more likely (those that incease \\mathcal{R}, such as high contact rates among susceptibles and poor hygiene) and those that make epidemics less likely (those that decrease \\mathcal{R}, such as reduction in susceptibility through vaccination and good hygiene).\n\nBecause nondimensional numbers play similarly useful roles in many aspects of Organismal Biology, it is worth thinking about them in some detail.","type":"content","url":"/scale-models#nondimensional-numbers","position":11},{"hierarchy":{"lvl1":"Terms of Use"},"type":"lvl1","url":"/terms","position":0},{"hierarchy":{"lvl1":"Terms of Use"},"content":"Except where otherwise stated, the original content of this book can be freely downloaded and used under a Creative Commons 4.0 BY-NC-SA license.\nThis license allows you to share and adapt the content for non-commercial purposes, as long as you use proper attribution and share the resulting materials under the same license.\nDefinitions of the italicized terms and other significant details of this license are given in the linked text, a copy of which is also provided with source materials for the book.\n\nSome original code content of this book can be freely downloaded and used under a permissive MIT license.\n\nDifferent terms of use for subsections of the book that are drawn from separate GitHub repositories, possibly by different authors, are specified in those repositories.\nThis includes, for example, content in the forked repositories on the \n\nOSYM GitHub repository or linked to those repositories (see the additional comments on submodules below).\nUsers wishing to use book content outside the specified terms of use (e.g. for commercial purposes) should check with the authors to clarify what is and isn‚Äôt permitted.","type":"content","url":"/terms","position":1},{"hierarchy":{"lvl1":""},"type":"lvl1","url":"/readme-4","position":0},{"hierarchy":{"lvl1":""},"content":"","type":"content","url":"/readme-4","position":1},{"hierarchy":{"lvl1":"üßÆ Design and save early larval morphologies"},"type":"lvl1","url":"/chimeradesign","position":0},{"hierarchy":{"lvl1":"üßÆ Design and save early larval morphologies"},"content":"This is a graphical interface for designing and saving early larval forms for exploring swimming and stability characteristics with the pyVRS (Python Volume-Rendered Swimmer) model of low-Reynolds number hydrodynamics. It has a simplified interface for entering parameters to investigate stability and movement of early-stage larval morphologies (e.g., eggs, blastulae and gastrulae) approximated by ‚Äúchimeras‚Äù of semi-spheroids. These early larval shapes are constructed by joining two half-spheroids about a common central radius.\n\nBy choosing different spheroid shapes (larger vs. smaller central radii; longer vs. shorter semi-spheroids, etc.) you can construct different surface shapes that resemble the outside surfaces of early stages in larval development. You can assign the main volume inside this surface to have a density that reflects the larval tissue within this surface.\n\nYou can also add inclusions, constructed from two half-spheroids, to reflect the inner structure of early stage larvae. You can assign different densities to model the effects of internal volumes of these inclusions, to reflect whether they are filled with seawater, calcium carbonate, lipid, or other materials.\n\nThe resulting shapes do not represent any particular species and stage exactly, but they approximate early stages including eggs, gastrulae and blastulae from a wide diversity of species, and an even wider diversity of hypothetical larval morphologies that do not appear in nature. This makes these shapes good tools for exploring the consequences of size, morphological and physiological features, and properties of the fluid environment such as shear.\n\n","type":"content","url":"/chimeradesign","position":1},{"hierarchy":{"lvl1":"üßÆ Design and save early larval morphologies","lvl2":"How to use this notebook"},"type":"lvl2","url":"/chimeradesign#how-to-use-this-notebook","position":2},{"hierarchy":{"lvl1":"üßÆ Design and save early larval morphologies","lvl2":"How to use this notebook"},"content":"This notebook is set up with ‚Äúcells‚Äù that contain either Python code or explanatory text. You can see the cells by the bars and numbers on the left side of the notebook window.\n\nTo set up the codes for exploring early stage larval morphology, pull down the Run menu and select Run All Cells","type":"content","url":"/chimeradesign#how-to-use-this-notebook","position":3},{"hierarchy":{"lvl1":"üßÆ Design and save early larval morphologies","lvl3":"Executing Jupyter notebook cells","lvl2":"How to use this notebook"},"type":"lvl3","url":"/chimeradesign#executing-jupyter-notebook-cells","position":4},{"hierarchy":{"lvl1":"üßÆ Design and save early larval morphologies","lvl3":"Executing Jupyter notebook cells","lvl2":"How to use this notebook"},"content":"To execute a code cell, select it and hold down the shift key while typing the enter key.\n\nTo reset the model to its initial state, pull down the Run menu and select Restart Kernel and Run All Cells","type":"content","url":"/chimeradesign#executing-jupyter-notebook-cells","position":5},{"hierarchy":{"lvl1":"üßÆ Design and save early larval morphologies","lvl3":"Using graphics output","lvl2":"How to use this notebook"},"type":"lvl3","url":"/chimeradesign#using-graphics-output","position":6},{"hierarchy":{"lvl1":"üßÆ Design and save early larval morphologies","lvl3":"Using graphics output","lvl2":"How to use this notebook"},"content":"When the model starts, it creates a larval shape using default parameters. That shape is shown in a separate, resizable graphics window. You can:\n\nClick and drag on graphics windows to control the viewing angle.\n\nClick on the floppy disk icon to save graphics windows as images. Use informative names like default_shape.svg so that you can tell one image from another later on.","type":"content","url":"/chimeradesign#using-graphics-output","position":7},{"hierarchy":{"lvl1":"üßÆ Design and save early larval morphologies","lvl3":"Selecting a larval shape","lvl2":"How to use this notebook"},"type":"lvl3","url":"/chimeradesign#selecting-a-larval-shape","position":8},{"hierarchy":{"lvl1":"üßÆ Design and save early larval morphologies","lvl3":"Selecting a larval shape","lvl2":"How to use this notebook"},"content":"Below, you can adjust geometrical parameters to select a larval shape:\n\nUse input boxes to modify a shape or define a new one, and then calculate its hydrodynamic properties\n\nExperiment by changing one or more geometrical parameters, and plotting the result.\n\nWhen you have a morphology that you are interested in simulating, save that shape to a file which you can import into the ChimeraSwim simulation.\n\nSave a file containing the current shape for use in a future session\n\n# Set up graphics environment\n#%matplotlib inline\n#%matplotlib notebook\n#import IPython\n%matplotlib widget\n#%matplotlib ipympl\nfrom matplotlib import pyplot\npyplot.ioff()\n#pyplot.ion()\nfrom mpl_interactions import ipyplot as iplt\nfrom mpl_toolkits import mplot3d\nfrom matplotlib.colors import LightSource\n# Import modules\nimport numpy as np\nfrom math import pi\nimport os\n# set up path to submodules\nimport sys\n#sys.path.append('../../../submodules/')\n#sys.path.append('../../../submodules/pyVRS')\nimport pyVRSmorph as mrph\nimport pyVRSflow as flw\nfrom meshSpheroid import chimeraSpheroid\n# Import widget infrastructure\nfrom ipywidgets import interact, interactive, fixed, interact_manual, Output\nimport ipywidgets as widgets\nfrom IPython import display as idisplay\nimport pickle\nfrom ipyfilechooser import FileChooser\nfrom copy import deepcopy\n\n\n\n# Create a class and global instances for morphology parameters\nglobal surf_pars, incl1_pars, incl2_pars\nclass CEpars():\n    \"\"\"\n    A simple class to facilitate acquiring and passing chimera ellipsoid\n    parameters with interactive_output widgets.\n    \"\"\"\n    def __init__(self,D=50.e-6,L1=100.e-6,L2=-40.e-6,d=6e-6,nlevel0=16,nlevel1=12,\n                      translate0=0.,translate1=0.,translate2=0.):\n        self.D = D\n        self.L1 = L1\n        self.L2 = L2\n        self.Ls = [L1,L2]\n        self.d = d\n        self.nlevels = [nlevel0,nlevel1]\n        self.translate = [translate0,translate1,translate2]\n\ndef set_surf_pars(D,L1,L2,d,nlevel0,nlevel1):\n    global surf_pars\n    surf_pars=CEpars(D=D,L1=L1,L2=L2,d=d,nlevel0=nlevel0,nlevel1=nlevel1)\n\ndef set_incl1_pars(D,L1,L2,d,nlevel0,nlevel1,translate0,translate1,translate2):\n    global incl1_pars\n    incl1_pars=CEpars(D=D,L1=L1,L2=L2,d=d,nlevel0=nlevel0,nlevel1=nlevel1,\n                      translate0=translate0,translate1=translate1,translate2=translate2)\n\ndef set_incl2_pars(D,L1,L2,d,nlevel0,nlevel1,translate0,translate1,translate2):\n    global incl2_pars\n    incl2_pars=CEpars(D=D,L1=L1,L2=L2,d=d,nlevel0=nlevel0,nlevel1=nlevel1,\n                      translate0=translate0,translate1=translate1,translate2=translate2)\n\n\n\n\n\n","type":"content","url":"/chimeradesign#selecting-a-larval-shape","position":9},{"hierarchy":{"lvl1":"üßÆ Design and save early larval morphologies","lvl2":"To design a new larval shape: "},"type":"lvl2","url":"/chimeradesign#to-design-a-new-larval-shape","position":10},{"hierarchy":{"lvl1":"üßÆ Design and save early larval morphologies","lvl2":"To design a new larval shape: "},"content":"Scroll to the shape parameter input boxes (there are separate parameter sets for the larval surface and inclusions).\n\nChange one or more shape parameters, and re-execute the code cell below to calculate and visualize the shape.\n\nWhen you are satisfied with the shape, re-execute the next code cells to recalculate flow around the new shapes.\n\nRun the simulation as before, with Reset to create a new simulation window and Run to visualize swimming trajectories.\n\n","type":"content","url":"/chimeradesign#to-design-a-new-larval-shape","position":11},{"hierarchy":{"lvl1":"üßÆ Design and save early larval morphologies","lvl3":"Define the outer larval shape","lvl2":"To design a new larval shape: "},"type":"lvl3","url":"/chimeradesign#define-the-outer-larval-shape","position":12},{"hierarchy":{"lvl1":"üßÆ Design and save early larval morphologies","lvl3":"Define the outer larval shape","lvl2":"To design a new larval shape: "},"content":"\n\nThe text boxes below enable you to set the shape parameters for the outside of a model larva. To change parameters, enter a new value and hit enter. The parameters are:\n\nD: central diameter\n\nL_1: length of the top semi-ellipse (distance from the upper tip to the equator)\n\nL_2: length of the bottom semi-ellipse (distance from the lower tip to the equator)\n\nAdditional parameters (that you may not have to adjust) specify the layout of triangles on the larval surface.\n\nd, a parameter specifying the number of columns of triangles on the top and bottom parts of the larval surface\n\nn_0 and n_1 specify the number of rows of triangles on the top and bottom parts of the larval surface\n\n# Set parameters for surface chimera\nsurf_D=widgets.FloatText(value=50.e-6,width=10,description = r\"$D$\")\nsurf_d=widgets.FloatText(value=6.e-6,description = r\"$d$\")\nsurf_L1=widgets.FloatText(value=100.e-6,description = r\"$L_1$\")\nsurf_nlevel0=widgets.IntText(value=16,description = r\"$n_0$\")\nsurf_L2=widgets.FloatText(value=40.e-6,description = r\"$L_2$\")\nsurf_nlevel1=widgets.IntText(value=12,description = r\"$n_1$\")\n\nui0 = widgets.VBox([surf_D,surf_d])\nui1 = widgets.VBox([surf_L1,surf_nlevel0])\nui2 = widgets.VBox([surf_L2,surf_nlevel1])\nui012 = widgets.HBox([ui0,ui1,ui2])\n\nout = widgets.interactive_output(set_surf_pars,{'D':surf_D,'L1':surf_L1,'L2':surf_L2,'d':surf_d,\n                                                'nlevel0':surf_nlevel0,'nlevel1':surf_nlevel1})\ndisplay(ui012,out)\n\n\n\n\n\n","type":"content","url":"/chimeradesign#define-the-outer-larval-shape","position":13},{"hierarchy":{"lvl1":"üßÆ Design and save early larval morphologies","lvl3":"Define an inclusion","lvl2":"To design a new larval shape: "},"type":"lvl3","url":"/chimeradesign#define-an-inclusion","position":14},{"hierarchy":{"lvl1":"üßÆ Design and save early larval morphologies","lvl3":"Define an inclusion","lvl2":"To design a new larval shape: "},"content":"The text boxes below enable you to set the shape parameters for inclusions inside a model larva. The parameters have the same interpretations as for the outer shape:\n\na: central radius\n\nb_0: length of the top semi-ellipse\n\nb_1: length of the bottom semi-ellipse (a negative number, because this semi-ellipse points downwards)\n\nAdditional parameters (that you may not have to adjust) specify the layout of triangles on the inclusion.\n\nd, a parameter specifying the number of columns of triangles on the top and bottom parts of the inclusion\n\nn_0 and n_1 specify the number of rows of triangles on the top and bottom parts of the inclusion\n\nMake sure the surfaces do not intersect (that is, the inclusion is entirely within the outer surface, etc.)!\n\n# Set parameters for the inclusion chimera\nincl1_D=widgets.FloatText(value=30.e-6,width=10,description = r\"$D$\")\nincl1_d=widgets.FloatText(value=5.e-6,description = r\"$d$\")\nincl1_L1=widgets.FloatText(value=50.e-6,description = r\"$L_1$\")\nincl1_nlevel0=widgets.IntText(value=12,description = r\"$n_0$\")\nincl1_L2=widgets.FloatText(value=20.e-6,description = r\"$L_2$\")\nincl1_nlevel1=widgets.IntText(value=8,description = r\"$n_1$\")\nincl1_translate0=widgets.FloatText(value=0.,description = r\"$x$ offset\")\nincl1_translate1=widgets.FloatText(value=0.,description = r\"$y$ offset\")\nincl1_translate2=widgets.FloatText(value=40.e-6,description = r\"$z$ offset\")\n\n#translate=[0.,0.,40.e-6]\n\nui0i = widgets.VBox([incl1_D,incl1_d,incl1_translate0])\nui1i = widgets.VBox([incl1_L1,incl1_nlevel0,incl1_translate1])\nui2i = widgets.VBox([incl1_L2,incl1_nlevel1,incl1_translate2])\nui012i = widgets.HBox([ui0i,ui1i,ui2i])\n\n\nouti = widgets.interactive_output(set_incl1_pars,{'D':incl1_D,'L1':incl1_L1,'L2':incl1_L2,'d':incl1_d,\n                                                'nlevel0':incl1_nlevel0,'nlevel1':incl1_nlevel1,\n                                                'translate0':incl1_translate0,\n                                                'translate1':incl1_translate1,\n                                                'translate2':incl1_translate2})\ndisplay(ui012i,outi)\n\n\n\n\n\n","type":"content","url":"/chimeradesign#define-an-inclusion","position":15},{"hierarchy":{"lvl1":"üßÆ Design and save early larval morphologies","lvl3":"Visualize the new larval shape","lvl2":"To design a new larval shape: "},"type":"lvl3","url":"/chimeradesign#visualize-the-new-larval-shape","position":16},{"hierarchy":{"lvl1":"üßÆ Design and save early larval morphologies","lvl3":"Visualize the new larval shape","lvl2":"To design a new larval shape: "},"content":"Execute this code cell to plot out the shape of the larva specified by the parameters you entered in the input boxes above. If you‚Äôre happy with the goemetry, proceed to the next step. If not, change the parameters and re-execute this cell again to display the new shape.\n\nCEsurf = chimeraSpheroid(D=surf_pars.D,L1=surf_pars.L1,L2=surf_pars.L2,d=surf_pars.d,nlevels=surf_pars.nlevels)\nCEincl = chimeraSpheroid(D=incl1_pars.D,L1=incl1_pars.L1,L2=incl1_pars.L2,d=incl1_pars.d,nlevels=incl1_pars.nlevels,translate=incl1_pars.translate)\nMnew = mrph.Morphology()\nMnew.check_normals = False\nMnew.gen_surface(vectors=CEsurf.vectors)\n# materials parameter can be 'seawater', 'tissue', 'lipid' or 'calcite' \nMnew.gen_inclusion(vectors=CEincl.vectors,material='freshwater',immersed_in=1)\n\nfigureM = pyplot.figure(num=57)\naxesM = figureM.add_subplot(projection='3d')\nMnew.plot_layers(axes=axesM)\n\nfigureM.canvas.draw()\nfigureM.canvas.flush_events()\npyplot.pause(0.25)\n#pyplot.ioff()\n\n\n\n\n\n","type":"content","url":"/chimeradesign#visualize-the-new-larval-shape","position":17},{"hierarchy":{"lvl1":"üßÆ Design and save early larval morphologies","lvl3":"Compute the fluid forces","lvl2":"To design a new larval shape: "},"type":"lvl3","url":"/chimeradesign#compute-the-fluid-forces","position":18},{"hierarchy":{"lvl1":"üßÆ Design and save early larval morphologies","lvl3":"Compute the fluid forces","lvl2":"To design a new larval shape: "},"content":"Executing this cell will compute the geometry and fluid flow around the model larva.\n\nDepending on the number of triangle and the speed of your computer, it may take a few seconds to complete:\n\nWhen it starts calculating, it prints out ‚ÄúCalculating inverse...‚Äù.\n\nWhen the calculation is complete, it prints out ‚ÄúDone calculating inverse.‚Äù\n\nThe output includes statistics like the magnitudes and centers of buoyancy and gravity.\n\nYou need to run this just once for each larval shape. You do not need to rerun it unless you change the larval shape.\n\nbutton6 = widgets.Button(description=\"Calculate flow\")\noutput6 = widgets.Output()\n\nbuttonsC = widgets.HBox([button6, output6])\ndisplay(buttonsC)\n\n@output6.capture()\ndef on_button_clicked6(b):\n    Mnew.body_calcs()\n    Mnew.flow_calcs(surface_layer=1)\n    \nbutton6.on_click(on_button_clicked6)\n\n\n\n\n\n","type":"content","url":"/chimeradesign#compute-the-fluid-forces","position":19},{"hierarchy":{"lvl1":"üßÆ Design and save early larval morphologies","lvl2":"Saving a larval shape "},"type":"lvl2","url":"/chimeradesign#saving-a-larval-shape","position":20},{"hierarchy":{"lvl1":"üßÆ Design and save early larval morphologies","lvl2":"Saving a larval shape "},"content":"\n\n# Create and display a FileChooser widget\nfc_s = FileChooser()\nfc_s.filter_pattern = '*.pickle'\nfc_s.title = '<b>Choose a filename for this larval morphology:</b>'\nfc_s.default_filename = 'new_morph.pickle'\n\ndisplay(fc_s)\n\n\n\n\n\nbutton3 = widgets.Button(description=\"Save file\")\noutput3 = widgets.Output()\n\nbuttonsS = widgets.HBox([button3, output3])\ndisplay(buttonsS)\n\n@output3.capture()\ndef on_button_clicked3(b):\n    with open(fc_s.selected, 'wb') as handle:\n        #print(f'Saving morphology as {fc_s.selected}')\n        Mnew.clear_big_arrays()\n        pickle.dump(Mnew, handle, protocol=pickle.HIGHEST_PROTOCOL)\n        print(f'Saved morphology as {fc_s.selected}')\n\nbutton3.on_click(on_button_clicked3)\n\n\n\n\n\n\n\n","type":"content","url":"/chimeradesign#saving-a-larval-shape","position":21},{"hierarchy":{"lvl1":"üßÆ Swimming of early larval stages in still water and shear"},"type":"lvl1","url":"/chimeraswim","position":0},{"hierarchy":{"lvl1":"üßÆ Swimming of early larval stages in still water and shear"},"content":"This is a notebook interface for using the pyVRS (Python Volume-Rendered Swimmer) model of low-Reynolds number hydrodynamics. It has a simplified interface for entering parameters to investigate stability and movement of early-stage larval morphologies (e.g., eggs, blastulae and gastrulae) approximated by ‚Äúchimeras‚Äù of semi-spheroids. These early larval shapes are constructed by joining two half-spheroids about a common central radius.\n\nBy choosing different spheroid shapes (larger vs. smaller central radii; longer vs. shorter semi-spheroids, etc.) you can construct different surface shapes that resemble the outside surfaces of early stages in larval development. You can assign the main volume inside this surface to have a density that reflects the larval tissue within this surface.\n\nYou can also add inclusions, constructed from two half-spheroids, to reflect the inner structure of early stage larvae. You can assign different densities to model the effects of internal volumes of these inclusions, to reflect whether they are filled with seawater, calcium carbonate, lipid, or other materials.\n\nThe resulting shapes do not represent any particular species and stage exactly, but they approximate early stages including eggs, gastrulae and blastulae from a wide diversity of species, and an even wider diversity of hypothetical larval morphologies that do not appear in nature. This makes these shapes good tools for exploring the consequences of size, morphological and physiological features, and properties of the fluid environment such as shear.\n\nThis interface has two parts:\n\nChimeraSwim.ipynb (this notebook) simulates the swimming of early-stage larval shapes using pre-calculated data from files.\n\nChimeraDesign.ipynb enables you to specify new larval shapes and save them into files, that can be loaded and simulated in this notebook.\n\n","type":"content","url":"/chimeraswim","position":1},{"hierarchy":{"lvl1":"üßÆ Swimming of early larval stages in still water and shear","lvl2":"How to use this notebook"},"type":"lvl2","url":"/chimeraswim#how-to-use-this-notebook","position":2},{"hierarchy":{"lvl1":"üßÆ Swimming of early larval stages in still water and shear","lvl2":"How to use this notebook"},"content":"This notebook is set up with ‚Äúcells‚Äù that contain either Python code or explanatory text. You can see the cells by the bars and numbers on the left side of the notebook window.","type":"content","url":"/chimeraswim#how-to-use-this-notebook","position":3},{"hierarchy":{"lvl1":"üßÆ Swimming of early larval stages in still water and shear","lvl3":"Executing Jupyter notebook cells","lvl2":"How to use this notebook"},"type":"lvl3","url":"/chimeraswim#executing-jupyter-notebook-cells","position":4},{"hierarchy":{"lvl1":"üßÆ Swimming of early larval stages in still water and shear","lvl3":"Executing Jupyter notebook cells","lvl2":"How to use this notebook"},"content":"To start the model, pull down the Run menu and select Run All Cells\n\nTo execute a code cell, select it and hold down the shift key while typing the enter key.\n\nTo reset the model to its initial state, pull down the Run menu and select Restart Kernel and Run All Cells","type":"content","url":"/chimeraswim#executing-jupyter-notebook-cells","position":5},{"hierarchy":{"lvl1":"üßÆ Swimming of early larval stages in still water and shear","lvl3":"Using graphics output","lvl2":"How to use this notebook"},"type":"lvl3","url":"/chimeraswim#using-graphics-output","position":6},{"hierarchy":{"lvl1":"üßÆ Swimming of early larval stages in still water and shear","lvl3":"Using graphics output","lvl2":"How to use this notebook"},"content":"When the model starts, it creates a larval shape using default parameters. That shape is shown in a separate, resizable graphics window. When the simulation has finished, you can:\n\nClick and drag on graphics windows to control the viewing angle.\n\nClick on the floppy disk icon to save graphics windows as images. Use informative names like default_shape.svg so that you can tell one image from another later on.","type":"content","url":"/chimeraswim#using-graphics-output","position":7},{"hierarchy":{"lvl1":"üßÆ Swimming of early larval stages in still water and shear","lvl3":"Selecting a larval shape","lvl2":"How to use this notebook"},"type":"lvl3","url":"/chimeraswim#selecting-a-larval-shape","position":8},{"hierarchy":{"lvl1":"üßÆ Swimming of early larval stages in still water and shear","lvl3":"Selecting a larval shape","lvl2":"How to use this notebook"},"content":"In this notebook, you can select larval shapes from among the ‚Äúmorph.pickle‚Äù files:\n\nLoad a file containing the shape and pre-computed hydrodynamic properties\n\nIn the notebook ChimeraDesign, use input boxes to modify a shape or define a new one, calculate its hydrodynamic properties and save it as a file\n\nA good way to start is by loading an existing shape (or use the default shape that is automatically loaded below), and running a few simulations with it.\n\nRun simulations using the current shape\n\nWhen you are familiar with the simulation interface, and have explored the effects of flow on this shape, you can try alternative shapes to see how morphology affects swimming.\nYou can then save that shape to simulate it in a future session without having to recompute it.\n\nSave a file containing the current shape for use in a future session\n\n# Set up graphics environment\n#%matplotlib inline\n#%matplotlib notebook\n#import IPython\n%matplotlib widget\n#%matplotlib ipympl\nfrom matplotlib import pyplot\npyplot.ioff()\n#pyplot.ion()\nfrom mpl_interactions import ipyplot as iplt\nfrom mpl_toolkits import mplot3d\nfrom matplotlib.colors import LightSource\n# Import modules\nimport numpy as np\nfrom math import pi\nimport os\n# set up path to submodules\nimport sys\n#sys.path.append('../../../submodules/')\n#sys.path.append('../../../submodules/pyVRS')\nimport pyVRSmorph as mrph\nimport pyVRSflow as flw\nfrom meshSpheroid import chimeraSpheroid\n# Import widget infrastructure\nfrom ipywidgets import interact, interactive, fixed, interact_manual, Output\nimport ipywidgets as widgets\nfrom IPython import display as idisplay\nimport pickle\nfrom ipyfilechooser import FileChooser\nfrom copy import deepcopy\n\n\n\n# Create a class and global instances for morphology parameters\nglobal surf_pars, incl1_pars, incl2_pars\nclass CEpars():\n    \"\"\"\n    A simple class to facilitate acquiring and passing chimera ellipsoid\n    parameters with interactive_output widgets.\n    \"\"\"\n    def __init__(self,D=50.e-6,L1=100.e-6,L2=-40.e-6,d=6e-6,nlevel0=16,nlevel1=12,\n                      translate0=0.,translate1=0.,translate2=0.):\n        self.D = D\n        self.L1 = L1\n        self.L2 = L2\n        self.Ls = [L1,L2]\n        self.d = d\n        self.nlevels = [nlevel0,nlevel1]\n        self.translate = [translate0,translate1,translate2]\n\ndef set_surf_pars(D,L1,L2,d,nlevel0,nlevel1):\n    global surf_pars\n    surf_pars=CEpars(D=D,L1=L1,L2=L2,d=d,nlevel0=nlevel0,nlevel1=nlevel1)\n\ndef set_incl1_pars(D,L1,L2,d,nlevel0,nlevel1,translate0,translate1,translate2):\n    global incl1_pars\n    incl1_pars=CEpars(D=D,L1=L1,L2=L2,d=d,nlevel0=nlevel0,nlevel1=nlevel1,\n                      translate0=translate0,translate1=translate1,translate2=translate2)\n\ndef set_incl2_pars(D,L1,L2,d,nlevel0,nlevel1,translate0,translate1,translate2):\n    global incl2_pars\n    incl2_pars=CEpars(D=D,L1=L1,L2=L2,d=d,nlevel0=nlevel0,nlevel1=nlevel1,\n                      translate0=translate0,translate1=translate1,translate2=translate2)\n\n\n\n# Create a class and global instances for simulation parameters\nglobal sim_pars\nclass SimPars():\n    \"\"\"\n    A simple class to facilitate acquiring and passing VRS simulation\n    parameters with interactive_output widgets.\n    \"\"\"\n    def __init__(self,dudz=0.,dvdz=0.,dwdx=0.,U0=0.,U1=0.,U2=0.,\n                 Tmax=20.,cil_speed=0.5*1000*1e-6,\n                 phi=pi/3.,theta=-pi/4.,psi=pi):\n        self.dudz = dudz\n        self.dvdz = dvdz\n        self.dwdx = dwdx\n        self.U0 = U0\n        self.U1 = U1\n        self.U2 = U2\n        self.Tmax = Tmax\n        self.cil_speed = cil_speed\n        self.S_fixed = np.asarray([0.,0.,dudz,0.,0.,dvdz,dwdx,0.,0.])\n        self.U_const_fixed = np.asarray([U0,U1,U2])\n        self.XEinit = np.asarray([0.,0.,0.,phi,theta,psi])\n\ndef set_sim_pars(dudz,dvdz,dwdx,Tmax,cil_speed,phi,theta,psi):\n    global sim_pars\n    sim_pars=SimPars(dudz=dudz,dvdz=dvdz,dwdx=dwdx,\n                 Tmax=Tmax,cil_speed=cil_speed,\n                 phi=phi,theta=theta,psi=psi)\n\nprint('Simulation parameters class defined...')\n\n\n\n\n\n\n\n\n\n","type":"content","url":"/chimeraswim#selecting-a-larval-shape","position":9},{"hierarchy":{"lvl1":"üßÆ Swimming of early larval stages in still water and shear","lvl2":"Loading a larval shape "},"type":"lvl2","url":"/chimeraswim#loading-a-larval-shape","position":10},{"hierarchy":{"lvl1":"üßÆ Swimming of early larval stages in still water and shear","lvl2":"Loading a larval shape "},"content":"\n\n# Create and display a FileChooser widget\nfc_l = FileChooser()\nfc_l.filter_pattern = '*.pickle'\nfc_l.title = '<b>Choose a filename for this larval morphology:</b>'\nfc_l.default_filename = 'newer_morph.pickle'\n\ndisplay(fc_l)\n#print(fc_l.selected_path)\n#print(fc_l.selected_filename)\n#print(fc_l.selected)\n\n\n\n\n\n# Load the default morphology file, to get a viable scenario for \"Run all cells\" setup\n#M = mrph.Morphology()\nwith open(fc_l.default_filename, 'rb') as handle:\n        #print(f'Loading morphology as {fc_l.default_filename}')\n        M = pickle.load(handle)\n        print(f'Loaded morphology file {fc_l.default_filename}')\n\n\n\n\n\nbutton4 = widgets.Button(description=\"Load file\")\noutput4 = widgets.Output()\n\nbuttonsL = widgets.HBox([button4, output4])\ndisplay(buttonsL)\n\n@output4.capture()\ndef on_button_clicked4(b):\n    with open(fc_l.selected, 'rb') as handle:\n        #print(f'Loading default morphology as {fc_l.selected}')\n        M = pickle.load(handle)\n        print(f'Loaded default morphology file {fc_l.selected}')\n\nbutton4.on_click(on_button_clicked4)\n\n\n\n\n\n","type":"content","url":"/chimeraswim#loading-a-larval-shape","position":11},{"hierarchy":{"lvl1":"üßÆ Swimming of early larval stages in still water and shear","lvl2":"Define the simulation parameters"},"type":"lvl2","url":"/chimeraswim#define-the-simulation-parameters","position":12},{"hierarchy":{"lvl1":"üßÆ Swimming of early larval stages in still water and shear","lvl2":"Define the simulation parameters"},"content":"This cell sets parameters for simulating how the larval shape swims under different flow conditions.\n\nThe parameters are:\n\n\\frac{dU}{dz}: change of horizontal velocity (U) across depth (z)\n\n\\frac{dV}{dz}: change of horizontal velocity (V) across depth (z)\n\n\\frac{dW}{dx}: change of vertical velocity (W) in the x direction\n\n\\phi, \\theta, \\psi: initial Euler angle\n\nT_{max}: duration of time to simulate\n\nV_{cilia}: velocity of cilia on the larval surface (red: maximum speed; blue: 0 speed)\n\n# Set simulation parameters\nspars_dudz=widgets.FloatText(value=0.,width=10,description = r\"$\\frac{dU}{dz}$\")\nspars_dvdz=widgets.FloatText(value=0.,description = r\"$\\frac{dV}{dz}$\")\nspars_dwdx=widgets.FloatText(value=0.,description = r\"$\\frac{dW}{dx}$\")\nspars_Tmax=widgets.FloatText(value=10,description = r\"$T_{max}$\")\nspars_cil_speed=widgets.FloatText(value=500.e-6,description = r\"$V_{cilia}$\")\nspars_phi=widgets.FloatText(value=pi/3.,description = r\"$\\phi$\")\nspars_theta=widgets.FloatText(value=pi/4.,description = r\"$\\theta$\")\nspars_psi=widgets.FloatText(value=pi,description = r\"$\\psi$\")\n\n#translate=[0.,0.,40.e-6]\n\nui0s = widgets.VBox([spars_dudz,spars_phi,spars_Tmax])\nui1s = widgets.VBox([spars_dvdz,spars_theta,spars_cil_speed])\nui2s = widgets.VBox([spars_dwdx,spars_psi])\nui012s = widgets.HBox([ui0s,ui1s,ui2s])\n\n\nouts = widgets.interactive_output(set_sim_pars,{'dudz':spars_dudz,'dvdz':spars_dvdz,'dwdx':spars_dwdx,'Tmax':spars_Tmax,\n                                                'cil_speed':spars_cil_speed,'phi':spars_phi,\n                                                'theta':spars_theta,\n                                                'psi':spars_psi})\ndisplay(ui012s,outs)\n\n\n\n\n\n","type":"content","url":"/chimeraswim#define-the-simulation-parameters","position":13},{"hierarchy":{"lvl1":"üßÆ Swimming of early larval stages in still water and shear","lvl2":"To run a simulation "},"type":"lvl2","url":"/chimeraswim#to-run-a-simulation","position":14},{"hierarchy":{"lvl1":"üßÆ Swimming of early larval stages in still water and shear","lvl2":"To run a simulation "},"content":"Hit the Reset button to create a new simulation window.\n\nHit Run to simulate swimming of the larval shape you defined using the flow parameters you defined.\n\nIn this window, the left hand side plot shows the trajectory of the larva (blue lines), starting at the position (0,0,0) which is marked with a red dot. The simulated time, and the larval position and velocity are given at the top of the plot.\n\nThe right hand side plot shows the orientation of the larval shape. The Euler angles specifying the larva‚Äôs orientation are given at the top of the plot.\n\nThe simulation will plot multiple trajectories in the same plot, to make it easy to compare the effects of different shear rates. You can save the plot using the disk icon at the top of the simulation window.\n\nTo run another simulation using the same simulation window, change e.g. the shear or ciliary velocity and click the Run button again. Make sure to press the enter key after you change parameters.\n\nTo run another simulation using a new simulation window, click the Reset button and then the Run button. The simulation will be plotted in a new graphics window below the previous one.\n\nglobal Sim\nbutton = widgets.Button(description=\"Reset\")\noutput = widgets.Output()\nbutton2 = widgets.Button(description=\"Run\")\noutput2 = widgets.Output()\n\nbuttons = widgets.HBox([button, output, button2, output2])\ndisplay(buttons)\n\n#pyplot.ion()\npyplot.ioff()\n\n@output.capture()\ndef on_button_clicked(b):\n    global Sim, sim_pars\n    with pyplot.ioff():\n        figS = pyplot.figure(num=58)\n    Sim = flw.VRSsim(morph=M,fignum=58)\n    #Sim = flw.VRSsim(morph=M,fig=figS,fignum=58)\n    #Sim = flw.VRSsim(morph=M,fig=figS)\n\n@output2.capture()\ndef on_button_clicked2(b):\n    global Sim,sim_pars\n    Sim.run(XEinit=sim_pars.XEinit,Tmax=sim_pars.Tmax,cil_speed=sim_pars.cil_speed,U_const_fixed=sim_pars.U_const_fixed,S_fixed=sim_pars.S_fixed)\n\n#pyplot.ioff()\nbutton.on_click(on_button_clicked)\n#pyplot.ion()\nbutton2.on_click(on_button_clicked2)\n\n\n\n\n\n","type":"content","url":"/chimeraswim#to-run-a-simulation","position":15},{"hierarchy":{"lvl1":"ChimeraSwim"},"type":"lvl1","url":"/readme-2","position":0},{"hierarchy":{"lvl1":"ChimeraSwim"},"content":"Simulate early-stage marine invertebrate larvae swimming at low Reynolds number.","type":"content","url":"/readme-2","position":1},{"hierarchy":{"lvl1":"üßÆ The Coefficient of Drag"},"type":"lvl1","url":"/cdsphere","position":0},{"hierarchy":{"lvl1":"üßÆ The Coefficient of Drag"},"content":"As described in the \n\nprevious page, the resistance force F on an immersed organism moving in a fluid is commonly expressed in a ratio known as the Coefficient of Drag:C_d  = \\frac{F}{\\frac{1}{2} \\rho L^2 U^2}\n\nThe Coefficient of Drag is the formula used to calculate the drag forces on an organism from an observation made on a dynamically similar scale model (that is, a model that is geometrically similar and has the same Reynolds number, \\mathcal{Re}).\n\nThe power of this approach is illustrated by the plot below, which shows the drag force on any size spherical organism moving at any velocity in fluid of any viscosity and density.\n\n# Import modules:\n#%matplotlib\nfrom math import *\nimport numpy as np\nfrom scipy.interpolate import CubicSpline, interp1d\nfrom scipy.optimize import root, bisect\nimport matplotlib.pyplot as plt\nplt.ion()\nfrom ipywidgets import interact, interactive, fixed, interact_manual\nimport ipywidgets as widgets\n\n\n\n# Experimental data for Cd for a sphere:\nrelist=[ .05875, .1585, .4786, 3.020, 7.015, 15.49, 57.54, 144.5, 264.9, 512.9, 1000., 1862., 3162., 4764., 8375., .1556*10**5, .2648*10**5, .3467*10**5, .5888*10**5, .1000*10**6, .1702*10**6, .2317*10**6, .2648*10**6, .2710*10**6, .2851*10**6, .3020*10**6, .3388*10**6, .3981*10**6, .5129*10**6, .1778*10**7, .2291*10**7, .5012*10**7]\ncdlist = [492.0, 169.8, 58.88, 10.86, 5.623, 3.388, 1.479, .9204, .7194, .5623, .4786, .4365, .4074, .3890, .3981, .4395, .4571, .4775, .4732, .4624,.4395, .4046, .3733, .3467, .2472, .1778, .1047, .09772, .1000, .1778, .1862, .1862]\nCdRe_logdata = [(log(relist[i],10),log(cdlist[i],10)) for i in range(len(relist))]\nRe_logdata = [log(relist[i],10) for i in range(len(relist))]\nCd_logdata = [log(cdlist[i],10) for i in range(len(relist))]\nstokes_transition = 1.5\n#CdL_interp = spline(CdRe_logdata)\n#CdL_interp = CubicSpline(Re_logdata,Cd_logdata)\nCdL_interp = interp1d(Re_logdata,Cd_logdata)\nReL_plot = np.linspace(-4,Re_logdata[-1],num=128)\n#ReL_plot = np.linspace(Re_logdata[0],Re_logdata[-1],num=128)\n#CdL_plot = CdL_interp(ReL_plot)\n# Stokes and Oseen analytical solutions\nCd_Stokes = lambda Re_: 24./Re_\nCd_Oseen = lambda Re_: 24./Re_*(1.+3./16.*Re_)\nCdL_Stokes = lambda logRe_: np.log10(24./np.power(10,logRe_))\nCdL_Oseen = lambda logRe_: np.log10(24./np.power(10,logRe_)*(1.+3./16.*np.power(10,logRe_)))\nCdRe = lambda logRe_: CdL_Oseen(logRe_) if logRe_ <= log(stokes_transition,10) else CdL_interp(logRe_)\nCdL_plot = [CdRe(r) for r in ReL_plot]\n\n\n\n#  Output a graph to show the various estimates\nfig, ax = plt.subplots()\nax.plot(Re_logdata,Cd_logdata,'o',color='purple',label='Experiment (data)')\nax.set_xlabel(r'Reynolds number, $\\log_{10}\\mathcal{Re}$')\nax.set_ylabel(r'Drag Coefficient, $\\log_{10}Cd$')\nReL_Stokes = np.linspace(-4.,log(stokes_transition,10),8)\nax.plot(ReL_Stokes,CdL_Stokes(ReL_Stokes),color='blue',label='Stokes theory')\nReL_Oseen = np.linspace(-4.,log(stokes_transition,10),8)#ax.plot(CdL_Oseen,-4,log(stokes_transition,10),color='black',legend_label='Oseen theory')\nax.plot(ReL_Oseen,CdL_Oseen(ReL_Oseen),color='red',label='Oseen theory')\nax.plot(ReL_plot,CdL_plot,'-.',color='cyan',label='Interpolation')\nax.legend()\nax.grid()\n\n\n\n\n\nIn this plot, note that the scales are logarithmic base 10 for both axes.\nNote also that there are several types of data used to define the curve:\n\ncyan line (and purple dots) for experimental observations\n\nblue and red lines for analytical model calculations.\n\nThe dash-dot cyan line interpolates between these data in a sensible way, providing a consistent function across many orders of magnitude of Reynolds number.\nThe interpolation shown by the cyan line is the form in which C_d would typically be calculated in a biomechanical investigation.\n\n","type":"content","url":"/cdsphere","position":1},{"hierarchy":{"lvl1":"üßÆ The Coefficient of Drag","lvl2":"How to calculate drag forces on organisms"},"type":"lvl2","url":"/cdsphere#how-to-calculate-drag-forces-on-organisms","position":2},{"hierarchy":{"lvl1":"üßÆ The Coefficient of Drag","lvl2":"How to calculate drag forces on organisms"},"content":"\n\nTo obtain the drag force on a spherical organism, use the following steps:\n\nUse the organism‚Äôs size (L) and velocity (U), and the fluid‚Äôs viscosity (\\mu) and density (\\rho) to calculate its Reynolds number,\n\\mathcal{Re} = \\frac{\\rho U L}{\\mu}\n\nTake the logarithm, base 10, of the Reynolds number\n\nFind the position on the horizontal axis corresponding to that \\log_{10}\\mathcal{Re}\n\nMove vertically to the cyan curve; this is the \\log_{10}C_d.\n\nCalculate the coefficient of drag, C_d = 10^{\\log_{10}C_d}\n\nCalculate the drag force,\nF_{drag} = \\frac{1}{2} \\rho L^2 U^2\n\nSome tools to make these calculations easier and more precise are provided in \n\nthis worksheet.\n\n","type":"content","url":"/cdsphere#how-to-calculate-drag-forces-on-organisms","position":3},{"hierarchy":{"lvl1":"üßÆ The Coefficient of Drag","lvl2":"Trends in the C_d curve"},"type":"lvl2","url":"/cdsphere#trends-in-the-c-d-curve","position":4},{"hierarchy":{"lvl1":"üßÆ The Coefficient of Drag","lvl2":"Trends in the C_d curve"},"content":"\n\nSeveral features of the C_d curve are worth pointing out.\n\nThe denominator in this expression is very similar in form and rationale to our estimate of the \n\nwake momentum.\nThe rationale is that, in cases where the drag forces are dominated by increases in wake momentum, the numerator will change in a roughly similar way as the denominator.\nBy the logic in the \n\nscaling of fluid forces, wake momentum is dominant when \\mathcal{Re} \\gg 1.\nTherefore, we predict that C_d will change relatively slowly at high Reynolds number.\n\nIn contrast,  at low Reynolds number, we expect the drag from vicous forces to be much higher than from wake momentum.\nTherefore, we predict that C_d will be large and (increase with decreasing Reynolds number) when \\mathcal{Re} \\ll 1.\n\nIn the range 10^4 < \\mathcal{Re} < 10^6, the coefficient of drag has some surprising ‚Äúwiggles‚Äù. This is due to the onset of \n\nturbulence.","type":"content","url":"/cdsphere#trends-in-the-c-d-curve","position":5},{"hierarchy":{"lvl1":"ReSphere"},"type":"lvl1","url":"/readme-1","position":0},{"hierarchy":{"lvl1":"ReSphere"},"content":"Jupyter notebooks for spheres moving in fluids, calculated using Reynolds numbers\n\nThe CdSphere.ipynb notebook can be accessed via Binder using this link: \n\n\n\nThe RS1.ipynb notebook can be accessed via Binder using this link: \n\n\n\nThe RS2.ipynb notebook can be accessed via Binder using this link: \n\n\n\nThe RS3.ipynb notebook can be accessed via Binder using this link: \n\n","type":"content","url":"/readme-1","position":1},{"hierarchy":{"lvl1":"üßÆ Calculations for spheres moving through fluids"},"type":"lvl1","url":"/rs1","position":0},{"hierarchy":{"lvl1":"üßÆ Calculations for spheres moving through fluids"},"content":"This worksheet provides some computational tools to help you understand and use the ideas of scale models and dynamic similarity, as implemented using the Reynolds number, \\mathcal{Re}, and the Coefficient of Drag, C_d. The rationale for why these nondimensional indices are useful and concise tools for quantifying\n\n# Import modules:\n#%matplotlib\nfrom math import *\nimport numpy as np\nfrom scipy.interpolate import CubicSpline, interp1d\nfrom scipy.optimize import root, bisect\nimport matplotlib.pyplot as plt\nplt.ion()\nfrom ipywidgets import interact, interactive, fixed, interact_manual\nimport ipywidgets as widgets\n\n\n\n# Experimental data for Cd for a sphere:\nrelist=[ .05875, .1585, .4786, 3.020, 7.015, 15.49, 57.54, 144.5, 264.9, 512.9, 1000., 1862., 3162., 4764., 8375., .1556*10**5, .2648*10**5, .3467*10**5, .5888*10**5, .1000*10**6, .1702*10**6, .2317*10**6, .2648*10**6, .2710*10**6, .2851*10**6, .3020*10**6, .3388*10**6, .3981*10**6, .5129*10**6, .1778*10**7, .2291*10**7, .5012*10**7]\ncdlist = [492.0, 169.8, 58.88, 10.86, 5.623, 3.388, 1.479, .9204, .7194, .5623, .4786, .4365, .4074, .3890, .3981, .4395, .4571, .4775, .4732, .4624,.4395, .4046, .3733, .3467, .2472, .1778, .1047, .09772, .1000, .1778, .1862, .1862]\nCdRe_logdata = [(log(relist[i],10),log(cdlist[i],10)) for i in range(len(relist))]\nRe_logdata = [log(relist[i],10) for i in range(len(relist))]\nCd_logdata = [log(cdlist[i],10) for i in range(len(relist))]\nstokes_transition = 1.5\n#CdL_interp = spline(CdRe_logdata)\n#CdL_interp = CubicSpline(Re_logdata,Cd_logdata)\nCdL_interp = interp1d(Re_logdata,Cd_logdata)\nReL_plot = np.linspace(-4,Re_logdata[-1],num=128)\n#ReL_plot = np.linspace(Re_logdata[0],Re_logdata[-1],num=128)\n#CdL_plot = CdL_interp(ReL_plot)\n# Stokes and Oseen analytical solutions\nCd_Stokes = lambda Re_: 24./Re_\nCd_Oseen = lambda Re_: 24./Re_*(1.+3./16.*Re_)\nCdL_Stokes = lambda logRe_: np.log10(24./np.power(10,logRe_))\nCdL_Oseen = lambda logRe_: np.log10(24./np.power(10,logRe_)*(1.+3./16.*np.power(10,logRe_)))\nCdRe = lambda logRe_: CdL_Oseen(logRe_) if logRe_ <= log(stokes_transition,10) else CdL_interp(logRe_)\nCdL_plot = [CdRe(r) for r in ReL_plot]\n\n\n\n","type":"content","url":"/rs1","position":1},{"hierarchy":{"lvl1":"üßÆ Calculations for spheres moving through fluids","lvl2":"Matching Reynolds numbers for dynamic similarity"},"type":"lvl2","url":"/rs1#matching-reynolds-numbers-for-dynamic-similarity","position":2},{"hierarchy":{"lvl1":"üßÆ Calculations for spheres moving through fluids","lvl2":"Matching Reynolds numbers for dynamic similarity"},"content":"This part of the worksheet enables you to calculate the parameters to make a dynamically similar scale model of an organism moving in a fluid.\nThe input panel below has two columns.\nIn the left column, you can enter the characteristics of the object of interest, and the fluid in which it is immersed. In the right column, you can enter the characteristics of the model organism and the fluid in which it is immersed.\nThe worksheet uses the formula,\\mathcal{Re} = \\frac{\\rho U L}{\\mu},\n\nto calculate the Reynolds numbers of both objects for you.\nIf they match, the model is dynamically similar to the object.\n\nLabelObj = widgets.Label(value='Object',\n                         layout=widgets.Layout(display=\"flex\", \n                                               justify_content=\"center\", \n                                               width=\"100%\"))\nLabelModel = widgets.Label(value='Model',\n                         layout=widgets.Layout(display=\"flex\", \n                                               justify_content=\"center\", \n                                               width=\"100%\"))\nmu1=widgets.FloatText(value=1.376e-3,width=20,description = r\"$\\mu~~ (\\frac{N s}{m^2})$\")\nrho1=widgets.FloatText(value=1028.,description = \"$\\\\rho$ ($kg/m^3$)\")\nU1=widgets.FloatText(value=5.e-6,description = \"$U$ ($m/s$)\")\nL1=widgets.FloatText(value=5.e-6,description = \"$L$ (m)\")\n\nmu2=widgets.FloatText(value=1.376e-3,width=20,description = r\"$\\mu~~ (\\frac{N s}{m^2})$\")\nrho2=widgets.FloatText(value=1028.,description = \"$\\\\rho$ ($kg/m^3$)\")\nU2=widgets.FloatText(value=5.e-6,description = \"$U$ ($m/s$)\")\nL2=widgets.FloatText(value=5.e-6,description = \"$L$ (m)\")\n\nui1 = widgets.VBox([LabelObj,mu1,rho1,U1,L1])\nui2 = widgets.VBox([LabelModel,mu2,rho2,U2,L2])\nui3 = widgets.HBox([ui1, ui2])\n\ndef REfunc1(rho1,U1,L1,mu1):\n    print('Object: Re = {:.4g}'.format(abs(rho1*U1*L1/mu1)))\n\ndef REfunc2(rho2,U2,L2,mu2):\n    print('Model: Re = {:.4g}'.format(abs(rho2*U2*L2/mu2)))\n\nout1 = widgets.interactive_output(REfunc1,{'rho1':rho1,'U1':U1,'L1':L1,'mu1':mu1})\nout2 = widgets.interactive_output(REfunc2,{'rho2':rho2,'U2':U2,'L2':L2,'mu2':mu2})\ndisplay(ui3,out1,out2)\n\n\n\n\n\n\n\n\n\n","type":"content","url":"/rs1#matching-reynolds-numbers-for-dynamic-similarity","position":3},{"hierarchy":{"lvl1":"üßÆ Calculations for spheres moving through fluids","lvl2":"Calculating force on a spherical particle moving at known velocity, U"},"type":"lvl2","url":"/rs1#calculating-force-on-a-spherical-particle-moving-at-known-velocity-u","position":4},{"hierarchy":{"lvl1":"üßÆ Calculations for spheres moving through fluids","lvl2":"Calculating force on a spherical particle moving at known velocity, U"},"content":"","type":"content","url":"/rs1#calculating-force-on-a-spherical-particle-moving-at-known-velocity-u","position":5},{"hierarchy":{"lvl1":"üßÆ Calculations for spheres moving through fluids","lvl3":"Force calculator","lvl2":"Calculating force on a spherical particle moving at known velocity, U"},"type":"lvl3","url":"/rs1#force-calculator","position":6},{"hierarchy":{"lvl1":"üßÆ Calculations for spheres moving through fluids","lvl3":"Force calculator","lvl2":"Calculating force on a spherical particle moving at known velocity, U"},"content":"This part of the worksheet enables you to calculate the force required to propel an organism of given size through a fluid with known viscosity and density.\nThe rationale is as follows:\n\nUse the organism‚Äôs diameter, D and velocity, U, and the fluid density (\\rho) and viscosity (\\mu), to calculate \\mathcal{Re}.\n\nUse \\mathcal{Re} to calculate the Coefficient of Drag, C_d,\nC_d  = \\frac{F}{\\frac{1}{2} \\rho L^2 U^2}\n\nUse C_d, the organism‚Äôs size and velocity, and the fluid density, to calculate the drag force F. To do this, we need to \n\nalgebraically rearrange the formula for C_d to solve for F.\n\nThe input panel below has text boxes for the particle size and velocity and the fluid density and viscosity as inputs, and the force required to maintain the particle‚Äôs velocity as output:\n\nmu3=widgets.FloatText(value=1.376e-3,width=20,description = r\"$\\mu~~ (\\frac{N s}{m^2})$\")\nrho3=widgets.FloatText(value=1028.,description = r\"$\\rho~~ (\\frac{kg}{m^3})$\")\nU3=widgets.FloatText(value=5.e-6,description = r\"$U~~ (\\frac{m}{s})$\")\nD3=widgets.FloatText(value=5.e-6,description = r\"$D~~ (m)$\")\n\nui1a = widgets.VBox([mu3,rho3])\nui2a = widgets.VBox([U3,D3])\nui3a = widgets.HBox([ui1a, ui2a])\n\ndef F3(rho3,U3,D3,mu3):\n    Re=abs(D3*U3*rho3/mu3)\n    logRe=log(Re,10)\n    logCd=CdRe(logRe)\n    Cd_=10**logCd\n    F_=np.sign(U3)*0.5*rho3*pi/4.*D3**2*U3**2*Cd_\n    print('Force required to move sphere at velocity U: F = {:.4g} N'.format(F_))\n     \nout3 = widgets.interactive_output(F3,{'rho3':rho3,'U3':U3,'D3':D3,'mu3':mu3})\ndisplay(ui3a,out3)\n\n\n\n\n\n\n\n","type":"content","url":"/rs1#force-calculator","position":7},{"hierarchy":{"lvl1":"üßÆ Calculations for spheres moving through fluids","lvl3":"Density calculator","lvl2":"Calculating force on a spherical particle moving at known velocity, U"},"type":"lvl3","url":"/rs1#density-calculator","position":8},{"hierarchy":{"lvl1":"üßÆ Calculations for spheres moving through fluids","lvl3":"Density calculator","lvl2":"Calculating force on a spherical particle moving at known velocity, U"},"content":"This calculator addresses the situation when we have observed a particle‚Äôs sinking rate, and we would like to infer its density.\nThis is closely related to the situation above:\n\nHaving calculated the force F, we then need to do an additional calculation to find the density of the sphere required to produce that force on the immersed particle.\nIn this calculator, the inputs are the same as above, and the output is the density required to move the particle at the specified velocity.\n\ng=9.81\n\nmu4=widgets.FloatText(value=1.376e-3,width=20,description = r\"$\\mu~~ (\\frac{N s}{m^2})$\")\nrho_water=widgets.FloatText(value=1028.,description = r\"$\\rho_{water}~~ (\\frac{kg}{m^3})$\")\nU4=widgets.FloatText(value=5.e-6,description = r\"$U~~ (\\frac{m}{s})$\")\nD4=widgets.FloatText(value=5.e-6,description = r\"$D~~ (m)$\")\n\nui1b = widgets.VBox([mu4,rho_water])\nui2b = widgets.VBox([U4,D4])\nui3b = widgets.HBox([ui1b, ui2b])\n\ndef rho4(rho_water,U4,D4,mu4):\n    if U4==0: # We don't have to calculate anything...\n        rho_sphere=rho4\n        print('Particle density equals fluid density: rho_sphere = {:.4g}'.format(rho_sphere))\n    else:\n        # Geometry:\n        rr=D4/2.\n        vol=float(4./3.*pi*rr**3)\n        Re=abs(D4*U4*rho_water/mu4)\n        logRe=log(Re,10)\n        logCd=CdRe(logRe)\n        Cd_=10**logCd\n        F_=np.sign(U4)*0.5*rho_water*pi/4.*D4**2*U4**2*Cd_\n        # Density calculation\n        excess_mass=F_/g\n        rho_excess=excess_mass/vol\n        rho_sphere=rho_excess+rho_water     \n        print('Particle density: rho_sphere =  = {:.4g} kg/m^3'.format(rho_sphere))\n    \nout4 = widgets.interactive_output(rho4,{'rho_water':rho_water,'U4':U4,'D4':D4,'mu4':mu4})\ndisplay(ui3b,out4)\n\n\n\n\n\n\n\n","type":"content","url":"/rs1#density-calculator","position":9},{"hierarchy":{"lvl1":"üßÆ Calculations for spheres moving through fluids","lvl2":"Calculating velocity of a spherical particle propelled by known force, F"},"type":"lvl2","url":"/rs1#calculating-velocity-of-a-spherical-particle-propelled-by-known-force-f","position":10},{"hierarchy":{"lvl1":"üßÆ Calculations for spheres moving through fluids","lvl2":"Calculating velocity of a spherical particle propelled by known force, F"},"content":"","type":"content","url":"/rs1#calculating-velocity-of-a-spherical-particle-propelled-by-known-force-f","position":11},{"hierarchy":{"lvl1":"üßÆ Calculations for spheres moving through fluids","lvl3":"Velocity calculator #1","lvl2":"Calculating velocity of a spherical particle propelled by known force, F"},"type":"lvl3","url":"/rs1#velocity-calculator-1","position":12},{"hierarchy":{"lvl1":"üßÆ Calculations for spheres moving through fluids","lvl3":"Velocity calculator #1","lvl2":"Calculating velocity of a spherical particle propelled by known force, F"},"content":"As noted, the \\mathcal{Re}-C_d curve describes the movement of all spheres at all speeds in all \n\nNewtonian fluids like air and water.\nThis is sufficient to determine the velocity of a sphere if we know its size, the force exerted on it, and the fluid characteristics.\n\nThere is however a slight complication:\nBoth Re and C_d are functions of particle velocity, U, (see the equations above).\nHowever, because we don‚Äôt in general have a convenient formula for C_d, we can‚Äôt write down an analytical formula to obtain the U that satisfies both these equations simulataneously.\n\nTo get past this hurdle, we‚Äôll use a time-honored mathematical technique: We‚Äôll guess.\n\nGuessing, or more precisely developing an intelligent sequence of trial-and-error iterations, is a great way to solve many computational problems.\nIn fact, this type of iteration is essentially what a lot of computer algorithms for solving many hard problems are doing.\nBelow, I‚Äôve made a calculator that does this iteration for you.\n\nBefore trusting in the software, however, it‚Äôs important that you gain some first-hand experience with this iterative process.\nThis part of the worksheet enables you to efficiently perform a sequence of iterations to determine the velocity of a particle with known force.\nThe rationale is as follows:\n\nGuess a velocity, U_{est}.\n\nUse the rationale in Section 3 to calculate the force, F_{est}, required to propel the particle at U_{est}.\n\nCompare F_{est} to the required force, and use the error to adjust the next guess of velocity up or down as needed.\n\nRepeat until the necessary accuracy has been achieved.\nWith a little practice, you will be able to calculate velocity to within a percent or less error in a few iterations.\n\nThe input panel below has text boxes for the particle size, the actual force on the particle, and the fluid density and viscosity ‚Äì and your guess at the velocity ‚Äì as inputs.\nIts output is the force required to move the particle at the velocity you guessed.\n\nmu5=widgets.FloatText(value=1.376e-3,width=20,description = r\"$\\mu~~ (\\frac{N s}{m^2})$\")\nrho5=widgets.FloatText(value=1028.,description = r\"$\\rho~~ (\\frac{kg}{m^3})$\")\nU_guess=widgets.FloatText(value=0.001,description = r\"$U_{guess}~~ (\\frac{m}{s})$\")\nD5=widgets.FloatText(value=5.e-6,description = r\"$D~~ (m)$\")\nF5=widgets.FloatText(value=1.e-11,description = r\"$F~~ (N)$\")\n\nui1c = widgets.VBox([mu5,F5,U_guess])\nui2c = widgets.VBox([rho5,D5])\nui3c = widgets.HBox([ui1c, ui2c])\n\ndef force5(rho5,U_guess,D5,mu5,F5):\n    Re_guess=float(D5*abs(U_guess)*rho5/mu5)\n    logRe=log(Re_guess,10.)\n    logCd=CdRe(logRe)\n    Cd_guess=10.**logCd\n    F_guess=np.sign(U_guess)*0.5*rho5*pi/4.*D5**2*U_guess**2*Cd_guess\n    #print('Particle density: rho_sphere = {:.4g} kg/m^3'.format(rho_sphere))\n    print('Using guessed velocity, U_est = {:.4g}'.format(U_guess))\n    print('Reynolds number: Re = {:.4g}'.format(Re_guess))\n    print('\\nForce required to move sphere at velocity U_est:')\n    print('F_est = {:.4g}'.format(F_guess))\n\n    print('\\nF_est-F_actual = {:.4g}'.format(F_guess-F5))\n    print('\\nRelative error is {:.4g} %'.format(100.*(F_guess-F5)/F5))\n  \nout5 = widgets.interactive_output(force5,{'rho5':rho5,'U_guess':U_guess,'D5':D5,'mu5':mu5,'F5':F5})\ndisplay(ui3c,out5)\n\n\n\n\n\n\n\n","type":"content","url":"/rs1#velocity-calculator-1","position":13},{"hierarchy":{"lvl1":"üßÆ Calculations for spheres moving through fluids","lvl3":"Velocity calculator #2","lvl2":"Calculating velocity of a spherical particle propelled by known force, F"},"type":"lvl3","url":"/rs1#velocity-calculator-2","position":14},{"hierarchy":{"lvl1":"üßÆ Calculations for spheres moving through fluids","lvl3":"Velocity calculator #2","lvl2":"Calculating velocity of a spherical particle propelled by known force, F"},"content":"This calculator is an extension of Velocity Calculator #1. This calculator automatically does the iteration to find the U which simultaneously satisfies the equations for \\mathcal{Re} and C_d.\nIt also incorporates the calculation in the density calculator above, so that the input is not force directly but particle density.\nThe input panel below has text boxes for the particle size and density, and the fluid density and viscosity. Its output is the velocity of the corresponding particle.\n\ndef cd_error(r,F_D,rho,mu,U):\n    \"\"\"A function evaluating the error between the parameter U and the\n    movement speed of a sphere with radius r subjected to force F_D in\n    fluid with density rho and viscosity mu. The U for which this function\n    evaluates to zero is the steady state movement speed. \"\"\"\n    if U==0.:\n        return -F_D\n    else:\n        signU=np.sign(U)\n        absU=abs(U)\n        #print 'got here...',r,F_D,rho,mu,U\n        logRe=log(2.*rho*r*absU/mu,10)\n        logCd=CdRe(logRe)\n        return (signU*0.5*rho*pi*r**2*U**2)*10**logCd - F_D\n\ndef U_sphere(r,F_D,rho,mu):\n    \"\"\"Steady-state movement velocity of a sphere in fluid, as determined by the\n    root of the error metric cd_error. \n    \"\"\"\n    # Determine the range over which the numerical root-finding algorithm should operate:\n    #Re_=2*rho*r*U./mu\n    Urange=relist[-1]*mu/(2.*rho*r)\n    Uerr = lambda u: cd_error(r,F_D,rho,mu,u)\n    U=bisect(Uerr,-Urange,Urange, rtol=0.000001,full_output=False)\n    return U\n\nmu6=widgets.FloatText(value=1.376e-3,width=20,description = r\"$\\mu~~ (\\frac{N s}{m^2})$\")\nrho_water=widgets.FloatText(value=1028.,description = r\"$\\rho~~ (\\frac{kg}{m^3})$\")\nrho_sphere=widgets.FloatText(value=1105.,description = r\"$\\rho_{sphere}~~ (\\frac{kg}{m^3})$\")\n#U_guess=widgets.FloatText(value=0.001,description = r\"$U_{guess}~~ (\\frac{m}{s})$\")\nD6=widgets.FloatText(value=5.e-6,description = r\"$D~~ (m)$\")\n#F6=widgets.FloatText(value=1.e-11,description = r\"$F~~ (N)$\")\n\nui1d = widgets.VBox([mu6,rho_water])\nui2d = widgets.VBox([rho_sphere,D6])\nui3d = widgets.HBox([ui1d, ui2d])\n\ndef U6(rho_water,rho_sphere,D6,mu6):\n    rr=D6/2.\n    vol=float(4./3.*pi*rr**3)\n    excess_mass=-(rho_sphere-rho_water)*vol # Keep the same sign convention as \n                                            # Het_labX.sws -- positive z is up\n    g=9.81\n    ff=g*excess_mass\n    if rho_water==rho_sphere:\n        print('External force is zero...')\n        U_s=0.\n    else:\n        U_s=U_sphere(rr,ff,rho_water,mu6)\n    print('Volume = {:.4g}'.format(vol))\n    print('Excess mass = {:.4g}'.format(excess_mass))\n    print('Gravity/buoyancy force = {:.4g}'.format(g*excess_mass))\n    print('Reynolds number: Re = {:.4g}'.format(2.*rr*abs(U_s)*rho_water/mu6))\n    print('U = {:.4g}'.format(U_s))\n  \nout6 = widgets.interactive_output(U6,{'rho_water':rho_water,'rho_sphere':rho_sphere,\n                                      'D6':D6,'mu6':mu6})\ndisplay(ui3d,out6)\n\n    #Flux_diff= 4 * pi * dd * rr * (C_w-C_s)\n    #Sh = Sherwood(rr,dd,rho_water,mu,abs(U_s))\n    #Flux_adv=float(Sh*Flux_diff)\n    #print 'Sherwood number: Sh = ',Sh\n    #print 'Diffusive flux: F_diff = ',float(Flux_diff)\n    #print 'Advective flux: F_adv = ',float(Flux_adv)\n\n\n\n\n\n","type":"content","url":"/rs1#velocity-calculator-2","position":15},{"hierarchy":{"lvl1":"üèûÔ∏è What makes organisms move through fluids (and what slows them down)?"},"type":"lvl1","url":"/rs1intro","position":0},{"hierarchy":{"lvl1":"üèûÔ∏è What makes organisms move through fluids (and what slows them down)?"},"content":"Like all physical objects, immersed particles obey \n\nNewton‚Äôs 2nd Law:\\mathit{sum~of~forces} = \\mathit{mass} \\times \\mathit{acceleration}\n\nThis Law gives us a tool to calculate the rate at which an object subjected to a force will move in a particular type of fluid.\nIf we know the particle‚Äôs movement, Newton‚Äôs Law also gives us a tool with which to calculate the force that must be acting on the particle to cause that movement.\n\nUnderstanding the factors that cause organisms to move through a fluid environment is easiest if we consider the lefthand side of this equation separately from the righthand side.","type":"content","url":"/rs1intro","position":1},{"hierarchy":{"lvl1":"üèûÔ∏è What makes organisms move through fluids (and what slows them down)?","lvl2":"The lefthand side: The sum of forces"},"type":"lvl2","url":"/rs1intro#the-lefthand-side-the-sum-of-forces","position":2},{"hierarchy":{"lvl1":"üèûÔ∏è What makes organisms move through fluids (and what slows them down)?","lvl2":"The lefthand side: The sum of forces"},"content":"A situation familiar to many of us is coasting downhill on a bicycle.\nStarting at a slow speed, we coast faster and faster, accelerated by the force of gravity.\nEventually we reach a steady speed, when drag caused by the air we‚Äôre pushing aside as we move (along with a bit of friction from the wheels and tires) matches the gravity forces.\nAt that point, the sum of gravity and drag forces are equal and opposite ‚Äì that is, they sum to zero ‚Äì so the acceleration rate is also zero.\n\nIf we duck down to the handlebars, we reduce the air drag.\nThen, the gravity force exceeds drag until we accelerate to a new, higher steady speed.\nIf the hill levels out somewhat, the gravity force is reduced.\nThen, the drag exceeds the gravity force until we slow down to a new, slower steady speed.\n\nThis dynamic balance between gravity and drag (and  it‚Äôs application in Newton‚Äôs 2nd Law) is helpful to keep in mind when we consider the forces acting on particles in fluids.","type":"content","url":"/rs1intro#the-lefthand-side-the-sum-of-forces","position":3},{"hierarchy":{"lvl1":"üèûÔ∏è What makes organisms move through fluids (and what slows them down)?","lvl2":"The righthand side: Mass \\times acceleration"},"type":"lvl2","url":"/rs1intro#the-righthand-side-mass-times-acceleration","position":4},{"hierarchy":{"lvl1":"üèûÔ∏è What makes organisms move through fluids (and what slows them down)?","lvl2":"The righthand side: Mass \\times acceleration"},"content":"As we continue on our bicycle ride, we eventually encounter a rise or uphill.\nAt that point, gravity is pulling us backwards, but we do not immediately stop and reverse ‚Äì we continue to coast uphill for awhile.\nWe continue coasting because we have momentum.\n\nMomentum is a familiar experience for all of us, but its name and definition may not be.\nThe momentum of an organism (or any other object) is defined as:\\mathit{momentum} = \\mathit{mass} \\times \\mathit{velocity}\n\nIntuitively, a bigger mass has more momentum than a smaller mass traveling at the same velocity.\nLikewise, a faster mass has more momentum than the same mass traveling more slowly.\n\nAcceleration is the rate of change in velocity,\\mathit{acceleration} = \\mathit{rate~of~change~of~velocity}\n\nSubstituting this expression for acceleration in Newton‚Äôs Law, and using the definition of momentum, we can state Newton‚Äôs 2nd Law in a different and possibly more intuitive way,\\mathit{sum~of~forces} = \\mathit{rate~of~change~of~momentum}\n\nHopping onto our bicycles again, this expresses another familiar phenomenon:\nWhen we apply force to the pedals, we produce a forward force which increases our momentum (by speeding us up).\nWhen we apply brakes, we produce a backwards force which decreases our momentum (by slowing us down).","type":"content","url":"/rs1intro#the-righthand-side-mass-times-acceleration","position":5},{"hierarchy":{"lvl1":"üèûÔ∏è What makes organisms move through fluids (and what slows them down)?","lvl2":"Understanding movement through fluids"},"type":"lvl2","url":"/rs1intro#understanding-movement-through-fluids","position":6},{"hierarchy":{"lvl1":"üèûÔ∏è What makes organisms move through fluids (and what slows them down)?","lvl2":"Understanding movement through fluids"},"content":"The elements of Newton‚Äôs 2nd Law that apply to bicycle riding ‚Äì gravity and drag forces resulting in changes to velocity and momentum ‚Äì also apply generally to organisms (or components of organisms) moving in fluids.\nThe next part of this section presents a more in-depth discussion of forces, masses and velocity changes.\nThe ideas in that discussion are then used in assessing scaling of forces on organisms immersed in fluids:\n\nHow do forces increase or decrease with organism size and velocity?\n\nHow can we understand consequences of organism shape, as opposed to variations in size?\n\nIn what ways is being immersed in air different from (or similar to) being immersed in water or another fluid?\n\nThe results of the scaling analysis are then used in a worksheet that provides tools to ask more specific questions, such as ‚ÄúHow fast will a given organism sink or float in a given fluid?‚Äù\n\nIt‚Äôs useful to keep in mind that, in science and engineering, the term ‚Äúvelocity‚Äù means a vector. This means that it has both a magnitude and a direction. This is distinct from ‚Äúspeed‚Äù, ‚Äúcelerity‚Äù and other terms that have only magnitude (that is, they are scalars). For example, a bicycle going 10 mph north has the same speed as a bicycle going 10 mph south, but it has opposite velocity.","type":"content","url":"/rs1intro#understanding-movement-through-fluids","position":7},{"hierarchy":{"lvl1":"üìñÔ∏è Transport of organisms by currents and turbulence"},"type":"lvl1","url":"/rs2context","position":0},{"hierarchy":{"lvl1":"üìñÔ∏è Transport of organisms by currents and turbulence"},"content":"Most environmental fluids ‚Äì masses of air in weather systems, or the water in lakes, rivers, estuaries, and the open ocean ‚Äì are moving at velocities that can vary from almost undetectable to extremely rapid.\nWe experience these as winds, river flows, tidal fluctuations and large scale ocean currents, among other ways.\nHere, we begin to consider the effects of these environmental flows on the movement and distribution of organisms.","type":"content","url":"/rs2context","position":1},{"hierarchy":{"lvl1":"üìñÔ∏è Transport of organisms by currents and turbulence","lvl2":"Examples of transport in environmental flows"},"type":"lvl2","url":"/rs2context#examples-of-transport-in-environmental-flows","position":2},{"hierarchy":{"lvl1":"üìñÔ∏è Transport of organisms by currents and turbulence","lvl2":"Examples of transport in environmental flows"},"content":"To get a concrete sense of the relevant phenomena, let‚Äôs begin with a couple examples:","type":"content","url":"/rs2context#examples-of-transport-in-environmental-flows","position":3},{"hierarchy":{"lvl1":"üìñÔ∏è Transport of organisms by currents and turbulence","lvl3":"Reproductive biology","lvl2":"Examples of transport in environmental flows"},"type":"lvl3","url":"/rs2context#reproductive-biology","position":4},{"hierarchy":{"lvl1":"üìñÔ∏è Transport of organisms by currents and turbulence","lvl3":"Reproductive biology","lvl2":"Examples of transport in environmental flows"},"content":"Most benthic marine invertebrates are \n\nfree spawning, meaning that they release their gametes into the water.\nSperm must encounter eggs for \n\nfertilization to happen, but this is more challenging than it might seem.\nThat‚Äôs because the surrounding water is almost always moving, due to waves, currents and tides.\nMovement of the water into which gametes are released means that in a very short time ‚Äì possibly within a few seconds ‚Äì these gametes have been moved far from the adults that released them.\nThough sperm are motile, their swimming abilities do not enable them to find and fertilize eggs that have been transported over long distances.\n\nThis has important consequences for the life histories of many species.\nMarine invertebrates typically accumulate metabolic resources to produce gametes for months or even years before spawning.\nOnce spawning begins, however, it‚Äôs essential that multiple individuals precisely synchronize the timing of spawning.\nIf an individual is early or late, its eggs will not encounter sperm to fertilize it, or its sperm will not encounter eggs to fertilize.\nThis risk of reproductive failure leads to behavioral strategies such as formation of large colonies or reproductive aggregations; use of environmental cues such as moon phases; and chemical communication among reproductive adults.\n\nGiven synchronized spawning, successful reproduction then depends on maximizing encounters of eggs with approriate concentrations of sperm, sufficient to make fertilization successful but not so dense as to make \n\npolyspermy likely.\nThe encounter rate of eggs with sperm ‚Äì and hence, reproductive success ‚Äì is determined in large part by how fast these gametes sink, rise or swim, along with the rates at which they are transported, mixed and diluted by environmental flows.","type":"content","url":"/rs2context#reproductive-biology","position":5},{"hierarchy":{"lvl1":"üìñÔ∏è Transport of organisms by currents and turbulence","lvl3":"Agriculture","lvl2":"Examples of transport in environmental flows"},"type":"lvl3","url":"/rs2context#agriculture","position":6},{"hierarchy":{"lvl1":"üìñÔ∏è Transport of organisms by currents and turbulence","lvl3":"Agriculture","lvl2":"Examples of transport in environmental flows"},"content":"Suppose a rice farmer uses a crop-dusting airplane to apply pesticide to a rice paddy under no-wind conditions.\nThe crop-duster has nozzles that emit droplets of known size.\nIf we know the density of the pesticide mixture, we can calculate the sinking velocity of the liquid pesticide droplets using the calculators in \n\nthis worksheet.\nIf we know the height at which pesticide particles were released, we can use the sinking rate to estimate how long it takes pesticide particles to arrive at ground level.\n\nUnder no-wind conditions, a long descent time means only a delay in arrival at the rice paddy.\nHowever, suppose rather than no-wind conditions there is a moderate breeze.\nIn this scenario, as particles sink vertically they are carried horizontally from the release point by the wind.\nIf you have walked downwind of a sprinkler or fountain in a stiff wind you are familiar with this phenomenon.\n\nIn the windy scenario, sinking time has a consequence that is potentially much more important than a delayed arrival time at the paddy: a long delay and strong wind might mean the pesticide arrives at ground level far downwind.\nIt may even miss the rice paddy entirely, landing instead on a different area which may be occupied by people, grazed by livestock or have other sensitive uses.\n\nThe ways in which sprayed pesticides, pollen, dust and a great many other anthropogenic and natural particles are transported and ultimately deposited are determined by their settlement rates, and by the environmental flows that transport and spread them.","type":"content","url":"/rs2context#agriculture","position":7},{"hierarchy":{"lvl1":"üìñÔ∏è Transport of organisms by currents and turbulence","lvl2":"Transport by advection"},"type":"lvl2","url":"/rs2context#transport-by-advection","position":8},{"hierarchy":{"lvl1":"üìñÔ∏è Transport of organisms by currents and turbulence","lvl2":"Transport by advection"},"content":"Transport of organisms and other immersed objects or substances by moving fluid is called \n\nadvection.\nEnvironmental flows often advect organisms, particles and solutes much faster and in different directions than they would otherwise move.\nFor example, many organisms move vertically ‚Äì they sink or rise under the influence of gravity and buoyancy.\nIn contrast, the principal direction of wind, currents and many other environmental flows is often horizontal.\nIn such cases, advection causes movement in directions those organisms would not otherwise move.\n\nEven when an organism has some horizontal movement, horizontal advective transport can be orders of magnitude faster than swimming movements.\nFor example, in many aquatic environments, characteristics such as light, temperature and nutrient availability change over a few meters in the vertical direction but are relatively constant over many kilometers in the horizontal direction.\nThe slow swimming of organisms such as plankton is often considered fast enough to regulate their access to light, warmth and nutrients by moving up or down in the water column.\nHowever, horizontal swimming at the same rate can have negligble effects, because their environment varies so slowly in the horizontal direction.\nIn these cases, only long-range advection by currents can move plankton sufficiently in the horizontal direction to significantly affect ambient conditions.","type":"content","url":"/rs2context#transport-by-advection","position":9},{"hierarchy":{"lvl1":"üìñÔ∏è Transport of organisms by currents and turbulence","lvl2":"Mixing by turbulence"},"type":"lvl2","url":"/rs2context#mixing-by-turbulence","position":10},{"hierarchy":{"lvl1":"üìñÔ∏è Transport of organisms by currents and turbulence","lvl2":"Mixing by turbulence"},"content":"Most environmental flows also have some level of \n\nturbulence.\nIf you have been aboard an airplane flying through turbulent air, you have felt first-hand that turbulence is composed of \n\neddies and other small-scale but energetic fluctuations of fluid velocity.\nTurbulence is also a very effective mechanism for mixing; this is frequently called \n\nturbulent diffusion, because it in some ways mimics the effects of molecular diffusion but is much faster.\n\nWhen you stir your coffee to mix cream or sugar, you can see how effective turbulent diffusion is.\nSometime, when you have a lot of time on your hands, add cream or sugar to coffee and wait for the mixing to occur without stirring.\nThis will give you a sense for how much turbulence has sped up the mixing process.\nTurbulent diffusion has similar effects in environmental flows, greatly enhancing the spread and mixing of organisms and other particles.","type":"content","url":"/rs2context#mixing-by-turbulence","position":11},{"hierarchy":{"lvl1":"üìñÔ∏è Transport of organisms by currents and turbulence","lvl2":"Distributions of organisms in environmental flows"},"type":"lvl2","url":"/rs2context#distributions-of-organisms-in-environmental-flows","position":12},{"hierarchy":{"lvl1":"üìñÔ∏è Transport of organisms by currents and turbulence","lvl2":"Distributions of organisms in environmental flows"},"content":"We now have three components of velocity to consider when thinking quantitatively about the movement of particles such as microorganisms, pollen or dust immersed in environmental flows:\n\nThe particles‚Äô own velocity relative to the fluid in which they are immersed, such as sinking or rising under the influence of gravity, buoyancy and drag forces.\n\nAdvection by the directional velocity of the fluid, such as wind or current, often primarily in horizonatal directions.\n\nTurbulent eddies, that cause small-scale random movements of individual particles while mixing and spreading a population of particles.\n\nTo understand the combined effects of vertical movements with advection and turbulence, it‚Äôs important to keep in mind the different effects on population distributions of advection by currents vs. mixing by turbulence.\n\nStarting with a group of organisms or a blob of solute, advection (with no turbulence) moves the overall average position (in engineering jargon, the center of mass) of that group or blob, such that it  moves with the current over time.\n\nStarting with a group of organisms or a blob of solute, turbulent diffusion (with no advection) spreads out the group or blob in a similar way to molecular diffusion or random swimming, but much faster except at very small length scales (much smaller than a millimeter).\n\nKeeping in mind that advection and turbulence are distinct forms of transport by fluids, we can anticipate environmental situations in which we have high adection and low turbulence; low advection and high turbulence, high advection and high turbulence, etc.\nThe \n\nnext worksheet gives us tools for quantitatively assessing the consequences of these different scenarios for different types of particles.\n\nThe phenomenon of population, mass, momentum, energy or any other conserved quantity being carried by moving fluid is called advection or convection.\nDifferent fields in the natural sciences and engineering use these terms slightly differently, but in all cases they imply that moving fluid transports a conserved quantity.\n\nEven this is an overestimate of mixing without turbulence, because temperature differences as the coffee cools cause some mixing currents!","type":"content","url":"/rs2context#distributions-of-organisms-in-environmental-flows","position":13},{"hierarchy":{"lvl1":"üßÆ Models of particle transport by advection and turbulence"},"type":"lvl1","url":"/rs2exec","position":0},{"hierarchy":{"lvl1":"üßÆ Models of particle transport by advection and turbulence"},"content":"A simple but useful approach for estimating the transport of particles in environmental flows is called a Gaussian plume model.\n\nTo explain the key assumptions of this model, we‚Äôll use a terrestrial example of wind-borne seed dispersal.\nUseful references are a journal article, Okubo and Levin (1989), and a book by the same authors, Okubo and Levin (2001).\n\nThe question we will address is: If a plant or tree releases seeds with sinking velocity U above the ground at a height h, how widely do its seeds disperse?\nYou can think of many examples of pollutant particles, carbon-containing particles in the ocean, aeolian dust particles, etc, whose distribution patterns are exactly analogous.\nIn the Gaussian Plume Model of seed dispersal, we‚Äôll assume that there is constant wind velocity, W.\nIn reality, the wind would likely vary over time and at different heights in intensity and direction; we will neglect this variation.\n\nWe‚Äôll also assume that turbulent intensity, as summarized by the turbulent diffusion coefficient K, is also equal at all times and places.\nIn reality, turbulence would also vary in time and space, but we will again neglect this complication.\n\nWe‚Äôll assume that, once they hit the gound, seeds stick to it and are not dispersed into the air again.\n\nFinally, we‚Äôll assume that at large scales the advective transport is much faster than the turbulent mixing. That is, we assume that turbulent mixing is significant in the vertical direction but can be ignored in the horizontal directions, because advective transport by the wind is much greater.\nThis is mostly a technical detail, because it is almost always true for most parts of environmental flows, but this assumption can have consequences in specific parts of the environment (very near the source, very near the ground, etc.).\n\nIf we accept these assumptions, we can calculate formulas for the concentration of seeds in different parts of the atmosphere surrounding the seed source, and for the rate at which seeds are deposited on the ground at various downstream distances.\nThese formulas are calculated for you in the Gaussian Plume calculator below.\n\n","type":"content","url":"/rs2exec","position":1},{"hierarchy":{"lvl1":"üßÆ Models of particle transport by advection and turbulence","lvl2":"Model rationale"},"type":"lvl2","url":"/rs2exec#model-rationale","position":2},{"hierarchy":{"lvl1":"üßÆ Models of particle transport by advection and turbulence","lvl2":"Model rationale"},"content":"The rationale of the Gaussian plume model is that it breaks the three components of movement:\n\nthe advection due to wind velocity, W\n\nthe spreading in the vertical direction by turbulence, K\n\nthe sinking velocity, U\n\ninto sequential, additive steps.\n\nSeparating the movement mechanisms makes it easy to approximate the resutling distributions and deposition patterns, in the following ways:\n\nSeeds (or other particles of interest) are transported horizontally downwind at a steady velocity, W.\n\nAs they move downwind, the vertical distribution of seeds is spreading due to the turbulent diffusion, to take the shape of a Gaussian distribution with a variance that increases over time at a rate proportional to K.\n\nThe vertical position of the mean of the Gaussian distribution of seeds is descending over time, due to the sinking velocity U.\n\nFollowing these steps, a formula can be written for the spatial distribution of seeds and their deposition rate.\n\n","type":"content","url":"/rs2exec#model-rationale","position":3},{"hierarchy":{"lvl1":"üßÆ Models of particle transport by advection and turbulence","lvl3":"Model Inputs:","lvl2":"Model rationale"},"type":"lvl3","url":"/rs2exec#model-inputs","position":4},{"hierarchy":{"lvl1":"üßÆ Models of particle transport by advection and turbulence","lvl3":"Model Inputs:","lvl2":"Model rationale"},"content":"In the default settings (to reproduce these, just restart the kernel in the menu at the top left):\n\nthe seed source is set to h = 10 m;\n\nthe seed‚Äôs sinking speed is U = 0.5 \\frac{m}{s};\n\nthe rate at which seeds are released is one per second: n = 1 s^{-1};\n\nthe default wind speed is W = 1 \\frac{m}{s}; and,\n\nthe default turbulent mixing intensity is K = 0.5 \\frac{m^2}{s}.\n\nYou can modify these as needed to apply to a specific problem, by entering a new value in a textbox and hitting enter.\n\nFor example, in calculating the distribution pattern of marine invertebrate eggs, or pesticide droplets from aerial spraying, you might calculate the sinking speed of these particle using \n\nthis worksheet, and use the calculator below to explore the consequences of various release heights, wind or current speeds, turbulence intensities, etc.\n\n","type":"content","url":"/rs2exec#model-inputs","position":5},{"hierarchy":{"lvl1":"üßÆ Models of particle transport by advection and turbulence","lvl3":"Model outputs:","lvl2":"Model rationale"},"type":"lvl3","url":"/rs2exec#model-outputs","position":6},{"hierarchy":{"lvl1":"üßÆ Models of particle transport by advection and turbulence","lvl3":"Model outputs:","lvl2":"Model rationale"},"content":"The model output is in the form of three plots.\n\nThe top graph is the total rate of deposition as a function of downstream distance from the source. This is called the Cross-Wind Integrated Deposition, or CWID.\n\nThis term means simply that we are not primarily concerned with the relatively small spread of seeds, pesticide or other particles in the cross-stream direction.\nWe are instead mainly interested in the much larger dispersal of those particles in the downstream direction.\n\nThe CWID integrates across all cross-stream positions, so it is straightforward to see the downstream transport.\nIn this plot, the horizontal axis is distance downstream from the source, x.\nYou can specify the extent of ground plotted by adjusting the plotting parameter x_{\\mathit{max}}.\n\nThe bottom two plots show the distribution of seeds in the air (or other particles in other fluids, as the case may be).\n\nIn these plots, the horizontal axis is x, and the vertical axis is height above the ground, z.\nThe color contours represent particle concentration.\nThe first of these two plots shows this concentration on a \\log_{10} scale, as indicated by the scale bar at right.\nThe bottom plot shows the same concentration, but on a linear scale.\n\nThe two plots show the same distribution; it is often easier to get an overall sense for the plume pattern on the linear scale plot, but easier to see dilute parts of the particle distribution using the log scale plot.\n\nexecfile('Codes/RS2exec.py')\n\n\n\n\n\n\n\n\n\n\n\n","type":"content","url":"/rs2exec#model-outputs","position":7},{"hierarchy":{"lvl1":"üßÆ Effects of flow on molecular transport mechanisms"},"type":"lvl1","url":"/rs3","position":0},{"hierarchy":{"lvl1":"üßÆ Effects of flow on molecular transport mechanisms"},"content":"A very useful set of formulas approximating \\mathcal{Sh} relevant to many environmental particles is given by Kiorboe et al. (2001). Here is a plot of \\mathcal{Sh} as a function of \\mathcal{Re} and \\mathcal{Sc} for spherical particles:\n\n# Import modules:\n#%matplotlib\nfrom math import *\nimport numpy as np\nfrom scipy.interpolate import CubicSpline, interp1d\nfrom scipy.optimize import root, bisect\nimport matplotlib.pyplot as plt\nplt.ion()\nfrom ipywidgets import interact, interactive, fixed, interact_manual\nimport ipywidgets as widgets\n\n# Experimental data for Cd for a sphere:\nrelist=[ .05875, .1585, .4786, 3.020, 7.015, 15.49, 57.54, 144.5, 264.9, 512.9, 1000., 1862., 3162., 4764., 8375., .1556*10**5, .2648*10**5, .3467*10**5, .5888*10**5, .1000*10**6, .1702*10**6, .2317*10**6, .2648*10**6, .2710*10**6, .2851*10**6, .3020*10**6, .3388*10**6, .3981*10**6, .5129*10**6, .1778*10**7, .2291*10**7, .5012*10**7]\ncdlist = [492.0, 169.8, 58.88, 10.86, 5.623, 3.388, 1.479, .9204, .7194, .5623, .4786, .4365, .4074, .3890, .3981, .4395, .4571, .4775, .4732, .4624,.4395, .4046, .3733, .3467, .2472, .1778, .1047, .09772, .1000, .1778, .1862, .1862]\nCdRe_logdata = [(log(relist[i],10),log(cdlist[i],10)) for i in range(len(relist))]\nRe_logdata = [log(relist[i],10) for i in range(len(relist))]\nCd_logdata = [log(cdlist[i],10) for i in range(len(relist))]\nstokes_transition = 1.5\n#CdL_interp = spline(CdRe_logdata)\n#CdL_interp = CubicSpline(Re_logdata,Cd_logdata)\nCdL_interp = interp1d(Re_logdata,Cd_logdata)\nReL_plot = np.linspace(-4,Re_logdata[-1],num=128)\n#ReL_plot = np.linspace(Re_logdata[0],Re_logdata[-1],num=128)\n#CdL_plot = CdL_interp(ReL_plot)\n# Stokes and Oseen analytical solutions\nCd_Stokes = lambda Re_: 24./Re_\nCd_Oseen = lambda Re_: 24./Re_*(1.+3./16.*Re_)\nCdL_Stokes = lambda logRe_: np.log10(24./np.power(10,logRe_))\nCdL_Oseen = lambda logRe_: np.log10(24./np.power(10,logRe_)*(1.+3./16.*np.power(10,logRe_)))\nCdRe = lambda logRe_: CdL_Oseen(logRe_) if logRe_ <= log(stokes_transition,10) else CdL_interp(logRe_)\nCdL_plot = [CdRe(r) for r in ReL_plot]\n\ndef cd_error(r,F_D,rho,mu,U):\n    \"\"\"A function evaluating the error between the parameter U and the\n    movement speed of a sphere with radius r subjected to force F_D in\n    fluid with density rho and viscosity mu. The U for which this function\n    evaluates to zero is the steady state movement speed. \"\"\"\n    if U==0.:\n        return -F_D\n    else:\n        signU=np.sign(U)\n        absU=abs(U)\n        #print 'got here...',r,F_D,rho,mu,U\n        logRe=log(2.*rho*r*absU/mu,10)\n        logCd=CdRe(logRe)\n        return (signU*0.5*rho*pi*r**2*U**2)*10**logCd - F_D\n\ndef U_sphere(r,F_D,rho,mu):\n    \"\"\"Steady-state movement velocity of a sphere in fluid, as determined by the\n    root of the error metric cd_error. \n    \"\"\"\n    # Determine the range over which the numerical root-finding algorithm should operate:\n    #Re_=2*rho*r*U./mu\n    Urange=relist[-1]*mu/(2.*rho*r)\n    Uerr = lambda u: cd_error(r,F_D,rho,mu,u)\n    U=bisect(Uerr,-Urange,Urange, rtol=0.000001,full_output=False)\n    return U\n\n\ndef Sherwood(r,D,rho,mu,U):\n    \"\"\" Calculate the Sherwood number for a moving sphere according to the curve fit from\n    Kiorboe et al. (2001). D is the diffusion coefficient; other parameters as above.\"\"\"\n    Re_=r*U*rho/mu  # Note that Kiorboe et al. use radius, not diameter as the length scale for Re\n    Pe_=r*U/D  # Note that Kiorboe et al. use radius, not diameter as the length scale for Re\n    Sc=mu/(D*rho)\n    #Sc=Pe_/Re_\n    Sh = 1. + 0.62 * Re_**0.41 * Sc**(1/3)\n    return Sh\n\n\nSh_RePe = lambda Re_,Pe_: Sherwood(1,Pe_**(-1),1,Re_**(-1),1)   \nSh_RePe3333 = lambda Re_: Sherwood(1,3333.**(-1),1,Re_**(-1),1)   \nSh_RePe1000 = lambda Re_: Sherwood(1,1000.**(-1),1,Re_**(-1),1)   \nSh_RePe333 = lambda Re_: Sherwood(1,333.**(-1),1,Re_**(-1),1)   \nSh_ReSc = lambda Re_,Sc_: Sherwood(1,1./(Sc_*Re_),1.,1./Re_,1.)   \nSh_ReSc3333 = lambda Re_: Sherwood(1.,1./(3333.*Re_),1.,1./Re_,1.)   \nSh_ReSc1000 = lambda Re_: Sherwood(1,1./(1000.*Re_),1.,1/Re_,1.)   \nSh_ReSc333 = lambda Re_: Sherwood(1,1./(333.*Re_),1.,1./Re_,1.)   \n\n# Show the Sherwood plots \nfig2, ax2 = plt.subplots()\nRe_Sher = np.linspace(1.e-1,2.e1,num=128)\nax2.plot(Re_Sher,Sh_ReSc3333(Re_Sher),color='cyan',label=r'$\\mathcal{Sc}=3333$')\nax2.plot(Re_Sher,Sh_ReSc1000(Re_Sher),color='red',label=r'$\\mathcal{Sc}=1000$')\nax2.plot(Re_Sher,Sh_ReSc333(Re_Sher),color='blue',label=r'$\\mathcal{Sc}=333$')\nax2.plot([0,Re_Sher.max()],[1,1],color='k',linestyle='--',label=r'$\\mathcal{Sh}=1$')\nax2.set_xlabel(r'Reynolds number, $Re$')\nax2.set_ylabel(r'Sherwood number, $Sh$')\nax2.grid()\nax2.legend();\n\n\n\nIn this plot, the cyan, red and blue lines represent the Sherwood number, \\mathcal{Sh}, for different Schmidt numbers, \\mathcal{Sc}.\n\\mathcal{Sc}is the ratio of the fluid kinematic viscosity to the solute‚Äôs diffusion coefficient.\nThat is, higher \\mathcal{Sc} implies more viscous fluids or less diffusive solutes.\nConversely, lower \\mathcal{Sc} implies less viscous fluids or more diffusive solutes.\n\nThe dashed black line represents \\mathcal{Sh}=1; that is, the case when flow has no effect on mass flux.\n\n\n\n","type":"content","url":"/rs3","position":1},{"hierarchy":{"lvl1":"üßÆ Effects of flow on molecular transport mechanisms","lvl2":"Sherwood number calculator"},"type":"lvl2","url":"/rs3#sherwood-number-calculator","position":2},{"hierarchy":{"lvl1":"üßÆ Effects of flow on molecular transport mechanisms","lvl2":"Sherwood number calculator"},"content":"As you can see in the plot above, under some conditions mass transport is greatly increased by fluid flow.\nBut, under other conditions, the increase is minimal.\nWhich applies to a given situation?\n\nThe text panel below enables you to enter the particle size, density and surface solute concentration, and the fluid viscosity, density and solute concentration.\nThe worksheet will then calculate for you the corresponding \\mathcal{Re}, \\mathcal{Sh} and mass transport rates.\n\nIn many environmental problems, important issues involve the amount of mass transport per unit mass of particle.\nFor example, a pollution problem may involve knowing whether a given mass of pollutant divided into many small particles has a different environmental effect than the same mass in a few larger particles.\nIn the example of nutrient uptake by phytoplankton, an ecological question might revolve around whether a given biomass of small cells is more effective at competing for nutrients than an equal biomass of large cells.\nThe calculator enables you to address those questions by calculating the mass transport per unit mass of particle.\n\nmu7=widgets.FloatText(value=1.376e-3,width=20,description = r\"$\\mu~~ (\\frac{N s}{m^2})$\")\nrho_water=widgets.FloatText(value=1028.,description = r\"$\\rho~~ (\\frac{kg}{m^3})$\")\nrho_sphere=widgets.FloatText(value=1105.,description = r\"$\\rho_{sphere}~~ (\\frac{kg}{m^3})$\")\nC_s=widgets.FloatText(value=0.,description = r\"$C_s$\")\nC_w=widgets.FloatText(value=1.,description = r\"$C_w$\")\nD7=widgets.FloatText(value=5.e-6,description = r\"$D~~ (m)$\")\nK7=widgets.FloatText(value=0.001,description = r\"$K~~ (\\frac{m^2}{s})$\")\n\nui1e = widgets.VBox([mu7,rho_water,C_w])\nui2e = widgets.VBox([rho_sphere,D7,C_s])\nui3e = widgets.HBox([ui1e, ui2e])\n\ndef Sh7(rho_water,rho_sphere,D7,mu7,K7,C_w,C_s):\n    rr=D7/2.\n    vol=float(4./3.*pi*rr**3)\n    excess_mass=-(rho_sphere-rho_water)*vol # Keep the same sign convention as \n                                            # Het_labX.sws -- positive z is up\n    g=9.81\n    ff=g*excess_mass\n    if rho_water==rho_sphere:\n        print('External force is zero...')\n        U_s=0.\n    else:\n        U_s=U_sphere(rr,ff,rho_water,mu7)\n    print('Volume = {:.4g}'.format(vol))\n    print('Excess mass = {:.4g}'.format(excess_mass))\n    print('Gravity/buoyancy force = {:.4g}'.format(g*excess_mass))\n    print('Reynolds number: Re = {:.4g}'.format(2.*rr*abs(U_s)*rho_water/mu7))\n    print('U = {:.4g}'.format(U_s))\n\n    Flux_diff= float(4 * pi * K7 * rr * (C_w-C_s))\n    #print '\\nFlux_diff=',Flux_diff\n    Sh = Sherwood(rr,K7,rho_water,mu7,abs(U_s))\n    Flux_adv=float(Sh*Flux_diff)\n    print('\\nSherwood number: Sh = {}'.format(Sh))\n    print('Diffusive transport: Q_diff = {}'.format(Flux_diff))\n    print('Advective transport: Q_adv = {}'.format(Flux_adv))\n    \n    print('\\nAdvective transport per unit mass: Q_adv/Excess mass = {}'.format(Flux_adv/abs(excess_mass)))   \n    \n    \nout7 = widgets.interactive_output(Sh7,{'rho_water':rho_water,'rho_sphere':rho_sphere,\n                                      'D7':D7,'mu7':mu7,'K7':K7,'C_s':C_s,'C_w':C_w})\ndisplay(ui3e,out7)\n\n\n\n","type":"content","url":"/rs3#sherwood-number-calculator","position":3},{"hierarchy":{"lvl1":"üìñÔ∏è Mass flux in and out of moving organisms"},"type":"lvl1","url":"/rs3context","position":0},{"hierarchy":{"lvl1":"üìñÔ∏è Mass flux in and out of moving organisms"},"content":"We are all familiar with the phenomenon of ‚Äúwind chill‚Äù ‚Äì we get colder on a chilly, windy day than on a day that is equally cold but has no wind.\nSimilarly, if you pour sugar crystals into your tea and let them sit on the bottom of your cup, they will take some time to dissolve.\nIf you stir your tea so that there is flow over the crystals they dissolve almost immediately.\nIn general, except at microscopic scales, molecular transport mechanisms are usually greatly enhanced by flow.\n\nJust as we used a \n\nscale model approach to estimate how fast particles move in fluids, we can use this approach to estimate how molecular transport mechanisms like diffusion are enhanced by particle movement.\nThe most convenient way to perform this calculation is with another dimensionless ratio.\nRecall that the Reynolds number is dimensionless, because it is the quotient of a force divided by another force -- the units of force in the numerator and denominator cancel).\nThe new dimensionless ratio is called the Sherwood number, \\mathcal{Sh}, and is defined as\\mathcal{Sh} = \\frac{\\mathit{mass~flux~with~diffusion~and~flow}}{\\mathit{mass~flux~with~diffusion~alone}}\n\nFor example, suppose we consider a phytoplankton cell that is absorbing nutrients as it slowly sinks in the water column.\n\\mathcal{Sh} is the actual mass transport of nutrients into the cell, divided by the mass of nutrients that would be transported if the cell were not sinking but were stationary in the water.\nIf the cell were stationary, mass transport would occur by diffusion alone.\nIf the cell is moving, the wind chill and stirred tea examples suggest that nutrient transport might be much higher.\nIf so, then actual transport is higher than transport by diffusion alone, and \\mathcal{Sh} \\gt 1.\n\nThree points are important here:\n\n1. \\mathcal{Sh} is a function of velocity (in this case, the sinking speed).\n\nPossible values range from \\mathcal{Sh} = 1, for a particle that is moving very slowly or not at all (that is, no enhancement of transport due to movement) to very large values (e.g. \\mathcal{Sh} \\gt 100) for some rapidly moving particles.\nThat means mass transport has been increased by a factor of more than 100.\nAs you can imagine, this could make quite a difference to nutrient uptake by cells, and in many other analogous situations\n\nBecause Sh depends on velocity, it is effectively summarized as a function of \\mathcal{Re} (just as was the \n\ncoefficient of drag, C_d).\nHere, \\mathcal{Re} summarizes how fluid flows around the particle.\n\n2. \\mathcal{Sh} is a function of the diffusion rate.\nBecause diffusion is involved, we need a way to express the diffusion rate of the nutrient (or other solute, as the case may be).\n\nThe convenient way to express this is as yet another dimensionless ratio, the \n\nSchmidt number, \\mathcal{Sc}.\n\\mathcal{Sc} has a simple definition:\\mathcal{Sc} = \\frac{\\mu}{D \\times \\rho}\n\nHere, \\mu is the fluid dynamic viscosity, \\rho is the fluid density, and D is the diffusion coefficient of the solute in the fluid.\nNote that \\mathcal{Sc} can also be written in terms of the kinematic viscosity, \\nu:\\mathcal{Sc} = \\frac{\\nu}{D}\n\nThis simple expression shows that \\mathcal{Sc} is actually the ratio of the momentum diffusivity, \\nu, to the mass diffusivity, D.\n\n3. For many simple shapes, we have a formula for the mass tranport due to diffusion alone.\n\nFor example, for a spherical particle, the mass transport of solute into the particle due to diffusion alone isQ_{\\mathit{diff}} = 2 \\pi D \\times d \\times (C_w - C_s).\n\nIn this formula,\n\nd is the particle diameter;\n\nC_w is the solute concentration in the fluid far from the particle; and,\n\nC_s is the concentration at the surface of the particle.\n\nFor example, if the particle is extremely effective at absorbing the solute (as might be approximately true for a phytoplankton cell absorbing nutrients) the C_s \\approx 0.\nIf we have a formula for Q_{\\mathit{diff}}, then all we need to know is \\mathcal{Sh}.\nThen, we can calculate the actual mass flux (including diffusion and advection) into a moving particle, Q_{\\mathit{adv}}.\n\nA worksheet that makes it easy to use Sherwood numbers to calculate the fluxes in and out of spherical organisms or other particles is \n\nhere.","type":"content","url":"/rs3context","position":1},{"hierarchy":{"lvl1":"üìñÔ∏è Estimating drag forces, Part 1"},"type":"lvl1","url":"/rscharact","position":0},{"hierarchy":{"lvl1":"üìñÔ∏è Estimating drag forces, Part 1"},"content":"In understanding the ways organisms move through fluids, it‚Äôs useful to distinguish between effects that are due mostly to an organism‚Äôs size from those associated with its shape.\nWe might ask, for example, ‚ÄúHow does swimming speed and cost of locomotion differ between a smaller younger fish and that same fish when it is older and larger but substantially the same shape?‚Äù\nWe could also ask, ‚ÄúIs the morphology of this fish streamlined as an adaptation to swimming quickly or for long distances, by comparison to another fish that is equal in size but largely sedentary?‚Äù\n\nHere, we focus on understanding the basic effects of size on drag forces acting on organisms moving in fluids.\nThat is, we will ask, ‚ÄúWhat are the inherent effects of being large or being small on drag forces?‚Äù\nLikewise, we will ask, ‚ÄúWhat are the inherent effects of moving quickly or slowly on drag forces?‚Äù\nThese questions are posed in generic terms because  we are interested in inherent effects ‚Äì those that are largely unavoidable consequences of size or speed.\n\nThe answers to these questions will provide us with tools to think more concretely about the effects of specific shapes, behaviors, etc.\nThe idea is that factors like size and speed will have strong effects on drag, and that variations in shape, surface properties and other specific traits will be ‚Äútweaks‚Äù of those strong effects.\nIf we can factor out the effects of size and speed, more subtle effects (like those of shape) will be easier to understand and quantify.","type":"content","url":"/rscharact","position":1},{"hierarchy":{"lvl1":"üìñÔ∏è Estimating drag forces, Part 1","lvl2":"Organismal characteristics"},"type":"lvl2","url":"/rscharact#organismal-characteristics","position":2},{"hierarchy":{"lvl1":"üìñÔ∏è Estimating drag forces, Part 1","lvl2":"Organismal characteristics"},"content":"Figure¬†1 is a cartoon of an organism moving through a fluid (in this case, sinking downwards).\nAs it moves, it pushes aside fluid in front of itself, illustrated by the blue ‚Äústreamlines‚Äù moving sideways near the underside of the organism.\nImmediately adjacent to the organism, fluid is moving with the organism (hence, added mass).\nThe organism leaves a wake behind itself, of fluid that is moving nearly as fast as it is (hence, wake momentum).\n\n\n\nFigure¬†1:A cartoon of a sinking organism. The organism has a linear dimension (diameter) L, frontal area A, and sinking velocity U. The blue lines indicate water flow around the organism, and the wake it leaves behind.\n\nIn generic terms, we can describe this organism using characteristic values (also see the discussion on Scale models and nondimensional numbers in the Overview).\nFor example, we can consider a characteristic length, L, as a linear metric that expresses an object size.\nIf the organism is spherical, then an obvious choice for L is the diameter.\nIf the organism is oblong, then there is some ambiguity, but if we choose for L some consistent standard such as maximum dimension or average of the dimensions, then the analysis will still reflect the differences between larger and smaller (but similarly shaped) particles.\n\nL is the characteristic length.\nAnalogously, we specify a characteristic area, A.\nA is an indicator of the approximate magnitude of the organism‚Äôs projected area.\nAs with length, the exact specification of A is obvious for a sphere, and a little ambiguous for an oblong organism.\nIn general, choosing a simple standard like the square of the characteristic length, A = L^2, will capture essential size effects as long as it is used consistently.\n\nWe also specify a characteristic speed, U, which in this case is clearly the sinking rate, as indicated by the blue arrow in \n\nFigure¬†1.","type":"content","url":"/rscharact#organismal-characteristics","position":3},{"hierarchy":{"lvl1":"üìñÔ∏è Estimating drag forces, Part 1","lvl2":"Fluid characteristics"},"type":"lvl2","url":"/rscharact#fluid-characteristics","position":4},{"hierarchy":{"lvl1":"üìñÔ∏è Estimating drag forces, Part 1","lvl2":"Fluid characteristics"},"content":"The drag on a moving organism depends, of course, on the characteristics of the fluid in which it is immersed.\nThe key fluid properties that affect drag are density and viscosity.\nYou can open worksheet to calculate these properties for freshwater, saltwater and air on Binder by clicking on\n\n\n\nThe variation of density and viscosity over a range of relevant temperatures for freshwater and saltwater with 35 ppt salinity are shown in \n\nFigure¬†2\n\n\n\nFigure¬†2:These plots show the variation of density, dynamic viscosity and kinematic viscosity across a range of temperatures relevant to aquatic organisms. It is a personal communication from Dr. Pete Jumars, and was calculated using formulas in  Jumars, P.A., J.W. Deming, P.S. Hill, L. Karp-Boss, P.L. Yager and W.B. Dade. 1993. Physical constraints on marine osmotrophy in an optimal foraging context. Mar. Microbial Food Webs 7:121-159.","type":"content","url":"/rscharact#fluid-characteristics","position":5},{"hierarchy":{"lvl1":"üìñÔ∏è Estimating drag forces, Part 1","lvl3":"Density","lvl2":"Fluid characteristics"},"type":"lvl3","url":"/rscharact#density","position":6},{"hierarchy":{"lvl1":"üìñÔ∏è Estimating drag forces, Part 1","lvl3":"Density","lvl2":"Fluid characteristics"},"content":"The density of a fluid is simply the mass of the fluid for a given volume.\nIn SI units, density is expressed in \\frac{kg}{m^3} (that is, kilograms per meter cubed).\nDensity is a function of temperature, the concentration of solutes such as salt, and pressure.\nAs an example, the bottom plot of \n\nFigure¬†2 shows the variation in density of freshwater (lower line) and 35 ppt saltwater (upper line).\nThis plot show that density is a slowly decreasing function of temperature. ","type":"content","url":"/rscharact#density","position":7},{"hierarchy":{"lvl1":"üìñÔ∏è Estimating drag forces, Part 1","lvl3":"Viscosity","lvl2":"Fluid characteristics"},"type":"lvl3","url":"/rscharact#viscosity","position":8},{"hierarchy":{"lvl1":"üìñÔ∏è Estimating drag forces, Part 1","lvl3":"Viscosity","lvl2":"Fluid characteristics"},"content":"We intuitively understand the difference between a more viscous fluid like honey or molasses and a less viscous fluid like water.\nIf we imagine sliding two plates next to each other in a fluid, viscosity expresses how much force is required to keep them moving.\nIntuitively, if the fluid is honey, it requires more force than if the fluid is water.\nKeeping them moving in air requires even less force.\nTherefore, honey is more viscous than water, and air is less viscous than either water or honey.\n\nThere is one slightly confusing aspect of viscosity, however: there are two ways in which visosity is commonly measured: dynamic viscosity and kinematic viscosity.","type":"content","url":"/rscharact#viscosity","position":9},{"hierarchy":{"lvl1":"üìñÔ∏è Estimating drag forces, Part 1","lvl4":"Dynamic viscosity","lvl3":"Viscosity","lvl2":"Fluid characteristics"},"type":"lvl4","url":"/rscharact#dynamic-viscosity","position":10},{"hierarchy":{"lvl1":"üìñÔ∏è Estimating drag forces, Part 1","lvl4":"Dynamic viscosity","lvl3":"Viscosity","lvl2":"Fluid characteristics"},"content":"The dynamic viscosity relates to forces, such as the force required to keep plates sliding past each other.\nDynamic viscosity is often symbolized by the Greek letter \\mu.\nThe SI units for dynamic viscosity are \\frac{N s}{m^2}.\n\nTo understand dynamic viscosity, let‚Äôs think about two plates immersed in water, separated by a distance H.\nOne of these plates is stationary, and the other is sliding past it at velocity U \\frac{m}{s}.\nThe water touching the stationary plate is stationary, and the water touching the moving plate moves with it at velocity U.\nThe dynamic viscosity is the force acting on each unit area of the moving plate required to keep it moving, divided by the separation distance H and the velocity U. \n\nThe velocity U divided by the distance H is a quantity called the velocity gradient.\nTherefore the dynamic viscosity is the force acting on each unit area of the moving plate normalized by the velocity gradient.","type":"content","url":"/rscharact#dynamic-viscosity","position":11},{"hierarchy":{"lvl1":"üìñÔ∏è Estimating drag forces, Part 1","lvl4":"Kinematic viscosity","lvl3":"Viscosity","lvl2":"Fluid characteristics"},"type":"lvl4","url":"/rscharact#kinematic-viscosity","position":12},{"hierarchy":{"lvl1":"üìñÔ∏è Estimating drag forces, Part 1","lvl4":"Kinematic viscosity","lvl3":"Viscosity","lvl2":"Fluid characteristics"},"content":"Kinematic viscosity is simply the dynamic viscosity divided by the density.\nKinematic viscosity is often symbolized by the Greek letter \\nu.\nThe SI units for kinematic viscosity are \\frac{m^2}{s}.\n\nIn some ways, since we typically know both the density and the dynamic viscosity, it seems counter-intuitive to also define the kinematic viscosity.\nThe reason it is defined is that dynamic viscosity frequently occurs in formulas divided by the density.\nFurthermore, the kinematic viscosity has an intuitive interpretation: it characterizes the diffusion of momentum in the same way the diffusion coefficient characterizes the diffusion of a solute, and conductivity characterizes the diffusion of heat.\nThis analogy between diffusion of mass, heat and momentum is often helpful in gaining intuition and in quantitative analysis about organism function.\n\nThe curve for freshwater ends at 0\\degree C; that is, at the freezing point of fresh water. The curve for salt water extends to lower temperatures, because its freezing point is lower.\n\nThis is because of the no-slip condition, which says that fluid molecules in contact with a surface are moved along with that surface.\n\nFor ‚Äúsimple‚Äù fluids, like water or air, dynamic viscosity does not vary with H or U. These are called Newtonian fluids. For some complex fluids relevant to Organismal Biology, such as blood or mucus, dynamic viscosity can differ for different values of H and U. These are called non-Newtonian fluids.","type":"content","url":"/rscharact#kinematic-viscosity","position":13},{"hierarchy":{"lvl1":"üìñÔ∏è Estimating drag forces, Part 2"},"type":"lvl1","url":"/rscharact2","position":0},{"hierarchy":{"lvl1":"üìñÔ∏è Estimating drag forces, Part 2"},"content":"With the set of organismal and fluid characteristics developed in \n\nPart 1, we can now begin to assess the generic effects of size and speed on drag forces acting on organisms.\nAs a reminder, we are deliberately avoiding references to specific morphologies, behaviors or fluids.\nInstead, we are looking for inherent effects of size, velocity and fluid characteristics that generalize across these specifics.\nBecause we omit specifics, we are aiming here for order of magnitude estimates.\nThe intent is, knowing the order of magnitude of the inherent generic effects, we will then be able to focus in detail about possible ‚Äútweaks‚Äù due to adaptations in morphology, behavior etc.\n\nAs our case study, we will think about the organism from \n\nPart 1 that is sinking at a steady speed in stationary fluid.\nWe will consider two types of forces, drawn from the previous pages:\n\nForces due to momentum\n\nMomentum forces on an organism moving at a constant velocity stem from the wake momentum, which is increasing as the length of the wake lengthens over time and requires force to maintain.\n\nForces due to viscosity\n\nViscous forces on an organism moving in a fluid stem from the fluid‚Äôs viscosity, \\mu, acting on the organism‚Äôs surface in proportion to the velocity gradient in flow from the organism‚Äôs surface (where fluid moves with the organism) to the ‚Äúfree stream‚Äù far from the organism, where fluid is undisturbed.\n\nThe key question we will address is, ‚ÄúHow do we expect forces due to viscosity and wake momentum to increase with organism size and speed?‚Äù","type":"content","url":"/rscharact2","position":1},{"hierarchy":{"lvl1":"üìñÔ∏è Estimating drag forces, Part 2","lvl2":"Forces due to wake momentum"},"type":"lvl2","url":"/rscharact2#forces-due-to-wake-momentum","position":2},{"hierarchy":{"lvl1":"üìñÔ∏è Estimating drag forces, Part 2","lvl2":"Forces due to wake momentum"},"content":"Figure¬†1 is a cartoon of the wake behind the sinking organism.\n\n\n\nFigure¬†1:Idealized wake behind a sinking particle. The orange lines indicate the wake. For our estimate, we assume the cross section of the wake is equal to A, the projected area of the particle. We also assume water within the wake has velocity U, and that water outside the wake has negligible velocity.\n\nOur estimate of forces on an organism due to wake momentum is based on:\n\nThe organism‚Äôs ‚Äúcharacteristic‚Äù parameters: size, L; area, A = L^2; and velocity, U.\n\nThe fluid‚Äôs density, \\rho.\n\nNewton‚Äôs 2nd Law, which tells us that the force arising from wake momentum, F_{mom}, equalsF_{mom} = \\mathit{rate~of~increase~of~wake~momentum}\n\nThe knowledge that the wake momentum is increasing because fluid mass ‚Äúswept out‚Äù by the organism (approximately at rate A \\times U \\times \\rho) is accelerated to the organism‚Äôs velocity (U).\n\nPutting these observations together, we can estimate the apparent drag force on the organism due to wake momentum asF_{mom} = \\rho L^2 U^2\n\n\t\nIn sum, F_{mom} is an order of magnitude estimate of the wake momentum force on an organism, which expresses the inherent effects of size L, velocity U and fluid density \\rho, subject to ‚Äútweaks‚Äù from future consideration of effects from specific details such as the organism‚Äôs shape.","type":"content","url":"/rscharact2#forces-due-to-wake-momentum","position":3},{"hierarchy":{"lvl1":"üìñÔ∏è Estimating drag forces, Part 2","lvl2":"Forces due to viscosity"},"type":"lvl2","url":"/rscharact2#forces-due-to-viscosity","position":4},{"hierarchy":{"lvl1":"üìñÔ∏è Estimating drag forces, Part 2","lvl2":"Forces due to viscosity"},"content":"Figure¬†2 is a cartoon of the fluid motion to the side of the sinking organism.\nThe cartoon illustrates several features that are important to recognize before estimating the drag forces due to viscosity.\n\n\n\nFigure¬†2:Idealized shear layer on a sinking particle. We assume that the velocity grades from U on the particle‚Äôs surface to close to zero over a distance approximately the size of the particle, L.\n\nThe orange curve represents a velocity profile, which is simply a plot of velocity as a function of distance from the organism‚Äôs surface.\nThis velocity profile reflects the fact that, regardless of details about the organism or the fluid, the fluid‚Äôs velocity at the surface equals the organim‚Äôs velocity, and the velocity of undisturbed fluid far from the organism is zero.\n\nThe velocity profile also illustrates the velocity gradient (that is, the rate of change of velocity with distance from the surface).\nIn the cartoon, the velocity gradient is relatively steep near the organism and becomes more gradual further away, which is typical of profiles observed near objects moving in fluids.\nThe velocity gradient is important because, as we saw in \n\nPart 1, the viscous force on the organism‚Äôs surface is proportional to this gradient.\n\nTo estimate the viscous force, then, we need an estimate of the velocity gradient at the organism‚Äôs surface.\nAs before, because we are deferring consideration of specifics like shape and behavior, we will settle for order of magnitude estimates of the velocity gradient and viscous force.\nThese details can be considered when we better understand the inherent effects of size, velocity and fluid properties.\n\nOur estimate of forces on an organism due to viscosity is based on:\n\nThe organism‚Äôs ‚Äúcharacteristic‚Äù parameters: size, L; area, A = L^2; and velocity, U.\n\nThe fluid‚Äôs dynamic viscosity, \\mu.\n\nThe knowledge (stemming from the way dynamic viscosity is defined and measured) that the viscous force is equal to the velocity gradient adjacent to the organism‚Äôs surface, multiplied by the dynamic viscosity and the area over which that viscosity acts.\n\nThe likelihood that the size of the organism, L, is usually a rough indicator of the distance over which it disturbs the surrounding fluid (illustrated by L in \n\nFigure¬†2 above the velocity profile.\n\nFrom these facts we can estimate the drag force due to viscosity, F_v, asF_{v} = \\mathit{viscosity} \\times \\mathit{area} \\times \\mathit{velocity~gradient}\n\n\t\nIn mathematical terms,F_{v} = \\mu L^2 \\frac{U}{L} = \\mu L U\n\n\t\nwhere the area is estimated as L^2 and the velocity gradient is estimated as \\frac{U}{L}.","type":"content","url":"/rscharact2#forces-due-to-viscosity","position":5},{"hierarchy":{"lvl1":"üìñÔ∏èÔ∏è Movement of organisms in fluid"},"type":"lvl1","url":"/rscontext","position":0},{"hierarchy":{"lvl1":"üìñÔ∏èÔ∏è Movement of organisms in fluid"},"content":"","type":"content","url":"/rscontext","position":1},{"hierarchy":{"lvl1":"üìñÔ∏èÔ∏è Movement of organisms in fluid","lvl2":"Motivation"},"type":"lvl2","url":"/rscontext#motivation","position":2},{"hierarchy":{"lvl1":"üìñÔ∏èÔ∏è Movement of organisms in fluid","lvl2":"Motivation"},"content":"Many aspects of Organismal Biology are affected, directly or indirectly, by the ways organisms (or parts of organisms) move through fluids.\nSome of these effects arise from consequences of sinking or floating in air or water.\nFor example, the rate at which carbon dioxide is removed from the atmosphere into the ocean is affected by how fast carbon fixed by phytoplankton sinks into the deep ocean.\nThe sinking rate for a given phytoplankton cell can vary greatly depending on whether it is eaten by zooplankton and excreted into large, fast-sinking fecal pellets or lysed by a viral infection into tiny slow-sinking subcellular fragments.\nThe rate and direction of range shifts by plants in response to climate change, or the ability to colonize new habitat patches, may depend on the sinking rates of windblown or current-borne propagules.\nFor an aquatic microorganism, its position in a water column that varies in temperature, light, nutrient availability and density of predators and prey may depend on its vertical movement relative to the water around it.\nFrom a more applied perspective, the ‚Äúdrift‚Äù of corn pollen from genetically modified plants into neighboring fields of organic corn depends on the sinking rate of the pollen particles.\nGeneralizing even more, the ‚Äúfootprint‚Äù of land contaminated by pollutant particles emitted by a sewage outfall or smokestack, or ocean fertilized by iron in wind-blown dust, depends on how fast these particles sink.\nYou can think of many other examples.\n\nIn addition to effects on spatial distributions, movement through fluids can also greatly amplify the effects of key molecular transport mechanisms, especially mass diffusion and heat conduction.\nYou are already familiar with these effects in your daily life.\nEach time you stir sugar into a cup of tea, blow on a hot spoonful of soup to make it edible, walk outside on a windy day, or stick a finger in the air to assess the wind direction you are experiencing the effects of fluid movement enhancing molecular transport.\nThis enhancement effect has implications for diverse aspects of Organismal Biology, including nutrient uptake, blood physiology, fertilization success, endothermy and many others.","type":"content","url":"/rscontext#motivation","position":3},{"hierarchy":{"lvl1":"üèûÔ∏è What are the forces acting on immersed particles?"},"type":"lvl1","url":"/rsforces","position":0},{"hierarchy":{"lvl1":"üèûÔ∏è What are the forces acting on immersed particles?"},"content":"For most particles relevant to Organismal Biology, three types of forces most strongly affect movement:\n\nGravity forces: Every particle has mass, M.\n\nThe force \n\ngravity exerts on a particle isF_{gravity} = g \\times M\n\nwhere g = 9.81 \\frac{m}{s^2} is the gravitational acceleration.\n\nPressure forces:\n\nAs you know from your ears, if you have dived to the bottom of a swimming pool, \n\npressure increases with depth.\nThat implies that the pressure acting on the bottom surface of a particle is stronger than the pressure acting on the top of that particle (because the bottom is deeper than the top).\n\nSince the pressure pushing upwards on the bottom of the particle is stronger that the pressure pushing downwards on the top of the particle, the net force of this pressure is an upward force, which we call buoyancy.\nIt turns out that this force is always equal to the gravitational force on the mass of fluid that the particle displaces, but opposite in direction (that is, the buoyancy tends to push particles upwards while gravity pulls them downwards).\n\nThis gives us the familiar sinking vs. floating phenomena: If a particle is denser than the fluid, its mass is greater than the mass of the displaced fluid, and hence it has a net downward force (gravity exceeds buoyancy). Therefore it sinks.\nIf the particle is less dense than the fluid, buoyancy exceeds gravity, and it floats.\n\nIf the particle is moving,\n\nViscous forces:\n\nViscosity is a measure of how ‚Äúthick‚Äù a fluid is.\nIn engineering terms, viscosity is the resistance to the motion of two parallel plates sliding past one another (this motion is called shear).\nFor example, fluids like honey, molasses and glycerine have much higher viscosity than fluids like water and air.\n\nThis means that dragging a particle through a more viscous fluid like honey at a given velocity requires much more force than dragging the same particle at the same velocity through a less viscous fluid like water or air.\n\nGravity, pressure (including buoyancy) and viscous forces all contribute to the sum of forces on the left hand side of the equation for Newton‚Äôs 2nd Law, as applied to an immersed particle.\n\nIn a few rare but interesting cases, other forces such as magnetism are important!\n\nNote that F_{gravity} is a vector, which means simply that it has both a magnitude (9.81 \\times M) and a direction (down).\n\nYou may also have felt the opposite: ‚Äúpopping‚Äù in your ears from the decrease in air pressure as an airplane takes off.","type":"content","url":"/rsforces","position":1},{"hierarchy":{"lvl1":"üí°Ô∏è ‚ÄúLook-up tables‚Äù for drag forces on moving particles"},"type":"lvl1","url":"/rslookup","position":0},{"hierarchy":{"lvl1":"üí°Ô∏è ‚ÄúLook-up tables‚Äù for drag forces on moving particles"},"content":"A key benefit of the Reynolds number is that it dramatically shrinks the number of experimental observations or numerical computations we need to characterize particle movement in fluids.\nThat is because it enables us to make and interpret scale models.\nIf we observe or compute one example of drag forces on an organism moving in fluid, the Reynolds number tells us how to translate that result to any geometrically similar organism in any fluid, as long as it has the same Reynolds number.\n\nAs an example, let‚Äôs consider the general problem of drag forces on spherical organisms moving through a variety of fluids (air, water of different salinities, blood, mucus, etc.).\nAs with many biomechanics models, assuming an organism is spherical applies to a few organisms exactly, but to a great many organsims approximately.\nOur goal is to create a \n\nlookup table that tabulates the drag forces on these organisms, to understandhow fast they rise or sink, as biomechanical consequences of size, habitat etc.\n\nTo cover relevant biological applications, we have at least four parameters to vary:\n\norganism size, L\n\norganism velocity, U\n\nfluid viscosity \\mu\n\nfluid density, \\rho\n\nIf we need 20 values of each parameter to fully characterize the parameter space for our lookup table, we need to make 20^4  = 160000 observations.\nFurthermore, some of these observations are difficult or impossible, such as measuring the forces on bacterium-sized organisms.\n\nThe Reynolds number rescues us from this difficult situation.\nWe know that all geometrically similar organisms with the same \\mathcal{Re} are scale models of each other (that is, they are dynamically similar).\nThis means we need only make one observation for each value of \\mathcal{Re}; from this observation, we can calculate all the specific instances of organisms, fluids etc. with the same Reynolds number.\n\nFor example, we can choose one convenient organism size (L), and a convenient fluid (with a given visosity, \\mu, and density, \\rho).\nWe can then measure drag forces across a range of velocity, U, giving us the complete range of \\mathcal{Re} we need to span the biologically interesting applications.\nThis gives us a lookup table that covers the whole range of organisms by measuring only 20 different values of \\mathcal{Re}!\n\nTo use this concise approach, we need a formula for converting the drag forces on one organism to another organism that is dynamically similar.\nThat formula has been provided by engineers and fluid mechanicists, and is called the \n\nCoefficient of Drag, C_d (also called the Drag Coefficient).\nThe formula for C_d isC_d  = \\frac{F}{\\frac{1}{2} \\rho L^2 U^2}\n\nThe Coefficient of Drag has been measured or calculated for many shapes, as for example for \n\nspheres.\n\nAlso called the Drag Coefficient.","type":"content","url":"/rslookup","position":1},{"hierarchy":{"lvl1":"üèûÔ∏è  Momentum changes due to ‚Äúadded mass‚Äù and ‚Äúwake momentum‚Äù"},"type":"lvl1","url":"/rsmasses","position":0},{"hierarchy":{"lvl1":"üèûÔ∏è  Momentum changes due to ‚Äúadded mass‚Äù and ‚Äúwake momentum‚Äù"},"content":"As noted, the term on the right hand side of Newton‚Äôs 2nd Law is  \\mathit{mass} \\times \\mathit{acceleration}, representing the rate of change of \n\nmomentum.\nMomentum is the product of mass times acceleration.\n\nOne contribution to momentum comes from the mass of the organism or particle.\nIn familiar terms, the mass of a bowling ball is much greater than the mass of a ping-pong ball, so the bowling ball has much more momentum than the ping-pong ball if they are traveling at the same velocity.\n\nIn most applications in Organismal Biology, an organism‚Äôs mass is more or less constant over short periods.\nIn that case, changes in the organism‚Äôs momentum result from changes in its velocity.\n\nHowever, for organisms immersed in fluids, there is another factor: To move, an organism or any other particle must also displace fluid around itself.\nThe water that is moved in concert with an organism must be accounted for in assessing the relationship between forces and movement.\nThere are two primary ways in which moving fluid affects the righthand side terms of Newton‚Äôs 2nd Law: Added mass, and wake momentum.\nUnderstanding these concepts will be very helpful when thinking about the biomechanics of organism movement in fluids.","type":"content","url":"/rsmasses","position":1},{"hierarchy":{"lvl1":"üèûÔ∏è  Momentum changes due to ‚Äúadded mass‚Äù and ‚Äúwake momentum‚Äù","lvl2":"Added mass"},"type":"lvl2","url":"/rsmasses#added-mass","position":2},{"hierarchy":{"lvl1":"üèûÔ∏è  Momentum changes due to ‚Äúadded mass‚Äù and ‚Äúwake momentum‚Äù","lvl2":"Added mass"},"content":"If you have seen a person rowing a boat (or had a chance to row one yourself) you have seen the shape of an oar.\nAt one end the oar has a handle, where it is gripped by the rower.\nAt the other end, the oar is the ‚Äúblade‚Äù, which is wide and flat but quite thin.\n\nTo propel the boat, the rower inserts the oar into the water with the blade perpendicular to the direction the boat is moving, before pulling.\nIt is intuitive that this is necessary to row effectively ‚Äì if the blade were parallel to the direction of motion, it would slice easily through the water and provide very little propulsion.\n\nDespite it being intuitive, few people (including rowers) have thought about why this is the case?\nWhen an oar is pulled through the water, its mass is the same whether it‚Äôs perpendicular or parallel to the direction of motion.\nWhat then is the difference?\n\nThe difference is \n\nadded mass, the engineering term for fluid that must be moved when an object moves through a fluid.\nFor example, when the oar is pulled in a perpendicular position, water next to the front and back of the blade moves with it.\nBecause the perpendicular blade has a large area in line with its motion, this is a lot of water.\nThis water is the added mass of the oar.\nAccelerating this added mass of water is what makes the oar effective, and oars are designed specifically to have large added mass when pulled in the perpendicular position.\n\nIn contrast, the parallel blade has a small area in line with its motion, so it moves relatively little water.\nThat is, it has little added mass.\nIt is said to be streamlined, which means it moves with little resistance through the fluid.\n\nIn a well-designed oar, the added mass in its ‚Äúpower‚Äù orientation is much larger than the mass of the blade itself.\nThe same is true of many appendages of organisms that propell themselves through water.\nWhile other fluid dynamical mechanisms are also operating, thinking in terms of added mass often provides useful insights into the biomechanics of movement through fluids.","type":"content","url":"/rsmasses#added-mass","position":3},{"hierarchy":{"lvl1":"üèûÔ∏è  Momentum changes due to ‚Äúadded mass‚Äù and ‚Äúwake momentum‚Äù","lvl2":"Wake momentum"},"type":"lvl2","url":"/rsmasses#wake-momentum","position":4},{"hierarchy":{"lvl1":"üèûÔ∏è  Momentum changes due to ‚Äúadded mass‚Äù and ‚Äúwake momentum‚Äù","lvl2":"Wake momentum"},"content":"Standing in an exposed spot on a very windy day, you can feel the pressure of the wind pushing you downwind.\nSince you are stationary and not accelerating, your momentum is constant and its rate of change is zero.\nNewton‚Äôs 2nd Law says that if your momentum is not changing, the sum of forces on you must be zero.\nHowever there is quite definitely a wind force acting on you.\nHow does this make sense?\n\nIt makes sense because, though your body‚Äôs momentum is not changing, by blocking the wind you are constantly changing the momentum of the air around you.\nSpecifically, you are creating a \n\nwake downwind of yourself, and that wake has less momentum than the air that is approaching you from upwind.\n\nTo understand the basic mechanism, let‚Äôs think about a simplified geometry:\nLet‚Äôs assume that your have a profile area (perpendicular to the wind) of 1m^2.\nThe wind speed upwind of you is 10 \\frac{m}{s} (about 11 mph).\nThat means roughly 10 m^3 of air, corresponding to a little over 12 kg, is encountering your body every second.\nThe momentum in that air is 10 m^3 \\times 12 kg ‚Äì a considerable amount.\n\nHowever your body is blocking that air, so that downstream of you there is a zone in which wind speed is greatly reduced.\nIf the air in this zone has zero velocity (an oversimplification, but still a useful rough estimate) then, by blocking the wind, you are subtracting 120 m^3kg of momentum each second from the air as it passes you.\nThis requires force, that is the force that you feel as wind pressure and provide by opposing it with your feet.\n\nThis idea ‚Äì that a moving organism creates a wake that requires force to maintain even if its own momentum is constant ‚Äì is key to understanding both how organisms are shaped by evolution to minimize costs of locomotion and how forces on moving organisms scale with basic characteristics such as size and velocity.","type":"content","url":"/rsmasses#wake-momentum","position":5},{"hierarchy":{"lvl1":"üèûÔ∏è  Momentum changes due to ‚Äúadded mass‚Äù and ‚Äúwake momentum‚Äù","lvl2":"Summary"},"type":"lvl2","url":"/rsmasses#summary","position":6},{"hierarchy":{"lvl1":"üèûÔ∏è  Momentum changes due to ‚Äúadded mass‚Äù and ‚Äúwake momentum‚Äù","lvl2":"Summary"},"content":"To sum up, an object moving in a fluid has additional ‚Äúapparent‚Äù contributions to its momentum, as accounted for in Newton‚Äôs 2nd Law.\nThis is because:\n\nWhen it accelerates, it also accelerates some of the fluid around it; the mass of this fluid is called ‚Äúadded mass‚Äù.\n\nAs it moves through the fluid, it leaves behind it a wake of fluid it has accelerated to its own velocity; to continually change the momentum of the fluid it encounters (the ‚Äúwake momentum‚Äù) requires force, which the object experiences as drag.\n\nAdded mass and wake momentum are continually acting on our own bodies, because we are immersed in a fluid (air).\nBecause our bodies are so much denser than air, we usually don‚Äôt feel these effects, but under some circumstances (bicycling, swimming, windy days, etc.) they become much more noticeable.\n\nSome references refer to \n\ninertia as a synonym for momentum. Inertia is defined slightly differently, but is a closely related concept. Some references refer to momentum effects as an \n\ninertial force. These effects are is not really a force, but it has units of force, and some references find it convenient to use this shorthand (while keeping in mind its actual interpretation).\n\nIn some cases, though, changes in mass during acceleration are important. Examples include the swimming biomechanics of ‚Äújet-propelled‚Äù animals like squid and jellyfish, in which water that initially is enclosed and moves with the organism is left behind during a muscular contraction to produce thrust.","type":"content","url":"/rsmasses#summary","position":7},{"hierarchy":{"lvl1":"üß≠Ô∏è Organization"},"type":"lvl1","url":"/rsorganization","position":0},{"hierarchy":{"lvl1":"üß≠Ô∏è Organization"},"content":"This unit provides quantitative tools for understanding the consequences for organsism of movement through fluids.\nTo keep the discussion general, we often refer to ‚Äúparticles‚Äù ‚Äì this refers in specific instances to whole organisms such as microorganisms, propagules such as seeds, or components of organisms such as blood cells or pollen.\nThe tools in this unit facilitate understanding the linkages by organismal characteristics such as size and density to organismal function from subcellular to physiological to ecological scales.\n\nThe unit is divided into three related but distinct sections.\n\nThe first section relates the sizes of particles, their densities, and the gravity and buoyancy forces acting on them to rates of movement through their fluid environment.\nThis section provides worksheets to address questions such as:\n\nHow does the rate at which fish or invertebrate eggs sink or float depend on egg size and lipid content?\n\nHow does the rate of transport to the deep ocean of carbon fixed by phytoplankton depend on consumption by zooplankton or infection by viruses?\n\nHow fast do propagules like seeds, spores or pollen sink?\n\nThe second section connects particles‚Äô sinking or floating rates to ambient winds or currents and turbulence, to understand how organismal characteristics interact with ambient environmental conditions to determine population-level horizontal and spatial distributions.\nThis section provides worksheets to address questions like:\n\nHow far does wind-borne pollen travel? How does pollination success depend on the distance and height of plants??\n\nWhat does the ‚Äúplume‚Äù of pollution particles look like? What is the likely exposure of organisms given habitat distributions and typical weather patterns?\n\nThe third section focuses specifically on fluxes of conserved quantities such as nutrients, oxygen and waste products as functions of movement through fluids.\nThis section addresses questions such as:\n\nWhat chemical cues are available to organisms such as bacteria? How does movement affect uptake and release of oxygen in blood cells?\n\nIn what ways do increases or decreases in size of aquatic microorganisms alter constraints on oxygen and nutrient uptake?\n\nHow does egg size and content affect fertilization success in aquatic environments?\n\nEach of these section is introduced with background and context, implemented in Jupyter notebooks running on Binder, and followed by activities that develop insights through application to specific questions in Organismal Biology.","type":"content","url":"/rsorganization","position":1},{"hierarchy":{"lvl1":"üí° Scaling of fluid forces: the Reynolds Number"},"type":"lvl1","url":"/rsscaling","position":0},{"hierarchy":{"lvl1":"üí° Scaling of fluid forces: the Reynolds Number"},"content":"A deep insight by fluid mechanicists George Stokes and Osborne Reynolds in the mid-19th century is that the relative magnitude of the inertial and viscous forces tells us a lot about a flow.\nThat led to the definition of the \n\nReynolds number, abbreviated as \\mathcal{Re}:\\mathcal{Re} = \\frac{\\mathrm{momentum~forces}}{\\mathrm{viscous~forces}}\n\nSubstituting our order-of-magnitude \n\nestimates of drag forces for these forces,\\mathcal{Re} = \\frac{\\rho U^2 L^2}{\\mu L U},\n\nor, after simplification,\\mathcal{Re} = \\frac{\\rho U L}{\\mu}.\n\nIn words: The Reynolds number, Equation \n\n(3), states the relative strengths of momentum effects and viscous forces, as inferred from the inherent effects of size, velocity and fluid characteristics.\n\nUsing the Reynolds number, we can list these inherent effects:\n\nLarger size, L, increases the relative strength of momentum effects compared to viscous forces; smaller size increases the relative strength of viscous forces\n\nFaster velocity, U, increases the relative strength of momentum effects compared to viscous forces; slower velocity increases the relative strength of viscous forces\n\nHigher fluid density, \\rho, increases the relative strength of momentum effects compared to viscous forces; lower density increases the relative strength of viscous forces\n\nHigher fluid viscosity, \\mu, decreases the relative strength of momentum effects compared to viscous forces; lower viscisity decreases the relative strength of viscous forces\n\nIt‚Äôs important to understand that these statements do not imply that increasing L results in smaller viscous forces.\nInstead, the statements are saying that, as L gets larger, momentum effects and viscous forces both increase, but momentum effects increase faster than viscous forces.\nThat can be seen from Equation \n\n(2), which shows that momentum effects increase in proportion with L^2, while viscous forces increase in proportion with L.","type":"content","url":"/rsscaling","position":1},{"hierarchy":{"lvl1":"üí° Scaling of fluid forces: the Reynolds Number","lvl2":"Scale models and dynamic similarity"},"type":"lvl2","url":"/rsscaling#scale-models-and-dynamic-similarity","position":2},{"hierarchy":{"lvl1":"üí° Scaling of fluid forces: the Reynolds Number","lvl2":"Scale models and dynamic similarity"},"content":"The Reynolds number gives us an important insight because it tells us that, for any two similarly shaped organisms moving in any Newtonian fluids, the relative magnitudes of inertial and viscous forces are equal if they have equal \\mathcal{Re}.\nThat is, any two organisms that are similar in shape but that may differ in size, speed and fluid type, are \n\ndynamically similar.\nDynamic similarity means those organisms (or replicas of organisms) are \n\nscale models of each other: measuring the forces, flows and other features of one is equivalent, after appropriate scaling, to measuring those features on the other.","type":"content","url":"/rsscaling#scale-models-and-dynamic-similarity","position":3},{"hierarchy":{"lvl1":"üí° Scaling of fluid forces: the Reynolds Number","lvl3":"An application of dynamic similarity","lvl2":"Scale models and dynamic similarity"},"type":"lvl3","url":"/rsscaling#an-application-of-dynamic-similarity","position":4},{"hierarchy":{"lvl1":"üí° Scaling of fluid forces: the Reynolds Number","lvl3":"An application of dynamic similarity","lvl2":"Scale models and dynamic similarity"},"content":"As an example, let‚Äôs consider a tiny organism: a bacterium swimming in water.\nIt is very difficult to measure the fluid forces on a bacterium.\nSuppose, instead, that we create a tennis ball-sized replica of the bacterium.\nInstead of water, we immerse the replica in Karo Syrup, which has a much larger kinematic viscosity, \\nu.\nSince \\nu is so much larger, we can make L much larger and (with an appropriate choice of velocity, U) we can still make the replica‚Äôs Reynolds number match the bacterium‚Äôs.\nWe can take then take advantage  of the replicas large size to measure fluid forces, and rescale them to correspond to forces on the bacterium.","type":"content","url":"/rsscaling#an-application-of-dynamic-similarity","position":5},{"hierarchy":{"lvl1":"üí° Scaling of fluid forces: the Reynolds Number","lvl2":"Reynolds number as an analytical tool"},"type":"lvl2","url":"/rsscaling#reynolds-number-as-an-analytical-tool","position":6},{"hierarchy":{"lvl1":"üí° Scaling of fluid forces: the Reynolds Number","lvl2":"Reynolds number as an analytical tool"},"content":"The mathematical formulas describing flow of fluids around organisms are called the \n\nNavier-Stokes equations.\nThese equations calculate the combined effects of momentum, viscosity and pressure on each part of a moving fluid.\nSolving the Navier-Stokes equations is often technically difficult, computationally expensive or simply not possible.\nThe Reynolds number provides a route to simplifying the Navier-Stokes equations in many biological applications, to obtain approximations that are usefully accurate and much easier to implement.","type":"content","url":"/rsscaling#reynolds-number-as-an-analytical-tool","position":7},{"hierarchy":{"lvl1":"üí° Scaling of fluid forces: the Reynolds Number","lvl3":"The low Reynolds number flow regime: \\mathcal{Re} \\ll 1","lvl2":"Reynolds number as an analytical tool"},"type":"lvl3","url":"/rsscaling#the-low-reynolds-number-flow-regime-mathcal-re-ll-1","position":8},{"hierarchy":{"lvl1":"üí° Scaling of fluid forces: the Reynolds Number","lvl3":"The low Reynolds number flow regime: \\mathcal{Re} \\ll 1","lvl2":"Reynolds number as an analytical tool"},"content":"A microorganism swimming in water, or a spore or pollen grain drifting in a breeze, is very small and typically moves very slowly.\nThat is, its characteristic length, L, and characteristic velocity, U, are both small.\nFrom Equation \n\n(3), we know this implies its Reynolds number is very small. In mathematical terms:\\mathcal{Re} \\ll 1\n\nWe can interpret Equation \n\n(4) to say that momentum effects are much smaller than viscous effects.\nIf we look for an intuitive comparison for \\mathcal{Re} \\ll 1, we can imagine a human (with much larger L and U) swimming in a fluid with very large \\mu, such as honey or tar.\n\nEquation \n\n(4) suggests that we can approximate the Navier-Stokes equations by neglecting momentum effects, and for very small slow organisms we won‚Äôt lose much accuracy.\nIt turns out that this simplification results in fluid flow equations  that are much more tractable than the Navier-Stokes equations.\nThese are called the Stokes equations, and the flow they describe with \\mathcal{Re} \\ll 1 is called \n\nStokes flow.\nAlmost all fluid dynamical analysis of microorganisms is done using the Stokes equations.\nThe model of swimming larvae later in this unit is an example.\n\nAs a reminder, the conclusion that flows around small, slow organisms is dominated by viscous forces arose from a very general consideration of the inherent effects of size and velocity.\nThey are not changed by specific morphological or behavioral adaptations.","type":"content","url":"/rsscaling#the-low-reynolds-number-flow-regime-mathcal-re-ll-1","position":9},{"hierarchy":{"lvl1":"üí° Scaling of fluid forces: the Reynolds Number","lvl3":"The high Reynolds number flow regime: \\mathcal{Re} \\gg 1","lvl2":"Reynolds number as an analytical tool"},"type":"lvl3","url":"/rsscaling#the-high-reynolds-number-flow-regime-mathcal-re-gg-1","position":10},{"hierarchy":{"lvl1":"üí° Scaling of fluid forces: the Reynolds Number","lvl3":"The high Reynolds number flow regime: \\mathcal{Re} \\gg 1","lvl2":"Reynolds number as an analytical tool"},"content":"At the other end of the spectrum, high Reynolds number flows are ones in which momentum effects are much larger than viscous forces.\\mathcal{Re} \\gg 1\n\nThere are some complications, because adjacent to a surface viscous forces can have large effects even in high Reynolds number flows.\nHigh Reynolds number flows are also subject to \n\nturbulence.\nNonetheless, neglecting viscous terms in the Navier-Stokes equations results in simplified equations that are much more tractable.\nThese equations are very useful approximations that have been widely used not only in biomechanical analysis of large, fast organisms but also in engineering.","type":"content","url":"/rsscaling#the-high-reynolds-number-flow-regime-mathcal-re-gg-1","position":11},{"hierarchy":{"lvl1":"üí° Scaling of fluid forces: the Reynolds Number","lvl2":"Reversible and irreversible flows"},"type":"lvl2","url":"/rsscaling#reversible-and-irreversible-flows","position":12},{"hierarchy":{"lvl1":"üí° Scaling of fluid forces: the Reynolds Number","lvl2":"Reversible and irreversible flows"},"content":"Viscous forces are directly proportional to the velocity gradient.\nIn mathematical terms, they are linear.\nThis results in an interesting and important feature of flows that are dominated by viscous forces ‚Äì that is, for flows in which \\mathcal{Re} \\ll 1: they are reversible.\n\nIf we think about the sliding plates in our \n\nestimates of drag forces, it seems intuitive that moving the plate at a speed v to the left would produce an equal and opposite fluid motion compared to moving it to the right.\nFurthermore, moving it at half the speed would produce half as much force, but if it acts for twice as long the final positions of the plate and the fluid will be the same.\n\nThis is what is meant by reversibility of low  \\mathcal{Re} flow.\nA classic video by G. I. Taylor shows a \n\ndemonstration of reversible flow.\nIn this video, dye is placed in a viscous fluid between rotating cylinders.\nThe cyclinders are rotated until the dye is greatly stretched; then reversed back into their original positions to restore the originam dye blob.\n\nReversibility has important consequences for microorganism swimming.\nIn particular, waving a fin back and forth is a  propulsive motion that works well for many fish and other high Reynolds number swimmers.\nHowever, at low Reynolds number, this reciprocating motion would have no net propulsive effect.\nInstead, microorganisms must propel themselves with motions that are non-reversible.\nFor example, the \n\nbacterial flagellum is a helical filament that rotates in a propeller-like way in only one direction.","type":"content","url":"/rsscaling#reversible-and-irreversible-flows","position":13},{"hierarchy":{"lvl1":"üí° Scaling of fluid forces: the Reynolds Number","lvl2":"Final points"},"type":"lvl2","url":"/rsscaling#final-points","position":14},{"hierarchy":{"lvl1":"üí° Scaling of fluid forces: the Reynolds Number","lvl2":"Final points"},"content":"A couple additional points to note:\n\n\\mathcal{Re} is a \n\nnon-dimensional number ‚Äì because the denominator and the numerator both have units of force, the result has no units.\nSo, whichever system of units you use to calculate \\mathcal{Re}, as long as you use it consistently you will get the same answer.\n\nThe Reynolds number also be written using the kinematic viscosity,\\mathcal{Re} = \\frac{U L}{\\nu}.\n\nThis is one of many instances that kinematic viscosity, \\nu, appears in biomechanics and fluid dynamics applications, which is why it is often tabulated in addition to dynamic viscosity, \\mu.","type":"content","url":"/rsscaling#final-points","position":15},{"hierarchy":{"lvl1":"Understanding life history dynamics in structured populations with a stage-within-age matrix model"},"type":"lvl1","url":"/croaker","position":0},{"hierarchy":{"lvl1":"Understanding life history dynamics in structured populations with a stage-within-age matrix model"},"content":"This computer lab is based on an analysis by Diamond et al. (2000)* of the population dynamics of a fish called the Atlantic croaker, Micropogonias undulatus ( for additonal information on this species see \n\nhttp://‚Äãwww‚Äã.tpwd‚Äã.state‚Äã.tx‚Äã.us‚Äã/huntwild‚Äã/wild‚Äã/species‚Äã/croaker/ ). As described by Diamond et al., the croaker has been experiencing significant mortality as by-catch from shrimp trawling. Also, its population is declining, or at least appeared to be when this paper was written (I haven't followed up with the most recent catch data, but there are published suggestions ocean warming is contributing to increases in croaker stocks). Diamond et al. sought to establish whether by-catch mortality is a significant factor in causing declining populations of Atlantic croakers.¬†\n\nAccording to Diamond et al., Atlantic croakers have a natural life of approximately 7 years. Over their lives, croakers grow and (as in most fish) increase their fecundity (production of sperm and eggs) as they get bigger. Their natural mortality rate (probability of dying in a given year) is very high when they are larvae and juveniles, but once they become adults mortality is much lower and roughly constant between ages 2 and 7 years. As noted, the adults are in addition subject to human-induced mortality from targeted fishing and by-catch.\n\nAside from changes in fecundity and mortality across year classes, the first year of a croaker's life is distinct because during this year it begins as an egg and develops through a sequence of stages into a juvenile and finally into an adult. During this interval, croakers grow and develop rapidly but also suffer very high mortality rates. Small changes in mortality rates during larval and juvenile stages can have big impacts on how many croakers survive to become long-lived, reproducing adults. Hence, variations in the demography of the first year can alter the fate of the entire population.\n\nRecall that in most of the plankton models we've seen (and nearly all biological oceanography models in general) populations of many species are collapsed into a single broad biomass category (e.g., phytoplankton, microzooplankton, etc.). Our main concern in previous discussions of these models has been taxonomic resolution; that is, whether a model which lumps many different species together into one functional unit can be accurate enough to have useful predictive power. In the case of the croaker, Diamond et al.'s detailed statistical analysis clearly led them to believe that even one functional unit for this species alone is insufficient.\n\n\n\nThe Altantic Croaker (\n\nhttp://‚Äãwww‚Äã.tpwd‚Äã.state‚Äã.tx‚Äã.us‚Äã/huntwild‚Äã/wild‚Äã/species‚Äã/croaker/)\n\n*Citation: Sandra L Diamond; Lindsay G Cowell; Larry B Crowder (2000) Population effects of shrimp trawl bycatch on Atlantic croaker. Canadian Journal of Fisheries and Aquatic Sciences; 57( 10):2010-21\n\n1. Diamond et al.'s model\n\nTo model the population of Atlantic croakers, Diamond et al. devised an age-structured model --¬†a model in which subpopulations are classified according to age (expressed here as Year Classes). The crux of Diamond et al.'s model is this:\n\nSuppose we label the number of croakers in Year Class 1 as $p_1$, the number of croakers in Year Class 2 as $p_2$, etc. For all seven Year Classes, the population in Year $\\mathbf{i}$¬†can then be described by the vector $$ \\mathbf{P}(i) = \\begin{pmatrix} p_1 \\\\ p_2 \\\\ p_3 \\\\ \\vdots \\\\ p_7 \\end{pmatrix}. \\label{eq:eqnVEC} $$\n\nTo have a population model, we need formulas that project the population¬†$\\mathbf{P}(i)$¬†forward to Year $i+1$. Three things happen to the croaker population in the transition between Years $i$ and $i+1$:\n\n(a) Individuals age by one year. That is, individuals who are in Year Class $j$ in Year $i$ are, if they survive, moved to Year Class $j+1$ in Year $i+1$.\n\n(b) Individuals die. Let's assume that the probability of an adult dying in a given year is $\\mu_{adult}$. Another way to express this is as a survival probability, $S_{adult}$. Because every adult will either die or survive, $\\mu_{adult}$ and $S_{adult}$ add up to one, so that\n\n$S_{adult} = 1 - \\mu_{adult}$.\n\nCombining aging and mortality, we can now say that the croaker population in Year Class $j+1$ in Year $i+1$ is equal to the croaker population in Year Class $j$ in Year $i$ times the survival rate during that year:\n\n$p_{j+1}(i+1) = S_{adult} ~ p_j(i)$\n\n(c) Individuals reproduce. In assessing reproduction of fish such as croakers, it's usually assumed that the main limitation is the number of eggs. That is because sperm are usually available in much greater numbers, most of which never encounter an egg and hence play no part in reproduction. To assess the number of eggs, we must focus on the population of female croakers. In some fish species the ratio of males to females is nearly equal (like it is in humans) and we could assume half the adults are female. However, in other fish species the sex ratio is strongly biased towards one gender (because of their basic biology, selective harvesting, etc.). In this case, it's clearest to model males and females separately, and since the number of males is almost always sufficient to fertilize all the females, we don't even have to worry about the males.\n\nSo, we make the assumption now that we are modeling only females, and adjust populations, fecundity etc. accordingly (for example, if half the eggs are of each gender, the effective fecundity in the female-only model is 50% of the total observed fecundity). Let's assume that a female croaker of age $i$ produces $F_i$ female eggs. Accounting for all Year Classes, the population of female eggs ($p_{eggs}$) produced in the $i+1$st year is then $$p_{eggs}(i+1) = F_1 p_1(i) + F_2 p_2(i) + F_3 p_3(i) + F_4 p_4(i) + F_5 p_5(i) + F_6 p_6(i) + F_7 p_7(i)$$\n\n2. Larval development and survival\n\nThe modeling approach as developed so far seems a concise but effective way of assessing the consequences of Year Class age structure in the Atlantic croaker population. However, as noted, the first year of a croaker's life involves a sequence of developmental stages: Egg (EGG),¬† Yolk-Sac larva (YSL), Ocean larva (OL), Estuary larva (EL), Early juvenile (EJ) and Late juvenile (LJ). Croakers at these stages differ in size, physiology, behavior and environment. Mortality rates are high in all these stages, and but the stages also differ very substantially in mortality rates and in duration (how long a larva spends in each stage).\n\nTo improve their predictions of survival in the critical first year, Diamond et al. decided they needed a more detailed submodel within their age-structured model. Their solution is a stage-within-age model, in which details of larval life are used to calculate survival through the first year, $S_{Y1}$. The resulting survival probability is used as a parameter in the age-structured model for the remaining year classes.¬†\n\nConsidering each of the larval and juvenile stages explicitly, we can say that the probability of surviving the entire first year is the product of survival probabilities in each stage: $$S_{Y1} = S_{EGG} ~ S_{YSL} ~ S_{OL} ~ S_{EL} ~ S_{EJ} ~ S_{LJ}.$$ We can be even more explicit in calculating survival probabilities, by noting that the probability of survival in each stage is an exponentially decreasing function of mortality rate and duration of that stage. For example, $$S_{EGG} = e^{-\\mu_{EGG} T_{EGG}},$$ where $\\mu_{EGG}$ is the mortality rate during the egg stage and $T_{EGG}$ is the time an egg requires to develop into the Yolk-Sac Larval stage. Similarly, $$S_{YSL} = e^{-\\mu_{YSL} T_{YSL}},$$ where $\\mu_{YSL}$ is the mortality rate during the egg stage and $T_{YSL}$ is the time a Yolk-Sac Larva requires to develop into the Ocean Larval stage, and so forth for all the larval stages.\n\n3. A speculative evolutionary scenario\n\nDiamond et al. carried out a detailed statistical analysis in which they estimated all the key parameters discussed so far. In addition to reproducing their modeling approach and results, we can add a new dimension to predictions of croaker population trajectories by speculating about evolutionary changes through which croaker life history might adjust to increases or decreases in mortality (in particular, addition of significant fishing mortality to populations that evolved without this type of mortality). In other fish species, a variety of life history changes have been observed in response to anthropogenic stresses. For example, a species in which large adults are heavily fished might evolve towards allocating more resources to reproduction and fewer to growth in small adults.\n\nAn implication of Diamond et al. is that conditions had changed relative to historical patterns at the time of their study, at least in fishing-induced mortality and possibly in many other ways. Thus, there is reason to speculate that croaker life history parameters might evolve away from current values, if those changes increase reproductive success.\n\nHere, we will consider changes in only one life history parameter: egg size. If we assume females have a specific amount of resources to invest in eggs, they face a trade-off between allocating those resources to more, smaller eggs or to fewer, larger eggs. There is a large literature on the evolution of egg size. Changes in egg size have consequences for sperm-egg encounter rates, for movement through the water column, for predation rates, for development times, and many other factors in larval life history. Here, we will focus on one possible effect of a hypothetical change in egg size, which is the development time in early larval stages.\n\nWe will assume that a Yolk-Sac Larva must reach a critical size before it is able to transition into an Ocean Larva. To do so, it must feed in the plankton, and this takes time during which it has a high probability of dying. If a larva starts from a larger egg, it has less growing to do before it can transition. Hence, its duration in the Yolk-Sac Larval stage is shorter, and its probability of surviving commensurately higher.\n\nIn this lab, we consider a scenario in which (over evolutionary time) females can adjust their egg size relative to the currently observed size by an Egg Investment Factor, $EIF$. If so, constraints on total maternal investment mean that the number of eggs must decrease by a factor of $\\frac{1}{EIF}$. Then, the population of female eggs in the $i+1$st year will be $$p_{eggs}(i+1) = \\frac{1}{EIF} \\left(F_1 p_1(i) + F_2 p_2(i) + F_3 p_3(i) + F_4 p_4(i) + F_5 p_5(i) + F_6 p_6(i) + F_7 p_7(i) \\right)$$ The other side of the egg-size tradeoff is the effect on larval duration, and hence on survival probability. We will assume that the effect of changed egg size is by changing the duration of the Ocean Larva stage, because this is the first stage at which the larva acquires resources by feeding. We define a Duration Factor, $DF$, by assuming that growth is exponential during the OL stage in Diamond et al.'s model (this is an assumption because they specify only the total duration of each larval stage, not the growth progression within it). Our assumption is unproven, but plausible -- many models assume growth rate is proportional to body size, because larger consumers often encounter more and larger resources. If we accept this assumption, the duration of the OL stage, $T_{OL}$, is changed by a factor $$DF = max \\left(1-\\frac{log(EIF)}{\\alpha T_{ol}},0 \\right)$$ Here, the \"max\" function enforces the fact that the OL stage cannot have a negative duration.\n\nThe question, then, is would changes from the observed condition (in which EIF=1) be evolutionarily advantageous or disadvantageous (i.e., would they lead to higher or lower reproductive fitness)?\n\n4. Modeling mechanics\n\nWe have now recapitulated the key elements of Diamond et al.'s age-within-stage model. To execute and analyze their model, Diamond et al. borrowed tools for matrix mathematics from linear algebra. Specifically, the modeling terms itemized above can be written very concisely as a matrix multiplication, $$\\mathbf{P}(i+1) = \\mathbf{A} \\mathbf{P}(i).$$ As above, $\\mathbf{P}(i)$ is the vector of population in Year Classes 1-7 in year $i$. The matrix $\\mathbf{A}$ contains the terms of the original age-structured model involved in advancing this population to year $i+1$: $$ \\mathbf{A} = \\begin{pmatrix} \\frac{F_1}{EIF} & \\frac{F_2}{EIF} & \\frac{F_3}{EIF} & \\frac{F_4}{EIF} & \\frac{F_5}{EIF} & \\frac{F_6}{EIF} & \\frac{F_7}{EIF} \\\\ S_{Y1} & 0 & 0 & 0 & 0 & 0 & 0 \\\\ 0 & S_{adult} & 0 & 0 & 0 & 0 & 0 \\\\ 0 & 0 & S_{adult} & 0 & 0 & 0 & 0 \\\\ 0 & 0 & 0 & S_{adult} & 0 & 0 & 0 \\\\ 0 & 0 & 0 & 0 & S_{adult} & 0 & 0 \\\\ 0 & 0 & 0 & 0 & 0 & S_{adult} & 0 \\\\ \\end{pmatrix} $$\n\nThis matrix is in a common form in population modeling, called a Leslie matrix, in which non-zero terms appear only in the top row and the subdiagonal. The interpretations of the non-zero terms are:\n\nIn the top row, each entry is the age-specific fecundity, which is the contribution of a female croaker in a given year class to the number of female eggs in the following year. For example, \\frac{F_2}{EIF} is the fecundity of a 2 year old female croaker, \\frac{F_3}{EIF} is the fecundity of a 3 year old female croaker, etc.\n\nThe subdiagonal terms, S_{Y1} and S_{adult}, are the survival probabilities for each age class. Specifically, S_{Y1} is the probability an egg will survive its first year to become an Age-2 fish. S_{adult} is the probability an Age-2 fish will survive to become an Age-3 fish, that an Age-3 fish will survive to become an Age-4 fish, etc.\n\nWith substitution into \\mathbf{A} of the larval life history parameters determining first-year survival,S_{Y1} = e^{-\\left( \\mu_{EGG} T_{EGG} + \\mu_{YSL} T_{YSL} + \\mu_{OL} DF T_{OL} + \\mu_{EL} T_{EL} + \\mu_{EJ} T_{EJ} + \\mu_{LJ} T_{LJ}  \\right)},\n\nwe obtain the stage-within-age model in matrix form, as posed and solved by Diamond et al..\n\n# Load modules and set graphics environment\nfrom math import *\nimport numpy as np\nfrom matplotlib import pyplot as plt\nplt.ion();\nfrom ipywidgets import interact, interactive, fixed, interact_manual\nimport ipywidgets as widgets\n\n\n\nfrom croaker import LesliePars, CroakerPopModel\n\n\n\n5. Exploration of the stage-within-age model: Model Inputs\n\nThe input boxes below enable you to experiment with population trajectories for for the Atlantic croaker according to Diamond et al.'s stage-within-age model. Three types of parameters appear below:\n\n(a) Simulation parameters: The input grid in the top row determines the initial population in each Year Class for a population simulation. The fourth input level specifies the number of years to be simulated.¬†\n\n(b) Demographic parameters: The second, third, fifth and sixth input rows specify the fecundity, mortality and duration parameters. The default values are estimates determined by Diamond et al. to apply to the Atlantic croaker population in the Gulf of Mexico (they also estimated parameters for the South and Mid-Atlantic Bights; see the paper for these parameter values).\n\n(c) Evolutionary parameter: The bottom input box enables you to specify the Egg Investment Factor, EIF. The default value is 1, representing the observed egg size. EIF<1 implies more, smaller eggs and EIF>1 implies fewer, larger eggs. The parameter $\\alpha$ reflects an assumed exponential growth relationship during the Ocean Larva stage. Larger values of $\\alpha$ correspond to faster growth rates; smaller values of $\\alpha$ correspond to slower growth rates. Both $EIF$ and $\\alpha$ affect duration of the Ocean Larva stage.\n\n¬†\n\n6. Exploration of \n\nthe stage-within-age model: Model Outputs\n\nThe model produces four types of output, in the form of plots (numerical data for these plots are also printed out, in case they are useful):\n\n(a) Age distribution: This plot shows the fraction of the croaker population in each year class. Note that the vertical axis is on a log10 scale. The initial age distribution (set by you in the top input grid) is plotted in green. The stable age distribution, which is the relative fraction of population in each Year Class if the simulation is allowed to run for infinite time, is plotted in blue. The actual final age structure at the end of the simulation is plotted in black.\n\n(b) Population time series: This plot shows total population of Atlantic croakers, as a function of years from the start of the simulation. The full age-within-stage model population trajectory is shown in green. An analytical approximation to this model, in which it is assumed that the population always matches the stable age distribution, is shown in blue.\n\n(c) Larval demography: This plot shows the cummulative probability of survival through the successive larval stages. As in Diamond et al.'s paper, time units for larval demography are days (not years, as for the time series plot). Note the vertical axis is on a log10 scale.¬†\n\n(d) Elasticities: This plot shows the elasticities for each parameter in the simulation. Elasticities are a metric of sensitivity of long-term population increase or decrease to small changes in parameters. For example, a small positive elasticity implies that increase of the corresponding parameter will slightly raise the long-term population trajectory. A large negative elasticity implies an increase in the corresponding parameter will substantially decrease the long-term population trajectory.¬†\n\n# Instantiate a GUI to modify parameters. \n#  Initial parameters from Diamond et al. (2000) for Atlantic croakers in the Gulf of Mexico:\nT_egg=widgets.FloatText(value=2.,description = r\"$T_{EGG}$\")\nT_ysl=widgets.FloatText(value=4.,description = r\"$T_{YSL}$\")\nT_ol=widgets.FloatText(value=45.,description = r\"$T_{OL}$\")\nT_el=widgets.FloatText(value=58.5,description = r\"$T_{EL}$\")\nT_ej=widgets.FloatText(value=75.,description = r\"$T_{EJ}$\")\nT_lj=widgets.FloatText(value=180.,description = r\"$T_{LJ}$\")\nEIF=widgets.FloatText(value=1,description = r\"$EIF$\")\n\nmu_egg=widgets.FloatText(value=0.4984,description = r\"$\\mu_{EGG}$\")\nmu_ysl=widgets.FloatText(value=0.1645,description = r\"$\\mu_{YSL}$\")\nmu_ol=widgets.FloatText(value=0.09,description = r\"$\\mu_{OL}$\")\nmu_el=widgets.FloatText(value=0.0591,description = r\"$\\mu_{EL}$\")\nmu_ej=widgets.FloatText(value=0.021,description = r\"$\\mu_{EJ}$\")\nmu_lj=widgets.FloatText(value=0.009,description = r\"$\\mu_{LJ}$\")\nmu_adult=widgets.FloatText(value=0.85,description = r\"$\\mu_{adult}$\")\n\nF1=widgets.FloatText(value=0.10,description = r\"$F_1$\")\nF2=widgets.FloatText(value=59581.,description = r\"$F_2$\")\nF3=widgets.FloatText(value=76456.,description = r\"$F_3$\")\nF4=widgets.FloatText(value=93690.,description = r\"$F_4$\")\nF5=widgets.FloatText(value=106614.,description = r\"$F_5$\")\nF6=widgets.FloatText(value=124565.,description = r\"$F_6$\")\nF7=widgets.FloatText(value=130310.,description = r\"$F_7$\")\nalpha=widgets.FloatText(value=0.035,description = r\"$\\alpha$\")\n\np1=widgets.FloatText(value=1.,description = r\"$p_1$\")\np2=widgets.FloatText(value=1.e-12,description = r\"$p_2$\")\np3=widgets.FloatText(value=1.e-12,description = r\"$p_3$\")\np4=widgets.FloatText(value=1.e-12,description = r\"$p_4$\")\np5=widgets.FloatText(value=1.e-12,description = r\"$p_5$\")\np6=widgets.FloatText(value=1.e-12,description = r\"$p_6$\")\np7=widgets.FloatText(value=1.e-12,description = r\"$p_7$\")\nN_years=widgets.IntText(value=7,description = r\"$N_{years}$\")\n\nui1 = widgets.VBox([T_egg,T_ysl,T_ol,T_el,T_ej,T_lj,EIF])\nui2 = widgets.VBox([mu_egg,mu_ysl,mu_ol,mu_el,mu_ej,mu_lj,mu_adult])\nui3 = widgets.VBox([F1,F2,F3,F4,F5,F6,F7,alpha])\nui4 = widgets.VBox([p1,p2,p3,p4,p5,p6,p7,N_years])\nuiC = widgets.HBox([ui1,ui2,ui3,ui4])\n    \nout = widgets.interactive_output(CroakerPopModel,{'T_egg':T_egg,'T_ysl':T_ysl,'T_ol':T_ol,'T_el':T_el,'T_ej':T_ej,'T_lj':T_lj,\n                 'mu_egg':mu_egg,'mu_ysl':mu_ysl,'mu_ol':mu_ol,'mu_el':mu_el,'mu_ej':mu_ej,'mu_lj':mu_lj,\n                 'mu_adult':mu_adult,\n                    'F1':F1,'F2':F2,'F3':F3,'F4':F4,'F5':F5,'F6':F6,'F7':F7,\n                    'p1':p1,'p2':p2,'p3':p3,'p4':p4,'p5':p5,'p6':p6,'p7':p7,\n                    'N_years':N_years,'alpha':alpha,'EIF':EIF})\ndisplay(uiC,out)\n\n\n\n7. Exploration of \n\nthe stage-within-age model: Study Questions\n\nYour tasks are to play with Diamond et al.'s stage-within-age model for awhile to familiarize yourself with how changes to the simulation, demographic and evolutionary parameters relate to larval survivorship, Year Class structure, and long-term population trends; then, address the following questions:\n\n1) Population structure:\n\nThe key parameters of the model are expressed in the Leslie matrix, B. Using results from linear algebra, is can be shown that populations with this form of matrix always approach a stable age distribution. That is, if you run them long enough, the population distribution will approach a steady state (blue). Note that this does not mean the total population is constant, only that the fraction of population in a given Year Class is constant. The steady state is a convenient benchmark for population analysis, because it is easy to calculate using mathematical tools from linear algebra, and it is a characteristic only of the Leslie matrix, not involving simulation-specific parameters like initial population structure and number of years simulated.\n\nIn what ways is the stable age distribution informative or uninformative? Is the analytical steady state age structure a good approximation for the full model? For how many years do initial conditions have significant impacts on age structure? In the event of a catastrophe (e.g., an oil spill), how long do you expect age structure impacts to last? Consider more moderate but continual environmental variations (which are not considered explicitly in this model). What kinds of variations (e.g., annual, decadal, etc.) would you expect to change croaker age structure?\n\nWhat are the key Year Classes? Given the relative abundance of fish of different ages, which size classes would be most impacted by targeted fishing or by-catch? Factoring in the age-dependent fecundity parameters, which size classes contribute most to reproduction?\n\n2) Population time series:\n\nThe stable age distribution corresponds to a total population that always changes geometrically in time (i.e., in a linear trajectory on a semi-log plot). The full model does not necessarily follow this type of trajectory.\n\nWhat do the time series for total population in the full model, and the time series for the stable age distribution (derived from eigenvalue analysis), say about long-term trends in the croaker population? Do these time series predict long-term increases or decreases? The two time series begin with the same total population; in what ways are the two time series similar or different? How do differences relate to your answers to 1)?¬†\n\n3) Larval demography:\n\nWhat do probabilities of larval survival across stages suggest about vunerability during early development? On average, how many eggs must a female lay to produce one offspring that survives its first year? What stages account for the most significant mortality? Which larval characteristics (e.g., size, sensory capabilities, swimming abilities, habitat, etc.) do you hypothesize might be most responsible for differences? In what ways would a survival probabilities differ in a fish species that gives live birth to a few, more-developed larvae? If you were sampling the plankton to assess croaker reproduction, how would estimates of larval survival inform your sampling design?\n\n4) Elasticities:\n\nWhat do elasticities for key parameters suggest about the croaker population's sensitivity to demographic parameters? Some parameters are inter-related. For example, in feeding larval stages, behaviors that enhance feeding rates often incur added risk of predation. Hence, a change in foraging behavior that increases feeding might both¬†shorten duration of a larval stage (T) and increase mortality rates (mu). What determines whether this is a beneficial or harmful change?\n\n5) Evolution of egg size:\n\nKeep in mind that the egg-size model implemented here is oversimplified in important ways. Nonetheless, it may suffice to suggest whether, under the fishing pressure and demographic regime modeled by Diamond et al., different egg sizes might evolve and, if so, whether eggs are likely to become bigger or smaller.¬†\n\nWhat are the long-term consequences of changes in egg size? Consider what magnitude of change might be relatively \"easy\" -- that is, not require major reorganization of egg structure or larval development mechanisms (clearly a speculative threshold...).¬† Within a spectrum of such changes, would you expect to see evolutionary changes in croaker egg size?\n\n6) Responses to climate change:\n\nConsider one of the many factors predicted to change in future oceans (temperature, pH, mixed layer depth, nutrient levels, alien invasions, pollution, human exploitation, etc.). Speculate how this factor might affect parameters like larval duration and mortality rates. Use insights from the model to predict the impacts (or lack of impacts) on future croaker population dynamics.¬†\n\n\n\n\n\n\n\n","type":"content","url":"/croaker","position":1},{"hierarchy":{"lvl1":"üèûÔ∏è Allometry and size-selection in diatoms"},"type":"lvl1","url":"/allometrysizeselection","position":0},{"hierarchy":{"lvl1":"üèûÔ∏è Allometry and size-selection in diatoms"},"content":"To gain a quantitative perspective on the effects of \n\nmixed layer dynamics on diatoms, Litchman et al. (2009) assumed that many diatom characteristics have allometries of the form of \n\npower laws,log_{10} X = log_{10}~a + (b \\times s)\n\nwhere X is the trait of interest, and a and b are allometric constants for that trait.\nThe metric of size is s = \\log_{10}(\\mathrm{cell~volume}),\n\nwhere cell volume is in \\mu m^3.\n\nTaking the power of 10 of both sides gives the value of the trait for each s,X = a \\times 10^{b \\times s}\n\nLitchman et al. analyzed data from the literature to obtain values of the allometric constants a and b for traits involved in growth, mortality and uptake and storage of nitrogen and phosphorus.\nThey separately analyzed diatoms from marine and freshwater environments.\nTheir results are summarized in their \n\nsupplemental materials.","type":"content","url":"/allometrysizeselection","position":1},{"hierarchy":{"lvl1":"üèûÔ∏è Allometry and size-selection in diatoms","lvl2":"Model formulation"},"type":"lvl2","url":"/allometrysizeselection#model-formulation","position":2},{"hierarchy":{"lvl1":"üèûÔ∏è Allometry and size-selection in diatoms","lvl2":"Model formulation"},"content":"Litchman et al. formulated a model that tracks the increase and decrease of diatom populations in a \n\nmixed layer.\nAt intervals, a mixing event such as a storm occurs.\nA mixing event replaces a fraction of the water in the mixed layer with an equal amount of water from below the mixed layer.\nThe diatoms in the displaced mixed layer water are lost, decreasing the cell populations in the mixed layer.\nHowever, the deep water entering the mixed layer brings new nutrient, which can fuel enhanced diatom growth.\n\nBetween mixing events, diatoms grow while competing for the diminishing amount of nutrient.\nIf nutrient concentrations get too low, some or all of the diatoms may be unable to grow, and these populations decrease due to mortality.\nCauses of mortality include ‚Äúbackground‚Äù mortality, which may be due to predators, pathogens, UV damage or other causes, and losses due to \n\nsinking out of the mixed layer.\n\nLitchman et al.'s model computed the population trajectories of a series of diatom variants, ranging from small to large cells.\nFor each diatom population, the model acounts for both the number of cells and the nutrient quota.\nThe quota is the amount of nutrient cells have in storage, compared to their minimum requirement to sustain growth, and to their maximum storage capacity.\nCells with a large quota can grow at or near their maximum rates, because they are not limited by nutrients.\nCells with a small quota grow slowly or not at all, and may be physiologically stressed, because they are severely nutrient-limited.\n\nA key feature of this model is that growth is determined by stored nutrients, not by the amount of nutrient in the water.\nTherefore, when a mixing event provides an instantaneous increase in nutrients, cells must first take up nutrients into storage before they can grow.\nAccording to Litchman et al.'s analysis (and consistent with many other observations), small cells take up nutrients faster and can grow at lower quotas, so they have a faster growth response to new nutrients provided by mixing events.\n\nConversely, Litchman et al. concluded that larger diatom cells have disproportionately higher nutrient storage capacity compared to smaller diatom cells.\nThis means that scenarios potentially exist in which large diatoms utilize stored nutrients to maintain growth when smaller cells have used up their quotas and stopped growing.","type":"content","url":"/allometrysizeselection#model-formulation","position":3},{"hierarchy":{"lvl1":"üèûÔ∏è Allometry and size-selection in diatoms","lvl2":"Allometric power laws in diatoms"},"type":"lvl2","url":"/allometrysizeselection#allometric-power-laws-in-diatoms","position":4},{"hierarchy":{"lvl1":"üèûÔ∏è Allometry and size-selection in diatoms","lvl2":"Allometric power laws in diatoms"},"content":"The allometric constants that Litchman et al. reported for nitrogen-limited diatoms are shown in \n\nTable¬†1.\n\nTable¬†1:Allometric constants for nutrient uptake and growth in diatoms. The constants a and b are substituted into Equation \n\n(3) to obtain the statistically derived allometry for the corresponding variable.\n\nVariable\n\na\n\nb\n\nDescription\n\nV^{hi}_{max.i}\n\n-7.8\n\n0.67\n\nMaximum nutrient uptake rate\n\nK_N\n\n-0.49\n\n0.17\n\nHalf-saturation constant for nutrient uptake\n\nQ_{min}\n\n-8.59\n\n0.56\n\nMinimum quota for growth\n\nQ_{max}\n\n-8.39\n\n0.81\n\nMaximum quota (full storage)\n\n\\mu_\\infty\n\n0.74\n\n-0.14\n\nMaximum growth rate (unlimited nutrient)\n\nIn \n\nTable¬†1, b<0 means that the quantity is decreasing with larger cell size, s.\nb>0 means that the quantity is increasing with larger cell size.\n\nSome key points about these allometric relationships are:\n\nBecause b is negative, the maximum growth rate, \\mu_{\\infty}, is slower for larger diatoms than for smaller diatoms\n\nThe minimum quota to support growth, Q_{min}, is larger for larger cells (b=0.56).\n\nThe maximum nutrient uptake rate, V^{hi}_{max.i}, increases with diatom size (b=0.67) but the amount of nutrient required to attain maximum quota increases even faster (b=0.81).\n\nBoth the minimum quota, Q_{min}, and the maximum quota, Q_{max}, increase with diatom size.\nHowever, Q_{max} grows faster (b=0.81) with cell size than Q_{min}  (b=0.56).\n\nPoint 1 means that, with abundant nutrients, small cells can out-grow large cells.\nPoint 2 means that small cells can continue growth at low quotas when large cells cannot.\nPoint 3 means that larger cells take longer to fill their quotas than smaller cells.\nAll these points suggest advantages for small diatom cells.\n\nHowever, Point 4 means that nutrient storage capacity, which is the difference between the minimum and maximum quotas, is larger in larger cells.\n\nLitchman et al.'s hypothesis is that the pulsed nature of nutrients in  mixed layers ‚Äì episodic injections of nutrients duriing mixing events such as storms, followed by long intervals of depleted nutrients ‚Äì amplify the storage advantages of large diatoms and enable them to compete successfully with small diatoms.\n\nThe model they devised to test their hypothesis about the effects of storage allometry and mixed layer dynamics is implemented in \n\nthis notebook.\nExplanation of the formulation of this model is in \n\nthis context page.","type":"content","url":"/allometrysizeselection#allometric-power-laws-in-diatoms","position":5},{"hierarchy":{"lvl1":"üìñÔ∏è Allometry of growth, nutrient acquisition and storage in diatoms"},"type":"lvl1","url":"/diatomallometry","position":0},{"hierarchy":{"lvl1":"üìñÔ∏è Allometry of growth, nutrient acquisition and storage in diatoms"},"content":"Litchman et al. (2009) asked whether the characteristics of \n\nmixed layers  could explain the diversity and success of large diatoms, and their greater presence in marine habitats relative to freshwater habitats such as lakes.\nThey noted that the differences between typical marine and freshwater habitats are:\n\nMixed layers in marine habitats tend to be deeper than mixed layers in lakes.\n\nNitrogen (nitrate) is more often limiting for diatom growth in marine systems, while phosphorus is more often limiting for diatom growth in freshwater systems.\n\nThe significance of the first point is that losses due to cells sinking out of the mixed layer due to their own \n\nsinking velocities are lower when mixed layers are deeper.\nCell losses due to sinking may be higher for larger diatom cells than for smaller cells.\nIf so, higher losses from shallow mixed layers might favor small, rarely lost cells over larger, more frequently lost cells.\nBecause mixed layers tend to be shallower in lakes, this could impact freshwater diatoms more than marine diatoms.\n\nThe significance of the second point hinges on nutrient storage in cells.\nDiatom cells can store key nutrients, such as nitrogen and phosphorus.\nHowever, because they are stored within different parts of cells, diatoms‚Äô storage capacities have different allometries for nitrogen than for phosphorus.\n\nLarger diatoms have disproportionately higher storage capacity (relative to requirements for growth) for nitrogen than smaller cells.\nHowever, storage capacity (relative to requirements for growth) for phosphorus are more nearly proportional in large and small diatom cells.\nIf so, potential advantages from greater storage capacity are more likely to favor larger cells in nitrogen-limited marine habitats than in phosphorus limited freshwater habitats.\n\nWith this in mind, Litchman et al. then asked,\n\nDo characteristics of some mixed layers confer advantages to cells with higher storage capacities, and if so are those characteristics more prevalent in marine than freshwater habitats?\n\nThe intuition behind Litchman et al.'s study was that episodic mixing could create conditions in which small cells had exhausted their stored nutrients, but large cells still retained enough nutrient storage to maintain growth.\nIf so, growth of large diatoms in the intervals between mixing events, when small diatoms cannot grow, could explain the persistence of large cells despite the uptake and growth rateadvantages of small cells.\n\nLitchman et al. constructed a \n\nmodel to investigate under which conditions this might happen, and whether those conditions occur more frequently in marine than freshwater habitats.\nTheir modeling approach was based on an idea from evolutionary game theory called an \n\nEvolutionarily Stable State, and on their analysis of \n\ndiatom allometry.\n\nThis is likely dependent on the condition of the diatom: healthy cells may be able to regulate their densities to prevent sinking, while starved cells may not.","type":"content","url":"/diatomallometry","position":1},{"hierarchy":{"lvl1":"üõº Implications of allometry for diatom aquaculture and carbon sequestration"},"type":"lvl1","url":"/diatomaquacultureactivity","position":0},{"hierarchy":{"lvl1":"üõº Implications of allometry for diatom aquaculture and carbon sequestration"},"content":"For diatoms competing for nutrients in mixed layers,\n\nActivities frame with linkages orgs w higher lower levels","type":"content","url":"/diatomaquacultureactivity","position":1},{"hierarchy":{"lvl1":"üõº Implications of allometry for diatom aquaculture and carbon sequestration","lvl2":"Aquaculture"},"type":"lvl2","url":"/diatomaquacultureactivity#aquaculture","position":2},{"hierarchy":{"lvl1":"üõº Implications of allometry for diatom aquaculture and carbon sequestration","lvl2":"Aquaculture"},"content":"The point of this activity is to assess biomass extraction in an aquaculture setting, analogous to a mixing event.\n\ncan look at variations in a?\n\nThe metric is biovolume removed in a mixing event, plus biovolume lost by sinking\n\nNeed to move a textbox to simulation parameters\n\nNeed a way to record mixing event losses and sinking losses (or to turn off mixing losses)\n\nActually mixing losses are proportional to average standing stock, with constant of proportionality \\frac{v_i}{z_m}. So we have that.\n\nMotivating questions:\n\nWhat variants, mixing fraction and mixing intervals maximize biovolume extraction?\n\nWill this always be the smallest cells, most frequent extractions, and whatever interval maximizes extraction? Is there allometry in the payoff per biovolume (and can it be easily implemented)?\n\nThe tasks:\n\nMaximize mixing and sinking losses across variation in size, mixing fraction and mixing interval\n\n3 sizes (individually and together --> 4 scenarios) x 3 intervals x 3 fractions\n\n\\textbf{ Aquaculture:} If you were to use diatoms in a biofuels or aquaculture setting\\footnote{In reality, other phytoplankton types would probably be preferable, but the design criteria and rationale might be very similar across taxa.}, you might design a chemostat or closed pond system that functions much like the mixed layer in Litchman et al.'s model: periodically you might extract water containing phytoplankton and replace it with nutrient-enriched water. Based on your answer above, \\textbf{which combinations of diatom size and mixing interval would you choose to make maximize productivity?}","type":"content","url":"/diatomaquacultureactivity#aquaculture","position":3},{"hierarchy":{"lvl1":"üõº Implications of allometry for diatom aquaculture and carbon sequestration","lvl2":"Carbon export from the mixed layer"},"type":"lvl2","url":"/diatomaquacultureactivity#carbon-export-from-the-mixed-layer","position":4},{"hierarchy":{"lvl1":"üõº Implications of allometry for diatom aquaculture and carbon sequestration","lvl2":"Carbon export from the mixed layer"},"content":"This is related to carbon export to deep water through mixing events and sinking\n\nFor comparability, we will use a standard set of diatom sizes for the basic model experiments (feel free to explore additional sizes if you want to):\n[ s=[2.5, 3.55, 5.0, 6.25, 7.5, 8.75, 10.0, 11.25] ] and on four mixing intervals, [ T=[3,14,35,40] ]\nFor these parameter combinations:","type":"content","url":"/diatomaquacultureactivity#carbon-export-from-the-mixed-layer","position":5},{"hierarchy":{"lvl1":"üõº Size-dependence of diatom biovolume in mixed layers: Overview"},"type":"lvl1","url":"/diatombiomassactivity","position":0},{"hierarchy":{"lvl1":"üõº Size-dependence of diatom biovolume in mixed layers: Overview"},"content":"Diatoms are a diverse group that represents a large fraction of \n\nprimary production and oxygen generation in aquatic habitats worldwide.\nDiatoms are also major prey species for aquatic grazers, important hosts for aquatic pathogens, and effective competitors for other primary producers.\nThe impacts diatom populations have, in these roles and others, are strongly affected  by the \n\nstanding stock of diatoms of different sizes.\n\nLitchman et al. (2009) used data analysis and model results to support the hypothesis that size-specific diatom standing stocks are strongly affected by the characteristics of the mixed layer in which they are growing.\nIf true, this hypothesis raises the questions,\n\nDoes primary production increase or decrease with different mixed layer characteristics?\n\nAre diatoms more available to grazers and pathogens in some types of mixed layers than in others?\n\nDo mixed layer characteristics affect the intensity of competition by diatoms for limiting nutrients?\n\nIn diverse diatom populations, are the best competitors also the variants that maximize or minimize availability and competitive intensity?\n\nIn this Activity , you will use Litchman et al.'s model to conduct a ‚Äúmini-study‚Äù, in which you answer these questions within the assumptions and limitations of the model.\n\nThe outcome of the mini-study will be a set of plots, showing whether or not changes in mixing layer characteristics causes systematic variation of implied grazer, pathogen and competitor impacts.\n\nThese plots will suggest further hypotheses, with implications that could be tested with empirical studies, to assess whether the model‚Äôs results reflect diatom populations in nature.","type":"content","url":"/diatombiomassactivity","position":1},{"hierarchy":{"lvl1":"üõº Size-dependence of diatom biovolume in mixed layers: Mini-study rationale"},"type":"lvl1","url":"/diatombiomassactivity2","position":0},{"hierarchy":{"lvl1":"üõº Size-dependence of diatom biovolume in mixed layers: Mini-study rationale"},"content":"Litchman et al. (2009)'s model used allometries of growth, nutrient uptake and nutrient storage quotas to predict the size-specific standing stocks of diatoms (expressed as biovolume) across variation in \n\nmixed layer characteristics.\n\nIn this Activity, we assume that that\n\nThe size-specific standing stock of diatoms is a proxy for primary production and availability to grazers and pathogens.\n\nThe mixed layer nutrient is a proxy for the intensity of competition among primary producers.\n\nBy ‚Äúproxy‚Äù, we mean that standing stocks and nutrient concentration is in some way an indicator, for example by being proportional or indicating increasing or decreasing trends.\n\nIn making this assumption, we should be clear that using proxies in this way is a simplification, but that the results may notetheless be indicative of the underlying ecological patterns.","type":"content","url":"/diatombiomassactivity2","position":1},{"hierarchy":{"lvl1":"üõº Size-dependence of diatom biovolume in mixed layers: Mini-study rationale","lvl2":"Grazers and pathogens"},"type":"lvl2","url":"/diatombiomassactivity2#grazers-and-pathogens","position":2},{"hierarchy":{"lvl1":"üõº Size-dependence of diatom biovolume in mixed layers: Mini-study rationale","lvl2":"Grazers and pathogens"},"content":"The rationale for assuming that standing stock is a plausible proxy for trophic impacts is that:\n\nprey availability to grazers is roughly proportional to the number of cells in the water; and,\n\nthe payoff per cell (nutritional gain for grazers, or replicates for pathogens) is roughly proportional to cell volume.\n\nTherefore the product of cell number and cell volume ‚Äì that is, the biovolume ‚Äì is roughly proportional to the ‚Äúpayoff‚Äù for a grazer or pathogen.\n\nLitchman et al. lend support to this interpretation in their paper, by subsuming losses to higher trophic levels in their density-independent ‚Äúbackground‚Äù mortality term.\nWhile there is little discussion of this term in their paper, Litchman et al. were well aware of grazing and pathogen impacts on diatoms, and intended the size-independent mortality term to account for it.\nIt is also plausible to assume that competition for light is affected by standing stock biovolume, and that competition for nutrients is largely determined by the standing stock of nutrients.","type":"content","url":"/diatombiomassactivity2#grazers-and-pathogens","position":3},{"hierarchy":{"lvl1":"üõº Size-dependence of diatom biovolume in mixed layers: Mini-study rationale","lvl2":"Primary production"},"type":"lvl2","url":"/diatombiomassactivity2#primary-production","position":4},{"hierarchy":{"lvl1":"üõº Size-dependence of diatom biovolume in mixed layers: Mini-study rationale","lvl2":"Primary production"},"content":"The rationale for assuming that standing stock is a plausible proxy for primary production is that:\n\nprimary production is roughly proportional to the number of cells in the water; and,\n\na large diatom cell likely has faster primary production than a small diatom cell; because the model does not have a more detailed calculation for this size dependence, cell volume is the best available metric.\n\nKeeping in mind the strengths and weaknesses of this rationale, we proceed assuming that the product of cell number and cell volume ‚Äì that is, the biovolume ‚Äì is roughly proportional to the size-specific diatom primary production.","type":"content","url":"/diatombiomassactivity2#primary-production","position":5},{"hierarchy":{"lvl1":"üõº Size-dependence of diatom biovolume in mixed layers: Mini-study rationale","lvl2":"Competition for light and nutrients"},"type":"lvl2","url":"/diatombiomassactivity2#competition-for-light-and-nutrients","position":6},{"hierarchy":{"lvl1":"üõº Size-dependence of diatom biovolume in mixed layers: Mini-study rationale","lvl2":"Competition for light and nutrients"},"content":"Diatoms compete with other primary producers for light and nutrients.\n\nThe rationale for assuming that standing stock is a plausible proxy for competition for light is that:\n\nshading is roughly proportional to the number of cells in the water; and,\n\na large diatom cell likely has stronger shading effects than a small diatom cell; since the model does not have a more detailed calculation for this size dependence, cell volume is the best available metric.\n\nKeeping in mind the strengths and weaknesses of this rationale, we proceed assuming that the product of cell number and cell volume ‚Äì that is, the biovolume ‚Äì is roughly proportional to the size-specific competitive impacts of diatom cells due to shading.\n\nThe rationale for assuming that standing stock is a plausible proxy for light is that:\n\nthe model directly calculates the availability of nutrient (nitrate) in the mixed layer; and,\n\nit is assumed that the mixed-layer nutrient concentration is the limiting resource for diatom growth, so it is plausible that is also limiting for other primary producers.\n\nKeeping in mind the strengths and weaknesses of this rationale, we proceed assuming that the mixed-layer nutrient concentration, R, is a plausible metric for size-specific competitive impacts of diatom cells due to nutrient limitation.\n\nThat term is \\m N_i, where N_i is the number of cells of size class i and m is the mortality rate. See \n\nthis explanation of the model and the original paper for details.\n\nIn fact, their motivation was in part to present an alternative to size-selective grazing in explaining diatom size distributions. The literature contains models that have a more resolved accounting of different classes of grazers, such as small and large zooplankton, with size-specific impacts on diatoms. However, those models do not resolve the specific effects of diatom allometry that Litchman et al. hypothesize to determine diatom size distributions in mixed layers.","type":"content","url":"/diatombiomassactivity2#competition-for-light-and-nutrients","position":7},{"hierarchy":{"lvl1":"üõº Size-dependence of diatom biovolume in mixed layers: Data collection"},"type":"lvl1","url":"/diatombiomassactivity3","position":0},{"hierarchy":{"lvl1":"üõº Size-dependence of diatom biovolume in mixed layers: Data collection"},"content":"Your task in this Activity is to execute a ‚Äúmini-study‚Äù that addresses the \n\nmotivating questions by tabulating the standing stocks of diatoms and nutrient across several cell sizes and several mixing intervals.\nYou will \n\ninterpret those data in terms of the motivating questions, in the next phase of the mini-study.","type":"content","url":"/diatombiomassactivity3","position":1},{"hierarchy":{"lvl1":"üõº Size-dependence of diatom biovolume in mixed layers: Data collection","lvl2":"Part 1: Consequences of diatom cell size"},"type":"lvl2","url":"/diatombiomassactivity3#part-1-consequences-of-diatom-cell-size","position":2},{"hierarchy":{"lvl1":"üõº Size-dependence of diatom biovolume in mixed layers: Data collection","lvl2":"Part 1: Consequences of diatom cell size"},"content":"The first part of this activity is a survey of biovolume and nutrient concentrations for different size classes of diatoms growing in monoculture, across a series of mixing event intervals.\nThe primary tool in your mini-study, aside from the model, is a spreadsheet in which you tabulate and plot model results.\nTo get started:\n\nOpen a spreadsheet, in which to tabulate and plot results.\n\nLaunch the \n\nmodel on Binder, and generate the user interface with Run all cells.\n\nInitialize a new diatom population using the default parameters, by clicking on the Set up population button.\n\nScroll down to the Seeding... section.Seed the population with diatoms of the smallest size class, by setting 0 in the i textbox (replacing ‚Äúall‚Äù), then clicking the Seed cell population button.\n\nNote that, if there are 8 size classes, these are numbered 0 to 7.\n\nClick on the Run simulation button using the default settings.\n\nIn the results labelled ‚ÄúPeriod-averaged statistics: standing stocks‚Äù, look at the BV column. This contains the biovolume of diatoms in each size class. Because you seeded cells only in the smallest size class (s=2.5), only this size class has nonzero biovolume.\n\nChoose a part of your spreadsheet in which to tabulate biovolume, and another part to tabulate nutrient concentration.\n\nIn the biovolume part of your spreadsheet, enter ‚Äús‚Äù into a cell, and under it enter the size of diatom you just simulated (2.5). This is the column for diatom size in your biovolume table.Next to the ‚Äús‚Äù, enter ‚ÄúBV8‚Äù and below it enter the BV value corresponding to s=2.5 in the model output. This is the column for biovolume for each of the size classes you simulate. The ‚Äú8‚Äù in ‚ÄúBV8‚Äù is the mixing interval, which is still the default 8 days.\n\nIn the nutrient concentration part of your spreadsheet, enter ‚Äús‚Äù into a cell, and under it enter the size of diatom you just simulated (2.5). This is the column for diatom size in your nutrient concentration table.Next to the ‚Äús‚Äù, enter ‚ÄúR8‚Äù and below it enter the averaged nutrient concentration value in the model output. This is the column for nutrient concentration  for each of the size classes you simulate. The ‚Äú8‚Äù in ‚ÄúR8‚Äù is the mixing interval, which is still the default 8 days.\n\nNow, change the mixing interval, t_{mix} to 16, in the textbox, and click Run simulation again.\n\nThis restarts the simulation, but uses the new mixing interval of 16 days instead of the default 8 days.\nWhen you restart the simulation, it will use the endpoint of the previous simulation as its initial condition.\nBecause the simulation is running for many mixing intervals, it will ‚Äúforget‚Äù these initial conditions just as it did in the original run.\n\nTo record this datum, enter ‚ÄúBV16‚Äù next to ‚ÄúBV8‚Äù, and enter the new BV value below it. Also, enter ‚ÄúR16‚Äù next to ‚ÄúR8‚Äù, and enter the new averaged nutrient concentration value below it.\n\nRepeat this for mixing intervals T_{mix}=32 and  T_{mix}=64, recording those results as before to create a row of one size class s and four values of BV or nutrient concentration.\n\nRepeat steps 3-10, but this time using the size class i=3, corresponding to s=6.79. Use the results to fill out the second row of BV and nutrient concentration data in your spreadsheet.\n\nRepeat steps 3-10, but this time using the size class i=7, corresponding to s=12.5. Use the results to fill out the third row of BV and nutrient concentration data in your spreadsheet.Pay particular attention to the plots in Figure 2, to assess whether the diatom population is periodic. If not, make a note of the results, but do not include it in your table.\n\nWhen the tables are complete, make X-Y Scatter plots of the data using the spreadsheet‚Äôs Chart funtion.\n\nThe data are in columns, with the first column being the x-axis.\n\nThe title of the BV plot is ‚Äú1-spp variation of biovolume‚Äù.\n\nThe title of the nutrient concentration plot is ‚Äú1-spp variation of nutrient concentration‚Äù.\n\nThe x-axis label is ‚Äúlog10(Diatom size)‚Äù.\n\nThe y-label is ‚ÄúBiovolume‚Äù.\n\nThe legend indicates the mixing interval associated with each line.\n\nBecause the biovolume and nutrient concentration differences are so extreme, double click on the vertical axes and set the scales to ‚ÄúLogarithmic‚Äù.\n\nThis completes the data collection for Part 1 of this Activity.","type":"content","url":"/diatombiomassactivity3#part-1-consequences-of-diatom-cell-size","position":3},{"hierarchy":{"lvl1":"üõº Size-dependence of diatom biovolume in mixed layers: Data collection","lvl2":"Part 2: Consequences of diatom diversity"},"type":"lvl2","url":"/diatombiomassactivity3#part-2-consequences-of-diatom-diversity","position":4},{"hierarchy":{"lvl1":"üõº Size-dependence of diatom biovolume in mixed layers: Data collection","lvl2":"Part 2: Consequences of diatom diversity"},"content":"The second part of this activity is a survey of biovolume and nutrient concentrations across a series of mixing event intervals, for a mixed diatom population that initially includes all the size classes.\n\nChoose a part of your spreadsheet for a new table for biovolume and nutrient concentration data, or start a new one.\n\nStart a column labeled ‚ÄúTmix‚Äù and fill out the column underneath by entering the sequence of mixing intervals to assess: T_{mix} = 8, 16, 32, 64.\n\nNext to ‚ÄúTmix‚Äù, enter a label for biovolume, BV, and a label for nutrient concentration, R.\n\nExecute the three setup button clicks:\n\nSet up population\n\nSeed cell population\n\nRun simulation.\n\nContinue the simulation, with repeated clicks on Run simulation, until the total biovolume does not change.\nThis means the diatom population is essentially periodic, though there may be remnants of diatom variants at tiny population numbers.Enter the results for averaged biovolume and nutrient concentration under their respective columns, in the row for T_{mix}=8.\n\nRepeat steps 2-3, changing the mixing interval T_{mix} to 16, 32 and 64, and recording the results in the appropriate rows.\n\nMake a chart with T_{mix} on the horizontal axis, and total biovolume on the vertical axis.Make another chart with  T_{mix} on the horizontal axis, and nutrient concentration on the vertical axis.\n\nLabel the axes of both plots.\n\nThe title of the BV plot is ‚ÄúMulti-spp variation of biovolume‚Äù.\n\nThe title of the nutrient concentration plot is ‚ÄúMulti-spp variation of nutrient concentration‚Äù.\n\nThis completes the data collection for Part 2 of this Activity.","type":"content","url":"/diatombiomassactivity3#part-2-consequences-of-diatom-diversity","position":5},{"hierarchy":{"lvl1":"üõº Size-dependence of diatom biovolume in mixed layers: Interpretation"},"type":"lvl1","url":"/diatombiomassactivity4","position":0},{"hierarchy":{"lvl1":"üõº Size-dependence of diatom biovolume in mixed layers: Interpretation"},"content":"In this part of the Activity, you will interpret the model results you tabulated in the \n\ndata collection phase.\n\nTaking the motivating questions in turn:\n\nDoes primary production increase or decrease with different mixed layer characteristics?\n\nAre diatoms more available to grazers and pathogens in some types of mixed layers than in others?\n\nThese questions are related, in that both refer to diatom biovolume as a proxy, in one case for rate of primary production by the diatom population, and in the other for the ‚Äúpayoff‚Äù available to a grazer or pathogen attacking the diatom population.\n\nExamine the table and plot in Part 1 you made of biovolume as a function of diatom size class and mixing interval.\n\nDo you see evidence in the model results that biovolume, and by implication availability and primary production, increase or decrease with mixing layer characteristics?\n\nDo you see evidence in the model results that trends in biovolume, and by implication availability and primary production, are different for different size classes of diatoms?\n\nWrite a few sentences summarizing your conclusions and the interpretation of the model results that you use to arrive at them.\n\nWhat qualifications do you think should be attached to your conclusions, given the use of proxies, model assumptions and mini-study design?\n\nDo mixed layer characteristics affect the intensity of competition by diatoms for limiting nutrients\nThis question refers to using mixed layer nutrient concentration as a proxy for competitive intensity with other primary producers (and among diatoms).\n\nExamine the table and plot you made in Part 1 of nutrient concentration as a function of diatom size class and mixing interval.\n\nDo you see evidence in the model results that nutrient concentration, and by implication competitive impacts, increase or decrease with mixing layer characteristics?\n\nDo you see evidence in the model results that trends in nutrient concentration, and by implication competitive impacts, are different for different size classes of diatoms?\n\nWrite a few sentences summarizing your conclusions and the interpretation of the model results that you use to arrive at them.\n\nWhat qualifications do you think should be attached to your conclusions, given the use of proxies, model assumptions and mini-study design?\n\nIn diverse diatom populations, are the best competitors also the variants that maximize or minimize availability and competitive intensity?\n\nThe data bearing on this question are model results that show the periodic population dynamics of monocultures of single diatom size classes (s=2.5, s=6.79, and s=12.5; and, the periodic dynamics of diverse populations diatoms (s=2.5,3.93,5.36,6.79,8.21,9.64,11.1,12.5\n\nIn the diverse population simulations, competition among variants determines which size classes are presents, rather than being set by initial conditions as in the monoculture simulations.\n\nExamine the table and plot you made in Part 2 of biovolume and nutrient concentration as a function mixing interval.\n\nDo you see evidence in the model results that competition among initially diverse populations leads to maximizing or minimizing biovolume, compared to monocultures containing some of the same diatom variants?\n\nDo you see evidence in the model results that competition among initially diverse populations leads to maximizing or minimizing nutrient competition, compared to monocultures containing some of the same diatom variants?\n\nWhy populations behave as you observe them to?\n\nWrite a few sentences summarizing your conclusions and the interpretation of the model results that you use to arrive at them.\n\nWhat qualifications do you think should be attached to your conclusions, given the use of proxies, model assumptions and mini-study design?","type":"content","url":"/diatombiomassactivity4","position":1},{"hierarchy":{"lvl1":"üõº Evolutionarily Stable States for diatoms in mixed layers: Overview"},"type":"lvl1","url":"/diatomessactivity","position":0},{"hierarchy":{"lvl1":"üõº Evolutionarily Stable States for diatoms in mixed layers: Overview"},"content":"Identifying and quantifying the constellation of ecological mechanisms that determine the diversity and abundance of species in ecosystems is an on-going challenge.\nIn aquatic ecosystems, this challenge was termed by G. E. Hutchinson the \n\nParadox of the Plankton ‚Äì the idea that competitive exclusion should lead to a low-diversity community with only one ‚Äúbest‚Äù competitor for each of the relatively few limiting resources.\nMost communities are much more diverse than this logic would suggest.\n\nOne useful tool for understanding how diversity in communities might be promoted or suppressed is the idea of an \n\nEvolutionarily Stable State, or ESS.\nThe ESS concept applies to a community of ‚Äúvariants‚Äù, that could be different species or different strains of a single species.\nAn ESS is a population of one or more of these variants that, once established, can exclude all other variants.\n\nLitchman et al. (2009) developed an ESS analysis of diatom size distributions in \n\nmixed layers.\nKey aspects of their model were:\n\nthe allometries of growth rate, nutrient uptake rate and nutrient storage across small, middle-sized and large diatoms\n\nfluctuating nutrient concentrations, including decreases due to nutrient consumption by diatoms and increases due to episodic mixing with nutrient-rich deep water.\n\nLitchman et al. sought to understand why diatom size distributions are larger in marine habitats than in freshwater habitats.\nThey hypothesized that differences between typical marine mixed layers layers and typical freshwater mixed layers underlie the differences in diatom communities.\nThey further hypothesized that the key functional traits affected by the marine vs. freshwater mixed layer characteristics are the allometries of growth- and nutrient-related traits.\n\nThese hypotheses raise the questions,\n\nDo Evolutionarily Stable States, as inferred from Litchman et al.'s model, correspond to relatively large diatom size distributions in marine environments?\n\nDo long-term competitive outcomes from initially mixed populations match ESS outcomes?\n\nDo diatom communities in mixed layers approach Evolutionarily Stable States or long-term competitive outcomes quickly enough to be observed in nature?\n\nIn this Activity, you will use Litchman et al.'s model to conduct a ‚Äúmini-study‚Äù, in which you will address these questions within the assumptions and limitations of the model.\n\nThe outcome of the mini-study will be a set of plots, showing which diatom variants form ESS‚Äôs under different mixing layer conditions, and whether or not initially mixed populations approach these ESS‚Äôs as an outcome of long-term competition.\n\nThese plots, and the timescales over which ESS and competitive outcomes occur, will suggest further hypotheses, with implications that could be tested with empirical studies about when and where the model‚Äôs results reflect diatom populations in nature.","type":"content","url":"/diatomessactivity","position":1},{"hierarchy":{"lvl1":"üõº Evolutionarily Stable States for diatoms in mixed layers: Mini-study rationale"},"type":"lvl1","url":"/diatomessactivity2","position":0},{"hierarchy":{"lvl1":"üõº Evolutionarily Stable States for diatoms in mixed layers: Mini-study rationale"},"content":"Your task in this Activity is to execute a ‚Äúmini-study‚Äù that addresses the \n\nmotivating questions by tabulating \n\nEvolutionarily Stable States, outcomes of competition among mixed diatom populations, and the timescales over which these outcomes occur, across several mixing intervals.\nYou will \n\ninterpret those data results in terms of the motivating questions, in the next phase of the mini-study.","type":"content","url":"/diatomessactivity2","position":1},{"hierarchy":{"lvl1":"üõº Evolutionarily Stable States for diatoms in mixed layers: Mini-study rationale","lvl2":"Mini-study rationale"},"type":"lvl2","url":"/diatomessactivity2#mini-study-rationale","position":2},{"hierarchy":{"lvl1":"üõº Evolutionarily Stable States for diatoms in mixed layers: Mini-study rationale","lvl2":"Mini-study rationale"},"content":"In their published research, Litchman et al. surveyed a finely resolved diatom size distribution, with numerous size classes.\nThey used a computerized loop to assess whether or not each of these size classes was an ESS, for each of a wide range of mixing intervals.\nThis approach is not practical in a mini-study.\n\nInstead, you will execute your mini-study to address some elements of the motivating questions:\n\nIn Part 1, you will ask,\n\nWhat are the outcomes of competition among initially mixed populations of diatom variants?Over which time periods do the outcomes of competition among initially mixed diatom populations approach their final state?\n\nIn this part of the mini-study, you will conduct simulations to acquire two kinds of data:\n\nYou will tabulate the number of cells, to determine the ‚Äúwinning‚Äù variant under different mixing intervals, when an entire spectrum of diatom size variants is initially present.\n\nThe rationale underlying this table is as an implementation of the principle of competitive exclusion:\nIn the long term, the ‚Äúbest‚Äù competitor should exlude all the other variants.\n\nYou will also record how many days are required for the diatom population to reach a ‚Äústeady state‚Äù ‚Äì that is, a constant period-averaged variant populations.\n\nThe rationale underlying the second of these tables is an assessment of relevance to real-world settings, in which conditions change and multiple influences are exerted on diatom populations.\nIn particular, if the predicted competitive outcomes occur only after many months or years, to what extent do we expect to see them in mixed layers in nature?\n\nIf you find that diatom populations quickly approach these ESS or competitive outcomes, that would suggest these dynamics may dominate other factors in determining diatom size distributions.\nConversely, if you find that populations arrive at ESS and competitive outcomes only very slowly, that would suggest these dynamics may be overwhelmed by other factors in variable aquatic habitats.\n\nIn Part 2, you will ask,\n\nAre the outcomes of competition among initially mixed populations of diatom variants also ESS‚Äôs?\n\nIn this part of the mini-study, you will test whether the winning variants in Part 1 are ESS‚Äôs.\n\nThere are two rationales for conducting these tests:\n\nBecause \n\nthe outcomes of competition can differ from ESS‚Äôs, the test for whether a variant (or combination of variants) is an ESS is different than a test for ‚Äúwinners‚Äù of competition among a mixed population.\n\nFinding out whether ‚Äúwinners‚Äù of competitive outcomes are also ESS‚Äôs is important in understanding the evolutionary implications of Litchman et al.'s model.\nIf you find that ‚Äúwinners‚Äù of competition are also the variants that form EES‚Äôs, that would support ‚Äì at least for this subset of conditions ‚Äì the relevance of the ESS concept as an indicator of trends in natural selection.\nConversely, if you find that winners of competition in initially mixed populations differ from EES variants, that would suggest the specific assumptions underlying ESS analysis may be less relevant.\n\nMany population models are deceptively slow in arriving at ‚Äústeady state‚Äù, particularly when there are many similar competing variants.\n\nFinding out whether the apparent winner is an ESS is a useful affirmation the the apparent steady state outcome is robust in the long term.","type":"content","url":"/diatomessactivity2#mini-study-rationale","position":3},{"hierarchy":{"lvl1":"üõº Evolutionarily Stable States for diatoms in mixed layers: Data collection"},"type":"lvl1","url":"/diatomessactivity3","position":0},{"hierarchy":{"lvl1":"üõº Evolutionarily Stable States for diatoms in mixed layers: Data collection"},"content":"In this mini-study, you will examine the outcomes of competition among diatom variants in mixed layers, and the \n\nEvolutionarily Stable States that arise in them.\n\nTo get started:\n\nOpen a spreadsheet, in which to tabulate and plot results.\n\nPrepare a table, by entering a row with the headings: ‚ÄúTmix‚Äù, ‚Äúi_win‚Äù, ‚Äús_win‚Äù, and ‚ÄúESS‚Äù.\n\nThe ‚ÄúTmix‚Äù column will contain a column of mixing intervals.Enter 1.5, 8, 18. 32 into this column.\n\nThe ‚Äúi_win‚Äù and ‚Äús_win‚Äù columns will contain the size class and size of the dominant diatom variant (the ‚Äúwinner‚Äù of the competition).\n\nThe ‚Äúdays‚Äù column will contain your assessment of how long it took for the winner to become dominant.A rough estimate, based on how many times you ran the simulation (multiplied by the number of mixing intervals, 128, and by the number of days in each mixing period).\n\nThe ESS column will contain whether or not the winning size class is also an ESS.You will fill this column in Part 2.\n\nLaunch the \n\nmodel on Binder, and generate the user interface with Run all cells.\n\nIn the Setting up diatom variants and mixed layer characteristics section, use the following parameter choices:\n\nSet the number of size classes to n_{sizes}=16, to reflect a spectrum of  potential marine diatom diversity.\n\nSet the mixed layer depth to z_m=100, to reflect the relatively deep mixed layers in many marine habitats.\n\nScroll down to the Seeding... section.\n\nSet the size classes, i, to ‚Äúall‚Äù.\n\nSet the number of cells to seed to N_i=0.1.\n\nThis will be the ‚Äúsmall‚Äù initial number of cells to test whether a diatom variant can invade.\n\nIn the Setting mixing event intervals, and running the simulation section,\n\nSet the number of intervals to n_{pers}=128.\n\nThis relatively large number of mixing intervals will be helpful in determining the steady state outcomes of diatom population dynamics.\n\nThese parameters will apply to all the simulation runs in this Activity.","type":"content","url":"/diatomessactivity3","position":1},{"hierarchy":{"lvl1":"üõº Evolutionarily Stable States for diatoms in mixed layers: Data collection","lvl2":"Part 1: Which variants win competition among mixed diatom populations?"},"type":"lvl2","url":"/diatomessactivity3#part-1-which-variants-win-competition-among-mixed-diatom-populations","position":2},{"hierarchy":{"lvl1":"üõº Evolutionarily Stable States for diatoms in mixed layers: Data collection","lvl2":"Part 1: Which variants win competition among mixed diatom populations?"},"content":"The first part of this Activity is a survey of competitive outcomes across a series of mixing event intervals.\n\nFor each of the mixing intervals, T_{mix} = 1.5, 8, 18 32, complete the following set of steps:\n\nInitialize a new diatom population, by clicking on the Set up population button.\n\nIn the Seeding... section, seed the population with diatoms of all size classes, by clicking the Seed cell population button.\n\nClick on the Run simulation button.\n\nTake note of which size class has the largest number of cells (under the ‚ÄúN‚Äù column in the tabular model output).\n\nClick on the Run simulation button, again, repeating as necessary, keeping track of how many times you run the simulation, until one variant is clearly excluding the other variants.\n\nWhen you judge the outcome is close to a steady state, record the winner‚Äôs size class i, its size s and the approximate number of days it took to arrive at a steady state.\n\nThis completes the data collection for Part 1 of this Activity.","type":"content","url":"/diatomessactivity3#part-1-which-variants-win-competition-among-mixed-diatom-populations","position":3},{"hierarchy":{"lvl1":"üõº Evolutionarily Stable States for diatoms in mixed layers: Data collection","lvl2":"Part 2: Are dominant competitors ESS‚Äôs?"},"type":"lvl2","url":"/diatomessactivity3#part-2-are-dominant-competitors-esss","position":4},{"hierarchy":{"lvl1":"üõº Evolutionarily Stable States for diatoms in mixed layers: Data collection","lvl2":"Part 2: Are dominant competitors ESS‚Äôs?"},"content":"The second part of this Activity is testing whether the dominant variants from Part 1 meet the criterion for being an ESS.\n\nFor each of the mixing intervals, T_{mix} = 1.5, 8, 18 32, complete the following set of steps:\n\nInitialize a new diatom population, by clicking on the Set up population button.\n\nIn the Seeding... section, seed the population with diatoms of the dominant size class, setting i to ‚Äúi_win‚Äù, then clicking the Seed cell population button.\n\nClick on the Run simulation button.\n\nConfirm in the Period-Averaged Time Series plots that the diatom population of this variant has reached steady state.\n\nIn the Seeding... section, seed the population with diatoms of all size classes, by setting i to ‚Äúall‚Äù, then clicking the Seed cell population button.\n\nClick on the Run simulation button.\n\nAfter the transients from seeding new cells have passed, take note of which size class have more cells than you seeded (0.1).In close cases, you may need to run the simulation two or more times.\n\nIf all of the variants, other than the original ESS candidate, have populations below the number you seeded (\n\n10-1) then there are no ‚Äúsuccessful‚Äù invaders, and the original size class is an ESS.In this case, enter a ‚Äúy‚Äù in the ESS column corresponding to the mixing interval.\n\nIf any of the variants, other than the original ESS candidate, have populations above the number you seeded (\n\n10-1) then these are ‚Äúsuccessful‚Äù invaders, and the original size class is not an ESS.In this case, enter a ‚Äún‚Äù in the ESS column corresponding to the mixing interval.\n\nThis completes the data collection for Part 2 of this Activity.","type":"content","url":"/diatomessactivity3#part-2-are-dominant-competitors-esss","position":5},{"hierarchy":{"lvl1":"üõº Evolutionarily Stable States for diatoms in mixed layers: Interpetation"},"type":"lvl1","url":"/diatomessactivity4","position":0},{"hierarchy":{"lvl1":"üõº Evolutionarily Stable States for diatoms in mixed layers: Interpetation"},"content":"In this part of the Activity, you will interpret the model results you tablulated in the \n\ndata collection phase.\n\nThis activity began with motivating questions focused on Litchman et al.'s analysis of Evolutionarily Stable Strategies of diatoms in mixed layers\n\nDo Evolutionarily Stable States, as inferred from Litchman et al.'s model, correspond to relatively large diatom size distributions in marine environments?\n\nDo long-term competitive outcomes from initially mixed populations match ESS outcomes?\n\nDo diatom communities in mixed layers approach Evolutionarily Stable States or long-term competitive outcomes quickly enough to be observed in nature?\n\nBecause our implementation of their model makes it impractical to exhaustively test for ESS‚Äôs among a large number of diatom size classes and a wide range in mixed layer characteristics, we instead examined a much smaller set of candidate ESS‚Äôs suggested by the outcomes of competition among mixed diatom populations.\n\nIn Part 1, we started with the question,\n\nWhat are the outcomes of competition among initially mixed populations of diatom variants?\n\nWe used the most successful competitors in a series of mixing intervals as candidates to test for ESS‚Äôs in Part 2.\n\nWe also noted the approximate time scales over which dominant competitors excluded less successful competitors.\nThese timescales are important context for assessing how well we would expect steady state outcomes of competition and ESS‚Äôs to be reflected in real-world mixing layers.\n\nExamine the tabulated observations of dominant diatom competitors and ESS‚Äôs.\n\nDo you see evidence that mixed layer characteristics favor different size classes of diatoms?In particular, Litchman et al.'s overall hypothesis is that temporal variations in mixing layer nutrient concentrations can lead to deviations from simple predictions that small diatoms are superior competitors.\nDo you see support for this hypothesis in your results?\n\nIn Part 2, we asked,\n\nAre the outcomes of competition among initially mixed populations of diatom variants also ESS‚Äôs?\n\nUsing mathematical approaches, it is in some cases easier and faster to determine ESS‚Äôs than to compute long time series of competing populations.In the limited dataset emerging from your mini-study, do ESS diatom variants appear to be good predictors of the dominant competitors in mixed diatom populations?\n\nFinally, we asked,\n\nOver which time periods do the outcomes of competition among initially mixed diatom populations approach their final state?\n\nESS‚Äôs give us no information about the time scales over which competitive exclusion occurs.\nIn contrast, the simulations give us an accurate measure over these time scales.\nKnowing these time scales, you can compare them to those of other processes occuring in mixed layers, such as changing seasons, shifts in populations of grazers and pathogens, transport into new environments by currents and tides, and other variations.\n\nIn your results, which results occur over short enough time scales that you would expect them to be reflected in real-world mixed layers?Which would you not expect to see in real mixed layers?Which mechanisms do you suspect might be responsible for any differences?","type":"content","url":"/diatomessactivity4","position":1},{"hierarchy":{"lvl1":"üßÆ Size-selection of diatoms in fluctuating environments"},"type":"lvl1","url":"/diatomsizeess","position":0},{"hierarchy":{"lvl1":"üßÆ Size-selection of diatoms in fluctuating environments"},"content":"This notebook implements (with some modifications) the diatom population dynamics model presented in \n\nLitchman et al..\n\nThis model uses \n\nallometric trends in growth rates and storage capacities to calculate the population dynamics of different-sized diatom variants.\nThe variants compete for a nutrient (nitrogen in the form of \n\nnitrate) within a \n\nmixed layer.\nNutrient is depleted in the mixed layer due to uptake by diatoms.\n\nMixing events (e.g. storms) occur periodically, that replace a fraction of the water in the mixed layer with deep water.\nThis has two effects: It transports some of the diatom cells into deep water, where they ultimately die; and, it injects nutrient (contained in deep water) into the mixed layer.\nTherefore, a mixing event both lowers the diatom population and provides nutrients to enhance its growth.\n\nLitchman et al.‚Äòs model is a so-called quota model.\n‚ÄúQuota‚Äù refers to cells‚Äô storage of nutrients, increasing as cells take up nutrient from the water and decreasing as that nutrient is consumed during growth.\nThe mode tracks the changes over time in:\n\nThe number of cells of each diatom variant\n\nThe quota (amount of stored nutrients) in cells of each diatom variant\n\nThe amount of nutrient in the water\n\nThe key question asked by Litchman et al. was,\n\nDo variations in the frequency and intensity of mixing events, combined with allometries of nutrient storage and use, explain the size distributions of diatoms in different habitats?\n\nThe rationale and key parameters are explained in \n\nthis discussion of diatom allometry and \n\nthis discussion of Litchman et al.'s data analysis.\nExplanation of the formulation of this model is in \n\nthis context page (and in the original paper).\n\n","type":"content","url":"/diatomsizeess","position":1},{"hierarchy":{"lvl1":"üßÆ Size-selection of diatoms in fluctuating environments","lvl2":"How to use this notebook"},"type":"lvl2","url":"/diatomsizeess#how-to-use-this-notebook","position":2},{"hierarchy":{"lvl1":"üßÆ Size-selection of diatoms in fluctuating environments","lvl2":"How to use this notebook"},"content":"To use the model, start by selecting Run All Cells under the Run menu at the top left of this page.\n\nThe parameters used in simulating diatom population dynamics are presented in three sets of textboxes and execution buttons, which you will use in sequence to:\n\nSet up the number and size range of diatom variants, and the characteristics of the mixed layer they inhabit.\n\nSeed the mixed layer with one or more of the diatom variants.\n\nSet the interval between mixing events and how many days to simulate the population.\n\nRun the simulation and look at the output.\n\nOptionally, reseed the population with new cells, and restart the simulation to see how the new set of variants interact.\n\nFrom the initial conditions you specify, the model runs through many mixing intervals and the diatom populations approach a repeated pattern.","type":"content","url":"/diatomsizeess#how-to-use-this-notebook","position":3},{"hierarchy":{"lvl1":"üßÆ Size-selection of diatoms in fluctuating environments","lvl3":"Graphical output","lvl2":"How to use this notebook"},"type":"lvl3","url":"/diatomsizeess#graphical-output","position":4},{"hierarchy":{"lvl1":"üßÆ Size-selection of diatoms in fluctuating environments","lvl3":"Graphical output","lvl2":"How to use this notebook"},"content":"The model produces two sets of graphical output:\n\nPlots of the population (expressed as biovolume) and quota of each variant, and the nutrient concentration, through the last simulated mixing interval.\n\nThese ‚Äúperiod‚Äù plots are good indicators of how effectively each variant stores nutrients when it is available, and uses that storage to fuel growth.\n\nPlots of the averages over each mixing interval of the population and quota of each variant, and the nutrient concentration, over the entire simulation.\n\nThe averaged plots are good indicators of the outcomes of competition between variants, because they show positive or negative population trends over long timespans.\n\nBiovolume is the number of cells times the volume of each cell, for each of the size variants. If cell densities are approximately constant, then the biovolume of each variant is approximately proportional to the total biomass of that variant.\n\nThese plots are automatically saved at the end of each simulation as images, so you can copy and paste them into a document or presentation to record your results.\nThe png format images are period.png and averagred.png; the svg format images are period.svg and averaged.svg.","type":"content","url":"/diatomsizeess#graphical-output","position":5},{"hierarchy":{"lvl1":"üßÆ Size-selection of diatoms in fluctuating environments","lvl3":"Tabular output","lvl2":"How to use this notebook"},"type":"lvl3","url":"/diatomsizeess#tabular-output","position":6},{"hierarchy":{"lvl1":"üßÆ Size-selection of diatoms in fluctuating environments","lvl3":"Tabular output","lvl2":"How to use this notebook"},"content":"The model also produces two tables of period-averaged results for the final mixing period:\n\nA table of standing stock, averaged through the last mixing period.\n\nThis table shows, for each size class:\n\nclass number, i\n\nsize metric, s_i\n\nsize, 10^{s_i}\n\nnumber cells per liter, N_i\n\nrelative quota, \\frac{Q_i}{Q_{i,min}}\n\nbiovolume, BV_i = N_i \\times 10^{s_i}\n\nnutrient concentration, R\n\nNote that R reflects the entire mixed layer, and does not vary by diatom size ‚Äì it is included in each row only to make a complete table for import into a spreadsheet.\n\nA table of diatom population losses (in units of biovolume per day), averaged through the last mixing period.\n\nThis table shows, for each size class:\n\nclass number, i\n\nsize metric, s_i\n\nsize, 10^{s_i}\n\nlosses due ‚Äúbackground‚Äù mortality, M\n\nlosses due to sinking out of the mixed layer, S\n\nlosses transport to deep water by mixing events, L\n\n# Load modules and set graphics environment\n%matplotlib widget\nimport numpy as np\nfrom matplotlib import pyplot as plt\n#plt.ion();\nfrom ipywidgets import interact, interactive, fixed, interact_manual\nimport ipywidgets as widgets\nfrom math import *\nfrom Litchman2009 import diatoms\n\n\n\n# Instantiate a Params object and a GUI to modify parameters. \n#params=Params(auto_plot=True)\nh = '27px'\nn_sizes=widgets.IntText(value=8,width=10,description = r\"$n_{sizes}$\")\nL_n_sizes = widgets.Label(value='Number size classes',layout=widgets.Layout(display=\"flex\", \n                                        justify_content=\"flex-end\",width=\"100%\",height=h))\nmin_size=widgets.FloatText(value=2.5,\n                               description = r\"$S_{min} (log_{10})$\")\nL_min_size = widgets.Label(value='Min. cell size',layout=widgets.Layout(display=\"flex\", \n                                        justify_content=\"flex-end\",width=\"100%\",height=h))\nmax_size=widgets.FloatText(value=2.5+1.25*8,\n                               description = r\"$S_{max} (log_{10})$\")\nL_max_size = widgets.Label(value='Max cell size',layout=widgets.Layout(display=\"flex\", \n                                        justify_content=\"flex-end\",width=\"100%\",height=h))\nqinit=widgets.FloatText(value=0.1,description = r\"$q_{init}$\")\nL_qinit = widgets.Label(value='Initial fractional quota',layout=widgets.Layout(display=\"flex\", \n                                        justify_content=\"flex-start\",width=\"100%\",height=h))\nm=widgets.FloatText(value=0.08,description = r\"$m$\")\nL_m = widgets.Label(value='Mortality rate ($day^{-1}$)',layout=widgets.Layout(display=\"flex\", \n                                        justify_content=\"flex-start\",width=\"100%\",height=h))\nz_m=widgets.FloatText(value=25,description = r\"$z_m$\")\nL_z_m = widgets.Label(value='Mixed layer depth ($m$)',layout=widgets.Layout(display=\"flex\", \n                                        justify_content=\"flex-start\",width=\"100%\",height=h))\na=widgets.FloatText(value=0.3,description = r\"$a$\")\nL_a = widgets.Label(value='Fractional mixing',layout=widgets.Layout(display=\"flex\", \n                                        justify_content=\"flex-start\",width=\"100%\",height=h))\nRdeep=widgets.FloatText(value=40.,description = r\"$R_{deep}$\")\nL_Rdeep = widgets.Label(value='Deep nitrogen',layout=widgets.Layout(display=\"flex\", \n                                        justify_content=\"flex-start\",width=\"100%\",height=h))\nui1 = widgets.VBox([n_sizes,min_size,max_size,m])\nui2 = widgets.VBox([a,Rdeep,z_m])\nuiL1 = widgets.VBox([L_n_sizes,L_min_size,L_max_size,L_m])\nuiL2 = widgets.VBox([L_a,L_Rdeep,L_z_m])\n\n\n\n","type":"content","url":"/diatomsizeess#tabular-output","position":7},{"hierarchy":{"lvl1":"üßÆ Size-selection of diatoms in fluctuating environments","lvl2":"Setting up diatom variants and mixed layer characteristics"},"type":"lvl2","url":"/diatomsizeess#setting-up-diatom-variants-and-mixed-layer-characteristics","position":8},{"hierarchy":{"lvl1":"üßÆ Size-selection of diatoms in fluctuating environments","lvl2":"Setting up diatom variants and mixed layer characteristics"},"content":"This part of the notebook lets you set up the ‚Äúscenario‚Äù of diatom variants and mixed layer characteristics.\n\nThe parameters are:\n\nN_{sizes}, the number of diatom variants\n\nS_{min} and S_{max}, the minumum and maximum sizes of the variants (variants will be distributed across this range)\n\nm, the mortality rate due to predation, pathogens, etc., affecting all variants equally\n\nz_m, the depth of the mixed layer; a shallower layer means more loss due to sinking, which disproportionately affects larger cells.\n\na, the fraction (between 0 and 1) of the mixed layer that is replaced in each mixing events. Larger a means more cells are lost, but more nutrients are gained.\n\nR_{deep}, the nutrient concentration in deep water.\n\nIt is a good strategy to start with these default values, to see their results, then modify one of more to see the effects of those changes.\n\nWhen you have the parameters you want, click the Set up population button below to set up the mixed layer.\n\n# Set up textboxes for population characteristics\nisizes=widgets.Text(value='all',description = r\"$i$\")\nL_isizes = widgets.Label(value='Size classes ($S_i$) to seed',layout=widgets.Layout(display=\"flex\", \n                                        justify_content=\"flex-start\",width=\"100%\",height=h))\nNseed=widgets.FloatText(value=1,description = r\"$N_i$\")\nL_Nseed = widgets.Label(value='Number cells to seed',layout=widgets.Layout(display=\"flex\", \n                                        justify_content=\"flex-start\",width=\"100%\",height=h))\nt_mix=widgets.FloatText(value=8.,description = r\"$t_{mix}$\")\nL_t_mix = widgets.Label(value='Mixing interval ($days$)',layout=widgets.Layout(display=\"flex\", \n                                        justify_content=\"flex-start\",width=\"100%\",height=h))\nn_pers=widgets.IntText(value=32,description = r\"$n_{pers}$\")\nL_n_pers = widgets.Label(value='Number of intervals',layout=widgets.Layout(display=\"flex\", \n                                        justify_content=\"flex-start\",width=\"100%\",height=h))\nn_record=widgets.IntText(value=12,description = r\"$n_{record}$\")\nL_n_record = widgets.Label(value='Data per interval',layout=widgets.Layout(display=\"flex\", \n                                        justify_content=\"flex-start\",width=\"100%\",height=h))\nui3 = widgets.VBox([qinit,isizes,Nseed])\nui4 = widgets.VBox([t_mix,n_pers,n_record])\nuiL3 = widgets.VBox([L_qinit,L_isizes,L_Nseed])\nuiL4 = widgets.VBox([L_t_mix,L_n_pers,L_n_record])\n\nuis12 = widgets.HBox([uiL1,ui1,ui2,uiL2])\nuis3 = widgets.HBox([uiL3,ui3])\nuis4 = widgets.HBox([ui4,uiL4])\n\nglobal n_sizes_,min_size_,max_size_,m_,a_,Rdeep_,z_m_\ndef setup_pars(n_sizes,min_size,max_size,m,a,Rdeep,z_m):\n    global n_sizes_,min_size_,max_size_,m_,a_,Rdeep_,z_m_\n    # Put current parameters into global equivalents for later use\n    n_sizes_ = n_sizes\n    min_size_ = min_size\n    max_size_ = max_size\n    m_ = m\n    a_ = a\n    Rdeep_ = Rdeep\n    z_m_ = z_m\n\nout12 = widgets.interactive_output(setup_pars,{'n_sizes':n_sizes,'min_size':min_size,'max_size':max_size,\n                                          'm':m,'a':a,'Rdeep':Rdeep,'z_m':z_m})\ndisplay(uis12,out12)\n\n\n\n\n\n# Set up a new diatoms object, using current parameters\nglobal D\nbuttonD = widgets.Button(\n    value=False,\n    description='Set up population',\n    disabled=False,\n    button_style='', # 'success', 'info', 'warning', 'danger' or ''\n    tooltip='Click to set up a simulation model of a diatom population, using the current parameters.',\n    icon='' # (FontAwesome names without the `fa-` prefix)\n)\noutputD = widgets.Output()\n@outputD.capture()\ndef setup(b):\n    global D, n_sizes_,min_size_,max_size_,m_,a_,Rdeep_,z_m_\n    # Initialize diatoms object\n    D = diatoms(z_m=z_m_,n_sizes=n_sizes_,size_range=[min_size_,max_size_],\n                m=m_,a=a_,Rdeep=Rdeep_,static_v=False)\n    D.setup()\n    print('New diatom population initialized...')\nbuttonD.on_click(setup)\nwidgets.VBox([buttonD,outputD])\n\n\n\n\n\n","type":"content","url":"/diatomsizeess#setting-up-diatom-variants-and-mixed-layer-characteristics","position":9},{"hierarchy":{"lvl1":"üßÆ Size-selection of diatoms in fluctuating environments","lvl2":"Seeding the mixed layer with diatom variants"},"type":"lvl2","url":"/diatomsizeess#seeding-the-mixed-layer-with-diatom-variants","position":10},{"hierarchy":{"lvl1":"üßÆ Size-selection of diatoms in fluctuating environments","lvl2":"Seeding the mixed layer with diatom variants"},"content":"This part of the notebook lets you ‚Äúseed‚Äù diatoms by adding cells into the scenario, as a starting point for simulating population dynamics.\nWhen you set up the mixed layer, the populations of all variants were set to zero.\nUsing these textboxes, you can introduce a starting population of diatoms, either all variants simultaneously or only variants you specify.\n\nThe parameters are:\n\nq_{init}, the initial quota in new diatom cells at the start of the simulation\n\nS_{i}, the size classes of the variants with which to seed the mixed layer.\n\nIf this entry is ‚Äúall‚Äù, then all variants will be seeded\n\nIf this entry is one or more numbers, e.g. ‚Äú1‚Äù or ‚Äú2,6‚Äù then only those size classes will be seeded\n\nN_i, the number of cells to seed into each selected size class.\n\nIt is a good strategy to start with these default values, to see their results, then modify one of more to see the effects of those changes.\n\nWhen you have the parameters you want, click the Seed cell population button below to set up the scenario.\n\n# Generate textboxes for parameters to seed the population\nglobal qinit_,isizes_,Nseed_\ndef seed_pars(qinit,isizes,Nseed):\n    global qinit_,isizes_,Nseed_\n    # Place parameters for seeding cells into global variables for later use.\n    # This is executed on each parameter change.\n    qinit_ = qinit\n    isizes_ = isizes\n    Nseed_ = Nseed\n\nout3 = widgets.interactive_output(seed_pars,{'qinit':qinit,'isizes':isizes,'Nseed':Nseed})\ndisplay(uis3,out3)\n\n\n\n\n\nbuttonS = widgets.Button(\n    value=False,\n    description='Seed cell population',\n    disabled=False,\n    button_style='', # 'success', 'info', 'warning', 'danger' or ''\n    tooltip='Click to add cells to the current population using the current parameters.',\n    icon='' # (FontAwesome names without the `fa-` prefix)\n)\noutputS = widgets.Output()\n@outputS.capture()\ndef seed(b):\n    global D,qint_,isizes_,Nseed_\n    # Seed selected size class(es), using the parameters set in seed_pars.\n    # This is executed only when the button is clicked. \n    # isizes=='all' means all size classes\n    jsizes = eval(isizes_)\n    if isizes_ == 'all':\n        D.seed(qinit=qinit_,N=Nseed_,sizes='all')\n        print(f'Seeded all size classes with {Nseed_} cells per liter')\n    elif isinstance(eval(isizes_),tuple):  # multiple integers entered\n        if any(i >len(D.sizes)-1 for i in eval(isizes_)):\n            print(f'Size class is outside range -- please choose a different size class.')\n            return\n        D.seed(qinit=qinit_,sizes=list(eval(isizes_)),N=Nseed_)\n        print(f'Seeded selected size classes: {isizes_} with {Nseed_} cells per liter')\n    elif isinstance(jsizes,int):   # a single integer entered\n        if jsizes>len(D.sizes)-1:\n            print(f'Size class is outside range -- please choose a different size class.')\n            return\n        #sizes_ = jsizes #[].append(jsizes)\n        D.seed(qinit=qinit_,sizes=jsizes,N=Nseed_)\n        print(f'Seeded selected size classes: {isizes_} with {Nseed_} cells per liter')\n    else:   # none of the above -- ask for new input\n        print(f'Invalid size selection -- please choose a different size class.')\n        return\n    print(f'Current cell populations are {D.Ns}')\nbuttonS.on_click(seed)\nwidgets.VBox([buttonS,outputS])\n\n\n\n\n\n","type":"content","url":"/diatomsizeess#seeding-the-mixed-layer-with-diatom-variants","position":11},{"hierarchy":{"lvl1":"üßÆ Size-selection of diatoms in fluctuating environments","lvl2":"Setting mixing event intervals, and running the simulation"},"type":"lvl2","url":"/diatomsizeess#setting-mixing-event-intervals-and-running-the-simulation","position":12},{"hierarchy":{"lvl1":"üßÆ Size-selection of diatoms in fluctuating environments","lvl2":"Setting mixing event intervals, and running the simulation"},"content":"This part of the notebook lets you specify the interval between mixing events, to see what the effects different intervals have on competition between diatom variants.\n\nImportant: These parameters run the simulation using the existing diatom populations. If you want to start with a ‚Äúblank slate‚Äù, go back and click the Set up population and Seed cell population buttons.\n\nThe parameters are:\n\nt_{mix}, the number of days between mixing events\n\nn_{pers}, the number of mixing periods to simulate\n\nn_{record}, the number of data points to record during each period. If the period plots look unsmooth, try increasing this parameter.\n\nIt is a good strategy to start with these default values, to see their results, then modify one of more to see the effects of those changes.\n\nWhen you have the parameters you want, click the Run simulation button below to simulate the population and plot the results.\n\n# Set up textboxes for simulation parameters\nglobal t_mix_,n_pers_,n_record_\ndef solve_pars(t_mix,n_pers,n_record):\n    global t_mix_,n_pers_,n_record_\n    # Record ODE solving parameters for later use; this is executed each time\n    # a parameter is changed\n    t_mix_ = t_mix\n    n_pers_ = n_pers\n    n_record_ = n_record\n    \nout4 = widgets.interactive_output(solve_pars,{'t_mix':t_mix,'n_pers':n_pers,'n_record':n_record})\ndisplay(uis4,out4)\n\n\n\n\n\n# Set up a button to run simulation with current parameters\nbuttonR = widgets.Button(\n    value=False,\n    description='Run simulation',\n    disabled=False,\n    button_style='', # 'success', 'info', 'warning', 'danger' or ''\n    tooltip='Click to run the simulation from the current state, using the current parameters.',\n    icon='' # (FontAwesome names without the `fa-` prefix)\n)\noutputR = widgets.Output()\n@outputR.capture()\ndef solve(b):\n    global D,t_mix_,n_pers_,n_record_\n    # clear previous output\n    outputR.clear_output()\n    # Seed selected size class(es); isizes==[] means all size classes\n    print('Running simulation...')\n    # Try to close figures, to prevent accumulating too many old copies\n    try:\n        plt.close(fig=D.fig1)\n        plt.close(fig=D.fig2)\n    except:\n        pass\n    D.solveODEs(t_mix=t_mix_,n_pers=n_pers_,n_record=n_record_)\n    print('...done.')\n    # Display output figures\n    D.fig2.show()\n    D.fig1.show()\n    # Save images to files in png and svg formats\n    D.fig1.savefig('period.png')\n    D.fig1.savefig('period.svg')\n    D.fig2.savefig('averaged.png')\n    D.fig2.savefig('averaged.svg')\n    #Image('period.png')\n\nbuttonR.on_click(solve)\nwidgets.VBox([buttonR,outputR])\n\n\n\n\n\n\n\n\n\n\n","type":"content","url":"/diatomsizeess#setting-mixing-event-intervals-and-running-the-simulation","position":13},{"hierarchy":{"lvl1":"üí°Ô∏è Evolutionarily Stable States: Predicting the outcomes of natural selection"},"type":"lvl1","url":"/evolutionarilystablestates","position":0},{"hierarchy":{"lvl1":"üí°Ô∏è Evolutionarily Stable States: Predicting the outcomes of natural selection"},"content":"An \n\nEvolutionarily Stable State, commonly abbreviated as an ESS, is description of the outcome of competition among a set of variants with different traits.\nESS‚Äôs are related to the idea of \n\ncompetitive exclusion, the hypothesis that if two species, or variants of one species compete for the same limiting resource, one will be a better competitor and the other will die off.\n\nAn ESS describes the scenario in which, if one variant (or combination of variants) is initially dominant, no other variants introduced in small numbers can grow.\nThat is, once established, an initial ESS population of variants can exclude ‚Äúinvasion‚Äù by a small number of individuals from any other variant.\n\nFor example, suppose a set of diatoms varying in size are competing for a limiting nutrient that is supplied at a constant rate.\nIf the initial variant is a middle-sized diatom, it will draw the nutrients to the lowest concentration that allows it to grow.\nIf a few larger cells are then introduced, those cells cannot grow because their nutrient uptake is insufficient at the nutrient level set by the established middle-sized cells.\n\nHowever, if a few small cells are introduced, those cells can grow at the nutrient level established by the middle-sized cells.\nThis is because, typically, smaller diatom can grow at lower nutrient concentrations than middle-sized or large diatoms.\nAs they grow, the small cells drive the nutrient levels lower, until the middle-sized cells cannot grow and eventually die off.\n\nIn this case, a population of middle-sized cells is not an ESS, because a population of middle-sized cells can be invaded by smaller cells.\n\nIn contrast, if the initial variant population is small, then those cells drive the nutrient level so low that neither middle-size nor large cells can invade.\nIn this case, the initial population of small cells is an ESS.","type":"content","url":"/evolutionarilystablestates","position":1},{"hierarchy":{"lvl1":"üí°Ô∏è Evolutionarily Stable States: Predicting the outcomes of natural selection","lvl2":"Multiple ESS‚Äôs"},"type":"lvl2","url":"/evolutionarilystablestates#multiple-esss","position":2},{"hierarchy":{"lvl1":"üí°Ô∏è Evolutionarily Stable States: Predicting the outcomes of natural selection","lvl2":"Multiple ESS‚Äôs"},"content":"It‚Äôs important to keep in mind the key distinction between an ESS and the outcome of competition among variants:\n\n\\rightarrow In an ESS, the ‚Äúestablished‚Äù variant is allowed to approach its steady state population, and to shape the environment.\\rightarrow In competition among variants, the environment may be shaped by a variety of internal and external conditions.\n\nIn the diatom example, ‚Äúshaping the environment‚Äù means determining the mixed layer nutrient concentrations.\nIn this example, small cells reduce the nutrient concentration so low that other variants cannot invade.\nScenarios are possible in which a different variant, if allowed to grow by itself, could create conditions in which small cells could not invade.\n\nThis distinction between ESS‚Äôs and the outcome of competition has two important implications:\n\nThe outcome of competition may be, but is not always, an ESS.\n\nThere may be multiple ESS variants under the same external conditions, each of which once established can exclude all other variants.","type":"content","url":"/evolutionarilystablestates#multiple-esss","position":3},{"hierarchy":{"lvl1":"üí°Ô∏è Evolutionarily Stable States: Predicting the outcomes of natural selection","lvl2":"ESS variations"},"type":"lvl2","url":"/evolutionarilystablestates#ess-variations","position":4},{"hierarchy":{"lvl1":"üí°Ô∏è Evolutionarily Stable States: Predicting the outcomes of natural selection","lvl2":"ESS variations"},"content":"Several variations exist in the idea of an Evolutionarily Stable State.\nIn some interpretations, the dominant variant in an ESS must resist invasion only by slightly different variants.\nThis interpretation is based on the idea that viable mutations lead to gradual changes in characteristics.\n\nIn other interpretations, the dominant variant in an ESS must resist invasion by all other variants.\nThis interpretation is based on the idea that viable mutations can cause large changes, or that evolution can follow different paths in separated environments that are subsequently connected.\nUnder this interpretation, more complex scenarios are possible.\nFor example, two or more very different variants can together form an ESS, excluding all other variants.","type":"content","url":"/evolutionarilystablestates#ess-variations","position":5},{"hierarchy":{"lvl1":"üí°Ô∏è Evolutionarily Stable States: Predicting the outcomes of natural selection","lvl2":"Real-world complications"},"type":"lvl2","url":"/evolutionarilystablestates#real-world-complications","position":6},{"hierarchy":{"lvl1":"üí°Ô∏è Evolutionarily Stable States: Predicting the outcomes of natural selection","lvl2":"Real-world complications"},"content":"The simple ESS scenario above has a clear and univesal implication: small diatoms should always exclude middle-sized and large diatoms.\nThis trend is indeed frequently observed in aquatic environments.\nHowever, middle-sized or large diatoms can persist and even dominate some aquatic habitats.\nHow can this be if small diatoms are better competitors?\n\nOne of the useful outcomes of simple models is that they provide clear expectations, and highlight deviations from these expectations that need to be explained.\nMany potentially relevant factors were omitted from the simple ESS scenario above, that may provide advantages to middle-sized and large diatoms.\nThese include:\n\nvariable environments with fluctuating nutrient concentrations (such that storage or ability to survive low-growth intervals are important)\n\nexceptions to the rule about poor growth at low nutrient concentrations\n\nselective grazing or attacks by pathogens on small diatoms\n\ncompetition for multiple limiting nutrients, light or other requirements\n\nbehavioral factors like depth regulation, which may be more effective for larger diatoms\n\nThe expectation that small diatoms should dominate is a motivation to investigate these and other factors that may contribute to the size diversity that actually exists in diatoms.","type":"content","url":"/evolutionarilystablestates#real-world-complications","position":7},{"hierarchy":{"lvl1":"üí°Ô∏è Evolutionarily Stable States: Predicting the outcomes of natural selection","lvl2":"Evolutionarily Stable States and competition in mixed populations"},"type":"lvl2","url":"/evolutionarilystablestates#evolutionarily-stable-states-and-competition-in-mixed-populations","position":8},{"hierarchy":{"lvl1":"üí°Ô∏è Evolutionarily Stable States: Predicting the outcomes of natural selection","lvl2":"Evolutionarily Stable States and competition in mixed populations"},"content":"ESS populations are usually, but not always, the same as the outcome of competition within an initially mixed population.\nDifferences can arise due to the key assumption that the initially dominant population creates the conditions into which other variants must invade.\nIf the ESS variants have not had exclusive use of the environment to create the conditions into other variants must invade, different outcomes are possible.\n\nScenarios are also possible in which multiple ESS‚Äôs exist.\nFor example variant A, when established, can exclude all other variants (including variant B).\nHowever, variant B, when established, can also exclude all other variants (including variant A).\n\nNote that ‚Äúbetter‚Äù in this context is defined as the successful competitor. For example, it could be that species A has faster uptake of high-concentration nutrients but species B has faster uptake of low-concentration nutrients. If the nutrient is limiting, it will be driven down to low concentrations, so species B is ‚Äúbetter‚Äù in competitive terms, even though under other circumstances species A might have higher growth. For example, under predation, both populations might be reduced so that nutrients are not limiting, and species A might predominate.\n\nIn ESS‚Äôs, ‚Äúinvasion‚Äù means that an initially small population of a new variant can grow, in the environment created by the established variant.\n\nThis expectation is based on the allometric analysis in \n\nLitchman et al. (2009), and conforms to conventional wisdom about the surface area:volume ratio advantages of smaller cells over larger cells.","type":"content","url":"/evolutionarilystablestates#evolutionarily-stable-states-and-competition-in-mixed-populations","position":9},{"hierarchy":{"lvl1":"Ô∏èüí°Ô∏è  A ‚Äúquota‚Äù model of diatom demography"},"type":"lvl1","url":"/litchman-etal2009","position":0},{"hierarchy":{"lvl1":"Ô∏èüí°Ô∏è  A ‚Äúquota‚Äù model of diatom demography"},"content":"Litchman et al.'s model of competing diatom variants uses the idea of nutrient ‚Äúquotas‚Äù to understand the allometric differences between large and small diatoms in traits such as growth and nutrient consumption.\nIn this context, ‚Äúgrowth‚Äù refers to cell division ‚Äì that is, growth of the cell population rather than increase in a given cell‚Äôs size.\nIn their model, quotas represent nutrient storage within cells.\nWhen cell take up nutrients, they are placed directly into storage, increasing the cell‚Äôs quota.\nWhen the cell grows or divides, it consumes nutrients from its storage, decreasing its quota.\n\nStorage of nutrients has a consequence that is central to Litchman et al.'s hypothesis about the larger diatoms present in marine compared to freshwater habitats:\n\nCell growth is determined not by the current nutrient concentration in the water, but by the nutrient quota that reflects past nutrient concentrations.\n\nThey hypothesized that  differences in quotas, quantified by the observed allometries in nutrient storage capacity and uptake rates, interact with the fluctuating conditions within mixed layers to favor larger diatoms in marine habitats and smaller diatoms in freshwater habitats.\nSpecifically, they hypothesized that, large diatoms with disproportionately large storage can continue growing under some conditions, when small diatoms have exhausted their quotas and ceased to grow.","type":"content","url":"/litchman-etal2009","position":1},{"hierarchy":{"lvl1":"Ô∏èüí°Ô∏è  A ‚Äúquota‚Äù model of diatom demography","lvl2":"Model rationale"},"type":"lvl2","url":"/litchman-etal2009#model-rationale","position":2},{"hierarchy":{"lvl1":"Ô∏èüí°Ô∏è  A ‚Äúquota‚Äù model of diatom demography","lvl2":"Model rationale"},"content":"The rationale for Litchman et al.‚Äòs model is based on accounting for nutrient concentration in the mixed layer, the numbers of cells of different diatom variants, and those cells‚Äô nutrient quotas.\nThese variants differ in size, and because of allometry also in nutrient storage and uptake rates, growth rates, sinking velocity and many other traits.\n\nThe rate at which the number of cells of a given diatom variant changes \n\nbetween mixing events can be summarized as:\\mathrm{change~in~cell~number} = \\mathrm{growth} - \\mathrm{mortality} - \\mathrm{loss~from~sinking}\n\nStored nutrients, accounted for in the diatom cells‚Äô quotas, are increased by uptake and decrease when nutrients are withdrawn to fuel growth:\\mathrm{change~in~quota} = \\mathrm{nutrient~uptake~rate} - \\mathrm{consumption~for~growth}\n\nFinally, the nutrient concentration within the mixed layer is reduced, between mixing events, when nutrients are taken up by diatoms:\\mathrm{change~in~nutrient~concentration} = -\\mathrm{consumption~by~cells}\n\nIn the model, mixing events are assumed to happen instantaneously.\nThat is, the model assumes there is an interval of diatom population dynamics as described in Equations \n\n(1), \n\n(2) and \n\n(3).\nThen a mixing event happens, during which no growth, mortality or nutrient uptake occurs.\nThen there is another interval of diatom population dynamics as described in Equations \n\n(1), \n\n(2) and \n\n(3), and another mixing event, and so on in a repeating cycle.\n\nAt \n\nmixing events, water is exchanged between the mixed layer and deep water.\nMixed layer water contains diatoms, which are lost when water containing them is moved out of the mixed layer.\nDeep water contains high nutrient concentration, which is added to the mixed layer when deep water moves into the mixed layer.","type":"content","url":"/litchman-etal2009#model-rationale","position":3},{"hierarchy":{"lvl1":"Ô∏èüí°Ô∏è  A ‚Äúquota‚Äù model of diatom demography","lvl2":"Quantifying rates"},"type":"lvl2","url":"/litchman-etal2009#quantifying-rates","position":4},{"hierarchy":{"lvl1":"Ô∏èüí°Ô∏è  A ‚Äúquota‚Äù model of diatom demography","lvl2":"Quantifying rates"},"content":"The development of Litchman et al.'s model is the process of devising mathematical expressions for each of the terms in  Equations \n\n(1), \n\n(2) and \n\n(3).\nThe key logical steps in obtaining these terms are:\n\nThe metric of size is s = \\log_{10}(\\mathrm{Cell~Volume}) where Cell Volume is in \\mu m^3.\n\nA cell‚Äôs quota, Q_i, increases due to nutrient uptake and decreases when nutrient is used for growth.\n\nThe rate at which nutrient uptake depends on nutrient concentration, R, is a \n\nMichaelis-Menton function,\\mathrm{nutrient~ uptake~rate} =  C_1 \\frac{R}{R+K_i}\n\nIn Equation \n\n(4), the coefficient of proportionality C_1 for a cell of size s_i is a linear function of the quota, Q_i, expressed relative to the cell‚Äôs minimum quota, Q_{min,i} and maximum quota, Q_{max,i}:C_1 = C_2 - C_3\\frac{Q_i-Q_{min,i}}{Q_{max,i}-Q_{min,i}}\n\nIn Equation \n\n(5), the coefficients C_2 and C_3 are constants,C_2 = V^{hi}_{max.i} \\\\\nC_3 = \\left(V^{hi}_{max.i} - V^{lo}_{max.i}  \\right)\n\nIn Equation \n\n(6), C_2 is the maximum rate of nutrient uptake, which occurs when the quota is low.\nC_3 is the rate at which nutrient uptake decreases at higher quotas.\nBecause C_2=C_3 when the cell quota is Q_i = Q_{max,i}, the cell‚Äôs nutrient uptake rate approaches zero as its quota approach its maximimum capacity, Q_{max,i}.\n\nDecrease in a cell‚Äôs quota due to growth is determined by its maximum growth rate, \\mu_i, and its quota Q_i relative to its minimum quota, Q_{min,i}: \\mathrm{consumption~for~growth} = \\mu_i\\left(1-\\frac{Q_{min,i}}{Q_i} \\right)\n\nMixing events replace a fraction a of mixed layer water with deep water. That implies that, after the mixing events, the diatom population of each variant i is decreased, while the nutrient level R is increased: N_{i,\\mathrm{after~mixing}}  = (1-a)~N_{i,\\mathrm{before~mixing}} \\\\\n R_\\mathrm{after~mixing}  = (1-a) R_\\mathrm{before~mixing} + a~R_\\mathrm{deep}\n\nThese expressions are substituted into Equations \n\n(1), \n\n(2) and \n\n(3) to formulate a mathematical model that can be simulated on a computer.","type":"content","url":"/litchman-etal2009#quantifying-rates","position":5},{"hierarchy":{"lvl1":"Ô∏èüí°Ô∏è  A ‚Äúquota‚Äù model of diatom demography","lvl2":"Model formulation"},"type":"lvl2","url":"/litchman-etal2009#model-formulation","position":6},{"hierarchy":{"lvl1":"Ô∏èüí°Ô∏è  A ‚Äúquota‚Äù model of diatom demography","lvl2":"Model formulation"},"content":"The model that results is in the form of a \n\nordinary differential equations, or ODEs, which means that it tracks diatom populations, cell quotas and nutrient concentration as they vary continuously over time between mixing events.\nThe familiar \n\nLotka-Volterra and \n\nlogistic population models are also ODE models.\n\nAfter substituting each of the mathematical expressions in \n\n(4)-\n\n(7), the quantitative expression of Equations \n\n(1), \n\n(2) and \n\n(3) for diatom populatin dynamics between mixing events is:\\frac{dQ_i}{dt} = \\left(V^{hi}_{max.i} - \\left(V^{hi}_{max.i} - V^{lo}_{max.i}  \\right) \\frac{Q_i-Q_{min,i}}{Q_{max,i}-Q_{min,i}} \\right) \\frac{R}{R+K_i} - \\mu_i\\left(1-\\frac{Q_{min,i}}{Q_i} \\right)\\frac{dN_i}{dt} = \\mu_i\\left(1-\\frac{Q_{min,i}}{Q_i} \\right) N_i - m N_i - \\frac{v_i}{z_m} N_i\\frac{dR}{dt} = - \\sum_i \\left(V^{hi}_{max.i} - \\left(V^{hi}_{max.i} - V^{lo}_{max.i}  \\right) \\frac{Q_i-Q_{min,i}}{Q_{max,i}-Q_{min,i}} \\right) \\frac{R}{R+K_i} N_i\n\nEquation \n\n(8) quantifies the effects of a mixing event.\n\nLitchman et al. modeled both nitrogen (nitrate) limitation and phosphorus limitation, but here we focus only on nitrogen.","type":"content","url":"/litchman-etal2009#model-formulation","position":7},{"hierarchy":{"lvl1":"üìñÔ∏è Why are diatoms larger in marine than freshwater habitats?"},"type":"lvl1","url":"/marinefreshdiatoms","position":0},{"hierarchy":{"lvl1":"üìñÔ∏è Why are diatoms larger in marine than freshwater habitats?"},"content":"Allometry is the study of how organismal traits vary with organism size.\nAmong aquatic organisms, size is associated with variations in numerous other traits and processes, across all of the organizational scales relevant to Organismal Biology.\nExamples include physiological traits such as respiration and nutrient uptake rates, organism-level traits such as intrinsic rate of growth and fecundity, behavioral traits such as locomotion and sensing, population-level traits such as reproduction and mortality rates, and ecological traits such as trophic interactions and carbon sequestration.\n\n\nAllometry is a useful tool for understanding linkages between these and many other characteristics of aquatic organisms.\n\nDiatoms are a large group of single-celled algae inhabiting aquatic environments world-wide.\nDiatoms are diverse, with about 12,000 known species.\nAcross this diversity, diatoms encompass a wide range of sizes (2-2000 \\mu m), and morphologies with numerous \n\nbeautiful and interesting features.\nMany of these features, such as pores and spines, likely serve functional roles in nutrient acquisition, predator defence and depth regulation.\n\nDiatoms are abundant, and are estimated to produce 20-50% of new oxygen generated worldwide each year.\nDiatoms are major contributors to primary production, are important consumers of dissolved nutrients and have strong trophic interactions with zooplankton grazers, heterotrophic protists and aquatic pathogens.\n\n\n\nFigure¬†1:Images from \n\nWikipedia of frustules from four species of diatoms (scale bar = 10 micrometres in a, c and d and 20 micrometres in b).\n\nDiatoms are encased in hard silica shells called \n\nfrustules (\n\nFigure¬†1).\nDue in part to the weigh of these frustules, diatom cells can sink relatively rapidly.\nThis makes diatoms significant contributors to sequestration into deep water of carbon fixed by photosynthesis in surface layers.\n\nIn 2009, \n\nLitchman et al. published a survey of diatom size distributions across a number of marine and freshwater habitats.\nThey found that, though there is a large diversity of sizes in all habitats, the diatom size distribution in marine habitats is consistently larger than the size distribution in freshwater habitats.\nLitchman et al. asked,\n\nWhy does a disparity in size distributions exist between marine and freshwater habitats?\n\nLitchman et al. noted that diatoms follow the usual allometries for nutrient uptake and growth:\nSmaller cells have, relative to metabolic demands, faster uptake of nutrients such as nitrogen and phosphorus. Smaller cells also have better ability to absorb very dilute nutrients.\nFurthermore, smaller cells have faster reproductive rates when replete with nutrients than larger cells.\nEach of these factors favor smaller cells, raising an even more fundamental question,\n\nWhy do large diatoms exist, when small ones have advantages in both nutrient uptake and maximum growth rate?\n\nA hypothezed factor frequently cited as favoring large cells is size-specific predation: the idea that smaller cells have a higher risk of predation, or of infection by pathogens, than larger cells.\nLarger cells would then be maintained not because they can grow faster but because they suffer lower predator- or pathogen-induced mortality rates than small cells.\nThis type of regulation of a population by higher trophic levels is called \n\ntop-down control.\n\nLitchman et al. hypothesized that additional answers to both of these questions are found in \n\nbottom-up control, modulated by the phenomena in oceans and lakes called \n\nMixed layers.\n\nIn Organismal Biology, the term aquatic is usually interpreted as referring to a water habitat that may be either marine (saltwater) or freshwater.\n\nEstimates of the number of species ranging from 20,000 to as high as 200,000.","type":"content","url":"/marinefreshdiatoms","position":1},{"hierarchy":{"lvl1":"üìñÔ∏è  Diatoms and mixed layers"},"type":"lvl1","url":"/mixedlayers","position":0},{"hierarchy":{"lvl1":"üìñÔ∏è  Diatoms and mixed layers"},"content":"Most aquatic environments are vertically stratified some or all of the time, meaning that there is vertical variation in water properties such as temperature and salinity.\nTypically, surface waters tend (at least seasonally) to be higher temperature (e.g., because they are warmed by the sun or warm air).\nIn marine environments, surface layers also often have lower salinity than deeper waters (in coastal regions, this can result from river inflows).\nThis variation, in which  water in surface layers is less dense than water in deeper layers, is known as stable stratification.\n\nIn the absence of a mechanism to energetically stir water in a stably stratified water column, lighter near-surface water will remain near-surface indefinitely, and denser deep water will stay deep.\nThe primary stirring mechanism in many oceanic and lake environments is wind, which causes waves, currents and tubulence in surface waters.\nStirring from wind typically overcomes stratification near the surface.\nHowever, it usually penetrates only partway into a water column.\n\nWithin this near-surface zone of penetration, wind-induced turbulence mixes water so that temperature and salinity are relatively uniform.\nThis zone is called the \n\nmixed layer.\nWithin the mixed layer, stratification has been lost, so that cells or nutrients at one level within the mixed layer can easily be transported by turbulence to another level within the mixed layer.\n\nHowever, there remains a density difference between water in the mixed layer and deeper water.\nThat means it takes substantial extra energy to mix lighter mixed layer water with denser water from below the mixed layer.\nThis extra energy is supplied only episodically, by events such as storms and internal waves.\n\nLike phytoplankton in general, diatoms typically inhabit the mixed layer within aquatic environments, where there is sunlight to fuel photosynthesis.\nBecause they are in low-density surface water, they may be moved within the mixed layer but are rarely carried below it into deep, unlit water.\n\nAs these cells grow and reproduce, they consume the nutrients in the mixed layer.\nOnce nutrients are depleted, they can be replaced only by mixing events, such as storms, that replace some of the nutrient-depleted surface water with nutrient-rich deep water.\n\nConcurrently, some near-surface water is moved deeper, below the mixed layer.\nDiatoms and other phytoplankton cells in that water are then typically lost into deep water, where they are unable to photosynthesize and eventually die or are eaten.\n\nThe net effect of a mixing event, then, is a partial loss of the diatom population (namely, those cells in the mixed layer water that is lost to deep water) and, simultaneously, a partial replenishment of nutrients in the mixed mixed layer that can support new growth (contained in the formerly nutrient-rich deep water now part of the mixed layer).","type":"content","url":"/mixedlayers","position":1},{"hierarchy":{"lvl1":"üõº Understanding the model interface"},"type":"lvl1","url":"/modelinterface","position":0},{"hierarchy":{"lvl1":"üõº Understanding the model interface"},"content":"The first Activity is getting familiar with how to simulate diatom population dynamics using the model.","type":"content","url":"/modelinterface","position":1},{"hierarchy":{"lvl1":"üõº Understanding the model interface","lvl2":"Running the model"},"type":"lvl2","url":"/modelinterface#running-the-model","position":2},{"hierarchy":{"lvl1":"üõº Understanding the model interface","lvl2":"Running the model"},"content":"To execute a simulation, follow these steps:\n\nOpen an executable version of the \n\nnotebook in Binder.\n\nSelect Run all cells under the Run menu. This sets up the graphical interface for the model.\n\nScroll down to the section labeled Setting up diatom variants and mixed layer characteristics.\nThe textboxes enable you to change the number and size of diatom classes, and the mixed layer characteristics.\nLeave these as the defaults for now, and click on the Set up population button.\n\nScroll down to the section labeled Seeding the mixed layer with diatom variants.\nThese textboxes enable you to add populations of some or all diatom size classes.\nTo seed the cells into the population using the default parameters, click on the Seed cell population button.\n\nSeeding cells is additive, meaning that if you click the button twice, it will add twice the selected cell populations.\n\nScroll down to the section labeled Setting mixing event intervals, and running the simulation.\nThese textboxes enable you to set the number of days between mixing events, the number of mixing intervals to run the simulation, and how many times to record data between mixing events.\n\nTo run the simulation with the default parameters, click on the Run simulation button.\n\nExamine the textual and graphical output.\nIn particular, look at:\n\nThe table of Period-averaged statistics: standing stocks in the textual output.\n\nThis table summarizes the number N, quota \\frac{Q}{Q_{min}}, and biovolume BV of each diatom size class i over the last simulated mixing interval.\nBelow the table are the total averaged biovolume of all the diatom size classes, and the total averaged nutrient concentration, in the final mixing interval.\n\nThe Period-Averaged Time Series (Figure 2) in the graphical output.\nThe plots in this figure show the period-averaged quotas and biovolume for each diatom size class, and the mixed layer nutrient concentration.\nNote that the vertical axis in the biovolume plot uses a log scale.\nThat means one major grid tick represents a factor of 10 in cell numbers.\n\nIn the Period-Averaged Biovolume plot, it is clear that populations of some size classes are still increasing while others are still decreasing.\nTo get a better sense of the ultimate periodic pattern, again click on the Run simulation button to restart the simulation from where it left off.\n\nLook again at the Period-Averaged Time Series (Figure 2).\nThis time, the Period-Averaged Biovolume plot shows that cell populations are more nearly constant, when averaged across a mixing interval.\n\nHowever, the smallest diatoms (s=2.5) are still slowly increasing, while the second smallest diatoms (s=3.93) are slowly decreasing, such that the dominant strain appears to be changing.\n\nFor a third time, click on the Run simulation button to restart the simulation from where it left off.\n\nThis time, it is clear that the smallest diatoms (s=2.5) are going to be the dominant variant, and outcompete diatoms in the other size classes.\nThis also means that the  1-Period Time Series (Figure 1) plots reflect a recurring, periodic pattern.\n\nRepeat steps 1-8, but this time change the ‚Äúall‚Äù to ‚Äú3,5‚Äù in the Size classes (S_i) to seed textbox in the  Seeding the mixed layer with diatom variants section.\nWhen you run the simulation this time, only size classes 3 and 5 are present in the diatom population.","type":"content","url":"/modelinterface#running-the-model","position":3},{"hierarchy":{"lvl1":"üõº Understanding the model interface","lvl2":"Setting up a model investigation"},"type":"lvl2","url":"/modelinterface#setting-up-a-model-investigation","position":4},{"hierarchy":{"lvl1":"üõº Understanding the model interface","lvl2":"Setting up a model investigation"},"content":"Your task in these Activities is to undertake a ‚Äúmini-study‚Äù, in which you use a systematic series of model runs to expose trends, which you then interpret in terms of the motivating questions and hypothesis tests.\n\nIn addressing the questions prompted by the Activities, it is helpful to keep these points in mind:","type":"content","url":"/modelinterface#setting-up-a-model-investigation","position":5},{"hierarchy":{"lvl1":"üõº Understanding the model interface","lvl3":"The model should be run for many mixing periods","lvl2":"Setting up a model investigation"},"type":"lvl3","url":"/modelinterface#the-model-should-be-run-for-many-mixing-periods","position":6},{"hierarchy":{"lvl1":"üõº Understanding the model interface","lvl3":"The model should be run for many mixing periods","lvl2":"Setting up a model investigation"},"content":"As in many models, Litchman et al.'s model starts with potentially unrealistic initial conditions.\nThat is, we do not know ahead of time what a reasonable starting population is for a given size class of diatoms.\n\nThe model is informative because the long-term model results are independent of many aspects of the initial conditions.\nFor example, whether the initial population of diatoms is 1 or 10, in the long run the initial population is typically ‚Äúforgotten‚Äù as the population settles into a periodic pattern timed by the mixing interval.\n\nThis means you have to run the model for a sufficiently long time to be periodic.\nThe model interface makes it easy to do this, because you can see from the \n\nperiod-averaged plots whether the long term trend has approached a ‚Äústeady state‚Äù in which some size class populations are constant and others absent or steadily decreasing.\nIf it hasn‚Äôt, you can simply click the Run simulation button to continue the simulation as long as necessary.","type":"content","url":"/modelinterface#the-model-should-be-run-for-many-mixing-periods","position":7},{"hierarchy":{"lvl1":"üõº Understanding the model interface","lvl3":"Plan a hypothesis test","lvl2":"Setting up a model investigation"},"type":"lvl3","url":"/modelinterface#plan-a-hypothesis-test","position":8},{"hierarchy":{"lvl1":"üõº Understanding the model interface","lvl3":"Plan a hypothesis test","lvl2":"Setting up a model investigation"},"content":"Model results are most informative when you systematically vary one or two parameters, with a specific motivating question to answer or hypothesis to test.\n\nFor this model, a motivating question can be something like,\n\nDoes mixed layer depth have an effect on diatom cell numbers?\n\nA series of runs to answer that question might leave all parameters and initial conditions constant, but vary the mixed layer depth parameter z_m over the largest range you think may be relevant to aquatic habitats.\nBecause you varied only the z_m parameter, any changes in the results must be due to that parameter.\nTo see whether this result holds true generally, you could try another set of parameters, and hold those constant while you vary z_m.\n\nA hypothesis for this model might be something like,\n\nMixing interval determines the size of the dominant diatoms.\n\nAn implication of this hypothesis is that changing the mixing interval t_{mix}, while holding the other parameters constant, leads to different dominant strains.\nA systematic series of simulations in which you vary only t_{mix} is therefore a test of this hypothesis.","type":"content","url":"/modelinterface#plan-a-hypothesis-test","position":9},{"hierarchy":{"lvl1":"üõº Understanding the model interface","lvl3":"Envision a plot","lvl2":"Setting up a model investigation"},"type":"lvl3","url":"/modelinterface#envision-a-plot","position":10},{"hierarchy":{"lvl1":"üõº Understanding the model interface","lvl3":"Envision a plot","lvl2":"Setting up a model investigation"},"content":"While it can be useful to do an initial exploration of parameter space with haphazard changes in parameters, it is usually difficult to detect clear patterns in the results of these changes, and even harder to communicate them to another scientist.\nThe most effective approach is to envision a hypothetical plot of data that would address a specific hypothesis or question.\nAs you design your modeling approach, ask yourself:\n\nWhat would a plot look like that convinces me that this hypothesis is true or false?\n\nWith the answer to that question, you can design the systematic series of model runs to generate data for that plot.\n\nWe are familiar with this approach for empirical data.\nFor example, Litchman et al. hypothesized that marine diatom size distributions are larger than freshwater diatom size distributions.\nThey envisioned a plot of their empirical data (their Figure 1) that would effectively test this hypotheses by showing the size distributions of several examples from each habitat type.\nIf the plot showed a systematic difference between the two types of habitat (it did) that would be compelling evidence in support of the hypothesis.\nA plot that showed no systematic difference across the two habitat types would contradict their hypothesis.\n\nThough it is less familiar, the same approach is informative with simulation results.\nFor example, Litchman et al. hypothesized that the interval between mixing events affected the stable diatom size distribution so as to favor larger diatoms than expected in mixed layers without mixing events.\nTo test this hypothesis, Litchman et al. envisioned a graph of the sizes of dominant diatom variants, across systematic variation in the interval between mixing events.\nThey conducted a series of simulations to obtain the data to make this plot, and used it to show support for their hypothesis.\n\nNote that the coordinates of the cursor are shown at the bottom of the figure, so you can read the actual numbers off data in the plots.\n\nThis is not always the case. For example, if the starting population of a given size class is 0, it will always be 0.","type":"content","url":"/modelinterface#envision-a-plot","position":11},{"hierarchy":{"lvl1":""},"type":"lvl1","url":"/cholera4b","position":0},{"hierarchy":{"lvl1":""},"content":"import numpy as np\nimport matplotlib.pyplot as plt\nfrom math import pi, cos, sin, erfc\nplot_prefix = \"Cholera_plot%d\" % (int(10000.*np.random.uniform()))\nglobal nyears_,beta_t_\n\nplt.ion()\n\n\n\n#def _(nyears = input_box(default=30, label = 'Number of years, $n_{years}$'),\n#      season = input_box(default=1., label = 'Seasonal variability, $c$'),\n#      climate = input_box(default=1.5, label = 'Climatic variability, $b$'),\n#      show_season=checkbox(default=True,label = \"Show seasonal transmission\"),\n#      show_climate=checkbox(default=True,label = \"Show climatic transmission\")):\n\ndef plot_transmission(nyears = 3,season = 1.,climate=1.5,verbose=False):\n    global nyears_,beta_t_\n    # We actually calculate in months... \n    nyears_=nyears\n    nmonths=12*nyears\n    \n    # Temporally varying transmission rate\n    beta_season=[1.+season*q*(0.1e1-cos(pi*q/0.3e1))/0.8e1 for q in np.arange(1,13)]\n    beta_season.reverse()\n    #beta_season= [1.+q*(0.1e1-cos(fpi*q/0.3e1))/0.2e1 for q in np.arange(1,13)]\n    for i in range(12):\n        beta_season[i]=beta_season[i]/beta_season[-1]\n\n    #b0=10.\n    climate=max(climate,0.)\n    beta_long_term=[q for q in np.linspace(1.5,climate,round(nmonths/2))]\n    beta_long_term.extend([q for q in np.linspace(climate,1.5,round(nmonths/2))])\n    beta_t=[beta_long_term[i]*beta_season[i % 11] for i in range(nmonths)]\n    beta_t_=beta_t\n\n    if verbose:\n        print('beta_season = ',beta_season)\n        print('beta_long_term = ',beta_long_term)\n        print('beta_t = ',beta_t)\n        \n    # create figure and subpolts\n    fig=plt.figure()  #figsize=(20,12))\n    # plot seasonal variation in transmission\n    ax1=fig.add_subplot(311)\n    ax1.plot(np.arange(1,13),beta_season,'r-',label='Seasonal Trans. rate, $\\\\beta_{season}$')\n    #ax1.set_xlabel(r'Months')\n    ax1.set_ylabel(r'$\\beta_{season}$')\n    \n    ax2=fig.add_subplot(312)\n    ax2.plot(beta_long_term,'b-',label='Climatic Trans. rate,$\\\\beta_{climate}$')\n    #ax2.set_xlabel(r'Months')\n    ax2.set_ylabel(r'$\\beta_{climate}$')\n\n    ax3=fig.add_subplot(313)\n    ax3.plot(range(nmonths),beta_t,'k-',label='Total Trans. rate, $\\\\beta_t$')\n    ax3.set_xlabel(r'Months')\n    ax3.set_ylabel(r'$\\beta_{t}$')\n    #show(trans_plot,gridlines=True)\n\n\n\nplot_transmission(nyears=10,climate=5)\n\n\n\n#def _(Nint = input_box(default=200000, label = 'Population, $N$'),\n#      alpha = input_box(default=.57, label='$\\\\alpha$'),\n#      gamma_ = input_box(default=1., label='$\\gamma$'),\n#      epsilon = slider(0.,1.,0.025,0.,label='Noise'),\n#      #epsilon = slider(0.,1.,0.025,0.995,label='Noise'),\n#      Iinit_frac = input_box(default=.0001, label='Init. fraction infected'),\n#      asymptom = input_box(default=25, label='Asymptomatic ratio, $A$'),\n#      t_immunity = input_box(default=12, label='$t_{immunity}$ (mos.)'),\n#      frac_vacc = slider(0.,1.,0.025,0.,label='$f_{vaccinated}$'),\n#      show_legend=checkbox(default=True,label = \"Show legends\"),\n#      show_immunity=checkbox(default=True,label = \"Show immunity\")):\n    \ndef plot_caseload(Nint=200000,alpha=.57,gamma_=1.,epsilon = 0.,Iinit_frac=.0001,\n                  asymptom=25,t_immunity=12,frac_vacc=0.,\n                  show_legend=True,show_immunity=True):\n    global nyears_,beta_t_\n    nyears=nyears_\n    beta_t=beta_t_\n    # We actually calculate in months... \n    nmonths=12*nyears\n    # We want population as a float\n    N=float(Nint)\n    \n    # Noise\n    eps_t=1.+np.random.uniform(low=-epsilon, high=epsilon, size=nmonths)\n    #eps_t=1.-epsilon*2.*epsilon*np.random.uniform(low=0.0, high=1.0, size=nmonths)\n\n\n    #  kappa contains the fractional loss of immunity\n    #t_immunity=12 # Period over which immunity declines (in months)\n    #kappa=[asymptom*q for q in np.linspace(1.,0.,t_immunity)]\n    kappa=[asymptom*0.5*(erfc(q)+0.) for q in np.linspace(-2.,2.,t_immunity)]\n\n    #  Create arrays to hold population categories\n    S=[0. for i in range(nmonths)]\n    I=[0. for i in range(nmonths+1)]\n    R=[0. for i in range(nmonths)]\n    years=[q/12. for q in np.arange(nmonths)]\n\n    #  Initial conditions\n    I[0]=Iinit_frac*N  #  Initial infecteds\n    S[0]=(1.-frac_vacc)*(N-I[0])  #  Initial susceptibles\n    R[0]=0.  # Initial resistants\n\n    for t in range(1,nmonths):\n    #for t in range(0,nmonths):\n        # Calculate the corresponding months\n        t_past=[q for q in range(t-t_immunity,t-1) if q>0]\n        #kappa_I=[I[tt]*kappa[t-tt] for tt in t_past]\n        #print t,t_past,[t-tt-1 for tt in t_past]\n        sum_kappa_I=sum([I[tt]*kappa[t-tt-1] for tt in t_past])\n        S[t]=(1.-frac_vacc)*(N-sum_kappa_I)\n        #S[t]=N-sum_kappa_I\n        R[t]=N-S[t]\n        I[t]=beta_t[t]*I[t-1]**alpha*(S[t]/N)**gamma_*eps_t[t]\n        #print t,sum_kappa_I\n\n    #==============================================================\n    #  Use pyplot to create a plot with dual y axes -- code modified from http://ask.sagemath.org/question/1000/two-y-axes\n    #\n    fig2 = plt.figure()\n    # Create the first Y-axis on the left by default and\n    # plot the first curve associated to the left Y-axis\n    ax3 = fig2.add_subplot(111)\n    ln3 = ax3.plot(years,I[0:-1], '-', color='red',label='Infected, $I(t)$')\n    ax3.set_ylabel('# Individuals', color='black')\n    #ax1.set_ylabel(ylabel='\\# Individuals', color='black')\n    #ax1.set_ylabel(ylabel='\\# Individuals', color='red')\n\n    # Paint the tick labels on the left Y-axis in red \n    # to match the color of a curve\n    for tl in ax3.get_yticklabels():\n        tl.set_color('red')\n\n    # Create the second Y-axis on the right and\n    # plot the second curve associated to the right Y-axis\n    ax4 = ax3.twinx()\n    ln4 = ax4.plot(years,S, '-', color='blue',label='Susceptible, $S(t)$')\n    ax4.set_ylim([0,N])\n    #ax2.set_ylabel(ylabel='\\# Individuals', color='blue')\n\n    # Paint the tick labels on the left Y-axis in blue \n    # to match the color of a curve\n    for tl in ax4.get_yticklabels():\n        tl.set_color('blue')\n\n    # Create the vertical and horizontal grid lines\n    ax3.xaxis.grid(color='grey', linestyle='--', linewidth=0.5)\n    ax3.yaxis.grid(color='grey', linestyle='--', linewidth=0.5)\n    #ax3.legend(handles=[ln3,ln4])\n    ax3.legend(loc=(0.0625,0.75))\n    ax4.legend(loc=(0.65,0.75))\n    #ax4.legend(loc=2)\n    \n    # Set range in time\n    plt.xlim([0.,nyears])\n    plt.xlabel('Year')\n    #if show_legend is True:\n     #   # Create a combined legend\n     #   lns=ln1+ln2\n     #   labs=[l.get_label() for l in lns]\n     #   ax3.legend(lns, labs, loc=0)\n\n    # Save the figure (to see it in Sage)\n    #plt.savefig(plot_prefix+'_comb.png')\n    #fig.show()\n\n    #show(I_plot+S_plot+R_plot)\n    fig3 = plt.figure()\n    ax5 = fig3.add_subplot(111)\n    ax5.plot(kappa,'-',label='Immunity after $i$ mos., $\\kappa_{i}$')\n    ax5.set_xlabel(r'Months')\n    ax5.set_ylabel(r'$\\kappa_{i}$')\n        #show(imm_plot,gridlines=True)\n    # Some textual output\n    print('Total number of cholera cases =',sum(I))\n    print('Average monthly cholera cases =',sum(I)/len(I)) #mean(I))\n    print('Average fraction of population that is susceptible =',sum(S)/(len(S)*N)) #mean(S)/N)\n    #print('Average transmission rate =',mean([beta_t))\n    print('Average transmission rate =',np.mean([beta_t[t]*eps_t[t] for t in range(1,nmonths)]))\n\n\n\nplot_caseload()\n\n\n\n\n\n","type":"content","url":"/cholera4b","position":1},{"hierarchy":{"lvl1":"üìñ Modes of cloning"},"type":"lvl1","url":"/cloningmodes","position":0},{"hierarchy":{"lvl1":"üìñ Modes of cloning"},"content":"Across species, cloning occurs in different forms.\nIn echinoderms, which represent many of the reported observations of cloning, there are at least two distinct modes of cloning:\n\nThe echinoid mode of cloning\nIn the cloning mode most commonly observed in echinoids \n\nsea urchins, larvae bifurcate during development, partway into their larval duration and prior to reaching competence.\nEach of these clones can either redifferentiate into a complete, smaller larva, or resume growth to reform the lost body parts.\nWhether it redifferentiates or regrows lost parts, each clone has to grow back to a size and developmental stage at which it is competent.\n\nThe model can simulate characteristics of two distinct modes of cloning, exemplified by cloning typically found in Echinoids and Ophiuroids:\n\nIn the Echinoid mode of cloning, larvae grow and develop to a threshold size smaller than the size at metamorphosis.\nAt this threshold size, some fraction of individuals clone to form two smaller daughters.\nThese clones resume growth, and have one of three outcomes:\n\nThey can remain as larvae until fully grown, and then proceed to metamorphosis.\n\nThey proceed to metamorphosis before being fully grown, becoming smaller juveniles.\n\nThey can remain as larvae, and clone again when they reach a threshold size.\n\nIn the Ophiuroid mode of cloning, larvae grow past the point of competence.\nThese larger larvae then divide into two clones, one of which retains the size and stage needed for competence.\nThis clone metamorphoses immediately.\nThe other, smaller clone then resumes development, repeating growth and either metamorphosing directly or cloning again to form a metamorph and yet another small clone.\n\nThe clone_modelND model is a simulation of these two cloning stratagies, implemented as a \n\nJupyter notebook.","type":"content","url":"/cloningmodes","position":1},{"hierarchy":{"lvl1":"üìñ Cloning in marine invertebrate larvae"},"type":"lvl1","url":"/larvalcloning","position":0},{"hierarchy":{"lvl1":"üìñ Cloning in marine invertebrate larvae"},"content":"In ‚Äúnormal‚Äù development (without cloning), a cohort of marine invertebrate larvae always decreases in population due to mortality.\nThis is because there is no mechanism for adding new larvae to the cohort.\nAssuming there is always a non-zero amount of mortality, the larval population must decrease.\n\nThe term competence is used by Larval Biologists to refer to a larva that has developed to a stage and size that makes them capable of metamorphosisis.\nThe term \n\nlarval duration refers to the time required for larvae to reach competence.\nThe ultimate \n\nrecruitment ‚Äì that is, the fraction of larvae surviving to  successfully metamorphose and join the post-larval population ‚Äì is then determined by the impacts of the larval mortality rate, acting over the larval duration.\n\nRecently, it has become clear that the larvae of a number of marine invertebrates can \n\nclone, either intrinsically or in response to environmental cues such as chemical stressors or predators.\nIn a cloning species, one larva can divide into two or more genetically identical ‚Äúdaughter‚Äù larvae.\nThis means that, in cloning larvae, the number of larvae in a cohort can either increase or decrease at any given time during development.\n\nWhile cloning produces two larvae out of one, it does not provide any additional tissue or nutritional resources to those larvae.\nThis means a larva that clones produces two daughter larvae which are smaller.\nIn most cases it is not known what the metabolic losses of cloning are, as the daughter larvae divide resources from the original larva.\nIf cloning itself is not too metabolically costly, then a reasonable baseline approximation is that the resources of two daughters produced by cloning add up approximately to the resources of the original larva.\n\nWhile cloning has an obvious benefit in terms of larval numbers, it also has costs.\nThose costs may include disruptions to key larval functions such as swimming or feeding, as a clone redevelops a complete larval morphology.\nFor example, if either or both clones are initially formed without a functional stomach, feeding is impossible until one is developed.\nSmaller larvae may experience higher mortality rates, e.g., due to predation (though lower mortality rates are also possible).\nMany  larvae also feed and grow in proportion to their body mass.\nThis means two small larvae feed and grow less than a single large one with equal total body mass.\n\nOther costs may stem from delays to metamorphosis.\nClones likely have a longer larval duration than the original larva, because they are smaller and may have disrupted development.\nDuring this extended larval duration, larvae face predators, pathogens, transport away from favorable habitats, and other risks.\n\nBecause there are relatively few quantitative observations of cloning in marine invertebrate larvae, especially under natural conditions, there is currently little empirical evidence whether or not cloning has important demographic effects on marine invertebrate populations, and if so whether the benefits of cloning outweigh the costs.\n\nSome larvae may also shed parts of their bodies, which are not subsequently capable of developing into adults. This is a form of tissue loss, as distinct from the types of cloning that we consider here.","type":"content","url":"/larvalcloning","position":1},{"hierarchy":{"lvl1":"üßÆ Modeling the demographic implications of cloning in marine invertebrate larvae"},"type":"lvl1","url":"/larvalcloningmodel","position":0},{"hierarchy":{"lvl1":"üßÆ Modeling the demographic implications of cloning in marine invertebrate larvae"},"content":"This is a graphical interface for using the clone_modelND (for Non-Dimensional) model of \n\ncloning in marine invertebrate larvae. The clone_modelND model calculates the size distribution of a cohort of marine invertebrate larvae over time. This cohort represents a group of larvae beginning development at the same time and at the same size. For example, the cohort could represent larvae from the eggs of a single mother, or larvae from the eggs of a local population of mothers that spawn synchronously at a given time and place.\n\nLike most larval life history models in the literature, size is assumed in the clone_modelND model to be a proxy for developmental state. This means that the model does not represent developmental state directly. Instead, it assumes that developmental state is closely coupled to size. For example, a larva is assumed to be competent to settle when it reaches a specific size. This approach means that the model does not exactly describe many details of morphology and life history associated with any given species. However, the more general results of this modeling approach may approximately describe a great many different species.\n\nThe model implemented through this notebook can simulate characteristics of \n\ntwo distinct modes of cloning, exemplified by cloning typically found in Echinoids and Ophiuroids\nIn addition, the clone_modelND model is capable of modeling many scenarios, such as fluctuating environments or multiple potential cloning or metamorphosis sizes, that are not implemented through this Jupyter NoteBook interface. These can be accessed by running the model directly from Python.\n\n","type":"content","url":"/larvalcloningmodel","position":1},{"hierarchy":{"lvl1":"üßÆ Modeling the demographic implications of cloning in marine invertebrate larvae","lvl2":"Model structure and parameters"},"type":"lvl2","url":"/larvalcloningmodel#model-structure-and-parameters","position":2},{"hierarchy":{"lvl1":"üßÆ Modeling the demographic implications of cloning in marine invertebrate larvae","lvl2":"Model structure and parameters"},"content":"The clone_modelND model has two independent variables: larval size, s, and time, t. It has one dependent variable: p(s,t), the population of larvae of size s at time t.\n\nThe model tracks how p(s,t) evolves as a function of time, under the influence of four mechanisms:\n\nLarval growth and development\n\ng_0 determines the basal growth rate.\n\nLarval mortality\n\nm_0 determines the basal mortality rate.\n\n\\alpha determines the size-dependence of mortality, e.g. due to predators that preferentially prey on early or late stage larvae (\\alpha<0 means mortality is higher for early stages; \\alpha>0 means mortality is higher for late stages; \\alpha=0 means mortality is the same for all stages).Note: These parameters interact so changing \\alpha=0 also affects the impact of m_0.\n\nSizes for developmental milestones\n\ns_{egg} determines egg size (starting size for a developing larva)\n\ns_0 determines the size at cloning\n\ns_1 determines the size of one clone (must have s_1<s_0). The other clone has size s_0-s_1.\n\ns_2 is the size at metamorphosis\n\ns_{max} determines the upper limit of the population size structure plot. It has no effect on the simulation itself.\n\nProbabilities for developmental milestones\n\nc_0 is the probability a larva will clone when it reaches size s_1. c_0=0 means larvae never clone. c_0 = 0.5 means 50% of larvae clone, etc.\n\nf_2 is the probability of metamorphosis at size s_2. f_2=1 means larvae always metamorphose when they reach size at metamorphosis. f_2 = 0.5 means 50% of larvae metamorphose when they reach size at metamorphosis.\n\nThe initial condition -- the size distribution at the beginning of a simulation -- is that all larvae are initially of size s_0. Because there are only a fixed amount of maternal resources to put into eggs, making larger eggs means there are initially fewer, larger larvae. Conversely, making smaller eggs means there are initially more, smaller larvae.\n\n","type":"content","url":"/larvalcloningmodel#model-structure-and-parameters","position":3},{"hierarchy":{"lvl1":"üßÆ Modeling the demographic implications of cloning in marine invertebrate larvae","lvl2":"Meaningful parameter choices"},"type":"lvl2","url":"/larvalcloningmodel#meaningful-parameter-choices","position":4},{"hierarchy":{"lvl1":"üßÆ Modeling the demographic implications of cloning in marine invertebrate larvae","lvl2":"Meaningful parameter choices"},"content":"The ‚ÄúND‚Äù in the name of the clone_modelND model indicates that the model is Non-Dimensional.\nThis means key quantities have been scaled by some parameters, to remove redundant axes of variation.\n\nThe population of larvae have been normalized by the total amount of maternal resources. If N is the initial number of larvae,  N \\times S_0 = 1.\n\nThe sizes of larvae have been normalized by the size at metamorphosis. This means that you should keep s_2=1.\n\nThe timescale has been scaled so that g_0 = 1. This means, essentially, that if larvae take approximately a week to develop, we count time in weeks. If larvae take a month to develop, we count time in months, etc.\n\nThe mortality parameters m_0 and \\alpha reflect the size and time scales described above. For example, a well developed late stage larva has scaled size approaching s=1, while a very early stage larva is close to s=0. Also, the mortality rate is relative to the time scale of growth. That is, if growth takes approximately a week to develop, the mortality rate is per week, etc.\n\n","type":"content","url":"/larvalcloningmodel#meaningful-parameter-choices","position":5},{"hierarchy":{"lvl1":"üßÆ Modeling the demographic implications of cloning in marine invertebrate larvae","lvl2":"Modes of cloning"},"type":"lvl2","url":"/larvalcloningmodel#modes-of-cloning","position":6},{"hierarchy":{"lvl1":"üßÆ Modeling the demographic implications of cloning in marine invertebrate larvae","lvl2":"Modes of cloning"},"content":"To simulate the Echinoid mode of cloning, set:\n\nf_2=1\n\ns_1<s_2\n\n0 \\le c_0 < 1\n\nTo simulate the Ophiuroid mode of cloning:\n\nf_2<1\n\ns_1>s_2\n\nc_0 = 1\n\n","type":"content","url":"/larvalcloningmodel#modes-of-cloning","position":7},{"hierarchy":{"lvl1":"üßÆ Modeling the demographic implications of cloning in marine invertebrate larvae","lvl2":"Understanding model output"},"type":"lvl2","url":"/larvalcloningmodel#understanding-model-output","position":8},{"hierarchy":{"lvl1":"üßÆ Modeling the demographic implications of cloning in marine invertebrate larvae","lvl2":"Understanding model output"},"content":"The output of this graphical interface for the clone_modelND model comprises three plots.\n\nThe plot at the left is a heat map of size distribution of larvae, p(s,t), over larval size (s) and time (t). A vertical line represents the size distribution at one point in simulated time. A horizontal line represents the abundance of larvae of a given size across time.\n\nThe plot at the upper right shows the cumulative number of metamorphs, F(t), across time. The cumulative number of metamorphs at the end of the simulation is given just above the end of this line.\n\nThe plot at the lower right shows the total number of developing larvae of all sizes, P(t), across time. The total number of larvae still developing at the end of the simulation is given just above the end of this line.\n\n# Load modules and set graphics environment\nfrom math import *\nimport numpy as np\nfrom matplotlib import pyplot as plt\nplt.ion();\nfrom ipywidgets import interact, interactive, fixed, interact_manual\nimport ipywidgets as widgets\nfrom clone_modelND import Params, ClonePDE\n\n\n\n# Instantiate a Params object and a GUI to modify parameters. \nparams=Params(auto_plot=True)\n# Restrict to a single environment, to simplify the interface\n#save_all=False,s_egg=0.1,s_0=0.75,s_1=0.25,s_2=1.,\n#                 Smax=1.25,s_j=1.,N0=1.,n_env=1,\n#                 t_env_cycle=1.,env_cycle_ratios=np.array([1.]),g_pars=[{'g0':1.}],\n#                 m_pars=[{'m0':0.15}],alpha=-0.75,c_0 = 0.5,f_2 = 1.,C = None,\n#                 nruns=1,start_time=0.,end_time=10.,dt=0.05,max_step=0.005,ns=4*32,\n#                 abserr=1.e-12,relerr=1.e-10,auto_plot=False\ns_egg=widgets.FloatText(value=0.1,width=10,description = r\"$s_{egg}$\")\ns_0=widgets.FloatText(value=0.75,description = r\"$s_0$\")\ns_1=widgets.FloatText(value=0.25,description = r\"$s_1$\")\ns_2=widgets.FloatText(value=1.0,description = r\"$s_2$\")\nSmax=widgets.FloatText(value=1.25,description = r\"$s_{max}$\")\nTmax=widgets.FloatText(value=10.,description = r\"$T_{max}$\")\ng0=widgets.FloatText(value=1.,description = r\"$g_0$\")\nm0=widgets.FloatText(value=0.,description = r\"$m_0$\")\nalpha=widgets.FloatText(value=-0.75,description = r\"$\\alpha$\")\nc_0=widgets.FloatText(value=0.,description = r\"$c_0$\")\nf_2=widgets.FloatText(value=1.,description = r\"$f_2$\")\n\nh = '30px'\nL_s_egg = widgets.Label(value='Egg size',layout=widgets.Layout(display=\"flex\", \n                                        justify_content=\"flex-end\",width=\"97%\",height=h))\nL_s_0 = widgets.Label(value='Size at cloning',layout=widgets.Layout(display=\"flex\", \n                                        justify_content=\"flex-end\",width=\"95%\",height=h))\nL_s_1 = widgets.Label(value='Clone size',layout=widgets.Layout(display=\"flex\", \n                                        justify_content=\"flex-end\",width=\"95%\",height=h))\nL_s_2 = widgets.Label(value='Size at metamorphosis',layout=widgets.Layout(display=\"flex\", \n                                        justify_content=\"flex-end\",width=\"97%\",height=h))\nL_Smax = widgets.Label(value='Plot limit',layout=widgets.Layout(display=\"flex\", \n                                        justify_content=\"flex-end\",width=\"90%\",height=h))\nuiL1 = widgets.VBox([L_s_egg,L_s_0,L_s_1,L_s_2,L_Smax])\n\nL_g0 = widgets.Label(value='Growth rate',layout=widgets.Layout(display=\"flex\", \n                                        justify_content=\"flex-start\",width=\"97%\",height=h))\nL_m0 = widgets.Label(value='Mortality rate',layout=widgets.Layout(display=\"flex\", \n                                        justify_content=\"flex-start\",width=\"95%\",height=h))\nL_alpha = widgets.Label(value='Mort. selectivity',layout=widgets.Layout(display=\"flex\", \n                                        justify_content=\"flex-start\",width=\"95%\",height=h))\nL_c_0 = widgets.Label(value='Cloning probability',layout=widgets.Layout(display=\"flex\", \n                                        justify_content=\"flex-start\",width=\"95%\",height=h))\nL_f_2 = widgets.Label(value='Metamorphosis probability',layout=widgets.Layout(display=\"flex\", \n                                        justify_content=\"flex-start\",width=\"97%\",height=h))\nL_Tmax = widgets.Label(value='End time',layout=widgets.Layout(display=\"flex\", \n                                        justify_content=\"flex-start\",width=\"90%\",height=h))\nuiL2 = widgets.VBox([L_g0,L_m0,L_alpha,L_c_0,L_f_2,L_Tmax])\n\n\nLabelObj = widgets.Label(value='Object',layout=widgets.Layout(display=\"flex\", \n                                        justify_content=\"center\",width=\"100%\"))\nLabelObj1 = widgets.Label(value='Object')\nSpace = widgets.Label(value=' ',\n                         layout=widgets.Layout(display=\"flex\", \n                                               justify_content=\"center\", \n                                               width=\"100%\"))\nLabelModel = widgets.Label(value='Model',\n                         layout=widgets.Layout(display=\"flex\", \n                                               justify_content=\"flex-end\", \n                                               width=\"150%\"))\nui0 = widgets.VBox([LabelObj,LabelObj1,Space,LabelModel])\nui1 = widgets.VBox([s_egg,s_0,s_1,s_2,Smax])\nui2 = widgets.VBox([g0,m0,alpha,c_0,f_2,Tmax])\nui3 = widgets.HBox([uiL1,ui1,ui2,uiL2])\n\ndef setParams(s_egg,s_0,s_1,s_2,Smax,g0,m0,alpha,c_0,f_2,Tmax):\n    params=Params(auto_plot=True)\n    params.s_egg = s_egg\n    params.s_0 = s_0\n    params.s_1 = s_1\n    params.s_2 = s_2\n    params.Smax = Smax\n    params.g_pars = [{'g0':g0}]\n    params.m_pars = [{'m0':m0}]\n    params.alpha = alpha\n    params.c_0 = c_0\n    params.f_2 = f_2\n    params.end_time = Tmax\n    result=ClonePDE(params)\n    \nout = widgets.interactive_output(setParams,{'s_egg':s_egg,'s_0':s_0,'s_1':s_1,'s_2':s_2,'Smax':Smax,\n                                             'g0':g0,'m0':m0,'alpha':alpha,'c_0':c_0,'f_2':f_2,'Tmax':Tmax})\ndisplay(ui3,out)\n\n\n\n\n\n","type":"content","url":"/larvalcloningmodel#understanding-model-output","position":9},{"hierarchy":{"lvl1":""},"type":"lvl1","url":"/spiror","position":0},{"hierarchy":{"lvl1":""},"content":"A multi-habitat, multi-strain model of Spirobis population dynamics.\n\nfrom matplotlib import pyplot as plt\nplt.ion();\nfrom ipywidgets import interact, interactive, fixed, interact_manual\nimport ipywidgets as widgets\nfrom spiror import SpirorbisStrain,Site,SimParams,SimSites\n\n\n\nglobal glob_site,glob_strain,glob_sim\nglobal glob_strains, glob_sites\nglob_strains = [] # Placeholder for a list of strains\nglob_sites = []   # Placeholder for a list of sites\nglobal sim_pars\n\n\n\n# Generate strains\n# Instantiate one or more SpirorbisStrain objects and create a GUI to modify parameters. \nlbl = widgets.Text(value='strain',width=10,description = r\"label\")\nclr = widgets.Text(value='k',width=10,description = r\"color\")\nfcnd = widgets.FloatText(value=10**4,description = r\"fecundity, $f$\")\nslct_fucus = widgets.FloatText(value=1.,width=10,description = r\"Fucus select.\")\nslct_asco = widgets.FloatText(value=1.,width=10,description = r\"Asco select\")\ninit_larv=widgets.FloatText(value=10**8,description = r\"Initial larvae\")\ninit_fucus=widgets.FloatText(value=0.,description = r\"Initial Fucus\")\ninit_asco=widgets.FloatText(value=0.,description = r\"Initial Asco\")\n\nui1 = widgets.VBox([lbl,init_fucus,slct_fucus])\nui2 = widgets.VBox([clr,init_asco,slct_asco])\nui3 = widgets.VBox([fcnd,init_larv])\nui4 = widgets.HBox([ui1,ui2,ui3])\n\ndef set_strain_pars(lbl_,clr_,fcnd_,slct_fucus_,slct_asco_,init_larv_,init_fucus_,init_asco_):\n    global glob_strain\n    glob_strain = SpirorbisStrain(label=lbl_,color=clr_,fecundity=fcnd_,select_fucus=slct_fucus_,\n                                  select_asco=slct_asco_,initial_larvae=init_larv_,\n                                  initial_adults_fucus=init_fucus_,initial_adults_asco=init_asco_)\n    \nout = widgets.interactive_output(set_strain_pars,{'lbl_':lbl,'clr_':clr,'fcnd_':fcnd,\n                                            'slct_fucus_':slct_fucus,'slct_asco_':slct_asco,\n                                            'init_larv_':init_larv,'init_fucus_':init_fucus,\n                                            'init_asco_':init_asco})\ndisplay(ui4,out)\n\nbutton1 = widgets.Button(description=\"Add strain to list\")\noutput1 = widgets.Output()\n\nbuttonsL1 = widgets.HBox([button1, output1])\ndisplay(buttonsL1)\n\n@output1.capture()\ndef on_button_clicked1(b):\n    global glob_strain,glob_strains\n    glob_strains.append(glob_strain)\n\nbutton1.on_click(on_button_clicked1)\n\nbutton3 = widgets.Button(description=\"Show strain list\")\noutput3 = widgets.Output()\n\nbuttonsL3 = widgets.HBox([button3, output3])\ndisplay(buttonsL3)\n\n@output3.capture()\ndef on_button_clicked3(b):\n    global glob_strains\n    output3.clear_output()\n    if len(glob_strains) == 0:\n        print('\\n\\nStrain list is empty...')\n    else:\n        for i,strain in enumerate(glob_strains):\n            print(f'\\n\\nStrain {i}:')\n            print(f'\\tlabel = {strain.label}')\n            print(f'\\tcolor = {strain.color}')\n            print(f'\\tfecundity = {strain.fecundity:.2e}')\n            print(f'\\tFucus selectivity = {strain.select_fucus}')\n            print(f'\\tAscophyllum selectivity = {strain.select_asco}')\n            print(f'\\tInitial number of larvae = {strain.initial_larvae:.2e}')\n            print(f'\\tInitial adults on Fucus = {strain.initial_adults_fucus:.2e}')\n            print(f'\\tInitial adults on Ascophyllum = {strain.initial_adults_asco:.2e}')\n        \n\nbutton3.on_click(on_button_clicked3)\n\n\n\nbutton2 = widgets.Button(description=\"Reset strain list\")\noutput2 = widgets.Output()\n\nbuttonsL2 = widgets.HBox([button2, output2])\ndisplay(buttonsL2)\n\n@output2.capture()\ndef on_button_clicked2(b):\n    global glob_strains\n    glob_strains = []\n\nbutton2.on_click(on_button_clicked2)\n\n\n\n# Generate sites\n# Instantiate one or more Site objects and create a GUI to modify parameters. \nlbl2 = widgets.Text(value='site',width=10,description = r\"label\")\ncarry_cap = widgets.FloatText(value=10**4,description = r\"Carrying Cap.\")\nmort_fucus = widgets.FloatText(value=0.1,width=10,description = r\"Mort. on Fucus\")\nmort_asco = widgets.FloatText(value=0.5,width=10,description = r\"Mort. on Asco\")\nmort_larv = widgets.FloatText(value=0.1,width=10,description = r\"Mort. of Larvae\")\nfrac_fucus=widgets.FloatText(value=0.5,description = r\"Fraction Fucus\")\ncat_prob=widgets.FloatText(value=0.,description = r\"Catast. Prob.\")\nenc_prob=widgets.FloatText(value=0.0001,description = r\"Encount. Prob.\")\n\nui1a = widgets.VBox([lbl2,mort_fucus,enc_prob])\nui2a = widgets.VBox([carry_cap,mort_asco,cat_prob])\nui3a = widgets.VBox([frac_fucus,mort_larv])\nui4a = widgets.HBox([ui1a,ui2a,ui3a])\n\n\n#site1 = Site(mortality_larvae = 0.1,mortality_fucus = 0.1,mortality_asco = 0.5,\n#                 carrying_cap = 10**5,strains=[fucus_specialist,asco_specialist,generalist],f = 0.5,cat = 0.,\n#                 encounter_prob = 0.0001,label='Tidepool (low turb.)')\n\n\ndef set_site_pars(lbl2_,carry_cap_,mort_fucus_,mort_asco_,mort_larv_,frac_fucus_,cat_prob_,enc_prob_):\n    global glob_site\n    glob_site = Site(label=lbl2_,mortality_larvae=mort_larv_,mortality_fucus=mort_fucus_,mortality_asco=mort_asco_,\n                 carrying_cap=carry_cap_,strains=glob_strains,f=frac_fucus_,cat=cat_prob_,\n                 encounter_prob=enc_prob_)\n                         \nout2 = widgets.interactive_output(set_site_pars,{'lbl2_':lbl2,'carry_cap_':carry_cap,\n                                            'mort_fucus_':mort_fucus,'mort_asco_':mort_asco,\n                                            'mort_larv_':mort_larv,'frac_fucus_':frac_fucus,\n                                            'cat_prob_':cat_prob,'enc_prob_':enc_prob})\ndisplay(ui4a,out2)\n\nbutton1a = widgets.Button(description=\"Add site to list\")\noutput1a = widgets.Output()\n\nbuttonsL2 = widgets.HBox([button1a, output1a])\ndisplay(buttonsL2)\n\n@output1a.capture()\ndef on_button_clicked1a(b):\n    global glob_site,glob_sites\n    glob_sites.append(glob_site)\n\nbutton1a.on_click(on_button_clicked1a)\n\nbutton3a = widgets.Button(description=\"Show site list\")\noutput3a = widgets.Output()\n\nbuttonsL3a = widgets.HBox([button3a, output3a])\ndisplay(buttonsL3a)\n\n@output3a.capture()\ndef on_button_clicked3a(b):\n    global glob_sites\n    output3a.clear_output()\n    if len(glob_sites) == 0:\n        print('\\n\\nSite list is empty...')\n    else:\n        for i,site in enumerate(glob_sites):\n            print(f'\\n\\nSite {i}:')\n            print(f'\\tlabel = {site.label}')\n            print(f'\\tCarrying capacity = {site.carrying_cap:.2e}')\n            print(f'\\tFraction Fucus = {site.f}')\n            print(f'\\tMortality of larvae = {site.mortality_larvae:.2e}')\n            print(f'\\tMortality of adults on Fucus = {site.mortality_fucus:.2e}')\n            print(f'\\tMortality of adults on Ascophyllum = {site.mortality_asco:.2e}')\n            print(f'\\tProbability of catastrophe = {site.cat}')\n            print(f'\\tProbability larvae encounter substrate = {site.encounter_prob}')\n        \n\nbutton3a.on_click(on_button_clicked3a)\n#button2a = widgets.Button(description=\"Reset strain list\")\n#output2 = widgets.Output()\n\n\n\nbutton2a = widgets.Button(description=\"Reset site list\")\noutput2a = widgets.Output()\n\nbuttonsL2a = widgets.HBox([button2a, output2a])\ndisplay(buttonsL2a)\n\n@output2a.capture()\ndef on_button_clicked2a(b):\n    global glob_sites\n    glob_sites = []\n\nbutton2a.on_click(on_button_clicked2a)\n\n\n\n# Instantiate a SimParams object and create a GUI to modify parameters and run the simulation. \nexchange = widgets.FloatText(value=0.,description = r\"Exchange\")\ntimesteps = widgets.IntText(value=4*10**3,width=10,description = r\"Timesteps\")\nplt_int = widgets.IntText(value=20,width=10,description = r\"Plot Interval\")\n\nui1b = widgets.VBox([timesteps,plt_int,exchange])\n#ui2b = widgets.VBox([carry_cap,mort_asco,cat_prob])\n#ui3b = widgets.VBox([frac_fucus,mort_larv])\n#ui4b = widgets.HBox([ui1b,ui2b,ui3b])\n\ndef set_sim_pars(timesteps_,plt_int_,exchange_):\n    global sim_pars,glob_sites\n    sim_pars = SimParams(exchange=exchange_,timesteps=timesteps_,plot_interval=plt_int_,sites=glob_sites)\n    #sim = SimSites(sim_pars)\n\nout3 = widgets.interactive_output(set_sim_pars,{'timesteps_':timesteps,'plt_int_':plt_int,\n                                            'exchange_':exchange})\ndisplay(ui1b,out3)\n\nbutton1b = widgets.Button(description=\"Run simulation\")\noutput1b = widgets.Output()\n\n#sim_pars = SimParams(A_openwater = 10**5,exchange_rate = 0.2,timesteps = 4 * 10**3,\n#                     plot_interval = 20,sites=glob_sites)\n#sim = SimSites(sim_pars)\n\n\n\n\n\n\nbutton2b = widgets.Button(description=\"Run simulation\")\noutput2b = widgets.Output()\n\nbuttonsL2b = widgets.HBox([button2b, output2b])\ndisplay(buttonsL2b)\n\n@output2b.capture()\ndef on_button_clicked2b(b):\n    global sim_pars\n    output2b.clear_output()\n    sim = SimSites(sim_pars)\n    plt.show()\n\nbutton2b.on_click(on_button_clicked2b)\n\n","type":"content","url":"/spiror","position":1},{"hierarchy":{"lvl1":"Larval recruitment in estuaries"},"type":"lvl1","url":"/estlarvswim","position":0},{"hierarchy":{"lvl1":"Larval recruitment in estuaries"},"content":"%matplotlib widget\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom IPython import display\n#from os import listdir\nfrom glob import glob\nimport ipywidgets as widgets\nfrom EstLarvSwim import Estuary, Larvae, SwimSim\nplt.ioff()\n\n\n\nglobal estuary\nestuaries = glob('Estuaries/*.out')\nout = widgets.Output()\nHTML_text_widget = widgets.HTML(value='<b>Choose an estuary/flow scenario: </b>')\nest = widgets.Select(\n    options=estuaries,\n    value=estuaries[0],\n    rows=len(estuaries),\n    description='',\n    disabled=False\n)\nestuary = Estuary(infile=est.value)  # load default estuary/flow scenario\nbuttonE = widgets.Button(\n    description='Load estuary',\n    disabled=False,\n    button_style='', # 'success', 'info', 'warning', 'danger' or ''\n    tooltip='Load estuary',\n    icon='check' # (FontAwesome names without the `fa-` prefix)\n)\n\ndef on_button_clickedE(b):\n    global estuary,est\n    estuary = Estuary(infile=est.value)\n\nbuttonE.on_click(on_button_clickedE)\n\nwidgets.Box([HTML_text_widget,\n              est,buttonE])\n\n\n\n\n\nDefine parameters for the first of three optional variants\n\n# Set simulation parameters for cohort 1\nglobal L1,L1pars\nHTML_text_widgetL1 = widgets.HTML(value='<b>Characteristics of Larval Variant 1: </b>')\nstyle = {'description_width': 'initial'}\nL1pars_N=widgets.IntText(value=64,width=5,description = r\"Number, $N$\")\nL1pars_reldate=widgets.FloatText(value=60,width=5,description = r\"Release Date\")\nL1pars_sdd=widgets.Text(value='4,10',description = r\"Stage Durations (days)\",style=style)\nL1pars_sv=widgets.Text(value='-500e-6,500e-6',description = r\"Stage velocities ($\\frac{m}{s}$)\",style=style)\nL1pars_color=widgets.Text(value='blue',description = r\"Color\")\nL1pars_sis=widgets.Checkbox(value=True,description = r\"Settle in substrate\")\nL1pars_se=widgets.Text(value='-80,-40',description = r\"Substrate Extent ($km$)\")\nL1pars_reldepths=widgets.Text(value='0.1,1',width=5,description = r\"Release Depths\",style=style)\n\nL1_0s = widgets.VBox([L1pars_N,L1pars_reldate,L1pars_reldepths])\nL1_0s.layout.align_items = 'flex-end'\nL1_1s = widgets.VBox([L1pars_color,L1pars_sdd,L1pars_se])\nL1_1s.layout.align_items = 'flex-end'\nL1_2s = widgets.VBox([L1pars_sis,L1pars_sv])\nL1_2s.layout.align_items = 'flex-end'\nL1_012s = widgets.HBox([L1_0s,L1_1s,L1_2s])\n\ntoList = lambda s: eval('['+s+']')\n\ndef set_L1pars(N,reldate,sdd,sv,sis,color,se,reldepths):\n    global L1,L1_pars\n    L1 = Larvae(N=N,release_date=reldate,\n                stage_durations_days=toList(sdd),stage_velocities=toList(sv),\n              color=color,settle_in_substrate=sis,substrate_extent=toList(se),\n              release_depths=toList(reldepths))\n\nouts1 = widgets.interactive_output(set_L1pars,{'N':L1pars_N,'reldate':L1pars_reldate,'sdd':L1pars_sdd,'sv':L1pars_sv,'sis':L1pars_sis,\n                                                'color':L1pars_color,'se':L1pars_se,\n                                                'reldepths':L1pars_reldepths})\nwidgets.VBox([HTML_text_widgetL1,widgets.HBox([L1_012s,outs1])])\n\n\n\n\n\n# Set simulation parameters for cohort 2\nglobal L2,L2pars\nHTML_text_widgetL2 = widgets.HTML(value='<b>Characteristics of Larval Variant 2: </b>')\nL2pars_N=widgets.IntText(value=64,width=5,description = r\"Number, $N$\")\nL2pars_reldate=widgets.FloatText(value=60,width=5,description = r\"Release Date\")\nL2pars_sdd=widgets.Text(value='4,10',description = r\"Stage Durations (days)\",style=style)\nL2pars_sv=widgets.Text(value='-500e-6,500e-6',description = r\"Stage velocities ($\\frac{m}{s}$)\",style=style)\nL2pars_color=widgets.Text(value='red',description = r\"Color\")\nL2pars_sis=widgets.Checkbox(value=True,description = r\"Settle in substrate\")\nL2pars_se=widgets.Text(value='-80,-40',description = r\"Substrate Extent ($km$)\")\nL2pars_reldepths=widgets.Text(value='0.1,1',width=5,description = r\"Release Depths\",style=style)\n\nL2_0s = widgets.VBox([L2pars_N,L2pars_reldate,L2pars_reldepths])\nL2_0s.layout.align_items = 'flex-end'\nL2_1s = widgets.VBox([L2pars_color,L2pars_sdd,L2pars_se])\nL2_1s.layout.align_items = 'flex-end'\nL2_2s = widgets.VBox([L2pars_sis,L2pars_sv])\nL2_2s.layout.align_items = 'flex-end'\nL2_012s = widgets.HBox([L2_0s,L2_1s,L2_2s])\n\ndef set_L2pars(N,reldate,sdd,sv,sis,color,se,reldepths):\n    global L2,L2_pars\n    L2 = Larvae(N=N,release_date=reldate,\n                stage_durations_days=toList(sdd),stage_velocities=toList(sv),\n              color=color,settle_in_substrate=sis,substrate_extent=toList(se),\n              release_depths=toList(reldepths))\n\nouts2 = widgets.interactive_output(set_L2pars,{'N':L2pars_N,'reldate':L2pars_reldate,'sdd':L2pars_sdd,'sv':L2pars_sv,'sis':L2pars_sis,\n                                                'color':L2pars_color,'se':L2pars_se,\n                                                'reldepths':L2pars_reldepths})\nwidgets.VBox([HTML_text_widgetL2,widgets.HBox([L2_012s,outs2])])\n\n\n\n\n\n# Set larval parameters for cohort 3\nglobal L3,L3pars\nHTML_text_widgetL3 = widgets.HTML(value='<b>Characteristics of Larval Variant 3: </b>')\nL3pars_N=widgets.IntText(value=64,width=5,description = r\"Number, $N$\")\nL3pars_reldate=widgets.FloatText(value=60,width=5,description = r\"Release Date\")\nL3pars_sdd=widgets.Text(value='4,10',description = r\"Stage Durations (days)\",style=style)\nL3pars_sv=widgets.Text(value='-500e-6,500e-6',description = r\"Stage velocities ($\\frac{m}{s}$)\",style=style)\nL3pars_color=widgets.Text(value='magenta',description = r\"Color\")\nL3pars_sis=widgets.Checkbox(value=True,description = r\"Settle in substrate\")\nL3pars_se=widgets.Text(value='-80,-40',description = r\"Substrate Extent ($km$)\")\nL3pars_reldepths=widgets.Text(value='0.1,1',width=5,description = r\"Release Depths\",style=style)\n\nL3_0s = widgets.VBox([L3pars_N,L3pars_reldate,L3pars_reldepths])\nL3_0s.layout.align_items = 'flex-end'\nL3_1s = widgets.VBox([L3pars_color,L3pars_sdd,L3pars_se])\nL3_1s.layout.align_items = 'flex-end'\nL3_2s = widgets.VBox([L3pars_sis,L3pars_sv])\nL3_2s.layout.align_items = 'flex-end'\nL3_012s = widgets.HBox([L3_0s,L3_1s,L3_2s])\n\ndef set_L3pars(N,reldate,sdd,sv,sis,color,se,reldepths):\n    global L3,L3_pars\n    L3 = Larvae(N=N,release_date=reldate,\n                stage_durations_days=toList(sdd),stage_velocities=toList(sv),\n              color=color,settle_in_substrate=sis,substrate_extent=toList(se),\n              release_depths=toList(reldepths))\n\nouts3 = widgets.interactive_output(set_L3pars,{'N':L3pars_N,'reldate':L3pars_reldate,'sdd':L3pars_sdd,'sv':L3pars_sv,'sis':L3pars_sis,\n                                                'color':L3pars_color,'se':L3pars_se,\n                                                'reldepths':L3pars_reldepths})\nwidgets.VBox([HTML_text_widgetL3,widgets.HBox([L3_012s,outs3])])\n\n\n\n\n\n# GUI to specify parameters and run simulations\nglobal S\nS = SwimSim()\n\noutS = widgets.Output()\nHTML_text_widgetS = widgets.HTML(value='<b>Choose simulation parameters: </b>')\n\nSpars_pltint=widgets.Text(value='2*3600',description = r\"Plot interval ($s$)\",style=style)\nSpars_days=widgets.Text(value='60,72',description = r\"Days to simulate\",style=style)\nSpars_L1=widgets.Checkbox(value=True,description = r\"Include variant 1\",style=style)\nSpars_L2=widgets.Checkbox(value=True,description = r\"Include variant 2\",style=style)\nSpars_L3=widgets.Checkbox(value=True,description = r\"Include variant 3\",style=style)\n\nbuttonU = widgets.ToggleButton(\n    value=False,\n    description='Update parameters',\n    disabled=False,\n    button_style='', # 'success', 'info', 'warning', 'danger' or ''\n    tooltip='Click to implement changes to estuary or larval parameters.',\n    icon='' # (FontAwesome names without the `fa-` prefix)\n)\n\nS_0s = widgets.VBox([Spars_days,Spars_pltint,buttonU])\nS_0s.layout.align_items = 'flex-end'\nS_1s = widgets.VBox([Spars_L1,Spars_L2,Spars_L3])\nS_1s.layout.align_items = 'flex-end'\nS_01s = widgets.HBox([S_0s,S_1s])\n\ndef set_Spars(days,pltint,useL1,useL2,useL3,up):\n    global S,L1,L2,L3,estuary\n    larvae = []\n    if useL1:\n        larvae.append(L1)\n    if useL2:\n        larvae.append(L2)\n    if useL3:\n        larvae.append(L3)    \n    S = SwimSim(estuary=estuary,larvae=larvae,plot_interval=eval(pltint),days=toList(days),plot_mode='ipynb')\n\nouts4 = widgets.interactive_output(set_Spars,{'days':Spars_days,'pltint':Spars_pltint,'useL1':Spars_L1,'useL2':Spars_L2,'useL3':Spars_L3,'up':buttonU})\n\nwidgets.VBox([HTML_text_widgetS,S_01s,outs4])\n\n\n\n\n\nbuttonS = widgets.Button(\n    description='Run simulation',\n    disabled=False,\n    button_style='', # 'success', 'info', 'warning', 'danger' or ''\n    tooltip='Click to run simulation using current parameters.',\n    icon='' # (FontAwesome names without the `fa-` prefix)\n)\noutputS = widgets.Output()\n@outputS.capture()\ndef on_button_clickedS(b):\n    global S\n    S.halt = False\n    with plt.ioff():\n        S.run()\nbuttonS.on_click(on_button_clickedS)\nwidgets.VBox([buttonS,outputS])\n\n\n\n\n\nS.halt = True\n\n","type":"content","url":"/estlarvswim","position":1},{"hierarchy":{"lvl1":""},"type":"lvl1","url":"/fsl","position":0},{"hierarchy":{"lvl1":""},"content":"%matplotlib widget\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom IPython import display\n#from os import listdir\nfrom glob import glob\nimport ipywidgets as widgets\n# a style for widget label width\nstyle = {'description_width': 'initial'} \n#plt.ion()\nplt.ioff()\nfrom pyFSLm import FSL1Dsim\nfrom pyFSLm_utils import FSLpars\n\n\n\n# Create an FSLpars instance, and populate it with grid parameters. These generally are\n# not changed by users.\nglobal fslpars\nfslpars = FSLpars()\nfslpars.Nx = 128  # number of x-direction gridpoints\nfslpars.Ny = 128  # not used in 1D simulations\nfslpars.Lx = 1.   # x-extent of the nondimensionalize domain\nfslpars.Ly = 1.   # not used in 1D simulations\n# Record a dummy filename, for runs parameterized from the GUI\nfslpars.filename = 'GUI'\n\n\n\n# Populate an input-driven dictionary of resource parameters\nglobal Rdict\nRdict = {}\n# Set up input boxes for parameter values\nHTML_text_widgetR = widgets.HTML(value='<b>Resource characteristics: </b>')\nRpars_phyto1=widgets.FloatText(value=1.5,width=5,description = r\"$Phyto_1$\")\nRpars_phyto2=widgets.FloatText(value=1.,width=5,description = r\"$Phyto_2$\")\nRpars_phyto3=widgets.FloatText(value=1.,width=5,description = r\"$Phyto_3$\")\nRpars_phyto4=widgets.FloatText(value=4.,width=5,description = r\"$Phyto_4$\")\nRpars_phyto5=widgets.FloatText(value=1.,width=5,description = r\"$Phyto_5$\")\nRpars_Damb=widgets.FloatText(value=0.01,width=5,description = r\"$D_{amb}$\")\n\nR_0s = widgets.VBox([Rpars_phyto1,Rpars_phyto4])\nR_0s.layout.align_items = 'flex-end'\nR_1s = widgets.VBox([Rpars_phyto2,Rpars_phyto5])\nR_1s.layout.align_items = 'flex-end'\nR_2s = widgets.VBox([Rpars_phyto3,Rpars_Damb])\nR_2s.layout.align_items = 'flex-end'\nR_012s = widgets.HBox([R_0s,R_1s,R_2s])\n\ndef set_Rpars(phyto1,phyto2,phyto3,phyto4,phyto5,Damb):\n    global Rdict\n    Rdict.update({'phyto1':phyto1,'phyto2':phyto2,'phyto3':phyto3,\n              'phyto4':phyto4,'phyto5':phyto5,'Damb':Damb})\n\noutR = widgets.interactive_output(set_Rpars,{'phyto1':Rpars_phyto1,'phyto2':Rpars_phyto2,'phyto3':Rpars_phyto3,\n                                             'phyto4':Rpars_phyto4,'phyto5':Rpars_phyto5,'Damb':Rpars_Damb})\nwidgets.VBox([HTML_text_widgetR,widgets.HBox([R_012s,outR])])\n\n\n\n\n\n# Populate an input-driven dictionary of parameters for consumer 1\nglobal C1dict\nC1dict = {}\n# Set up input boxes for parameter values\nHTML_text_widgetC1 = widgets.HTML(value='<b>Consumer 1 characteristics: </b>')\nC1pars_Fr=widgets.FloatText(value=0.1,description = r\"Frost num., $Fr$\",style=style)\nC1pars_Le=widgets.FloatText(value=1.,description = r\"Lessard num., $Le$\",style=style)\nC1pars_Str=widgets.FloatText(value=0.4,width=5,description = r\"Strathmann num., $Str$\",style=style)\nC1pars_N=widgets.FloatText(value=1.,width=5,description = r\"Init. Density, $N$\",style=style)\nC1pars_alpha1=widgets.FloatText(value=0.,width=5,description = r\"$\\alpha_1$\",style=style)\nC1pars_alpha4=widgets.FloatText(value=0.667,width=5,description = r\"$\\alpha_4$\",style=style)\nC1pars_sighat=widgets.FloatText(value=2.,width=5,description = r\"$\\hat{\\sigma}$\",style=style)\nC1pars_psi=widgets.FloatText(value=-0.5,width=5,description = r\"Directional pers., $\\psi$\",style=style)\n\nC1_0s = widgets.VBox([C1pars_Fr,C1pars_N,C1pars_sighat])\nC1_0s.layout.align_items = 'flex-end'\nC1_1s = widgets.VBox([C1pars_Str,C1pars_alpha1,C1pars_psi])\nC1_1s.layout.align_items = 'flex-end'\nC1_2s = widgets.VBox([C1pars_Le,C1pars_alpha4])\nC1_2s.layout.align_items = 'flex-end'\nC1_012s = widgets.HBox([C1_0s,C1_1s,C1_2s])\n\ndef set_C1pars(Fr,Str,Le,N,alpha1,alpha4,sigma_hat,psi):\n    global C1dict\n    C1dict.update({'Fr':Fr,'Str':Str,'Le':Le,'N':N,'alpha1':alpha1,'alpha4':alpha4,'sigma_hat':sigma_hat,'psi':psi})\n\noutC1 = widgets.interactive_output(set_C1pars,{'Fr':C1pars_Fr,'Str':C1pars_Str,'Le':C1pars_Le,\n                                               'N':C1pars_N,'alpha1':C1pars_alpha1,'alpha4':C1pars_alpha4,\n                                               'sigma_hat':C1pars_sighat,'psi':C1pars_psi})\nwidgets.VBox([HTML_text_widgetC1,widgets.HBox([C1_012s,outC1])])\n\n\n\n\n\n# Populate an input-driven dictionary of parameters for consumer 2\nglobal C2dict\nC2dict = {}\n# Set up input boxes for parameter values\nHTML_text_widgetC2 = widgets.HTML(value='<b>Consumer 2 characteristics: </b>')\nC2pars_Fr=widgets.FloatText(value=1.,description = r\"Frost num., $Fr$\",style=style)\nC2pars_Le=widgets.FloatText(value=1.,description = r\"Lessard num., $Le$\",style=style)\nC2pars_Str=widgets.FloatText(value=0.2,width=5,description = r\"Strathmann num., $Str$\",style=style)\nC2pars_N=widgets.FloatText(value=1.,width=5,description = r\"Init. Density, $N$\",style=style)\nC2pars_alpha1=widgets.FloatText(value=0.,width=5,description = r\"$\\alpha_1$\",style=style)\nC2pars_alpha4=widgets.FloatText(value=0.667,width=5,description = r\"$\\alpha_4$\",style=style)\nC2pars_sighat=widgets.FloatText(value=2.,width=5,description = r\"$\\hat{\\sigma}$\",style=style)\nC2pars_psi=widgets.FloatText(value=-0.5,width=5,description = r\"Directional pers., $\\psi$\",style=style)\n\nC2_0s = widgets.VBox([C2pars_Fr,C2pars_N,C2pars_sighat])\nC2_0s.layout.align_items = 'flex-end'\nC2_1s = widgets.VBox([C2pars_Str,C2pars_alpha1,C2pars_psi])\nC2_1s.layout.align_items = 'flex-end'\nC2_2s = widgets.VBox([C2pars_Le,C2pars_alpha4])\nC2_2s.layout.align_items = 'flex-end'\nC2_012s = widgets.HBox([C2_0s,C2_1s,C2_2s])\n\ndef set_C2pars(Fr,Str,Le,N,alpha1,alpha4,sigma_hat,psi):\n    global C2dict\n    C2dict.update({'Fr':Fr,'Str':Str,'Le':Le,'N':N,'alpha1':alpha1,'alpha4':alpha4,'sigma_hat':sigma_hat,'psi':psi})\n\noutC2 = widgets.interactive_output(set_C2pars,{'Fr':C2pars_Fr,'Str':C2pars_Str,'Le':C2pars_Le,\n                                               'N':C2pars_N,'alpha1':C2pars_alpha1,'alpha4':C2pars_alpha4,\n                                               'sigma_hat':C2pars_sighat,'psi':C2pars_psi})\nwidgets.VBox([HTML_text_widgetC2,widgets.HBox([C2_012s,outC2])])\n\n\n\n\n\n# Populate an input-driven dictionary of parameters for consumer 3\nglobal C3dict\nC3dict = {}\n# Set up input boxes for parameter values\nHTML_text_widgetC3 = widgets.HTML(value='<b>Consumer 3 characteristics: </b>')\nC3pars_Fr=widgets.FloatText(value=10.,description = r\"Frost num., $Fr$\",style=style)\nC3pars_Le=widgets.FloatText(value=1.,description = r\"Lessard num., $Le$\",style=style)\nC3pars_Str=widgets.FloatText(value=0.1,width=5,description = r\"Strathmann num., $Str$\",style=style)\nC3pars_N=widgets.FloatText(value=1.,width=5,description = r\"Init. Density, $N$\",style=style)\nC3pars_alpha1=widgets.FloatText(value=0.,width=5,description = r\"$\\alpha_1$\",style=style)\nC3pars_alpha4=widgets.FloatText(value=0.667,width=5,description = r\"$\\alpha_4$\",style=style)\nC3pars_sighat=widgets.FloatText(value=2.,width=5,description = r\"$\\hat{\\sigma}$\",style=style)\nC3pars_psi=widgets.FloatText(value=-0.5,width=5,description = r\"Directional pers., $\\psi$\",style=style)\n\nC3_0s = widgets.VBox([C3pars_Fr,C3pars_N,C3pars_sighat])\nC3_0s.layout.align_items = 'flex-end'\nC3_1s = widgets.VBox([C3pars_Str,C3pars_alpha1,C3pars_psi])\nC3_1s.layout.align_items = 'flex-end'\nC3_2s = widgets.VBox([C3pars_Le,C3pars_alpha4])\nC3_2s.layout.align_items = 'flex-end'\nC3_012s = widgets.HBox([C3_0s,C3_1s,C3_2s])\n\ndef set_C3pars(Fr,Str,Le,N,alpha1,alpha4,sigma_hat,psi):\n    global C3dict\n    C3dict.update({'Fr':Fr,'Str':Str,'Le':Le,'N':N,'alpha1':alpha1,'alpha4':alpha4,'sigma_hat':sigma_hat,'psi':psi})\n\noutC3 = widgets.interactive_output(set_C3pars,{'Fr':C3pars_Fr,'Str':C3pars_Str,'Le':C3pars_Le,\n                                               'N':C3pars_N,'alpha1':C3pars_alpha1,'alpha4':C3pars_alpha4,\n                                               'sigma_hat':C3pars_sighat,'psi':C3pars_psi})\nwidgets.VBox([HTML_text_widgetC3,widgets.HBox([C3_012s,outC3])])\n\n\n\n\n\nglobal src_file,srcfile\nsfiles = glob('Sources/Source_FSL5_*.dat')\nout = widgets.Output()\nHTML_text_widget = widgets.HTML(value='<b>Choose a source file: </b>')\nsrcfile = widgets.Select(\n    options=sfiles,\n    value=sfiles[0],\n    rows=len(sfiles),\n    description='',\n    disabled=False\n)\nfslpars.source_file = srcfile.value  # start with the default file\nbuttonE = widgets.Button(\n    description='Choose a source file',\n    disabled=False,\n    button_style='', # 'success', 'info', 'warning', 'danger' or ''\n    tooltip='Load estuary',\n    icon='check', # (FontAwesome names without the `fa-` prefix)\n    style=style\n)\n\ndef on_button_clickedE(b):\n    global fslpars\n    fslpars.source_file = srcfile.value  # use newly selected file\n    fslpars.src_file = open(fslpars.source_file,\"r\")    \n    fslpars.load_source(init=True,verbose=False)\n\nbuttonE.on_click(on_button_clickedE)\n\nwidgets.Box([HTML_text_widget,\n              srcfile,buttonE])\n\n\n\n\n\n# GUI to specify temporal parameters for and run the simulation\nglobal F\n\noutF = widgets.Output()\nHTML_text_widgetF = widgets.HTML(value='<b>Choose simulation parameters: </b>')\n\nFpars_pltint=widgets.FloatText(value='0.5',description = r\"Plot interval\",style=style)\nFpars_statint=widgets.FloatText(value='0.5',description = r\"Statistics interval\",style=style)\nFpars_Tend=widgets.FloatText(value='3',description = r\"Run duration\",style=style)\nFpars_dt=widgets.FloatText(value='0.01',description = r\"Timestep\",style=style)\nFpars_L1=widgets.Checkbox(value=True,description = r\"Include variant 1\",style=style)\nFpars_L2=widgets.Checkbox(value=True,description = r\"Include variant 2\",style=style)\nFpars_L3=widgets.Checkbox(value=True,description = r\"Include variant 3\",style=style)\n\nbuttonU = widgets.ToggleButton(\n    value=False,\n    description='Update parameters',\n    disabled=False,\n    button_style='', # 'success', 'info', 'warning', 'danger' or ''\n    tooltip='Click to implement parameter changes.',\n    icon='' # (FontAwesome names without the `fa-` prefix)\n)\n\nF_0s = widgets.VBox([Fpars_Tend,Fpars_pltint,Fpars_dt,Fpars_statint])\nF_0s.layout.align_items = 'flex-end'\nF_1s = widgets.VBox([Fpars_L1,Fpars_L2,Fpars_L3,buttonU])\nF_1s.layout.align_items = 'flex-end'\nF_01s = widgets.HBox([F_0s,F_1s])\n\ndef set_Fpars(Tend,dt,pltint,statint,useL1,useL2,useL3,up):\n    global fslpars,Rdict,C3dict,C2dict,C3dict\n    # temporal parameters\n    fslpars.endTime=Tend\n    fslpars.dt = dt\n    fslpars.plotInterval = pltint\n    fslpars.seriesInterval = statint\n    # reset consumer parameters, then load as requested\n    fslpars.Fr = []\n    fslpars.Str = []\n    fslpars.Le = []\n    fslpars.N = []\n    fslpars.alpha1 = []\n    fslpars.alpha4 = []\n    fslpars.sigma_hat = []\n    fslpars.psi = []\n    Cdicts = [C1dict,C2dict,C3dict]\n    us = [useL1,useL2,useL3]\n    for i,u in enumerate(us):\n        if u:\n            fslpars.Fr += [Cdicts[i]['Fr']]\n            fslpars.Str += [Cdicts[i]['Str']]\n            fslpars.Le += [Cdicts[i]['Le']]\n            fslpars.N += [Cdicts[i]['N']]\n            fslpars.alpha1 += [Cdicts[i]['alpha1']]\n            fslpars.alpha4 += [Cdicts[i]['alpha4']]\n            fslpars.sigma_hat += [Cdicts[i]['sigma_hat']]\n            fslpars.psi += [Cdicts[i]['psi']]\n    fslpars.M = len(fslpars.Fr)\n    # load resource parameters\n    fslpars.__dict__.update(Rdict)\n\noutf4 = widgets.interactive_output(set_Fpars,{'Tend':Fpars_Tend,'dt':Fpars_dt,\n                                              'pltint':Fpars_pltint,'statint':Fpars_statint,\n                                              'useL1':Fpars_L1,'useL2':Fpars_L2,'useL3':Fpars_L3,'up':buttonU})\n\nwidgets.VBox([HTML_text_widgetF,F_01s,outf4])\n\n\n\n\n\nbuttonF = widgets.Button(\n    description='Run simulation',\n    disabled=False,\n    button_style='', # 'success', 'info', 'warning', 'danger' or ''\n    tooltip='Click to run simulation using current parameters.',\n    icon='' # (FontAwesome names without the `fa-` prefix)\n)\n\n\noutputF = widgets.Output()\n@outputF.capture()\ndef on_button_clickedF(b):\n    global F,fslpars\n    F = FSL1Dsim(pars=fslpars,plot_mode='ipynb')\n    #F = FSL1Dsim(input_file='tmp3_0.01_1_10_2_2.inp',plot_mode='ipynb')\n    F.setup()\n    F.halt = False\n    with plt.ioff():\n        F.run()\nbuttonF.on_click(on_button_clickedF)\nwidgets.VBox([buttonF,outputF])\n\n\n\n\n\n#F.halt = True\n\n","type":"content","url":"/fsl","position":1},{"hierarchy":{"lvl1":""},"type":"lvl1","url":"/fsl2d","position":0},{"hierarchy":{"lvl1":""},"content":"%matplotlib widget\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom IPython import display\n#from os import listdir\nfrom glob import glob\nimport ipywidgets as widgets\n# a style for widget label width\nstyle = {'description_width': 'initial'} \n#plt.ion()\nplt.ioff()\nfrom pyFSL2Dm import FSL2Dsim\n#from pyFSLm import FSL1Dsim\nfrom pyFSLm_utils import FSLpars\n\n\n\n# Create an FSLpars instance, and populate it with grid parameters. These generally are\n# not changed by users.\nglobal fslpars\nfslpars = FSLpars()\nfslpars.Nx = 128  # number of x-direction gridpoints\nfslpars.Ny = 128  # not used in 1D simulations\nfslpars.Lx = 1.   # x-extent of the nondimensionalize domain\nfslpars.Ly = 1.   # not used in 1D simulations\n# Record a dummy filename, for runs parameterized from the GUI\nfslpars.filename = 'GUI'\n\n\n\n# Populate an input-driven dictionary of resource parameters\nglobal Rdict\nRdict = {}\n# Set up input boxes for parameter values\nHTML_text_widgetR = widgets.HTML(value='<b>Resource characteristics: </b>')\nRpars_phyto1=widgets.FloatText(value=1.5,width=5,description = r\"$Phyto_1$\")\nRpars_phyto2=widgets.FloatText(value=1.,width=5,description = r\"$Phyto_2$\")\nRpars_phyto3=widgets.FloatText(value=1.,width=5,description = r\"$Phyto_3$\")\nRpars_phyto4=widgets.FloatText(value=4.,width=5,description = r\"$Phyto_4$\")\nRpars_phyto5=widgets.FloatText(value=1.,width=5,description = r\"$Phyto_5$\")\nRpars_Damb=widgets.FloatText(value=0.01,width=5,description = r\"$D_{amb}$\")\n\nR_0s = widgets.VBox([Rpars_phyto1,Rpars_phyto4])\nR_0s.layout.align_items = 'flex-end'\nR_1s = widgets.VBox([Rpars_phyto2,Rpars_phyto5])\nR_1s.layout.align_items = 'flex-end'\nR_2s = widgets.VBox([Rpars_phyto3,Rpars_Damb])\nR_2s.layout.align_items = 'flex-end'\nR_012s = widgets.HBox([R_0s,R_1s,R_2s])\n\ndef set_Rpars(phyto1,phyto2,phyto3,phyto4,phyto5,Damb):\n    global Rdict\n    Rdict.update({'phyto1':phyto1,'phyto2':phyto2,'phyto3':phyto3,\n              'phyto4':phyto4,'phyto5':phyto5,'Damb':Damb})\n\noutR = widgets.interactive_output(set_Rpars,{'phyto1':Rpars_phyto1,'phyto2':Rpars_phyto2,'phyto3':Rpars_phyto3,\n                                             'phyto4':Rpars_phyto4,'phyto5':Rpars_phyto5,'Damb':Rpars_Damb})\nwidgets.VBox([HTML_text_widgetR,widgets.HBox([R_012s,outR])])\n\n\n\n\n\n# Populate an input-driven dictionary of parameters for consumer 1\nglobal C1dict\nC1dict = {}\n# Set up input boxes for parameter values\nHTML_text_widgetC1 = widgets.HTML(value='<b>Consumer 1 characteristics: </b>')\nC1pars_Fr=widgets.FloatText(value=0.1,description = r\"Frost num., $Fr$\",style=style)\nC1pars_Le=widgets.FloatText(value=1.,description = r\"Lessard num., $Le$\",style=style)\nC1pars_Str=widgets.FloatText(value=0.4,width=5,description = r\"Strathmann num., $Str$\",style=style)\nC1pars_N=widgets.FloatText(value=1.,width=5,description = r\"Init. Density, $N$\",style=style)\nC1pars_alpha1=widgets.FloatText(value=0.,width=5,description = r\"$\\alpha_1$\",style=style)\nC1pars_alpha4=widgets.FloatText(value=0.667,width=5,description = r\"$\\alpha_4$\",style=style)\nC1pars_sighat=widgets.FloatText(value=2.,width=5,description = r\"$\\hat{\\sigma}$\",style=style)\nC1pars_psi=widgets.FloatText(value=-0.5,width=5,description = r\"Directional pers., $\\psi$\",style=style)\n\nC1_0s = widgets.VBox([C1pars_Fr,C1pars_N,C1pars_sighat])\nC1_0s.layout.align_items = 'flex-end'\nC1_1s = widgets.VBox([C1pars_Str,C1pars_alpha1,C1pars_psi])\nC1_1s.layout.align_items = 'flex-end'\nC1_2s = widgets.VBox([C1pars_Le,C1pars_alpha4])\nC1_2s.layout.align_items = 'flex-end'\nC1_012s = widgets.HBox([C1_0s,C1_1s,C1_2s])\n\ndef set_C1pars(Fr,Str,Le,N,alpha1,alpha4,sigma_hat,psi):\n    global C1dict\n    C1dict.update({'Fr':Fr,'Str':Str,'Le':Le,'N':N,'alpha1':alpha1,'alpha4':alpha4,'sigma_hat':sigma_hat,'psi':psi})\n\noutC1 = widgets.interactive_output(set_C1pars,{'Fr':C1pars_Fr,'Str':C1pars_Str,'Le':C1pars_Le,\n                                               'N':C1pars_N,'alpha1':C1pars_alpha1,'alpha4':C1pars_alpha4,\n                                               'sigma_hat':C1pars_sighat,'psi':C1pars_psi})\nwidgets.VBox([HTML_text_widgetC1,widgets.HBox([C1_012s,outC1])])\n\n\n\n\n\n# Populate an input-driven dictionary of parameters for consumer 2\nglobal C2dict\nC2dict = {}\n# Set up input boxes for parameter values\nHTML_text_widgetC2 = widgets.HTML(value='<b>Consumer 2 characteristics: </b>')\nC2pars_Fr=widgets.FloatText(value=1.,description = r\"Frost num., $Fr$\",style=style)\nC2pars_Le=widgets.FloatText(value=1.,description = r\"Lessard num., $Le$\",style=style)\nC2pars_Str=widgets.FloatText(value=0.2,width=5,description = r\"Strathmann num., $Str$\",style=style)\nC2pars_N=widgets.FloatText(value=1.,width=5,description = r\"Init. Density, $N$\",style=style)\nC2pars_alpha1=widgets.FloatText(value=0.,width=5,description = r\"$\\alpha_1$\",style=style)\nC2pars_alpha4=widgets.FloatText(value=0.667,width=5,description = r\"$\\alpha_4$\",style=style)\nC2pars_sighat=widgets.FloatText(value=2.,width=5,description = r\"$\\hat{\\sigma}$\",style=style)\nC2pars_psi=widgets.FloatText(value=-0.5,width=5,description = r\"Directional pers., $\\psi$\",style=style)\n\nC2_0s = widgets.VBox([C2pars_Fr,C2pars_N,C2pars_sighat])\nC2_0s.layout.align_items = 'flex-end'\nC2_1s = widgets.VBox([C2pars_Str,C2pars_alpha1,C2pars_psi])\nC2_1s.layout.align_items = 'flex-end'\nC2_2s = widgets.VBox([C2pars_Le,C2pars_alpha4])\nC2_2s.layout.align_items = 'flex-end'\nC2_012s = widgets.HBox([C2_0s,C2_1s,C2_2s])\n\ndef set_C2pars(Fr,Str,Le,N,alpha1,alpha4,sigma_hat,psi):\n    global C2dict\n    C2dict.update({'Fr':Fr,'Str':Str,'Le':Le,'N':N,'alpha1':alpha1,'alpha4':alpha4,'sigma_hat':sigma_hat,'psi':psi})\n\noutC2 = widgets.interactive_output(set_C2pars,{'Fr':C2pars_Fr,'Str':C2pars_Str,'Le':C2pars_Le,\n                                               'N':C2pars_N,'alpha1':C2pars_alpha1,'alpha4':C2pars_alpha4,\n                                               'sigma_hat':C2pars_sighat,'psi':C2pars_psi})\nwidgets.VBox([HTML_text_widgetC2,widgets.HBox([C2_012s,outC2])])\n\n\n\n\n\n# Populate an input-driven dictionary of parameters for consumer 3\nglobal C3dict\nC3dict = {}\n# Set up input boxes for parameter values\nHTML_text_widgetC3 = widgets.HTML(value='<b>Consumer 3 characteristics: </b>')\nC3pars_Fr=widgets.FloatText(value=10.,description = r\"Frost num., $Fr$\",style=style)\nC3pars_Le=widgets.FloatText(value=1.,description = r\"Lessard num., $Le$\",style=style)\nC3pars_Str=widgets.FloatText(value=0.1,width=5,description = r\"Strathmann num., $Str$\",style=style)\nC3pars_N=widgets.FloatText(value=1.,width=5,description = r\"Init. Density, $N$\",style=style)\nC3pars_alpha1=widgets.FloatText(value=0.,width=5,description = r\"$\\alpha_1$\",style=style)\nC3pars_alpha4=widgets.FloatText(value=0.667,width=5,description = r\"$\\alpha_4$\",style=style)\nC3pars_sighat=widgets.FloatText(value=2.,width=5,description = r\"$\\hat{\\sigma}$\",style=style)\nC3pars_psi=widgets.FloatText(value=-0.5,width=5,description = r\"Directional pers., $\\psi$\",style=style)\n\nC3_0s = widgets.VBox([C3pars_Fr,C3pars_N,C3pars_sighat])\nC3_0s.layout.align_items = 'flex-end'\nC3_1s = widgets.VBox([C3pars_Str,C3pars_alpha1,C3pars_psi])\nC3_1s.layout.align_items = 'flex-end'\nC3_2s = widgets.VBox([C3pars_Le,C3pars_alpha4])\nC3_2s.layout.align_items = 'flex-end'\nC3_012s = widgets.HBox([C3_0s,C3_1s,C3_2s])\n\ndef set_C3pars(Fr,Str,Le,N,alpha1,alpha4,sigma_hat,psi):\n    global C3dict\n    C3dict.update({'Fr':Fr,'Str':Str,'Le':Le,'N':N,'alpha1':alpha1,'alpha4':alpha4,'sigma_hat':sigma_hat,'psi':psi})\n\noutC3 = widgets.interactive_output(set_C3pars,{'Fr':C3pars_Fr,'Str':C3pars_Str,'Le':C3pars_Le,\n                                               'N':C3pars_N,'alpha1':C3pars_alpha1,'alpha4':C3pars_alpha4,\n                                               'sigma_hat':C3pars_sighat,'psi':C3pars_psi})\nwidgets.VBox([HTML_text_widgetC3,widgets.HBox([C3_012s,outC3])])\n\n\n\n\n\nglobal src_file,srcfile\nsfiles = glob('Sources/Source_FSL5_*.dat')\nout = widgets.Output()\nHTML_text_widget = widgets.HTML(value='<b>Choose a source file: </b>')\nsrcfile = widgets.Select(\n    options=sfiles,\n    value=sfiles[0],\n    rows=len(sfiles),\n    description='',\n    disabled=False\n)\nfslpars.source_file = srcfile.value  # start with the default file\nbuttonE = widgets.Button(\n    description='Choose a source file',\n    disabled=False,\n    button_style='', # 'success', 'info', 'warning', 'danger' or ''\n    tooltip='Load estuary',\n    icon='check', # (FontAwesome names without the `fa-` prefix)\n    style=style\n)\n\ndef on_button_clickedE(b):\n    global fslpars\n    fslpars.source_file = srcfile.value  # use newly selected file\n    fslpars.src_file = open(fslpars.source_file,\"r\")    \n    fslpars.load_source(init=True,verbose=False)\n\nbuttonE.on_click(on_button_clickedE)\n\nwidgets.Box([HTML_text_widget,\n              srcfile,buttonE])\n\n\n\n\n\n# GUI to specify temporal parameters for and run the simulation\nglobal F\n\noutF = widgets.Output()\nHTML_text_widgetF = widgets.HTML(value='<b>Choose simulation parameters: </b>')\n\nFpars_pltint=widgets.FloatText(value='0.5',description = r\"Plot interval\",style=style)\nFpars_statint=widgets.FloatText(value='0.5',description = r\"Statistics interval\",style=style)\nFpars_Tend=widgets.FloatText(value='3',description = r\"Run duration\",style=style)\nFpars_dt=widgets.FloatText(value='0.01',description = r\"Timestep\",style=style)\nFpars_L1=widgets.Checkbox(value=True,description = r\"Include variant 1\",style=style)\nFpars_L2=widgets.Checkbox(value=True,description = r\"Include variant 2\",style=style)\nFpars_L3=widgets.Checkbox(value=True,description = r\"Include variant 3\",style=style)\n\nbuttonU = widgets.ToggleButton(\n    value=False,\n    description='Update parameters',\n    disabled=False,\n    button_style='', # 'success', 'info', 'warning', 'danger' or ''\n    tooltip='Click to implement parameter changes.',\n    icon='' # (FontAwesome names without the `fa-` prefix)\n)\n\nF_0s = widgets.VBox([Fpars_Tend,Fpars_pltint,Fpars_dt,Fpars_statint])\nF_0s.layout.align_items = 'flex-end'\nF_1s = widgets.VBox([Fpars_L1,Fpars_L2,Fpars_L3,buttonU])\nF_1s.layout.align_items = 'flex-end'\nF_01s = widgets.HBox([F_0s,F_1s])\n\ndef set_Fpars(Tend,dt,pltint,statint,useL1,useL2,useL3,up):\n    global fslpars,Rdict,C3dict,C2dict,C3dict\n    # temporal parameters\n    fslpars.endTime=Tend\n    fslpars.dt = dt\n    fslpars.plotInterval = pltint\n    fslpars.seriesInterval = statint\n    # reset consumer parameters, then load as requested\n    fslpars.Fr = []\n    fslpars.Str = []\n    fslpars.Le = []\n    fslpars.N = []\n    fslpars.alpha1 = []\n    fslpars.alpha4 = []\n    fslpars.sigma_hat = []\n    fslpars.psi = []\n    Cdicts = [C1dict,C2dict,C3dict]\n    us = [useL1,useL2,useL3]\n    for i,u in enumerate(us):\n        if u:\n            fslpars.Fr += [Cdicts[i]['Fr']]\n            fslpars.Str += [Cdicts[i]['Str']]\n            fslpars.Le += [Cdicts[i]['Le']]\n            fslpars.N += [Cdicts[i]['N']]\n            fslpars.alpha1 += [Cdicts[i]['alpha1']]\n            fslpars.alpha4 += [Cdicts[i]['alpha4']]\n            fslpars.sigma_hat += [Cdicts[i]['sigma_hat']]\n            fslpars.psi += [Cdicts[i]['psi']]\n    fslpars.M = len(fslpars.Fr)\n    # load resource parameters\n    fslpars.__dict__.update(Rdict)\n\noutf4 = widgets.interactive_output(set_Fpars,{'Tend':Fpars_Tend,'dt':Fpars_dt,\n                                              'pltint':Fpars_pltint,'statint':Fpars_statint,\n                                              'useL1':Fpars_L1,'useL2':Fpars_L2,'useL3':Fpars_L3,'up':buttonU})\n\nwidgets.VBox([HTML_text_widgetF,F_01s,outf4])\n\n\n\n\n\nbuttonF = widgets.Button(\n    description='Run simulation',\n    disabled=False,\n    button_style='', # 'success', 'info', 'warning', 'danger' or ''\n    tooltip='Click to run simulation using current parameters.',\n    icon='' # (FontAwesome names without the `fa-` prefix)\n)\n\n\noutputF = widgets.Output()\n@outputF.capture()\ndef on_button_clickedF(b):\n    global F,fslpars\n    F = FSL2Dsim(pars=fslpars,plot_mode='ipynb',verbose=False,figsize=(12,11))\n    #F = FSL1Dsim(input_file='tmp3_0.01_1_10_2_2.inp',plot_mode='ipynb')\n    F.setup()\n    F.halt = False\n    with plt.ioff():\n        F.run()\nbuttonF.on_click(on_button_clickedF)\nwidgets.VBox([buttonF,outputF])\n\n\n\n\n\n#F.halt = True\n\n","type":"content","url":"/fsl2d","position":1},{"hierarchy":{"lvl1":""},"type":"lvl1","url":"/wolfsheeppersist","position":0},{"hierarchy":{"lvl1":""},"content":"import math\nimport ipywidgets as widgets\nfrom agents import GrassPatch, Sheep, Wolf\nfrom mesa import Model\nfrom mesa.datacollection import DataCollector\nfrom mesa.discrete_space import OrthogonalVonNeumannGrid\nfrom mesa.experimental.devs import ABMSimulator\nfrom mesa.visualization import (\n    CommandConsole,\n    Slider,\n    SolaraViz,\n    SpaceRenderer,\n    make_plot_component,\n)\nfrom mesa.visualization.components import AgentPortrayalStyle\n\n\n\nLabelGrid = widgets.Label(value=r\"\\(\\textbf{Grid Properties}\\)\",\n                         layout=widgets.Layout(display=\"flex\", \n                                               #justify_content=\"center\", \n                                               width=\"100%\"))\nmark_size=widgets.FloatText(value=50,width=20,description = r\"Marker Size\")\ngrid_width=widgets.FloatText(value=20,description = \"Width\")\ngrid_height=widgets.FloatText(value=20,description = \"Height\")\n\nui1 = widgets.VBox([LabelGrid,mark_size,grid_width,grid_height])\ndisplay(ui1)\n\n\n\n\n\n\n\ndef wolf_sheep_portrayal(agent,marker_size=int(mark_size.value)):\n    if agent is None:\n        return\n\n    portrayal = AgentPortrayalStyle(\n        size=marker_size,\n        marker=\"o\",\n        zorder=2,\n    )\n\n    if isinstance(agent, Wolf):\n        portrayal.update((\"color\", \"black\"))\n    elif isinstance(agent, Sheep):\n        portrayal.update((\"color\", \"white\"))\n    elif isinstance(agent, GrassPatch):\n        if agent.fully_grown:\n            portrayal.update((\"color\", \"tab:green\"))\n        else:\n            portrayal.update((\"color\", \"tab:brown\"))\n        portrayal.update((\"marker\", \"s\"), (\"size\", 125), (\"zorder\", 1))\n\n    return portrayal\n\n\nmodel_params = {\n    \"seed\": {\n        \"type\": \"InputText\",\n        \"value\": 42,\n        \"label\": \"Random Seed\",\n    },\n    \"grass\": {\n        \"type\": \"Select\",\n        \"value\": True,\n        \"values\": [True, False],\n        \"label\": \"grass regrowth enabled?\",\n    },\n    \"grass_regrowth_time\": Slider(\"Grass Regrowth Time\", 20, 1, 50),\n    \"initial_sheep\": Slider(\"Initial Sheep Population\", 100, 10, 300),\n    \"sheep_reproduce\": Slider(\"Sheep Reproduction Rate\", 0.04, 0.01, 1.0, 0.01),\n    \"initial_wolves\": Slider(\"Initial Wolf Population\", 10, 5, 100),\n    \"wolf_reproduce\": Slider(\n        \"Wolf Reproduction Rate\",\n        0.05,\n        0.01,\n        1.0,\n        0.01,\n    ),\n    \"wolf_gain_from_food\": Slider(\"Wolf Gain From Food Rate\", 20, 1, 50),\n    \"sheep_gain_from_food\": Slider(\"Sheep Gain From Food\", 4, 1, 10),\n}\n\n\ndef post_process_space(ax):\n    ax.set_aspect(\"equal\")\n    ax.set_xticks([])\n    ax.set_yticks([])\n\n\ndef post_process_lines(ax):\n    ax.legend(loc=\"center left\", bbox_to_anchor=(1, 0.9))\n\n\nlineplot_component = make_plot_component(\n    {\"Wolves\": \"black\", \"Sheep\": \"tab:gray\", \"Grass\": \"tab:green\"},\n    post_process=post_process_lines,\n)\n\nclass WolfSheep(Model):\n    \"\"\"Wolf-Sheep Predation Model.\n\n    A model for simulating wolf and sheep (predator-prey) ecosystem modelling.\n    \"\"\"\n\n    description = (\n        \"A model for simulating wolf and sheep (predator-prey) ecosystem modelling.\"\n    )\n\n    def __init__(\n        self,\n        width=int(grid_height.value),\n        height=int(grid_width.value),\n        initial_sheep=100,\n        initial_wolves=50,\n        sheep_reproduce=0.04,\n        wolf_reproduce=0.05,\n        wolf_gain_from_food=20,\n        grass=True,\n        grass_regrowth_time=30,\n        sheep_gain_from_food=4,\n        seed=None,\n        simulator: ABMSimulator = None,\n    ):\n        \"\"\"Create a new Wolf-Sheep model with the given parameters.\n\n        Args:\n            height: Height of the grid\n            width: Width of the grid\n            initial_sheep: Number of sheep to start with\n            initial_wolves: Number of wolves to start with\n            sheep_reproduce: Probability of each sheep reproducing each step\n            wolf_reproduce: Probability of each wolf reproducing each step\n            wolf_gain_from_food: Energy a wolf gains from eating a sheep\n            grass: Whether to have the sheep eat grass for energy\n            grass_regrowth_time: How long it takes for a grass patch to regrow\n                                once it is eaten\n            sheep_gain_from_food: Energy sheep gain from grass, if enabled\n            seed: Random seed\n            simulator: ABMSimulator instance for event scheduling\n        \"\"\"\n        super().__init__(seed=seed)\n        self.simulator = simulator\n        self.simulator.setup(self)\n\n        # Initialize model parameters\n        self.height = height\n        self.width = width\n        self.grass = grass\n\n        # Create grid using experimental cell space\n        self.grid = OrthogonalVonNeumannGrid(\n            [self.height, self.width],\n            torus=True,\n            capacity=math.inf,\n            random=self.random,\n        )\n\n        # Set up data collection\n        model_reporters = {\n            \"Wolves\": lambda m: len(m.agents_by_type[Wolf]),\n            \"Sheep\": lambda m: len(m.agents_by_type[Sheep]),\n        }\n        if grass:\n            model_reporters[\"Grass\"] = lambda m: len(\n                m.agents_by_type[GrassPatch].select(lambda a: a.fully_grown)\n            )\n\n        self.datacollector = DataCollector(model_reporters)\n\n        # Create sheep:\n        Sheep.create_agents(\n            self,\n            initial_sheep,\n            energy=self.rng.random((initial_sheep,)) * 2 * sheep_gain_from_food,\n            p_reproduce=sheep_reproduce,\n            energy_from_food=sheep_gain_from_food,\n            cell=self.random.choices(self.grid.all_cells.cells, k=initial_sheep),\n        )\n        # Create Wolves:\n        Wolf.create_agents(\n            self,\n            initial_wolves,\n            energy=self.rng.random((initial_wolves,)) * 2 * wolf_gain_from_food,\n            p_reproduce=wolf_reproduce,\n            energy_from_food=wolf_gain_from_food,\n            cell=self.random.choices(self.grid.all_cells.cells, k=initial_wolves),\n        )\n\n        # Create grass patches if enabled\n        if grass:\n            possibly_fully_grown = [True, False]\n            for cell in self.grid:\n                fully_grown = self.random.choice(possibly_fully_grown)\n                countdown = (\n                    0 if fully_grown else self.random.randrange(0, grass_regrowth_time)\n                )\n                GrassPatch(self, countdown, grass_regrowth_time, cell)\n\n        # Collect initial data\n        self.running = True\n        self.datacollector.collect(self)\n\n    def step(self):\n        \"\"\"Execute one step of the model.\"\"\"\n        # First activate all sheep, then all wolves, both in random order\n        self.agents_by_type[Sheep].shuffle_do(\"step\")\n        self.agents_by_type[Wolf].shuffle_do(\"step\")\n\n        # Collect data\n        self.datacollector.collect(self)\n\n\nsimulator = ABMSimulator()\n# NOTE: the width and height arguments in SolaraViz appear to be reversed in their effect on the displayed grid\n#wolfsheep = WolfSheep(simulator=simulator, grass=True,width=int(grid_height.value),height=int(grid_width.value))\n#model = wolfsheep()\nmodel = WolfSheep(simulator=simulator, grass=True)\n\n#class WolfSheep2(WolfSheep):\n#    def __init__(self):\n#        super().__init__(simulator=simulator, grass=True,width=int(grid_height.value),height=int(grid_width.value))\n#        pass\n#model = WolfSheep()\n\nrenderer = SpaceRenderer(\n    model,\n    backend=\"matplotlib\",\n)\nrenderer.draw_agents(wolf_sheep_portrayal)\nrenderer.post_process = post_process_space\n\npage = SolaraViz(\n    model,\n    renderer,\n    components=[lineplot_component, CommandConsole],\n    model_params=model_params,\n    name=\"Wolf Sheep\",\n    simulator=simulator,\n)\npage  # noqa\n\n","type":"content","url":"/wolfsheeppersist","position":1}]}